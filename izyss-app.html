<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IZYSS — Plateforme IA Intérim</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
/* ===== GLOBAL VARS ===== */
:root {
  --bg: #F4F6FB;
  --surface: #FFFFFF;
  --surface-hover: #F8F9FD;
  --border: #E8ECF4;
  --border-light: #F0F2F8;
  --text-primary: #1A1D2E;
  --text-secondary: #6B7294;
  --text-tertiary: #9CA3C4;
  --accent: #6C5CE7;
  --accent-light: #A29BFE;
  --accent-bg: #F0EEFF;
  --accent-glow: rgba(108, 92, 231, 0.12);
  --blue: #4A90D9;
  --blue-bg: #EBF3FC;
  --green: #2ECC71;
  --green-bg: #E8F8F0;
  --orange: #F39C12;
  --orange-bg: #FEF5E7;
  --red: #E74C3C;
  --red-bg: #FDECEB;
  --sidebar-w: 260px;
  --header-h: 72px;
  --radius: 16px;
  --radius-sm: 10px;
  --shadow-sm: 0 1px 3px rgba(26,29,46,0.04);
  --shadow-md: 0 4px 20px rgba(26,29,46,0.06);
  --shadow-lg: 0 8px 40px rgba(26,29,46,0.08);
  --shadow-accent: 0 4px 24px rgba(108,92,231,0.18);
  --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'DM Sans', -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text-primary);
  overflow-x: hidden;
}

/* ===== MASTER SIDEBAR ===== */
.sidebar {
  position: fixed; left: 0; top: 0; bottom: 0;
  width: var(--sidebar-w);
  background: var(--surface);
  border-right: 1px solid var(--border);
  display: flex; flex-direction: column; z-index: 100;
}
.sidebar-logo {
  padding: 24px 28px;
  display: flex; align-items: center; gap: 12px;
  border-bottom: 1px solid var(--border-light);
}
.logo-icon {
  width: 40px; height: 40px;
  background: linear-gradient(135deg, var(--accent), var(--accent-light));
  border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  color: white; font-family: 'Space Mono', monospace; font-weight: 700; font-size: 16px;
  box-shadow: var(--shadow-accent);
}
.logo-text {
  font-size: 20px; font-weight: 700; letter-spacing: -0.5px;
  background: linear-gradient(135deg, var(--accent), var(--blue));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
.sidebar-nav { flex: 1; padding: 20px 16px; display: flex; flex-direction: column; gap: 4px; overflow-y: auto; }
.nav-section-label {
  font-size: 10px; font-weight: 600; text-transform: uppercase;
  letter-spacing: 1.2px; color: var(--text-tertiary); padding: 16px 12px 8px;
}
.nav-item {
  display: flex; align-items: center; gap: 12px; padding: 11px 14px;
  border-radius: var(--radius-sm); cursor: pointer; transition: var(--transition);
  font-size: 14px; font-weight: 500; color: var(--text-secondary);
  position: relative; text-decoration: none; user-select: none;
}
.nav-item:hover { background: var(--surface-hover); color: var(--text-primary); }
.nav-item.active { background: var(--accent-bg); color: var(--accent); font-weight: 600; }
.nav-item.active::before {
  content: ''; position: absolute; left: -16px; top: 50%; transform: translateY(-50%);
  width: 3px; height: 24px; background: var(--accent); border-radius: 0 4px 4px 0;
}
.nav-icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.nav-badge { margin-left: auto; background: var(--accent); color: white; font-size: 11px; font-weight: 600; padding: 2px 8px; border-radius: 20px; }
.sidebar-footer { padding: 16px; border-top: 1px solid var(--border-light); }
.agency-card { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: var(--radius-sm); background: var(--surface-hover); }
.agency-avatar { width: 36px; height: 36px; background: linear-gradient(135deg, #FF6B6B, #FFA07A); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 13px; }
.agency-info { flex: 1; }
.agency-name { font-size: 13px; font-weight: 600; }
.agency-role { font-size: 11px; color: var(--text-tertiary); }

/* Page sections - hidden by default */
.page-section { display: none; }
.page-section.active { display: block; }

/* Placeholder pages */
.placeholder-page {
  display: flex; align-items: center; justify-content: center; min-height: 80vh; text-align: center;
}

::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }
::-webkit-scrollbar-thumb:hover { background: var(--text-tertiary); }

/* ========================================== */
/* SCORING PAGE STYLES                        */
/* ========================================== */
.scoring-layout {
  display: grid;
  grid-template-columns: 380px 1fr;
  gap: 24px;
  align-items: start;
}

.card-subtitle {
  font-size: 12px;
  color: var(--text-secondary);
  margin-top: 2px;
}

.total-bar {
  padding: 16px 24px;
  background: linear-gradient(135deg, rgba(108,92,231,0.04), rgba(74,144,217,0.04));
  border-bottom: 1px solid var(--border-light);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.total-label {
  font-size: 13px;
  font-weight: 600;
  color: var(--text-secondary);
}

.total-value {
  font-family: 'Space Mono', monospace;
  font-size: 22px;
  font-weight: 700;
  transition: var(--transition);
}

.total-value.valid { color: var(--green); }
.total-value.warning { color: var(--orange); }
.total-value.over { color: var(--red); }

.total-target {
  font-size: 12px;
  color: var(--text-tertiary);
  margin-left: 4px;
  font-family: 'DM Sans', sans-serif;
  font-weight: 500;
}

.total-progress {
  width: 100%;
  height: 6px;
  background: var(--bg);
  border-radius: 10px;
  margin-top: 10px;
  overflow: hidden;
}

.total-progress-fill {
  height: 100%;
  border-radius: 10px;
  transition: width 0.4s ease, background 0.3s ease;
}

.criteria-section {
  padding: 16px 24px 8px;
}

.criteria-section-title {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-tertiary);
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.criteria-section-title::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border-light);
}

.criterion {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 14px;
  border-radius: var(--radius-sm);
  margin-bottom: 6px;
  transition: var(--transition);
  cursor: default;
  border: 1px solid transparent;
}

.criterion:hover {
  background: var(--surface-hover);
  border-color: var(--border-light);
}

.criterion-toggle {
  position: relative;
  width: 38px;
  height: 22px;
  flex-shrink: 0;
}

.criterion-toggle input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background: var(--border);
  border-radius: 22px;
  transition: var(--transition);
}

.toggle-slider::before {
  content: '';
  position: absolute;
  height: 16px;
  width: 16px;
  left: 3px;
  bottom: 3px;
  background: white;
  border-radius: 50%;
  transition: var(--transition);
  box-shadow: 0 1px 3px rgba(0,0,0,0.15);
}

.criterion-toggle input:checked + .toggle-slider {
  background: var(--accent);
}

.criterion-toggle input:checked + .toggle-slider::before {
  transform: translateX(16px);
}

.criterion-icon {
  width: 32px; height: 32px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 15px;
  flex-shrink: 0;
}

.criterion-info {
  flex: 1;
  min-width: 0;
}

.criterion-name {
  font-size: 13.5px;
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.criterion-desc {
  font-size: 11.5px;
  color: var(--text-tertiary);
  margin-top: 1px;
}

.criterion-points {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-shrink: 0;
}

.points-btn {
  width: 28px; height: 28px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--surface);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 16px;
  color: var(--text-secondary);
  transition: var(--transition);
  font-weight: 600;
  user-select: none;
}

.points-btn:hover {
  border-color: var(--accent);
  color: var(--accent);
  background: var(--accent-bg);
}

.points-btn:active {
  transform: scale(0.92);
}

.points-value {
  font-family: 'Space Mono', monospace;
  font-size: 16px;
  font-weight: 700;
  min-width: 36px;
  text-align: center;
  color: var(--accent);
}

.points-value.disabled {
  color: var(--text-tertiary);
}

.add-criterion-area {
  padding: 12px 24px 20px;
}

.add-criterion-btn {
  width: 100%;
  padding: 12px;
  border: 2px dashed var(--border);
  border-radius: var(--radius-sm);
  background: transparent;
  font-family: inherit;
  font-size: 13px;
  font-weight: 600;
  color: var(--text-tertiary);
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.add-criterion-btn:hover {
  border-color: var(--accent);
  color: var(--accent);
  background: var(--accent-bg);
}

.add-form {
  display: none;
  flex-direction: column;
  gap: 10px;
  padding: 16px;
  background: var(--surface-hover);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-light);
}

.add-form.show { display: flex; }

.add-form input {
  padding: 10px 14px;
  border: 1px solid var(--border);
  border-radius: 8px;
  font-family: inherit;
  font-size: 13px;
  outline: none;
  transition: var(--transition);
}

.add-form input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
}

.add-form-actions {
  display: flex;
  gap: 8px;
}

.btn-primary {
  padding: 9px 18px;
  background: linear-gradient(135deg, var(--accent), #8B7CF6);
  color: white;
  border: none;
  border-radius: 8px;
  font-family: inherit;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
}

.btn-primary:hover {
  box-shadow: var(--shadow-accent);
  transform: translateY(-1px);
}

.btn-secondary {
  padding: 9px 18px;
  background: var(--surface);
  color: var(--text-secondary);
  border: 1px solid var(--border);
  border-radius: 8px;
  font-family: inherit;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
}

.btn-secondary:hover {
  background: var(--bg);
}

.save-bar {
  padding: 16px 24px;
  border-top: 1px solid var(--border-light);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: linear-gradient(135deg, rgba(108,92,231,0.02), rgba(74,144,217,0.02));
}

.save-info {
  font-size: 12px;
  color: var(--text-tertiary);
  display: flex;
  align-items: center;
  gap: 6px;
}

.save-btn {
  padding: 10px 24px;
  background: linear-gradient(135deg, var(--accent), #8B7CF6);
  color: white;
  border: none;
  border-radius: var(--radius-sm);
  font-family: inherit;
  font-size: 13.5px;
  font-weight: 700;
  cursor: pointer;
  transition: var(--transition);
  box-shadow: var(--shadow-accent);
  display: flex;
  align-items: center;
  gap: 8px;
}

.save-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 28px rgba(108,92,231,0.3);
}

.results-filters {
  display: flex;
  gap: 8px;
}

.filter-chip {
  padding: 6px 14px;
  border: 1px solid var(--border);
  border-radius: 20px;
  font-size: 12px;
  font-weight: 500;
  color: var(--text-secondary);
  cursor: pointer;
  transition: var(--transition);
  background: var(--surface);
}

.filter-chip:hover, .filter-chip.active {
  border-color: var(--accent);
  color: var(--accent);
  background: var(--accent-bg);
}

.cv-table {
  width: 100%;
}

.cv-table th {
  text-align: left;
  padding: 12px 20px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  color: var(--text-tertiary);
  background: var(--surface-hover);
  border-bottom: 1px solid var(--border-light);
}

.cv-table td {
  padding: 16px 20px;
  font-size: 13.5px;
  border-bottom: 1px solid var(--border-light);
  vertical-align: middle;
}

.cv-table tr {
  transition: var(--transition);
  cursor: pointer;
}

.cv-table tbody tr:hover td {
  background: var(--surface-hover);
}

.cv-table tr:last-child td { border-bottom: none; }

.candidate-cell {
  display: flex;
  align-items: center;
  gap: 12px;
}

.candidate-avatar {
  width: 38px; height: 38px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 13px;
  color: white;
  flex-shrink: 0;
}

.candidate-name { font-weight: 600; }
.candidate-sub { font-size: 12px; color: var(--text-tertiary); margin-top: 1px; }

.score-ring {
  position: relative;
  width: 52px; height: 52px;
}

.score-ring svg {
  transform: rotate(-90deg);
  width: 52px; height: 52px;
}

.score-ring-bg {
  fill: none;
  stroke: var(--bg);
  stroke-width: 4;
}

.score-ring-fill {
  fill: none;
  stroke-width: 4;
  stroke-linecap: round;
  transition: stroke-dashoffset 1s ease, stroke 0.3s ease;
}

.score-ring-text {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'Space Mono', monospace;
  font-size: 13px;
  font-weight: 700;
}

.score-breakdown {
  display: flex;
  flex-direction: column;
  gap: 4px;
  min-width: 180px;
}

.breakdown-row {
  display: flex;
  align-items: center;
  gap: 8px;
}

.breakdown-label {
  font-size: 11px;
  color: var(--text-tertiary);
  min-width: 70px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.breakdown-track {
  flex: 1;
  height: 4px;
  background: var(--bg);
  border-radius: 10px;
  overflow: hidden;
}

.breakdown-fill {
  height: 100%;
  border-radius: 10px;
  transition: width 0.8s ease;
}

.breakdown-pts {
  font-size: 11px;
  font-family: 'Space Mono', monospace;
  font-weight: 700;
  min-width: 28px;
  text-align: right;
}
/* Scoring — Upload CV */
.sc-upload-area{margin:0 20px 20px;padding:18px;border:2px dashed var(--border);border-radius:var(--radius-sm);cursor:pointer;transition:var(--transition);text-align:center;}
.sc-upload-area:hover{border-color:var(--accent);background:var(--accent-bg);}
.sc-upload-title{font-size:13px;font-weight:700;color:var(--text-secondary);margin-top:8px;}
.sc-upload-sub{font-size:11.5px;color:var(--text-tertiary);margin-top:3px;}
.sc-upload-progress{margin-top:10px;height:4px;background:var(--bg);border-radius:10px;overflow:hidden;display:none;}
.sc-upload-progress-fill{height:100%;background:linear-gradient(90deg,var(--accent),#8B7CF6);border-radius:10px;width:0;transition:width 0.3s ease;}
/* Scoring — Cartes candidats */
.sc-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:16px;padding:0 20px 20px;}
.sc-card{background:var(--surface);border:1.5px solid var(--border);border-radius:16px;overflow:hidden;transition:var(--transition);animation:fadeUp 0.35s ease backwards;}
.sc-card:hover{box-shadow:var(--shadow-md);transform:translateY(-2px);border-color:rgba(108,92,231,0.15);}
.sc-score-bar{height:3px;width:100%;}
.sc-score-bar i{display:block;height:100%;transition:width 0.8s ease;}
.sc-card-body{padding:16px 16px 12px;display:flex;gap:12px;align-items:flex-start;}
.sc-avatar{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:15px;color:#fff;flex-shrink:0;}
.sc-info{flex:1;min-width:0;}
.sc-name{font-size:14px;font-weight:800;color:var(--text-primary);}
.sc-sub{font-size:11.5px;color:var(--text-secondary);margin-top:2px;}
.sc-status{display:inline-flex;align-items:center;gap:5px;margin-top:8px;padding:3px 10px;border-radius:20px;font-size:11px;font-weight:700;}
.sc-status.available{background:var(--green-bg);color:var(--green);}
.sc-status.pending{background:var(--orange-bg);color:var(--orange);}
.sc-status.placed{background:var(--blue-bg);color:var(--blue);}
.sc-ring-wrap{display:flex;flex-direction:column;align-items:center;gap:3px;flex-shrink:0;}
.sc-ring{position:relative;width:52px;height:52px;}
.sc-ring svg{transform:rotate(-90deg);width:52px;height:52px;}
.sc-ring-bg{fill:none;stroke:var(--bg);stroke-width:4.5;}
.sc-ring-fg{fill:none;stroke-width:4.5;stroke-linecap:round;transition:stroke-dashoffset 1s ease;}
.sc-ring-t{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-family:'Space Mono',monospace;font-size:13px;font-weight:700;}
.sc-ring-l{font-size:9px;color:var(--text-tertiary);font-weight:600;text-transform:uppercase;letter-spacing:0.4px;}
.sc-breakdown{padding:0 16px 12px;display:flex;flex-direction:column;gap:5px;}
.sc-act{padding:10px 16px;border-top:1px solid var(--border-light);display:flex;gap:8px;}
.sc-act-btn{flex:1;padding:8px;border-radius:9px;border:1.5px solid var(--border);background:var(--surface);font-family:inherit;font-size:12px;font-weight:700;color:var(--text-secondary);cursor:pointer;transition:var(--transition);}
.sc-act-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.sc-act-btn.primary{background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;border-color:transparent;}
.sc-act-btn.primary:hover{transform:translateY(-1px);box-shadow:var(--shadow-accent);}
/* Scoring — card layout v2 */
.sc-card-top{padding:16px;display:flex;gap:12px;align-items:flex-start;}
.sc-card-avatar{width:44px;height:44px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:15px;color:#fff;flex-shrink:0;}
.sc-card-info{flex:1;min-width:0;}
.sc-card-name{font-size:14px;font-weight:800;color:var(--text-primary);}
.sc-card-sub{font-size:11.5px;color:var(--text-secondary);margin-top:2px;}
.sc-ring-wrap{position:relative;display:inline-flex;align-items:center;justify-content:center;flex-shrink:0;}
.sc-ring-text{position:absolute;font-family:'Space Mono',monospace;font-size:12px;font-weight:700;}
.sc-bars{padding:0 16px 12px;display:flex;flex-direction:column;gap:6px;}
.sc-bar-row{display:flex;align-items:center;gap:8px;}
.sc-bar-label{font-size:11px;color:var(--text-secondary);width:90px;flex-shrink:0;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.sc-bar-track{flex:1;height:4px;background:var(--border);border-radius:4px;overflow:hidden;}
.sc-bar-fill{height:100%;border-radius:4px;transition:width 0.7s ease;}
.sc-bar-pts{font-size:10px;font-weight:700;width:28px;text-align:right;flex-shrink:0;}
.sc-act{padding:10px 16px 14px;border-top:1px solid var(--border-light);display:flex;gap:6px;}
.sc-btn-cv,.sc-btn-contact,.sc-btn-mission{flex:1;display:flex;align-items:center;justify-content:center;gap:5px;padding:8px 6px;border-radius:9px;border:1.5px solid var(--border);background:var(--surface);font-family:inherit;font-size:11.5px;font-weight:700;color:var(--text-secondary);cursor:pointer;transition:var(--transition);}
.sc-btn-cv:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.sc-btn-contact:hover{border-color:var(--green);color:var(--green);background:var(--green-bg);}
.sc-btn-mission{background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;border-color:transparent;}
.sc-btn-mission:hover{transform:translateY(-1px);box-shadow:var(--shadow-accent);}
/* Scoring — Modal proposition client */
.sc-propose-ov{position:fixed;inset:0;background:rgba(15,20,40,0.45);backdrop-filter:blur(4px);z-index:9000;display:none;align-items:center;justify-content:center;}
.sc-propose-ov.open{display:flex;}
.sc-propose-modal{background:var(--surface);border-radius:20px;width:480px;max-width:calc(100vw - 32px);max-height:80vh;display:flex;flex-direction:column;box-shadow:0 24px 64px rgba(15,20,40,0.22);}
.sc-propose-head{padding:20px 24px 16px;border-bottom:1px solid var(--border-light);display:flex;align-items:center;gap:12px;}
.sc-propose-head-icon{width:40px;height:40px;border-radius:12px;background:linear-gradient(135deg,var(--accent),#8B7CF6);display:flex;align-items:center;justify-content:center;flex-shrink:0;}
.sc-propose-head-text{flex:1;min-width:0;}
.sc-propose-title{font-size:15px;font-weight:800;color:var(--text-primary);}
.sc-propose-sub{font-size:12px;color:var(--text-secondary);margin-top:2px;}
.sc-propose-close{width:32px;height:32px;border-radius:50%;border:1.5px solid var(--border);background:transparent;cursor:pointer;display:flex;align-items:center;justify-content:center;color:var(--text-secondary);transition:var(--transition);}
.sc-propose-close:hover{background:var(--bg);color:var(--text-primary);}
.sc-propose-body{flex:1;overflow-y:auto;padding:16px 24px;}
.sc-propose-label{font-size:11px;font-weight:700;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:0.6px;margin-bottom:10px;}
.sc-propose-client{border:1.5px solid var(--border);border-radius:12px;margin-bottom:10px;cursor:pointer;transition:var(--transition);overflow:hidden;}
.sc-propose-client:hover{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-bg);}
.sc-propose-client.selected{border-color:var(--accent);background:var(--accent-bg);}
.sc-propose-client-head{padding:12px 14px;display:flex;align-items:center;gap:10px;}
.sc-propose-client-av{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:12px;color:#fff;flex-shrink:0;}
.sc-propose-client-name{font-size:13px;font-weight:700;color:var(--text-primary);}
.sc-propose-client-missions{font-size:11.5px;color:var(--text-secondary);}
.sc-propose-client-check{margin-left:auto;width:20px;height:20px;border-radius:50%;border:2px solid var(--border);background:var(--bg);transition:var(--transition);}
.sc-propose-client.selected .sc-propose-client-check{background:var(--accent);border-color:var(--accent);display:flex;align-items:center;justify-content:center;}
.sc-propose-missions{padding:0 14px 12px;display:flex;flex-direction:column;gap:6px;}
.sc-propose-mission{padding:8px 10px;background:var(--bg);border-radius:8px;border:1.5px solid transparent;cursor:pointer;transition:var(--transition);}
.sc-propose-mission:hover{border-color:var(--accent);}
.sc-propose-mission.selected{border-color:var(--accent);background:var(--accent-bg);}
.sc-propose-mission-name{font-size:12px;font-weight:700;color:var(--text-primary);}
.sc-propose-mission-date{font-size:11px;color:var(--text-secondary);}
.sc-propose-visibility{padding:12px 24px;border-top:1px solid var(--border-light);}
.sc-propose-visibility-label{font-size:11px;font-weight:700;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:0.6px;margin-bottom:8px;}
.sc-propose-vis-opts{display:flex;gap:8px;}
.sc-propose-vis-opt{flex:1;padding:10px 12px;border:1.5px solid var(--border);border-radius:10px;cursor:pointer;transition:var(--transition);text-align:center;background:var(--surface);}
.sc-propose-vis-opt:hover{border-color:var(--accent);background:var(--accent-bg);}
.sc-propose-vis-opt.on.full{border-color:var(--green);background:var(--green-bg);}
.sc-propose-vis-opt.on.anon{border-color:var(--orange);background:var(--orange-bg);}
.sc-propose-vis-icon{font-size:18px;margin-bottom:3px;}
.sc-propose-vis-title{font-size:11.5px;font-weight:700;}
.sc-propose-vis-opt.on.full .sc-propose-vis-title{color:var(--green);}
.sc-propose-vis-opt.on.anon .sc-propose-vis-title{color:var(--orange);}
.sc-propose-vis-desc{font-size:10px;color:var(--text-tertiary);margin-top:1px;}
.sc-propose-foot{padding:16px 24px;border-top:1px solid var(--border-light);display:flex;gap:10px;}
.sc-propose-cancel{flex:1;padding:11px;border-radius:10px;border:1.5px solid var(--border);background:transparent;font-family:inherit;font-size:13px;font-weight:700;color:var(--text-secondary);cursor:pointer;transition:var(--transition);}
.sc-propose-cancel:hover{background:var(--bg);}
.sc-propose-confirm{flex:2;padding:11px;border-radius:10px;border:none;background:linear-gradient(135deg,var(--accent),#8B7CF6);font-family:inherit;font-size:13px;font-weight:700;color:#fff;cursor:pointer;transition:var(--transition);}
.sc-propose-confirm:hover{transform:translateY(-1px);box-shadow:var(--shadow-accent);}
.sc-propose-confirm:disabled{opacity:0.45;cursor:default;transform:none;box-shadow:none;}
/* Scoring — Résultats header */
.results-header{padding:20px 20px 16px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border-light);}
.sc-empty{display:flex;flex-direction:column;align-items:center;padding:48px 20px;gap:10px;color:var(--text-tertiary);}

.status-badge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.status-badge.available { background: var(--green-bg); color: var(--green); }
.status-badge.pending { background: var(--orange-bg); color: var(--orange); }
.status-badge.placed { background: var(--blue-bg); color: var(--blue); }

.status-dot {
  width: 6px; height: 6px;
  border-radius: 50%;
  background: currentColor;
}

.row-actions {
  display: flex;
  gap: 6px;
}

.row-action-btn {
  width: 32px; height: 32px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--surface);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: var(--text-tertiary);
  transition: var(--transition);
  font-size: 14px;
}

.row-action-btn:hover {
  border-color: var(--accent);
  color: var(--accent);
  background: var(--accent-bg);
}





/* ========================================== */
/* MISSIONS PAGE STYLES                       */
/* ========================================== */
#page-missions .ms-toolbar{display:flex;align-items:center;gap:10px;margin-bottom:20px;flex-wrap:wrap;}
#page-missions .ms-search{display:flex;align-items:center;gap:8px;padding:9px 18px;border-radius:50px;border:1.5px solid var(--border);background:var(--surface);transition:var(--transition);min-width:260px;}
#page-missions .ms-search:focus-within{border-color:var(--accent);box-shadow:0 0 0 4px var(--accent-glow);}
#page-missions .ms-search input{border:none;outline:none;font-family:inherit;font-size:13px;width:100%;background:transparent;}
#page-missions .ms-search input::placeholder{color:var(--text-tertiary);}
.ms-pill{padding:8px 16px;border-radius:50px;font-size:12.5px;font-weight:600;cursor:pointer;transition:var(--transition);border:1.5px solid var(--border);background:var(--surface);color:var(--text-secondary);user-select:none;white-space:nowrap;}
.ms-pill:hover{border-color:var(--accent);color:var(--accent);}
.ms-pill.on{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 4px 16px rgba(108,92,231,0.2);}
.ms-toolbar-sep{width:1px;height:28px;background:var(--border);}
.ms-toolbar-right{margin-left:auto;display:flex;gap:8px;}
.ms-view-toggle{display:flex;border:1.5px solid var(--border);border-radius:var(--radius-sm);overflow:hidden;}
.ms-view-btn{padding:8px 14px;cursor:pointer;transition:var(--transition);background:var(--surface);color:var(--text-tertiary);display:flex;align-items:center;gap:5px;font-size:12px;font-weight:600;}
.ms-view-btn:hover{color:var(--accent);}
.ms-view-btn.on{background:var(--accent-bg);color:var(--accent);}
.ms-table-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;animation:fadeUp 0.5s ease backwards;}
.ms-table-card.off{display:none;}
#page-missions .ms-table-card table{width:100%;border-collapse:collapse;font-size:13px;}
#page-missions .ms-table-card thead{background:var(--surface-hover);}
#page-missions .ms-table-card th{padding:12px 16px;text-align:left;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.8px;color:var(--text-tertiary);border-bottom:1px solid var(--border);white-space:nowrap;}
#page-missions .ms-table-card td{padding:14px 16px;border-bottom:1px solid var(--border-light);vertical-align:middle;}
#page-missions .ms-table-card tr{transition:var(--transition);cursor:pointer;}
#page-missions .ms-table-card tbody tr:hover{background:var(--surface-hover);}
#page-missions .ms-table-card tr:last-child td{border-bottom:none;}
.ms-td-mission{display:flex;align-items:center;gap:12px;}
.ms-td-urgency{width:10px;height:10px;border-radius:50%;flex-shrink:0;}
.ms-td-urgency.high{background:var(--red);box-shadow:0 0 8px rgba(231,76,60,0.4);}
.ms-td-urgency.medium{background:var(--orange);box-shadow:0 0 8px rgba(243,156,18,0.4);}
.ms-td-urgency.low{background:var(--green);}
.ms-td-m-info{min-width:0;}
.ms-td-m-title{font-size:14px;font-weight:700;}
.ms-td-m-client{font-size:11.5px;color:var(--text-secondary);}
.ms-td-status{padding:5px 12px;border-radius:20px;font-size:11px;font-weight:700;display:inline-flex;align-items:center;gap:5px;white-space:nowrap;}
.ms-st-open{background:var(--green-bg);color:var(--green);}
.ms-st-progress{background:var(--blue-bg);color:var(--blue);}
.ms-st-urgent{background:var(--red-bg);color:var(--red);}
.ms-st-filled{background:var(--accent-bg);color:var(--accent);}
.ms-st-done{background:var(--surface-hover);color:var(--text-tertiary);}
.ms-td-avatars{display:flex;}
.ms-td-avatars>div{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:10px;color:#fff;margin-left:-6px;border:2px solid var(--surface);}
.ms-td-avatars>div:first-child{margin-left:0;}
.ms-td-plus{background:var(--bg) !important;color:var(--text-tertiary) !important;font-size:10px;}
.ms-td-dates{font-size:12px;color:var(--text-secondary);white-space:nowrap;}
.ms-td-loc{font-size:12px;color:var(--text-secondary);}
.ms-td-match{display:flex;align-items:center;gap:6px;}
.ms-match-num{font-family:'Space Mono',monospace;font-size:14px;font-weight:700;}
.ms-match-bar{width:40px;height:5px;background:var(--border-light);border-radius:10px;overflow:hidden;}
.ms-match-fill{height:100%;border-radius:10px;}
.ms-act-btn{width:30px;height:30px;border-radius:8px;border:1px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--transition);font-size:13px;color:var(--text-tertiary);}
.ms-act-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
/* KANBAN */
.ms-kanban{display:none;grid-template-columns:repeat(4,1fr);gap:16px;align-items:start;}
.ms-kanban.on{display:grid;}
.ms-kb-col{background:var(--surface-hover);border-radius:var(--radius);padding:0;min-height:200px;}
.ms-kb-col-h{padding:16px 18px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);}
.ms-kb-col-title{font-size:13px;font-weight:700;display:flex;align-items:center;gap:8px;}
.ms-kb-col-count{font-size:11px;font-weight:600;padding:2px 8px;border-radius:20px;background:var(--border);color:var(--text-secondary);}
.ms-kb-col-body{padding:12px;display:flex;flex-direction:column;gap:10px;}
.ms-kb-card{background:var(--surface);border:1.5px solid var(--border);border-radius:14px;padding:16px;transition:var(--transition);cursor:pointer;animation:fadeUp 0.4s ease backwards;}
.ms-kb-card:hover{box-shadow:0 6px 24px rgba(26,29,46,0.07);transform:translateY(-3px);border-color:rgba(108,92,231,0.15);}
.ms-kb-top{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.ms-kb-urg{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.ms-kb-title{font-size:13.5px;font-weight:700;flex:1;}
.ms-kb-client{font-size:11.5px;color:var(--text-secondary);margin-bottom:8px;display:flex;align-items:center;gap:4px;}
.ms-kb-meta{display:flex;gap:10px;margin-bottom:10px;flex-wrap:wrap;}
.ms-kb-meta-i{font-size:11px;color:var(--text-tertiary);display:flex;align-items:center;gap:3px;}
.ms-kb-footer{display:flex;align-items:center;justify-content:space-between;padding-top:10px;border-top:1px solid var(--border-light);}
.ms-kb-avatars{display:flex;}
.ms-kb-avatars>div{width:24px;height:24px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:9px;color:#fff;margin-left:-4px;border:2px solid var(--surface);}
.ms-kb-avatars>div:first-child{margin-left:0;}
.ms-kb-match{font-size:11px;font-weight:600;color:var(--accent);display:flex;align-items:center;gap:4px;}
/* DRAWER */
.ms-dov{display:none;position:fixed;inset:0;background:rgba(26,29,46,0.35);backdrop-filter:blur(6px);z-index:300;}
.ms-dov.on{display:block;}
.ms-dw{position:fixed;top:0;right:-600px;bottom:0;width:580px;max-width:94vw;background:var(--surface);z-index:301;transition:right 0.4s cubic-bezier(0.4,0,0.2,1);overflow-y:auto;box-shadow:-20px 0 60px rgba(26,29,46,0.12);}
.ms-dw.on{right:0;}
.ms-dw-head{position:sticky;top:0;z-index:2;background:rgba(255,255,255,0.92);backdrop-filter:blur(16px);padding:20px 28px;border-bottom:1px solid var(--border-light);display:flex;align-items:center;justify-content:space-between;}
.ms-dw-x{width:38px;height:38px;border-radius:10px;border:none;background:var(--bg);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text-secondary);transition:var(--transition);font-size:18px;}
.ms-dw-x:hover{background:var(--red-bg);color:var(--red);}
.ms-dw-body{padding:28px;}
.ms-dw-m-header{margin-bottom:24px;}
.ms-dw-m-title{font-size:22px;font-weight:800;letter-spacing:-0.3px;display:flex;align-items:center;gap:10px;}
.ms-dw-m-client{font-size:14px;color:var(--text-secondary);margin-top:4px;display:flex;align-items:center;gap:6px;}
.ms-dw-m-status{margin-top:10px;}
.ms-dw-quick{display:flex;gap:8px;margin-bottom:24px;}
.ms-dw-qbtn{flex:1;padding:11px;border-radius:var(--radius-sm);border:1.5px solid var(--border);background:var(--surface);font-family:inherit;font-size:12px;font-weight:700;cursor:pointer;transition:var(--transition);display:flex;align-items:center;justify-content:center;gap:6px;color:var(--text-secondary);}
.ms-dw-qbtn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.ms-dw-qbtn.primary{background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;border:none;box-shadow:0 4px 16px rgba(108,92,231,0.2);}
.ms-dw-sec{margin-bottom:24px;}
.ms-dw-sec-t{font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:1.2px;color:var(--text-tertiary);margin-bottom:12px;}
.ms-dw-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.ms-dw-it{padding:12px 16px;background:var(--bg);border-radius:var(--radius-sm);}
.ms-dw-it-l{font-size:11px;color:var(--text-tertiary);}
.ms-dw-it-v{font-size:14px;font-weight:700;margin-top:3px;}
.ms-dw-chips{display:flex;flex-wrap:wrap;gap:6px;}
.ms-tag{padding:3px 10px;border-radius:50px;font-size:11px;font-weight:700;background:var(--green-bg);color:var(--green);}
.ms-dw-cand{display:flex;align-items:center;gap:12px;padding:14px;background:var(--bg);border-radius:var(--radius-sm);margin-bottom:8px;transition:var(--transition);cursor:pointer;}
.ms-dw-cand:hover{background:var(--accent-bg);}
.ms-dw-cand-av{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;color:#fff;flex-shrink:0;}
.ms-dw-cand-info{flex:1;}
.ms-dw-cand-nm{font-size:13px;font-weight:700;}
.ms-dw-cand-rl{font-size:11px;color:var(--text-secondary);}
.ms-dw-cand-status{font-size:11px;font-weight:600;padding:3px 10px;border-radius:20px;flex-shrink:0;}
.ms-h-btn{height:40px;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-sm);border:1px solid var(--border);background:var(--surface);cursor:pointer;transition:var(--transition);color:var(--text-secondary);padding:0 16px;gap:8px;font-family:inherit;font-size:13px;font-weight:600;}
.ms-h-btn:hover{border-color:var(--accent-light);color:var(--accent);background:var(--accent-bg);}
.ms-h-btn-primary{background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;border:none;box-shadow:0 4px 20px rgba(108,92,231,0.2);}
.ms-h-btn-primary:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(108,92,231,0.3);color:#fff;background:linear-gradient(135deg,var(--accent),#8B7CF6);}
.ms-urg-pills{display:flex;gap:8px;}
.ms-urg-pill{padding:8px 16px;border-radius:50px;border:1.5px solid var(--border);background:var(--surface);font-size:12px;font-weight:600;cursor:pointer;transition:var(--transition);display:flex;align-items:center;gap:6px;color:var(--text-secondary);}
.ms-urg-pill:hover{border-color:var(--accent);}
.ms-urg-pill.on.high{border-color:var(--red);background:var(--red-bg);color:var(--red);}
.ms-urg-pill.on.med{border-color:var(--orange);background:var(--orange-bg);color:var(--orange);}
.ms-urg-pill.on.low{border-color:var(--green);background:var(--green-bg);color:var(--green);}
@media(max-width:1100px){.ms-kanban{grid-template-columns:repeat(2,1fr);}}

/* ========================================== */
/* CONTRATS PAGE STYLES                       */
/* ========================================== */
#page-contrats .ct-toolbar{display:flex;align-items:center;gap:10px;margin-bottom:20px;flex-wrap:wrap;}
#page-contrats .ct-search{display:flex;align-items:center;gap:8px;padding:9px 18px;border-radius:50px;border:1.5px solid var(--border);background:var(--surface);transition:var(--transition);min-width:260px;}
#page-contrats .ct-search:focus-within{border-color:var(--accent);box-shadow:0 0 0 4px var(--accent-glow);}
#page-contrats .ct-search input{border:none;outline:none;font-family:inherit;font-size:13px;width:100%;background:transparent;}
#page-contrats .ct-search input::placeholder{color:var(--text-tertiary);}
.ct-pill{padding:8px 16px;border-radius:50px;font-size:12.5px;font-weight:600;cursor:pointer;transition:var(--transition);border:1.5px solid var(--border);background:var(--surface);color:var(--text-secondary);user-select:none;white-space:nowrap;}
.ct-pill:hover{border-color:var(--accent);color:var(--accent);}
.ct-pill.on{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 4px 16px rgba(108,92,231,0.2);}
.ct-tcard{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;animation:fadeUp 0.5s ease backwards;}
#page-contrats .ct-tcard table{width:100%;border-collapse:collapse;font-size:13px;}
#page-contrats .ct-tcard thead{background:var(--surface-hover);}
#page-contrats .ct-tcard th{padding:12px 16px;text-align:left;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.8px;color:var(--text-tertiary);border-bottom:1px solid var(--border);white-space:nowrap;user-select:none;}
#page-contrats .ct-tcard td{padding:14px 16px;border-bottom:1px solid var(--border-light);vertical-align:middle;}
#page-contrats .ct-tcard tr{transition:var(--transition);cursor:pointer;}
#page-contrats .ct-tcard tbody tr:hover{background:var(--surface-hover);}
#page-contrats .ct-tcard tr:last-child td{border-bottom:none;}
.ct-td-c{display:flex;align-items:center;gap:12px;}
.ct-td-av{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;color:#fff;flex-shrink:0;}
.ct-td-nm{font-size:13.5px;font-weight:700;}
.ct-td-sub{font-size:11.5px;color:var(--text-secondary);}
.ct-td-client{display:flex;align-items:center;gap:8px;}
.ct-td-cl-logo{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;}
.ct-td-cl-nm{font-size:13px;font-weight:600;}
.ct-st-badge{padding:5px 12px;border-radius:20px;font-size:11px;font-weight:700;display:inline-flex;align-items:center;gap:5px;white-space:nowrap;}
.ct-st-active{background:var(--green-bg);color:var(--green);}
.ct-st-pending{background:var(--orange-bg);color:var(--orange);}
.ct-st-ended{background:var(--border-light);color:var(--text-tertiary);}
.ct-st-sign{background:var(--blue-bg);color:var(--blue);}
.ct-st-avenant{background:#FDE8F3;color:#E84393;}
.ct-td-dates{font-size:12px;color:var(--text-secondary);white-space:nowrap;}
.ct-td-dates b{color:var(--text-primary);font-weight:600;}
.ct-td-bar{display:flex;align-items:center;gap:8px;}
.ct-progress-bar{width:80px;height:6px;background:var(--border-light);border-radius:10px;overflow:hidden;}
.ct-progress-fill{height:100%;border-radius:10px;transition:width 0.8s ease;}
.ct-progress-pct{font-family:'Space Mono',monospace;font-size:11px;font-weight:700;min-width:28px;}
.ct-td-avenant{font-family:'Space Mono',monospace;font-size:12px;font-weight:700;display:flex;align-items:center;gap:4px;}
.ct-act-btn{width:30px;height:30px;border-radius:8px;border:1px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--transition);font-size:13px;color:var(--text-tertiary);}
.ct-act-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.ct-act-btn.warn:hover{border-color:var(--orange);color:var(--orange);background:var(--orange-bg);}
.ct-act-btn.aven{border-color:#E84393;color:#E84393;background:#FDE8F3;}
.ct-act-btn.aven:hover{box-shadow:0 2px 12px rgba(232,67,147,0.2);}
.ct-pagination{display:flex;align-items:center;justify-content:space-between;padding:16px 24px;border-top:1px solid var(--border-light);}
.ct-dov{display:none;position:fixed;inset:0;background:rgba(26,29,46,0.35);backdrop-filter:blur(6px);z-index:300;}
.ct-dov.on{display:block;}
.ct-dw{position:fixed;top:0;right:-600px;bottom:0;width:580px;max-width:94vw;background:var(--surface);z-index:301;transition:right 0.4s cubic-bezier(0.4,0,0.2,1);overflow-y:auto;box-shadow:-20px 0 60px rgba(26,29,46,0.12);}
.ct-dw.on{right:0;}
.ct-dw-head{position:sticky;top:0;z-index:2;background:rgba(255,255,255,0.92);backdrop-filter:blur(16px);padding:20px 28px;border-bottom:1px solid var(--border-light);display:flex;align-items:center;justify-content:space-between;}
.ct-dw-x{width:38px;height:38px;border-radius:10px;border:none;background:var(--bg);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text-secondary);transition:var(--transition);font-size:18px;}
.ct-dw-x:hover{background:var(--red-bg);color:var(--red);}
.ct-dw-body{padding:28px;}
.ct-dw-hero{display:flex;gap:14px;align-items:center;padding:20px;background:linear-gradient(135deg,var(--accent) 0%,#8B7CF6 100%);border-radius:var(--radius);color:#fff;margin-bottom:24px;}
.ct-dw-av{width:52px;height:52px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:19px;background:rgba(255,255,255,0.2);flex-shrink:0;}
.ct-dw-nm{font-size:18px;font-weight:800;}
.ct-dw-rl{font-size:13px;opacity:0.85;margin-top:2px;}
.ct-dw-num{font-family:'Space Mono',monospace;font-size:11px;opacity:0.7;margin-top:4px;}
.ct-tl-bar{margin-bottom:24px;}
.ct-tl-bar-label{display:flex;justify-content:space-between;font-size:11px;color:var(--text-tertiary);margin-bottom:6px;}
.ct-tl-bar-track{height:10px;background:var(--border-light);border-radius:10px;overflow:hidden;}
.ct-tl-bar-fill{height:100%;border-radius:10px;transition:width 1s ease;}
.ct-dw-sec{margin-bottom:24px;}
.ct-dw-sec-t{font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:1.2px;color:var(--text-tertiary);margin-bottom:12px;display:flex;align-items:center;justify-content:space-between;}
.ct-dw-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.ct-dw-it{padding:12px 16px;background:var(--bg);border-radius:var(--radius-sm);}
.ct-dw-it-l{font-size:11px;color:var(--text-tertiary);}
.ct-dw-it-v{font-size:14px;font-weight:700;margin-top:3px;}
.ct-aven-list{display:flex;flex-direction:column;gap:10px;}
.ct-aven-card{padding:16px 18px;border:1.5px solid var(--border);border-radius:var(--radius-sm);position:relative;transition:var(--transition);}
.ct-aven-card:hover{border-color:var(--accent-light);}
.ct-aven-card-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;}
.ct-aven-num{font-size:12px;font-weight:700;color:#E84393;}
.ct-aven-date{font-size:11px;color:var(--text-tertiary);}
.ct-aven-type{font-size:13px;font-weight:700;}
.ct-aven-detail{font-size:12px;color:var(--text-secondary);margin-top:4px;line-height:1.5;}
.ct-aven-badge{display:inline-flex;padding:3px 8px;border-radius:12px;font-size:10px;font-weight:700;margin-top:6px;}
.ct-quick-aven{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:24px;}
.ct-qa-btn{padding:16px;border:1.5px solid var(--border);border-radius:var(--radius);cursor:pointer;transition:var(--transition);text-align:center;background:var(--surface);}
.ct-qa-btn:hover{border-color:#E84393;background:#FDE8F3;transform:translateY(-2px);box-shadow:0 4px 16px rgba(232,67,147,0.1);}
.ct-qa-ico{font-size:24px;margin-bottom:6px;}
.ct-qa-t{font-size:13px;font-weight:700;}
.ct-qa-d{font-size:10.5px;color:var(--text-tertiary);margin-top:2px;}
.ct-h-btn{height:40px;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-sm);border:1px solid var(--border);background:var(--surface);cursor:pointer;transition:var(--transition);color:var(--text-secondary);padding:0 16px;gap:8px;font-family:inherit;font-size:13px;font-weight:600;}
.ct-h-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.ct-h-btn-primary{background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;border:none;box-shadow:0 4px 20px rgba(108,92,231,0.2);}
.ct-h-btn-primary:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(108,92,231,0.3);color:#fff;background:linear-gradient(135deg,var(--accent),#8B7CF6);}
.ct-btn-p{padding:10px 24px;border:none;border-radius:var(--radius-sm);background:linear-gradient(135deg,#E84393,#c44dcc);color:#fff;font-family:inherit;font-size:14px;font-weight:700;cursor:pointer;transition:var(--transition);box-shadow:0 4px 20px rgba(232,67,147,0.2);}
.ct-btn-p:hover{transform:translateY(-1px);}
.ct-btn-ac{padding:10px 24px;border:none;border-radius:var(--radius-sm);background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;font-family:inherit;font-size:14px;font-weight:700;cursor:pointer;transition:var(--transition);box-shadow:0 4px 20px rgba(108,92,231,0.2);}
.ct-btn-ac:hover{transform:translateY(-1px);}

/* ========================================== */
/* DASHBOARD PAGE STYLES                      */
/* ========================================== */
.db-kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:18px;margin-bottom:28px;}
.db-kpi-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:22px 24px;transition:var(--transition);cursor:default;position:relative;overflow:hidden;animation:fadeUp 0.5s ease backwards;}
.db-kpi-card::after{content:'';position:absolute;top:0;left:0;right:0;height:3px;border-radius:var(--radius) var(--radius) 0 0;opacity:0;transition:var(--transition);}
.db-kpi-card:hover{box-shadow:0 4px 20px rgba(26,29,46,0.06);transform:translateY(-2px);}
.db-kpi-card:hover::after{opacity:1;}
.db-kpi-card:nth-child(1)::after{background:linear-gradient(90deg,var(--accent),var(--accent-light));}
.db-kpi-card:nth-child(2)::after{background:linear-gradient(90deg,var(--blue),#74B9FF);}
.db-kpi-card:nth-child(3)::after{background:linear-gradient(90deg,var(--green),#55E6A5);}
.db-kpi-card:nth-child(4)::after{background:linear-gradient(90deg,var(--orange),#FDCB6E);}
.db-kpi-card:nth-child(1){animation-delay:0.05s;}
.db-kpi-card:nth-child(2){animation-delay:0.1s;}
.db-kpi-card:nth-child(3){animation-delay:0.15s;}
.db-kpi-card:nth-child(4){animation-delay:0.2s;}
.db-kpi-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
.db-kpi-icon{width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;}
.db-kpi-card:nth-child(1) .db-kpi-icon{background:var(--accent-bg);color:var(--accent);}
.db-kpi-card:nth-child(2) .db-kpi-icon{background:var(--blue-bg);color:var(--blue);}
.db-kpi-card:nth-child(3) .db-kpi-icon{background:var(--green-bg);color:var(--green);}
.db-kpi-card:nth-child(4) .db-kpi-icon{background:var(--orange-bg);color:var(--orange);}
.db-kpi-trend{display:flex;align-items:center;gap:4px;font-size:12px;font-weight:600;padding:3px 8px;border-radius:20px;}
.db-kpi-trend.up{color:var(--green);background:var(--green-bg);}
.db-kpi-trend.down{color:var(--red);background:var(--red-bg);}
.db-kpi-value{font-size:32px;font-weight:700;letter-spacing:-1px;line-height:1;margin-bottom:4px;}
.db-kpi-label{font-size:13px;color:var(--text-secondary);font-weight:500;}
.db-grid{display:grid;grid-template-columns:1fr 380px;gap:22px;}
.db-left-col{display:flex;flex-direction:column;gap:22px;}
.db-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;animation:fadeUp 0.5s ease backwards;animation-delay:0.25s;}
.db-card-header{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:1px solid var(--border-light);}
.db-card-title{font-size:15px;font-weight:700;display:flex;align-items:center;gap:8px;}
.db-card-action{font-size:12px;color:var(--accent);font-weight:600;cursor:pointer;padding:5px 12px;border-radius:20px;transition:var(--transition);}
.db-card-action:hover{background:var(--accent-bg);}
.db-activity-list{padding:8px 0;}
.db-activity-item{display:flex;align-items:flex-start;gap:14px;padding:14px 24px;transition:var(--transition);cursor:default;}
.db-activity-item:hover{background:var(--surface-hover);}
.db-activity-dot{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:15px;margin-top:2px;}
.db-activity-dot.purple{background:var(--accent-bg);}
.db-activity-dot.blue{background:var(--blue-bg);}
.db-activity-dot.green{background:var(--green-bg);}
.db-activity-dot.orange{background:var(--orange-bg);}
.db-activity-content{flex:1;}
.db-activity-text{font-size:13.5px;line-height:1.5;color:var(--text-primary);}
.db-activity-text strong{font-weight:600;color:var(--accent);}
.db-activity-time{font-size:11.5px;color:var(--text-tertiary);margin-top:3px;}
.db-missions-list{padding:8px 0;}
.db-mission-item{display:flex;align-items:center;gap:14px;padding:14px 24px;transition:var(--transition);cursor:pointer;}
.db-mission-item:hover{background:var(--surface-hover);}
.db-mission-urgency{width:4px;height:40px;border-radius:4px;flex-shrink:0;}
.db-mission-urgency.high{background:var(--red);}
.db-mission-urgency.medium{background:var(--orange);}
.db-mission-urgency.low{background:var(--green);}
.db-mission-info{flex:1;}
.db-mission-title{font-size:13.5px;font-weight:600;}
.db-mission-meta{font-size:12px;color:var(--text-secondary);margin-top:3px;display:flex;align-items:center;gap:12px;}
.db-mission-match{display:flex;align-items:center;gap:6px;font-size:12px;font-weight:600;color:var(--accent);background:var(--accent-bg);padding:4px 10px;border-radius:20px;flex-shrink:0;}
.db-candidates-table{width:100%;}
.db-candidates-table th{text-align:left;padding:12px 24px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.8px;color:var(--text-tertiary);background:var(--surface-hover);border-bottom:1px solid var(--border-light);}
.db-candidates-table td{padding:14px 24px;font-size:13.5px;border-bottom:1px solid var(--border-light);vertical-align:middle;}
.db-candidates-table tr:last-child td{border-bottom:none;}
.db-candidates-table tr:hover td{background:var(--surface-hover);}
.db-candidate-cell{display:flex;align-items:center;gap:12px;}
.db-candidate-avatar{width:34px;height:34px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:12px;color:white;flex-shrink:0;}
.db-candidate-name{font-weight:600;}
.db-score-bar{display:flex;align-items:center;gap:8px;}
.db-score-track{flex:1;height:6px;background:var(--bg);border-radius:10px;overflow:hidden;min-width:60px;}
.db-score-fill{height:100%;border-radius:10px;transition:width 0.6s cubic-bezier(0.4,0,0.2,1);}
.db-score-value{font-size:13px;font-weight:700;font-family:'Space Mono',monospace;min-width:32px;}
.db-status-badge{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:20px;font-size:12px;font-weight:600;}
.db-status-badge.available{background:var(--green-bg);color:var(--green);}
.db-status-badge.pending{background:var(--orange-bg);color:var(--orange);}
.db-status-badge.placed{background:var(--blue-bg);color:var(--blue);}
.db-status-dot{width:6px;height:6px;border-radius:50%;background:currentColor;}
.db-chat-widget{position:fixed;bottom:28px;right:28px;z-index:200;}
.db-chat-bubble{width:60px;height:60px;background:linear-gradient(135deg,var(--accent),#8B7CF6);border-radius:20px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 4px 24px rgba(108,92,231,0.18),0 8px 32px rgba(108,92,231,0.3);transition:var(--transition);color:white;font-size:24px;}
.db-chat-bubble:hover{transform:scale(1.08);box-shadow:0 4px 24px rgba(108,92,231,0.18),0 12px 40px rgba(108,92,231,0.4);}
.db-chat-bubble .db-pulse{position:absolute;width:60px;height:60px;border-radius:20px;background:var(--accent);animation:dbPulse 2s ease-in-out infinite;z-index:-1;}
@keyframes dbPulse{0%,100%{opacity:0;transform:scale(1);}50%{opacity:0.3;transform:scale(1.3);}}
.db-chat-panel{position:absolute;bottom:72px;right:0;width:400px;height:520px;background:var(--surface);border-radius:var(--radius);border:1px solid var(--border);box-shadow:0 8px 40px rgba(26,29,46,0.08);display:none;flex-direction:column;overflow:hidden;animation:dbChatSlide 0.3s cubic-bezier(0.34,1.56,0.64,1);}
.db-chat-panel.open{display:flex;}
@keyframes dbChatSlide{from{opacity:0;transform:translateY(12px) scale(0.96);}to{opacity:1;transform:translateY(0) scale(1);}}
.db-chat-header{padding:18px 22px;border-bottom:1px solid var(--border-light);display:flex;align-items:center;gap:12px;background:linear-gradient(135deg,rgba(108,92,231,0.04),rgba(74,144,217,0.04));}
.db-chat-ai-avatar{width:38px;height:38px;background:linear-gradient(135deg,var(--accent),var(--accent-light));border-radius:12px;display:flex;align-items:center;justify-content:center;color:white;font-size:18px;}
.db-chat-ai-info{flex:1;}
.db-chat-ai-name{font-size:14px;font-weight:700;}
.db-chat-ai-status{font-size:11.5px;color:var(--green);display:flex;align-items:center;gap:5px;}
.db-chat-ai-status::before{content:'';width:6px;height:6px;background:var(--green);border-radius:50%;}
.db-chat-close{width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:8px;cursor:pointer;color:var(--text-tertiary);transition:var(--transition);border:none;background:none;}
.db-chat-close:hover{background:var(--bg);color:var(--text-primary);}
.db-chat-messages{flex:1;padding:20px;display:flex;flex-direction:column;gap:16px;overflow-y:auto;}
.db-msg{max-width:85%;padding:12px 16px;border-radius:16px;font-size:13.5px;line-height:1.55;}
.db-msg.ai{background:var(--bg);border-bottom-left-radius:4px;align-self:flex-start;}
.db-msg.user{background:linear-gradient(135deg,var(--accent),#8B7CF6);color:white;border-bottom-right-radius:4px;align-self:flex-end;}
.db-chat-suggestions{display:flex;flex-wrap:wrap;gap:6px;padding:0 20px 12px;}
.db-chat-suggestion{padding:7px 14px;border:1px solid var(--border);border-radius:20px;font-size:12px;color:var(--text-secondary);cursor:pointer;transition:var(--transition);background:var(--surface);}
.db-chat-suggestion:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.db-chat-input-area{padding:16px 20px;border-top:1px solid var(--border-light);display:flex;align-items:center;gap:10px;}
.db-chat-input{flex:1;border:1px solid var(--border);border-radius:12px;padding:11px 16px;font-size:13.5px;font-family:inherit;outline:none;transition:var(--transition);background:var(--bg);}
.db-chat-input:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-glow);background:var(--surface);}
.db-chat-input::placeholder{color:var(--text-tertiary);}
.db-chat-voice-btn{width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:12px;border:1px solid var(--border);background:var(--surface);cursor:pointer;transition:var(--transition);color:var(--text-secondary);}
.db-chat-voice-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.db-chat-send-btn{width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:12px;border:none;background:linear-gradient(135deg,var(--accent),#8B7CF6);cursor:pointer;color:white;transition:var(--transition);box-shadow:0 4px 24px rgba(108,92,231,0.18);}
.db-chat-send-btn:hover{transform:scale(1.05);box-shadow:0 4px 20px rgba(108,92,231,0.35);}
.db-header-search{display:flex;align-items:center;gap:8px;padding:9px 16px;background:var(--bg);border:1px solid var(--border);border-radius:var(--radius-sm);font-size:13px;color:var(--text-tertiary);cursor:pointer;transition:var(--transition);min-width:220px;}
.db-header-search:hover{border-color:var(--accent-light);box-shadow:0 0 0 3px var(--accent-glow);}
.db-header-search kbd{background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:1px 6px;font-size:11px;font-family:'Space Mono',monospace;margin-left:auto;}
.db-activity-item{animation:fadeUp 0.4s ease backwards;}
.db-activity-item:nth-child(1){animation-delay:0.3s;}
.db-activity-item:nth-child(2){animation-delay:0.36s;}
.db-activity-item:nth-child(3){animation-delay:0.42s;}
.db-activity-item:nth-child(4){animation-delay:0.48s;}
.db-activity-item:nth-child(5){animation-delay:0.54s;}
.db-activity-item:nth-child(6){animation-delay:0.60s;}

/* ========================================== */
/* CANDIDATS PAGE STYLES                      */
/* ========================================== */
#page-candidats .toolbar{display:flex;align-items:center;gap:8px;margin-bottom:20px;flex-wrap:wrap;}
#page-candidats .search-box{display:flex;align-items:center;gap:8px;padding:9px 18px;border-radius:50px;border:1.5px solid var(--border);background:var(--surface);transition:var(--transition);min-width:260px;}
#page-candidats .search-box:focus-within{border-color:var(--accent);box-shadow:0 0 0 4px var(--accent-glow);}
#page-candidats .search-box input{border:none;outline:none;font-family:inherit;font-size:13px;width:100%;background:transparent;}
#page-candidats .search-box input::placeholder{color:var(--text-tertiary);}
#page-candidats .cd-pill{padding:7px 16px;border-radius:50px;font-size:12.5px;font-weight:600;cursor:pointer;transition:var(--transition);border:1.5px solid var(--border);background:var(--surface);color:var(--text-secondary);user-select:none;white-space:nowrap;}
#page-candidats .cd-pill:hover{border-color:var(--accent);color:var(--accent);}
#page-candidats .cd-pill.on{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 4px 12px rgba(108,92,231,0.18);}
/* Results header */
.cv-results-head{display:flex;align-items:center;gap:12px;margin-bottom:16px;}
.cv-count{font-size:13px;font-weight:700;color:var(--text-secondary);}
.cv-count span{color:var(--accent);font-family:'Space Mono',monospace;}
/* Card grid */
.cv-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;}
/* Candidate card */
.cv-card{background:var(--surface);border:1.5px solid var(--border);border-radius:14px;overflow:hidden;cursor:pointer;transition:var(--transition);animation:fadeUp 0.4s ease backwards;display:flex;flex-direction:column;}
.cv-card:hover{transform:translateY(-3px);box-shadow:0 10px 32px rgba(26,29,46,0.08);border-color:rgba(108,92,231,0.2);}
.cv-card-bar{height:3px;}
.cv-card-bar.dispo{background:linear-gradient(90deg,#2ECC71,#55E6A5);}
.cv-card-bar.mission{background:linear-gradient(90deg,#4A90D9,#74B9FF);}
.cv-card-bar.indispo{background:linear-gradient(90deg,#E74C3C,#FF7675);}
.cv-card-bar.dormant{background:linear-gradient(90deg,#F39C12,#FDCB6E);}
.cv-card-body{padding:16px 18px 12px;display:flex;gap:14px;align-items:flex-start;flex:1;}
.cv-av{width:46px;height:46px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:15px;color:#fff;flex-shrink:0;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
.cv-meta{flex:1;min-width:0;}
.cv-nm{font-size:14.5px;font-weight:800;letter-spacing:-0.2px;margin-bottom:1px;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;}
.cv-rl{font-size:12px;color:var(--text-secondary);margin-bottom:8px;}
.cv-status-row{display:flex;align-items:center;justify-content:space-between;margin-bottom:9px;}
/* Status badge */
.cv-st{padding:4px 10px;border-radius:20px;font-size:11px;font-weight:700;display:inline-flex;align-items:center;gap:5px;white-space:nowrap;}
.cv-st.dispo{background:var(--green-bg);color:var(--green);}
.cv-st.mission{background:var(--blue-bg);color:var(--blue);}
.cv-st.indispo{background:var(--red-bg);color:var(--red);}
.cv-st.dormant{background:var(--orange-bg);color:var(--orange);}
/* Score badge */
.cv-score{display:flex;flex-direction:column;align-items:center;justify-content:center;width:44px;height:44px;border-radius:10px;flex-shrink:0;}
.cv-score.high{background:#EFFFEF;}
.cv-score.mid{background:#FFF8EC;}
.cv-score.low{background:#FFF1F0;}
.cv-score-n{font-family:'Space Mono',monospace;font-size:14px;font-weight:700;line-height:1;}
.cv-score.high .cv-score-n{color:#2ECC71;}
.cv-score.mid .cv-score-n{color:#F39C12;}
.cv-score.low .cv-score-n{color:#E74C3C;}
.cv-score-l{font-size:8px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;color:var(--text-tertiary);margin-top:2px;}
/* Skills */
.cv-skills{display:flex;flex-wrap:wrap;gap:4px;}
.cv-sk{padding:3px 9px;border-radius:50px;font-size:10.5px;font-weight:700;}
.cv-sk.g{background:var(--green-bg);color:var(--green);}
.cv-sk.o{background:var(--orange-bg);color:var(--orange);}
.cv-sk.b{background:var(--blue-bg);color:var(--blue);}
.cv-sk.p{background:var(--accent-bg);color:var(--accent);}
/* Card footer */
.cv-card-foot{padding:12px 18px;border-top:1px solid var(--border-light);display:flex;align-items:center;justify-content:space-between;gap:8px;}
.cv-foot-info{display:flex;flex-direction:column;gap:3px;}
.cv-loc{font-size:11.5px;color:var(--text-secondary);display:flex;align-items:center;gap:3px;}
.cv-date{font-size:11px;color:var(--text-tertiary);}
.cv-foot-acts{display:flex;gap:5px;flex-shrink:0;align-items:center;}
.cv-act{width:32px;height:32px;border-radius:8px;border:1px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--transition);font-size:13px;color:var(--text-tertiary);}
.cv-act:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.cv-act-propose{height:32px;border-radius:8px;border:none;background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--transition);font-size:11.5px;font-weight:700;padding:0 12px;gap:4px;font-family:inherit;white-space:nowrap;}
.cv-act-propose:hover{transform:translateY(-1px);box-shadow:0 4px 14px rgba(108,92,231,0.3);}
/* Drawer */
.cd-dov{display:none;position:fixed;inset:0;background:rgba(26,29,46,0.35);backdrop-filter:blur(6px);z-index:300;}
.cd-dov.on{display:block;}
.cd-dw{position:fixed;top:0;right:-560px;bottom:0;width:540px;max-width:94vw;background:var(--surface);z-index:301;transition:right 0.4s cubic-bezier(0.4,0,0.2,1);overflow-y:auto;box-shadow:-20px 0 60px rgba(26,29,46,0.12);}
.cd-dw.on{right:0;}
.cd-dw-head{position:sticky;top:0;z-index:2;background:rgba(255,255,255,0.92);backdrop-filter:blur(16px);padding:20px 28px;border-bottom:1px solid var(--border-light);display:flex;align-items:center;justify-content:space-between;}
.cd-dw-x{width:38px;height:38px;border-radius:10px;border:none;background:var(--bg);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text-secondary);transition:var(--transition);font-size:18px;}
.cd-dw-x:hover{background:var(--red-bg);color:var(--red);}
.cd-dw-profile{padding:28px;}
.cd-dw-hero{display:flex;gap:18px;align-items:center;margin-bottom:24px;}
.cd-dw-av{width:72px;height:72px;border-radius:20px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:26px;color:#fff;box-shadow:0 6px 20px rgba(0,0,0,0.12);}
.cd-dw-nm{font-size:22px;font-weight:800;letter-spacing:-0.3px;}
.cd-dw-rl{font-size:14px;color:var(--text-secondary);margin-top:3px;}
.cd-dw-quick{display:flex;gap:8px;margin-bottom:28px;}
.cd-dw-qbtn{flex:1;padding:11px;border-radius:var(--radius-sm);border:1.5px solid var(--border);background:var(--surface);font-family:inherit;font-size:12px;font-weight:700;cursor:pointer;transition:var(--transition);display:flex;align-items:center;justify-content:center;gap:6px;color:var(--text-secondary);}
.cd-dw-qbtn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.cd-dw-qbtn.primary{background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;border:none;box-shadow:0 4px 16px rgba(108,92,231,0.2);}
.cd-dw-qbtn.primary:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(108,92,231,0.3);}
.cd-dw-sec{margin-bottom:24px;}
.cd-dw-sec-t{font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:1.2px;color:var(--text-tertiary);margin-bottom:12px;}
.cd-dw-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.cd-dw-it{padding:12px 16px;background:var(--bg);border-radius:var(--radius-sm);}
.cd-dw-it-l{font-size:11px;color:var(--text-tertiary);}
.cd-dw-it-v{font-size:14px;font-weight:700;margin-top:3px;}
.cd-dw-chips{display:flex;flex-wrap:wrap;gap:6px;}
.cd-dw-exp-i{padding:14px 16px;background:var(--bg);border-radius:var(--radius-sm);margin-bottom:8px;border-left:3px solid var(--accent);}
.cd-dw-exp-t{font-size:14px;font-weight:700;}
.cd-dw-exp-c{font-size:12.5px;color:var(--text-secondary);margin-top:2px;}
.cd-dw-exp-p{font-size:11.5px;color:var(--text-tertiary);margin-top:3px;}
.cd-dw-timeline{display:flex;flex-direction:column;gap:0;}
.cd-dw-tl-item{display:flex;gap:12px;padding:10px 0;position:relative;}
.cd-dw-tl-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;margin-top:4px;border:2px solid var(--border);background:var(--surface);}
.cd-dw-tl-dot.gn{border-color:var(--green);background:var(--green);}
.cd-dw-tl-dot.bl{border-color:var(--blue);background:var(--blue);}
.cd-dw-tl-dot.or{border-color:var(--orange);background:var(--orange);}
.cd-dw-tl-item:not(:last-child)::before{content:'';position:absolute;left:4px;top:18px;bottom:-4px;width:2px;background:var(--border-light);}
.cd-dw-tl-msg{font-size:13px;line-height:1.5;}
.cd-dw-tl-time{font-size:11px;color:var(--text-tertiary);margin-top:2px;}
/* Import drop zone */
.cd-drop-zone{border:2px dashed var(--border);border-radius:var(--radius);padding:48px 24px;text-align:center;cursor:pointer;transition:var(--transition);}
.cd-drop-zone:hover,.cd-drop-zone.over{border-color:var(--accent);background:var(--accent-bg);}
.cd-drop-icon{font-size:48px;margin-bottom:12px;}
.cd-drop-title{font-size:15px;font-weight:700;margin-bottom:4px;}
.cd-drop-desc{font-size:12.5px;color:var(--text-secondary);}
.cd-drop-formats{margin-top:12px;font-size:11px;color:var(--text-tertiary);}
/* Header buttons */
.cd-h-btn{height:40px;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-sm);border:1px solid var(--border);background:var(--surface);cursor:pointer;transition:var(--transition);color:var(--text-secondary);padding:0 16px;gap:8px;font-family:inherit;font-size:13px;font-weight:600;}
.cd-h-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.cd-h-btn-primary{background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;border:none;box-shadow:0 4px 20px rgba(108,92,231,0.2);}
.cd-h-btn-primary:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(108,92,231,0.3);color:#fff;background:linear-gradient(135deg,var(--accent),#8B7CF6);}

/* ========================================== */
/* PORTAIL CLIENT PAGE STYLES                 */
/* ========================================== */
/* Variables agence (white-label) */
#page-portail{--pc-primary:#E74C3C;--pc-primary-dark:#C0392B;--pc-bg:#F7F8FC;--pc-surface:#FFFFFF;--pc-text:#1B1D2A;--pc-text-secondary:#6E7191;--pc-border:#ECEEF6;--pc-success:#00C48C;--pc-warning:#FF9F43;--pc-danger:#FF6B6B;}
#page-portail .main{background:var(--pc-bg);min-height:100vh;}
/* Topbar */
.pc-topbar{background:rgba(255,255,255,0.96);backdrop-filter:blur(20px);border-bottom:1px solid var(--pc-border);padding:0 clamp(20px,4vw,48px);height:64px;display:flex;align-items:center;justify-content:space-between;}
.pc-tbl{display:flex;align-items:center;gap:12px;}
.pc-logo{width:38px;height:38px;background:var(--pc-primary);border-radius:10px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:13px;}
.pc-brand{display:flex;flex-direction:column;}
.pc-nm{font-size:15px;font-weight:800;color:var(--pc-text);}
.pc-pw{font-size:10px;color:var(--pc-text-secondary);}
.pc-pw b{color:var(--accent);font-weight:700;}
.pc-sep{width:1px;height:28px;background:var(--pc-border);margin:0 8px;}
.pc-cl{font-size:13px;font-weight:600;color:var(--pc-text-secondary);}
.pc-tbr{display:flex;align-items:center;gap:10px;}
.pc-usr{display:flex;align-items:center;gap:8px;padding:6px 12px 6px 6px;border-radius:10px;cursor:pointer;transition:var(--transition);}
.pc-usr:hover{background:#F0F2F8;}
.pc-av{width:34px;height:34px;background:var(--pc-primary);border-radius:9px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:12px;}
.pc-un{font-size:13px;font-weight:600;color:var(--pc-text);}
/* Page layout */
.pc-page{max-width:1100px;margin:0 auto;padding:36px clamp(20px,4vw,48px) 60px;}
/* Page header */
.pc-page-header{margin-bottom:32px;}
.pc-page-header h1{font-size:24px;font-weight:800;color:var(--pc-text);letter-spacing:-0.4px;}
.pc-page-header p{font-size:14px;color:var(--pc-text-secondary);margin-top:5px;}
/* Missions list */
.pc-missions-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(320px,1fr));gap:16px;}
.pc-mission-card{background:var(--pc-surface);border:1.5px solid var(--pc-border);border-radius:16px;padding:24px;cursor:pointer;transition:var(--transition);animation:fadeUp 0.3s ease backwards;}
.pc-mission-card:hover{border-color:var(--pc-primary);box-shadow:0 8px 32px rgba(231,76,60,0.08);transform:translateY(-3px);}
.pc-mission-status-badge{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.4px;margin-bottom:14px;}
.pc-mission-status-badge.active{background:#EBF9F4;color:var(--pc-success);}
.pc-mission-status-badge.pourvue{background:#F0F2F8;color:var(--pc-text-secondary);}
.pc-mission-title-text{font-size:17px;font-weight:800;color:var(--pc-text);letter-spacing:-0.2px;}
.pc-mission-client-name{font-size:13px;color:var(--pc-text-secondary);margin-top:4px;}
.pc-mission-meta{display:flex;gap:20px;align-items:center;margin-top:16px;padding-top:16px;border-top:1px solid var(--pc-border);}
.pc-mission-meta-item{display:flex;flex-direction:column;gap:2px;}
.pc-mission-meta-label{font-size:10.5px;color:var(--pc-text-secondary);text-transform:uppercase;letter-spacing:0.5px;}
.pc-mission-meta-value{font-size:14px;font-weight:700;color:var(--pc-text);}
.pc-mission-arrow{margin-left:auto;color:var(--pc-primary);display:flex;align-items:center;}
/* Candidates screen header */
.pc-screen-header{display:flex;align-items:center;gap:16px;margin-bottom:28px;flex-wrap:wrap;}
.pc-back-btn{display:flex;align-items:center;gap:6px;padding:8px 16px;border-radius:10px;border:1.5px solid var(--pc-border);background:var(--pc-surface);font-family:inherit;font-size:13px;font-weight:600;color:var(--pc-text-secondary);cursor:pointer;transition:var(--transition);}
.pc-back-btn:hover{border-color:var(--pc-primary);color:var(--pc-primary);background:#FEF5F4;}
.pc-screen-mission-info{flex:1;}
.pc-screen-mission-title{font-size:20px;font-weight:800;color:var(--pc-text);letter-spacing:-0.3px;}
.pc-screen-mission-sub{font-size:13px;color:var(--pc-text-secondary);margin-top:2px;}
.pc-candidates-count{font-size:13px;color:var(--pc-text-secondary);background:var(--pc-surface);border:1.5px solid var(--pc-border);padding:6px 14px;border-radius:20px;font-weight:600;}
/* Candidates grid */
.pc-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(300px,1fr));gap:16px;}
.pc-card{background:var(--pc-surface);border:1.5px solid var(--pc-border);border-radius:16px;overflow:hidden;cursor:pointer;transition:all 0.25s ease;animation:fadeUp 0.3s ease backwards;}
.pc-card:hover{border-color:rgba(231,76,60,0.25);box-shadow:0 8px 28px rgba(27,29,42,0.07);transform:translateY(-3px);}
.pc-card.dismissed{opacity:0;transform:scale(0.95);pointer-events:none;}
/* Card score bar */
.pc-bar{height:3px;width:100%;}
.pc-bar i{display:block;height:100%;transition:width 0.8s ease;}
/* Card body */
.pc-body{padding:18px 18px 12px;display:flex;gap:13px;align-items:flex-start;}
.pc-avatar{width:50px;height:50px;border-radius:13px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:16px;color:#fff;flex-shrink:0;position:relative;}
.pc-lock-badge{position:absolute;bottom:-4px;right:-4px;width:19px;height:19px;background:var(--pc-surface);border:1.5px solid var(--pc-border);border-radius:50%;display:flex;align-items:center;justify-content:center;}
.pc-info{flex:1;min-width:0;}
.pc-cname{font-size:14.5px;font-weight:800;color:var(--pc-text);}
.pc-role{font-size:12px;color:var(--pc-text-secondary);margin-top:2px;}
.pc-chips{display:flex;flex-wrap:wrap;gap:5px;margin-top:9px;}
.pc-chip{padding:4px 10px;border-radius:20px;font-size:11px;font-weight:600;}
.pc-chip.g{background:#EBF9F4;color:#00A878;}
.pc-chip.o{background:#FFF3E0;color:#E67E22;}
.pc-chip.b{background:#EBF3FC;color:#2E86C1;}
.pc-comment-saved{margin-top:8px;font-size:11.5px;color:var(--pc-text-secondary);background:var(--pc-bg);border-radius:8px;padding:7px 10px;border-left:2px solid var(--pc-primary);}
/* Score ring */
.pc-pct{display:flex;flex-direction:column;align-items:center;flex-shrink:0;gap:3px;}
.pc-ring{position:relative;width:52px;height:52px;}
.pc-ring svg{transform:rotate(-90deg);width:52px;height:52px;}
.pc-ring-bg{fill:none;stroke:var(--pc-border);stroke-width:4.5;}
.pc-ring-fg{fill:none;stroke-width:4.5;stroke-linecap:round;transition:stroke-dashoffset 1s ease;}
.pc-ring-t{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-family:'Space Mono',monospace;font-size:12.5px;font-weight:700;}
.pc-ring-l{font-size:9px;color:var(--pc-text-secondary);font-weight:600;text-transform:uppercase;letter-spacing:0.4px;}
/* Availability strip */
.pc-avail{margin:0 18px;padding:9px 0;border-top:1px solid var(--pc-border);display:flex;align-items:center;gap:8px;}
.pc-avail-dot{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.pc-avail-dot.g{background:var(--pc-success);}
.pc-avail-dot.o{background:var(--pc-warning);}
.pc-avail-dot.b{background:#4A90D9;}
.pc-at{font-size:12.5px;font-weight:700;}
.pc-aw{margin-left:auto;font-size:11px;color:var(--pc-text-secondary);}
/* Comment area on card */
.pc-comment-area{margin:0 18px 10px;display:none;}
.pc-comment-area.open{display:block;}
.pc-comment-input{width:100%;padding:9px 12px;border:1.5px solid var(--pc-border);border-radius:9px;font-family:inherit;font-size:12.5px;resize:none;outline:none;color:var(--pc-text);transition:var(--transition);box-sizing:border-box;}
.pc-comment-input:focus{border-color:var(--pc-primary);}
/* Card actions */
.pc-act{padding:10px 18px;display:flex;gap:7px;border-top:1px solid var(--pc-border);}
.pc-btn-a{flex:1;padding:9px 10px;border-radius:9px;border:1.5px solid transparent;font-family:inherit;font-size:12px;font-weight:700;cursor:pointer;transition:var(--transition);}
.pc-btn-a.interested{background:var(--pc-primary);color:#fff;border-color:var(--pc-primary);}
.pc-btn-a.interested:hover{background:var(--pc-primary-dark);border-color:var(--pc-primary-dark);}
.pc-btn-a.interested-done{background:#EBF9F4;color:var(--pc-success);border-color:#C3F0E0;pointer-events:none;}
.pc-btn-a.not-interested{background:var(--pc-surface);color:var(--pc-text-secondary);border-color:var(--pc-border);}
.pc-btn-a.not-interested:hover{border-color:var(--pc-danger);color:var(--pc-danger);background:#FFF0F0;}
.pc-btn-a.prolong{background:var(--pc-surface);color:#2E86C1;border-color:#D6EAF8;}
.pc-btn-a.prolong:hover{background:#EBF3FC;border-color:#2E86C1;}
.pc-btn-a.comment-btn{background:var(--pc-surface);color:var(--pc-text-secondary);border-color:var(--pc-border);flex:0;padding:9px 11px;}
.pc-btn-a.comment-btn:hover{border-color:var(--pc-primary);color:var(--pc-primary);}
.pc-btn-a.comment-btn.active{background:#FEF5F4;color:var(--pc-primary);border-color:var(--pc-primary);}
/* Drawer */
.pc-dov{display:none;position:fixed;inset:0;background:rgba(27,29,42,0.3);backdrop-filter:blur(4px);z-index:300;}
.pc-dov.on{display:block;}
.pc-dw{position:fixed;top:0;right:-560px;bottom:0;width:540px;max-width:94vw;background:var(--pc-surface);z-index:301;transition:right 0.35s cubic-bezier(0.4,0,0.2,1);overflow-y:auto;box-shadow:-16px 0 48px rgba(27,29,42,0.1);}
.pc-dw.on{right:0;}
.pc-dw-head{position:sticky;top:0;z-index:2;background:rgba(255,255,255,0.96);backdrop-filter:blur(16px);padding:18px 24px;border-bottom:1px solid var(--pc-border);display:flex;align-items:center;justify-content:space-between;}
.pc-dw-x{width:36px;height:36px;border-radius:9px;border:none;background:#F7F8FC;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--pc-text-secondary);transition:var(--transition);font-size:16px;}
.pc-dw-x:hover{background:#FFF0F0;color:var(--pc-danger);}
.pc-dw-body{padding:28px 24px;}
.pc-dw-av{width:72px;height:72px;border-radius:18px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:24px;color:#fff;margin-bottom:16px;}
.pc-dw-nm{font-size:22px;font-weight:800;color:var(--pc-text);letter-spacing:-0.3px;}
.pc-dw-rl{font-size:14px;color:var(--pc-text-secondary);margin-top:4px;}
.pc-dw-anon{margin-top:16px;padding:14px 18px;background:#FFF3E0;border-radius:10px;font-size:13px;color:#C67019;font-weight:600;line-height:1.5;}
.pc-dw-sec{margin-top:24px;}
.pc-dw-sec-t{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:1.2px;color:var(--pc-text-secondary);margin-bottom:12px;}
.pc-dw-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.pc-dw-it{padding:12px 16px;background:#F7F8FC;border-radius:10px;}
.pc-dw-it-l{font-size:11px;color:var(--pc-text-secondary);}
.pc-dw-it-v{font-size:14px;font-weight:700;color:var(--pc-text);margin-top:3px;}
.pc-dw-chips{display:flex;flex-wrap:wrap;gap:6px;}
.pc-dw-exp-i{padding:13px 16px;background:#F7F8FC;border-radius:10px;margin-bottom:8px;border-left:3px solid var(--pc-primary);}
.pc-dw-exp-t{font-size:14px;font-weight:700;color:var(--pc-text);}
.pc-dw-exp-c{font-size:12.5px;color:var(--pc-text-secondary);margin-top:2px;}
.pc-dw-exp-p{font-size:11.5px;color:var(--pc-text-secondary);margin-top:3px;}
.pc-dw-comment{margin-top:24px;}
.pc-dw-comment textarea{width:100%;padding:12px 14px;border:1.5px solid var(--pc-border);border-radius:10px;font-family:inherit;font-size:13px;resize:vertical;outline:none;color:var(--pc-text);transition:var(--transition);box-sizing:border-box;min-height:80px;}
.pc-dw-comment textarea:focus{border-color:var(--pc-primary);}
.pc-dw-foot{position:sticky;bottom:0;padding:16px 24px;background:rgba(255,255,255,0.96);backdrop-filter:blur(12px);border-top:1px solid var(--pc-border);display:flex;gap:8px;}
.pc-dw-btn{flex:1;padding:13px;border-radius:10px;border:1.5px solid transparent;font-family:inherit;font-size:14px;font-weight:700;cursor:pointer;transition:var(--transition);}
.pc-dw-btn.interested{background:var(--pc-primary);color:#fff;border-color:var(--pc-primary);}
.pc-dw-btn.interested:hover{background:var(--pc-primary-dark);}
.pc-dw-btn.interested-done{background:#EBF9F4;color:var(--pc-success);border-color:#C3F0E0;pointer-events:none;}
.pc-dw-btn.not-interested{background:#F7F8FC;color:var(--pc-text-secondary);border-color:var(--pc-border);}
.pc-dw-btn.not-interested:hover{border-color:var(--pc-danger);color:var(--pc-danger);background:#FFF0F0;}
.pc-dw-btn.prolong{background:#EBF3FC;color:#2E86C1;border-color:#D6EAF8;}
.pc-dw-btn.prolong:hover{background:#D6EAF8;}
/* Empty state */
.pc-empty{grid-column:1/-1;display:flex;flex-direction:column;align-items:center;padding:60px 20px;gap:10px;}
.powered{text-align:center;padding:24px;font-size:12px;color:var(--pc-text-secondary);}
.powered b{color:var(--accent);}
/* Modal demande de candidats */
.pc-modal-ov{display:none;position:fixed;inset:0;background:rgba(27,29,42,0.35);backdrop-filter:blur(4px);z-index:400;align-items:center;justify-content:center;}
.pc-modal-ov.open{display:flex;}
.pc-modal{background:#fff;border-radius:20px;width:100%;max-width:520px;margin:20px;box-shadow:0 24px 60px rgba(27,29,42,0.15);animation:fadeUp 0.25s ease;}
.pc-modal-head{padding:22px 24px 0;display:flex;align-items:center;justify-content:space-between;}
.pc-modal-title{font-size:17px;font-weight:800;color:var(--pc-text);}
.pc-modal-x{width:34px;height:34px;border-radius:9px;border:none;background:#F7F8FC;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--pc-text-secondary);font-size:16px;transition:var(--transition);}
.pc-modal-x:hover{background:#FFF0F0;color:var(--pc-danger);}
.pc-modal-body{padding:20px 24px;}
.pc-form-group{margin-bottom:16px;}
.pc-form-label{font-size:11.5px;font-weight:700;color:var(--pc-text-secondary);text-transform:uppercase;letter-spacing:0.6px;margin-bottom:6px;display:block;}
.pc-form-input{width:100%;padding:10px 13px;border:1.5px solid var(--pc-border);border-radius:10px;font-family:inherit;font-size:13.5px;color:var(--pc-text);outline:none;transition:var(--transition);box-sizing:border-box;background:#fff;}
.pc-form-input:focus{border-color:var(--pc-primary);box-shadow:0 0 0 3px rgba(231,76,60,0.08);}
.pc-form-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.pc-form-select{width:100%;padding:10px 13px;border:1.5px solid var(--pc-border);border-radius:10px;font-family:inherit;font-size:13.5px;color:var(--pc-text);outline:none;transition:var(--transition);box-sizing:border-box;background:#fff;cursor:pointer;}
.pc-form-select:focus{border-color:var(--pc-primary);}
.pc-form-textarea{width:100%;padding:10px 13px;border:1.5px solid var(--pc-border);border-radius:10px;font-family:inherit;font-size:13.5px;color:var(--pc-text);outline:none;transition:var(--transition);box-sizing:border-box;resize:vertical;min-height:80px;}
.pc-form-textarea:focus{border-color:var(--pc-primary);}
.pc-modal-foot{padding:0 24px 22px;display:flex;gap:10px;}
.pc-modal-cancel{flex:1;padding:12px;border-radius:10px;border:1.5px solid var(--pc-border);background:#fff;font-family:inherit;font-size:13.5px;font-weight:700;color:var(--pc-text-secondary);cursor:pointer;transition:var(--transition);}
.pc-modal-cancel:hover{border-color:var(--pc-text-secondary);}
.pc-modal-submit{flex:2;padding:12px;border-radius:10px;border:none;background:var(--pc-primary);color:#fff;font-family:inherit;font-size:13.5px;font-weight:700;cursor:pointer;transition:var(--transition);}
.pc-modal-submit:hover{background:var(--pc-primary-dark);}
/* Bouton demande sur la page missions */
.pc-request-btn{display:flex;align-items:center;gap:8px;padding:10px 20px;border-radius:10px;border:none;background:var(--pc-primary);color:#fff;font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;transition:var(--transition);}
.pc-request-btn:hover{background:var(--pc-primary-dark);}
/* Sélecteur de rôle */
.pc-selector-page{max-width:720px;margin:0 auto;padding:72px clamp(20px,4vw,48px) 60px;}
.pc-selector-header{text-align:center;margin-bottom:48px;}
.pc-selector-header h1{font-size:26px;font-weight:800;color:var(--pc-text);letter-spacing:-0.4px;}
.pc-selector-header p{font-size:14px;color:var(--pc-text-secondary);margin-top:8px;line-height:1.6;}
.pc-role-cards{display:grid;grid-template-columns:1fr 1fr;gap:20px;}
.pc-role-card{background:var(--pc-surface);border:2px solid var(--pc-border);border-radius:20px;padding:36px 28px;cursor:pointer;transition:var(--transition);text-align:center;animation:fadeUp 0.3s ease backwards;}
.pc-role-card:first-child{animation-delay:0.05s;}
.pc-role-card:last-child{animation-delay:0.12s;}
.pc-role-card.agency:hover{border-color:#6C5CE7;box-shadow:0 12px 40px rgba(108,92,231,0.1);transform:translateY(-4px);}
.pc-role-card.client:hover{border-color:var(--pc-primary);box-shadow:0 12px 40px rgba(231,76,60,0.1);transform:translateY(-4px);}
.pc-role-icon{width:64px;height:64px;border-radius:18px;display:flex;align-items:center;justify-content:center;margin:0 auto 20px;}
.pc-role-icon.agency{background:#F0EEFF;}
.pc-role-icon.client{background:#FEF5F4;}
.pc-role-title{font-size:18px;font-weight:800;color:var(--pc-text);margin-bottom:8px;}
.pc-role-desc{font-size:13px;color:var(--pc-text-secondary);line-height:1.6;}
.pc-role-badge{display:inline-block;margin-top:18px;padding:5px 14px;border-radius:20px;font-size:11.5px;font-weight:700;}
.pc-role-badge.agency{background:#F0EEFF;color:#6C5CE7;}
.pc-role-badge.client{background:#FEF5F4;color:var(--pc-primary);}
/* Vue agence */
.pc-agency-client-card{background:var(--pc-surface);border:1.5px solid var(--pc-border);border-radius:14px;overflow:hidden;margin-bottom:16px;animation:fadeUp 0.3s ease backwards;}
.pc-agency-client-head{padding:18px 20px;display:flex;align-items:center;gap:14px;}
.pc-agency-client-avatar{width:44px;height:44px;border-radius:12px;background:linear-gradient(135deg,#6C5CE7,#A29BFE);display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:15px;flex-shrink:0;}
.pc-agency-client-info{flex:1;}
.pc-agency-client-name{font-size:15px;font-weight:800;color:var(--pc-text);}
.pc-agency-client-meta{font-size:12px;color:var(--pc-text-secondary);margin-top:2px;}
.pc-agency-client-stats{display:flex;gap:8px;}
.pc-agency-stat{padding:4px 10px;border-radius:20px;font-size:11px;font-weight:700;}
.pc-agency-stat.sent{background:#EBF3FC;color:#2E86C1;}
.pc-agency-stat.accepted{background:#EBF9F4;color:var(--pc-success);}
.pc-agency-stat.pending{background:#FFF3E0;color:var(--pc-warning);}
.pc-agency-missions{border-top:1px solid var(--pc-border);}
.pc-agency-mission-row{display:flex;align-items:center;gap:12px;padding:13px 20px;border-bottom:1px solid var(--pc-border);}
.pc-agency-mission-row:last-child{border-bottom:none;}
.pc-agency-mission-name{font-size:13px;font-weight:700;color:var(--pc-text);flex:1;}
.pc-agency-mission-sub{font-size:12px;color:var(--pc-text-secondary);}
.pc-agency-send-btn{padding:6px 14px;border-radius:8px;border:1.5px solid var(--pc-border);background:var(--pc-surface);font-family:inherit;font-size:12px;font-weight:700;color:var(--pc-text-secondary);cursor:pointer;transition:var(--transition);}
.pc-agency-send-btn:hover{border-color:#6C5CE7;color:#6C5CE7;background:#F0EEFF;}
/* Boutons enPoste */
.pc-btn-a.stop{background:var(--pc-surface);color:var(--pc-danger);border-color:#FFD6D6;}
.pc-btn-a.stop:hover{background:#FFF0F0;border-color:var(--pc-danger);}
.pc-dw-btn.stop{background:#FFF0F0;color:var(--pc-danger);border-color:#FFD6D6;}
.pc-dw-btn.stop:hover{background:#FFD6D6;}
/* Calendrier prolongation */
.pc-prolong-picker{margin:0 18px 10px;display:none;background:#F7F8FC;border-radius:10px;padding:14px 16px;border:1.5px solid var(--pc-border);}
.pc-prolong-picker.open{display:block;}
.pc-prolong-picker-title{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.8px;color:var(--pc-text-secondary);margin-bottom:10px;}
.pc-prolong-picker-row{display:flex;gap:10px;align-items:center;}
.pc-prolong-picker-row label{font-size:11.5px;color:var(--pc-text-secondary);font-weight:600;white-space:nowrap;}
.pc-prolong-picker-row input[type="date"]{flex:1;padding:7px 10px;border:1.5px solid var(--pc-border);border-radius:8px;font-family:inherit;font-size:12.5px;color:var(--pc-text);outline:none;background:var(--pc-surface);}
.pc-prolong-picker-row input[type="date"]:focus{border-color:var(--pc-primary);}
.pc-prolong-confirm-btn{width:100%;margin-top:10px;padding:9px;border-radius:9px;border:none;background:var(--pc-primary);color:#fff;font-family:inherit;font-size:12.5px;font-weight:700;cursor:pointer;transition:var(--transition);}
.pc-prolong-confirm-btn:hover{background:var(--pc-primary-dark);}
/* Calendrier dans le drawer */
.pc-dw-prolong-form{margin-top:16px;background:#F7F8FC;border-radius:10px;padding:16px;}
.pc-dw-prolong-form .pc-prolong-picker-title{margin-bottom:12px;}
.pc-dw-prolong-dates{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-bottom:12px;}
.pc-dw-prolong-dates label{font-size:11px;color:var(--pc-text-secondary);font-weight:600;display:block;margin-bottom:4px;}
.pc-dw-prolong-dates input[type="date"]{width:100%;padding:8px 10px;border:1.5px solid var(--pc-border);border-radius:8px;font-family:inherit;font-size:12.5px;color:var(--pc-text);outline:none;box-sizing:border-box;}
.pc-dw-prolong-dates input[type="date"]:focus{border-color:var(--pc-primary);}

/* ========================================== */
/* RELANCES PAGE STYLES                       */
/* ========================================== */
.kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:28px;}
.kpi{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px 22px;transition:var(--transition);animation:fadeUp 0.4s ease backwards;}
.kpi:hover{box-shadow:0 4px 20px rgba(26,29,46,0.06);transform:translateY(-2px);}
.kpi-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
.kpi-icon{width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:18px;}
.kpi-trend{font-size:11px;font-weight:700;padding:3px 8px;border-radius:20px;}
.kpi-val{font-size:30px;font-weight:800;font-family:'Space Mono',monospace;letter-spacing:-1px;}
.kpi-label{font-size:12px;color:var(--text-secondary);margin-top:2px;}
.layout{display:grid;grid-template-columns:1fr 380px;gap:24px;}
.card-h{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:1px solid var(--border-light);}
.card-t{font-size:15px;font-weight:700;display:flex;align-items:center;gap:8px;}
.card-a{font-size:12px;color:var(--accent);font-weight:600;cursor:pointer;padding:5px 12px;border-radius:20px;transition:var(--transition);}
.card-a:hover{background:var(--accent-bg);}
.campaigns{padding:16px 24px;display:flex;flex-direction:column;gap:12px;}
.camp{padding:18px 20px;border:1.5px solid var(--border);border-radius:14px;transition:var(--transition);cursor:pointer;position:relative;overflow:hidden;}
.camp:hover{border-color:rgba(108,92,231,0.2);box-shadow:0 4px 20px rgba(26,29,46,0.05);transform:translateY(-2px);}
.camp.running{border-color:var(--green);background:linear-gradient(135deg,rgba(46,204,113,0.02),rgba(46,204,113,0.05));}
.camp.scheduled{border-color:var(--blue);background:linear-gradient(135deg,rgba(74,144,217,0.02),rgba(74,144,217,0.05));}
.camp.paused{border-color:var(--orange);background:linear-gradient(135deg,rgba(243,156,18,0.02),rgba(243,156,18,0.05));}
.camp-top{display:flex;align-items:center;gap:12px;margin-bottom:12px;}
.camp-icon{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
.camp-info{flex:1;min-width:0;}
.camp-name{font-size:14px;font-weight:700;}
.camp-desc{font-size:12px;color:var(--text-secondary);margin-top:2px;}
.camp-status{padding:4px 10px;border-radius:20px;font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;flex-shrink:0;}
.camp-status.running{background:var(--green-bg);color:var(--green);}
.camp-status.scheduled{background:var(--blue-bg);color:var(--blue);}
.camp-status.paused{background:var(--orange-bg);color:var(--orange);}
.camp-status.done{background:var(--accent-bg);color:var(--accent);}
.camp-stats{display:flex;gap:16px;}
.camp-stat{display:flex;align-items:center;gap:6px;}
.camp-stat-val{font-family:'Space Mono',monospace;font-size:14px;font-weight:700;}
.camp-stat-label{font-size:11px;color:var(--text-tertiary);}
.camp-bar{margin-top:12px;height:6px;background:var(--bg);border-radius:10px;overflow:hidden;}
.camp-bar-fill{height:100%;border-radius:10px;transition:width 1s ease;}
.camp-actions{display:flex;gap:6px;margin-top:12px;}
.camp-btn{padding:6px 14px;border-radius:8px;border:1px solid var(--border);background:var(--surface);font-family:inherit;font-size:11.5px;font-weight:600;cursor:pointer;transition:var(--transition);display:flex;align-items:center;gap:5px;color:var(--text-secondary);}
.camp-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.camp-btn.pause:hover{border-color:var(--orange);color:var(--orange);background:var(--orange-bg);}
.camp-btn.stop:hover{border-color:var(--red);color:var(--red);background:var(--red-bg);}
.feed{padding:8px 0;max-height:600px;overflow-y:auto;}
.feed-item{padding:14px 24px;display:flex;gap:12px;transition:var(--transition);border-bottom:1px solid var(--border-light);animation:slideIn 0.3s ease backwards;}
.feed-item:hover{background:var(--surface-hover);}
.feed-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;}
.feed-content{flex:1;min-width:0;}
.feed-msg{font-size:13px;line-height:1.5;}
.feed-msg b{font-weight:700;}
.feed-time{font-size:11px;color:var(--text-tertiary);margin-top:3px;}
.feed-tag{display:inline-block;padding:2px 8px;border-radius:12px;font-size:10px;font-weight:700;margin-left:4px;}
@keyframes slideIn{from{opacity:0;transform:translateX(-10px);}to{opacity:1;transform:translateX(0);}}
.modal-ov{display:none;position:fixed;inset:0;background:rgba(26,29,46,0.4);backdrop-filter:blur(4px);z-index:300;align-items:center;justify-content:center;}
.modal-ov.show{display:flex;}
.modal-h{padding:22px 24px;border-bottom:1px solid var(--border-light);display:flex;align-items:center;justify-content:space-between;}
.modal-t{font-size:17px;font-weight:700;display:flex;align-items:center;gap:8px;}
.modal-x{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text-tertiary);transition:var(--transition);border:none;background:none;font-size:18px;}
.modal-x:hover{background:var(--bg);color:var(--text-primary);}
.modal-body{padding:24px;}
.modal-footer{padding:16px 24px;border-top:1px solid var(--border-light);display:flex;justify-content:flex-end;gap:10px;}
.field{margin-bottom:18px;}
.field-label{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.8px;color:var(--text-tertiary);margin-bottom:6px;}
.field-input{width:100%;padding:10px 14px;border:1px solid var(--border);border-radius:8px;font-family:inherit;font-size:13.5px;outline:none;transition:var(--transition);background:var(--bg);}
.field-input:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-glow);background:var(--surface);}
select.field-input{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%236B7294' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;background-color:var(--bg);}
textarea.field-input{resize:vertical;min-height:80px;line-height:1.5;}
.field-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.type-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.type-card{padding:14px 12px;border:1.5px solid var(--border);border-radius:12px;cursor:pointer;transition:var(--transition);text-align:center;}
.type-card:hover{border-color:var(--accent-light);}
.type-card.on{border-color:var(--accent);background:var(--accent-bg);box-shadow:0 0 0 3px var(--accent-glow);}
.type-card-icon{font-size:24px;margin-bottom:6px;}
.type-card-name{font-size:12px;font-weight:700;}
.type-card-desc{font-size:10px;color:var(--text-tertiary);margin-top:2px;}
.ch-pills{display:flex;gap:8px;}
.ch-pill{padding:8px 16px;border-radius:50px;border:1.5px solid var(--border);background:var(--surface);font-size:12px;font-weight:600;cursor:pointer;transition:var(--transition);color:var(--text-secondary);display:flex;align-items:center;gap:6px;}
.ch-pill:hover{border-color:var(--accent);}
.ch-pill.on{background:var(--accent);color:#fff;border-color:var(--accent);}
.presence{margin-top:24px;}
.presence-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;padding:16px 24px;}
.pres-card{padding:16px 18px;border:1.5px solid var(--border);border-radius:14px;display:flex;align-items:center;gap:14px;transition:var(--transition);}
.pres-card:hover{box-shadow:0 4px 16px rgba(26,29,46,0.05);}
.pres-card.confirmed{border-color:var(--green);background:linear-gradient(135deg,rgba(46,204,113,0.03),rgba(46,204,113,0.06));}
.pres-card.waiting{border-color:var(--orange);background:linear-gradient(135deg,rgba(243,156,18,0.03),rgba(243,156,18,0.06));}
.pres-card.absent{border-color:var(--red);background:linear-gradient(135deg,rgba(231,76,60,0.03),rgba(231,76,60,0.06));}
.pres-av{width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:15px;color:#fff;flex-shrink:0;}
.pres-info{flex:1;min-width:0;}
.pres-nm{font-size:13.5px;font-weight:700;}
.pres-mission{font-size:11.5px;color:var(--text-secondary);margin-top:1px;}
.pres-status{padding:5px 12px;border-radius:20px;font-size:11px;font-weight:700;flex-shrink:0;}
.pres-status.confirmed{background:var(--green-bg);color:var(--green);}
.pres-status.waiting{background:var(--orange-bg);color:var(--orange);}
.pres-status.absent{background:var(--red-bg);color:var(--red);}
.pres-time{font-size:10px;color:var(--text-tertiary);margin-top:3px;}
.powered{text-align:center;padding:20px;font-size:11px;color:var(--text-tertiary);}
.powered span{font-weight:700;background:linear-gradient(135deg,var(--accent),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}

/* ========================================== */
/* MATCHING PAGE STYLES                       */
/* ========================================== */

:root {
  --bg: #F4F6FB;
  --surface: #FFFFFF;
  --surface-hover: #F8F9FD;
  --border: #E8ECF4;
  --border-light: #F0F2F8;
  --text-primary: #1A1D2E;
  --text-secondary: #6B7294;
  --text-tertiary: #9CA3C4;
  --accent: #6C5CE7;
  --accent-light: #A29BFE;
  --accent-bg: #F0EEFF;
  --accent-glow: rgba(108,92,231,0.12);
  --blue: #4A90D9;
  --blue-bg: #EBF3FC;
  --green: #2ECC71;
  --green-bg: #E8F8F0;
  --orange: #F39C12;
  --orange-bg: #FEF5E7;
  --red: #E74C3C;
  --red-bg: #FDECEB;
  --sidebar-w: 260px;
  --header-h: 72px;
  --radius: 16px;
  --radius-sm: 10px;
  --shadow-sm: 0 1px 3px rgba(26,29,46,0.04);
  --shadow-md: 0 4px 20px rgba(26,29,46,0.06);
  --shadow-lg: 0 8px 40px rgba(26,29,46,0.08);
  --shadow-accent: 0 4px 24px rgba(108,92,231,0.18);
  --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'DM Sans', -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text-primary);
  overflow-x: hidden;
}

/* ===== MAIN ===== */
.main { margin-left: var(--sidebar-w); min-height: 100vh; }

/* ===== HEADER ===== */
.header {
  height: var(--header-h);
  background: rgba(255,255,255,0.85); backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 32px; position: sticky; top: 0; z-index: 50;
}
.header-left { display: flex; flex-direction: column; }
.header-title { font-size: 22px; font-weight: 700; letter-spacing: -0.3px; display: flex; align-items: center; gap: 10px; }
.header-subtitle { font-size: 13px; color: var(--text-secondary); margin-top: 2px; }
.header-right { display: flex; align-items: center; gap: 12px; }
.header-btn {
  width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
  border-radius: var(--radius-sm); border: 1px solid var(--border); background: var(--surface);
  cursor: pointer; transition: var(--transition); color: var(--text-secondary); position: relative;
}
.header-btn:hover { border-color: var(--accent-light); color: var(--accent); }
.notif-dot { position: absolute; top: 8px; right: 8px; width: 8px; height: 8px; background: var(--red); border-radius: 50%; border: 2px solid var(--surface); }

/* ===== CONTENT ===== */
.content { padding: 28px 32px; max-width: 1400px; }

/* ===== MISSIONS TABS ===== */
.missions-tabs {
  display: flex; gap: 10px; margin-bottom: 24px; align-items: center;
  overflow-x: auto; padding-bottom: 4px;
}
.mission-tab {
  display: flex; align-items: center; gap: 10px;
  padding: 12px 18px; background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius-sm); cursor: pointer; transition: var(--transition);
  white-space: nowrap; min-width: 0;
}
.mission-tab:hover { border-color: var(--accent-light); box-shadow: var(--shadow-sm); }
.mission-tab.active {
  border-color: var(--accent); background: var(--accent-bg);
  box-shadow: 0 0 0 3px var(--accent-glow);
}
.mission-tab-urgency { width: 4px; height: 28px; border-radius: 4px; flex-shrink: 0; }
.mission-tab-urgency.high { background: var(--red); }
.mission-tab-urgency.medium { background: var(--orange); }
.mission-tab-urgency.low { background: var(--green); }
.mission-tab-info { min-width: 0; }
.mission-tab-title { font-size: 13px; font-weight: 600; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.mission-tab-meta { font-size: 11px; color: var(--text-tertiary); margin-top: 2px; }
.mission-tab-match {
  background: var(--accent); color: white; font-size: 11px; font-weight: 700;
  padding: 3px 8px; border-radius: 20px; margin-left: auto; flex-shrink: 0;
}
.new-mission-tab {
  display: flex; align-items: center; justify-content: center; gap: 8px;
  padding: 12px 20px; border: 2px dashed var(--border); border-radius: var(--radius-sm);
  cursor: pointer; transition: var(--transition); font-size: 13px; font-weight: 600;
  color: var(--text-tertiary); background: transparent; white-space: nowrap;
}
.new-mission-tab:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-bg); }

/* ===== MATCHING LAYOUT ===== */
.matching-layout {
  display: grid; grid-template-columns: 380px 1fr; gap: 24px;
}

.card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius); overflow: hidden;
  animation: fadeUp 0.5s ease backwards;
}
.card:nth-child(2) { animation-delay: 0.1s; }

.card-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 20px 24px; border-bottom: 1px solid var(--border-light);
}
.card-title { font-size: 15px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
.card-action {
  font-size: 12px; color: var(--accent); font-weight: 600; cursor: pointer;
  padding: 5px 12px; border-radius: 20px; transition: var(--transition);
}
.card-action:hover { background: var(--accent-bg); }

/* ===== FICHE DE POSTE ===== */
.fiche-content { padding: 20px 24px; }

.fiche-field { margin-bottom: 16px; }
.fiche-label {
  font-size: 11px; font-weight: 600; text-transform: uppercase;
  letter-spacing: 0.8px; color: var(--text-tertiary); margin-bottom: 6px;
}
.fiche-input {
  width: 100%; padding: 10px 14px; border: 1px solid var(--border);
  border-radius: 8px; font-family: inherit; font-size: 13.5px;
  outline: none; transition: var(--transition); background: var(--bg);
}
.fiche-input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); background: var(--surface); }
.fiche-input::placeholder { color: var(--text-tertiary); }

select.fiche-input { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%236B7294' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 14px center; background-color: var(--bg); }
select.fiche-input:focus { background-color: var(--surface); }

.fiche-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

.fiche-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
.fiche-tag {
  display: flex; align-items: center; gap: 5px;
  padding: 5px 12px; background: var(--accent-bg); color: var(--accent);
  border-radius: 20px; font-size: 12px; font-weight: 600;
}
.fiche-tag-remove { cursor: pointer; opacity: 0.6; transition: var(--transition); font-size: 14px; }
.fiche-tag-remove:hover { opacity: 1; }

.fiche-tag-input-wrap {
  display: flex; gap: 8px; margin-top: 8px;
}
.fiche-tag-input {
  flex: 1; padding: 7px 12px; border: 1px dashed var(--border);
  border-radius: 20px; font-family: inherit; font-size: 12px;
  outline: none; transition: var(--transition); background: transparent;
}
.fiche-tag-input:focus { border-color: var(--accent); border-style: solid; }
.fiche-tag-input::placeholder { color: var(--text-tertiary); }
.fiche-tag-add {
  width: 30px; height: 30px; border-radius: 50%; border: 1px solid var(--border);
  background: var(--surface); display: flex; align-items: center; justify-content: center;
  cursor: pointer; transition: var(--transition); color: var(--text-tertiary); font-size: 16px;
}
.fiche-tag-add:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-bg); }

/* ===== MATCH BUTTONS ===== */
.match-actions {
  padding: 16px 24px; border-top: 1px solid var(--border-light);
  display: flex; flex-direction: column; gap: 10px;
}

.match-btn {
  width: 100%; padding: 13px; border: none; border-radius: var(--radius-sm);
  font-family: inherit; font-size: 14px; font-weight: 700; cursor: pointer;
  transition: var(--transition); display: flex; align-items: center;
  justify-content: center; gap: 10px;
}

.match-btn-primary {
  background: linear-gradient(135deg, var(--accent), #8B7CF6); color: white;
  box-shadow: var(--shadow-accent);
}
.match-btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 28px rgba(108,92,231,0.3); }

.match-btn-secondary {
  background: var(--surface); color: var(--text-secondary);
  border: 1px solid var(--border) !important;
}
.match-btn-secondary:hover { border-color: var(--accent) !important; color: var(--accent); }

/* ===== MATCHING RESULTS ===== */
.results-status {
  padding: 16px 24px; border-bottom: 1px solid var(--border-light);
  display: flex; align-items: center; justify-content: space-between;
  background: linear-gradient(135deg, rgba(108,92,231,0.03), rgba(74,144,217,0.03));
}
.results-status-left { display: flex; align-items: center; gap: 10px; }
.results-count {
  font-family: 'Space Mono', monospace; font-size: 24px; font-weight: 700; color: var(--accent);
}
.results-count-label { font-size: 13px; color: var(--text-secondary); }
.results-sort {
  display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-tertiary);
}
.sort-select {
  padding: 5px 10px; border: 1px solid var(--border); border-radius: 6px;
  font-family: inherit; font-size: 12px; outline: none; cursor: pointer;
  background: var(--surface);
}

/* ===== CANDIDATE MATCH CARDS ===== */
.match-list { padding: 8px 0; }

.match-card {
  display: flex; align-items: center; gap: 16px;
  padding: 18px 24px; transition: var(--transition); cursor: pointer;
  border-bottom: 1px solid var(--border-light); position: relative;
}
.match-card:last-child { border-bottom: none; }
.match-card:hover { background: var(--surface-hover); }

.match-rank {
  font-family: 'Space Mono', monospace; font-size: 14px; font-weight: 700;
  color: var(--text-tertiary); min-width: 24px; text-align: center;
}
.match-rank.top { color: var(--accent); }

.match-avatar {
  width: 46px; height: 46px; border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  font-weight: 700; font-size: 15px; color: white; flex-shrink: 0;
}

.match-info { flex: 1; min-width: 0; }
.match-name { font-size: 14px; font-weight: 700; }
.match-sub { font-size: 12px; color: var(--text-secondary); margin-top: 2px; }

.match-criteria { display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap; }
.match-crit {
  display: flex; align-items: center; gap: 4px;
  padding: 3px 10px; border-radius: 20px; font-size: 11px; font-weight: 600;
}
.match-crit.ok { background: var(--green-bg); color: var(--green); }
.match-crit.partial { background: var(--orange-bg); color: var(--orange); }
.match-crit.no { background: var(--red-bg); color: var(--red); }

/* Match % ring */
.match-pct-wrap {
  display: flex; flex-direction: column; align-items: center; gap: 4px; flex-shrink: 0;
}
.match-ring { position: relative; width: 58px; height: 58px; }
.match-ring svg { transform: rotate(-90deg); width: 58px; height: 58px; }
.match-ring-bg { fill: none; stroke: var(--bg); stroke-width: 4; }
.match-ring-fill { fill: none; stroke-width: 4; stroke-linecap: round; transition: stroke-dashoffset 1s ease; }
.match-ring-text {
  position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
  font-family: 'Space Mono', monospace; font-size: 14px; font-weight: 700;
}
.match-pct-label { font-size: 10px; color: var(--text-tertiary); font-weight: 600; }

/* Match actions */
.match-card-actions { display: flex; gap: 6px; flex-shrink: 0; }
.match-action-btn {
  width: 34px; height: 34px; border-radius: 8px; border: 1px solid var(--border);
  background: var(--surface); display: flex; align-items: center; justify-content: center;
  cursor: pointer; color: var(--text-tertiary); transition: var(--transition); font-size: 15px;
}
.match-action-btn:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-bg); }

/* ===== SCANNING ANIMATION ===== */
.scanning-overlay {
  display: none; flex-direction: column; align-items: center; justify-content: center;
  padding: 60px 24px; gap: 20px;
}
.scanning-overlay.show { display: flex; }

.scan-spinner {
  width: 64px; height: 64px; border-radius: 50%;
  border: 4px solid var(--border); border-top-color: var(--accent);
  animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

.scan-text { font-size: 15px; font-weight: 600; color: var(--text-secondary); }
.scan-sub { font-size: 13px; color: var(--text-tertiary); margin-top: -12px; }

.scan-progress-bar {
  width: 240px; height: 6px; background: var(--bg); border-radius: 10px; overflow: hidden;
}
.scan-progress-fill {
  height: 100%; width: 0%; border-radius: 10px;
  background: linear-gradient(90deg, var(--accent), var(--accent-light));
  transition: width 0.3s ease;
}

/* ===== NEW FICHE MODAL ===== */
.modal-overlay {
  display: none; position: fixed; inset: 0; background: rgba(26,29,46,0.4);
  backdrop-filter: blur(4px); z-index: 300; align-items: center; justify-content: center;
}
.modal-overlay.show { display: flex; }

.modal {
  background: var(--surface); border-radius: var(--radius); width: 520px;
  max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-lg);
  animation: modalIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}
@keyframes modalIn { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }

.modal-header {
  padding: 20px 24px; border-bottom: 1px solid var(--border-light);
  display: flex; align-items: center; justify-content: space-between;
}
.modal-title { font-size: 17px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
.modal-close {
  width: 32px; height: 32px; border-radius: 8px; display: flex;
  align-items: center; justify-content: center; cursor: pointer;
  color: var(--text-tertiary); transition: var(--transition); border: none; background: none;
}
.modal-close:hover { background: var(--bg); color: var(--text-primary); }
.modal-body { padding: 24px; }
.modal-footer {
  padding: 16px 24px; border-top: 1px solid var(--border-light);
  display: flex; justify-content: flex-end; gap: 10px;
}

/* ===== LIVE DOT ===== */
.live-dot {
  width: 8px; height: 8px; background: var(--green); border-radius: 50%;
  display: inline-block; animation: livePulse 2s ease-in-out infinite;
}
@keyframes livePulse {
  0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(46,204,113,0.4); }
  50% { opacity: 0.8; box-shadow: 0 0 0 6px rgba(46,204,113,0); }
}

/* ===== CHAT WIDGET ===== */
.chat-widget { position: fixed; bottom: 28px; right: 28px; z-index: 200; }
.chat-bubble {
  width: 60px; height: 60px;
  background: linear-gradient(135deg, var(--accent), #8B7CF6);
  border-radius: 20px; display: flex; align-items: center; justify-content: center;
  cursor: pointer; box-shadow: var(--shadow-accent), 0 8px 32px rgba(108,92,231,0.3);
  transition: var(--transition); color: white;
}
.chat-bubble:hover { transform: scale(1.08); }
.chat-bubble .pulse {
  position: absolute; width: 60px; height: 60px; border-radius: 20px;
  background: var(--accent); animation: pulse 2s ease-in-out infinite; z-index: -1;
}
@keyframes pulse { 0%, 100% { opacity: 0; transform: scale(1); } 50% { opacity: 0.3; transform: scale(1.3); } }

/* ===== POWERED BY ===== */
.powered-by { text-align: center; padding: 20px; font-size: 11px; color: var(--text-tertiary); }
.powered-by span { font-weight: 700; background: linear-gradient(135deg, var(--accent), var(--blue)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

/* ===== TOAST ===== */
.toast {
  position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(20px);
  background: var(--text-primary); color: white; padding: 14px 24px; border-radius: var(--radius-sm);
  font-size: 13.5px; font-weight: 600; box-shadow: var(--shadow-lg); opacity: 0;
  transition: all 0.3s ease; pointer-events: none; z-index: 300;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* ===== ANIMATIONS ===== */
@keyframes fadeUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }

::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

/* ===== EMPTY STATE ===== */
.empty-state {
  display: flex; flex-direction: column; align-items: center;
  justify-content: center; padding: 60px 24px; gap: 12px;
}
.empty-icon { font-size: 48px; margin-bottom: 8px; }
.empty-title { font-size: 16px; font-weight: 700; color: var(--text-primary); }
.empty-desc { font-size: 13px; color: var(--text-tertiary); text-align: center; max-width: 280px; line-height: 1.6; }


/* ===== MATCHING REFONTE ===== */
/* Grid candidats résultats */
.mtc-grid{display:grid;grid-template-columns:repeat(2,1fr);gap:14px;padding:16px;}
/* Card */
.mtc-card{background:var(--surface);border:1.5px solid var(--border);border-radius:16px;overflow:hidden;transition:var(--transition);animation:fadeUp 0.35s ease backwards;}
.mtc-card:hover{box-shadow:var(--shadow-md);transform:translateY(-2px);border-color:rgba(108,92,231,0.2);}
/* Accent strip */
.mtc-bar{height:3px;width:100%;}
/* Head */
.mtc-head{padding:16px 16px 12px;display:flex;align-items:flex-start;gap:12px;}
/* Avatar group (avatar + rank corner dot) */
.mtc-av-group{position:relative;flex-shrink:0;}
.mtc-av{width:50px;height:50px;border-radius:14px;display:flex;align-items:center;justify-content:center;font:800 16px 'DM Sans',sans-serif;color:#fff;}
.mtc-rank-dot{position:absolute;top:-7px;right:-7px;width:20px;height:20px;border-radius:50%;border:2px solid var(--surface);display:flex;align-items:center;justify-content:center;font:700 9px 'Space Mono',monospace;z-index:1;}
.mtc-rank-dot.gold{background:#FDCB6E;color:#7A5200;}
.mtc-rank-dot.silver{background:#B2BEC3;color:#fff;}
.mtc-rank-dot.bronze{background:#E17055;color:#fff;}
.mtc-rank-dot.other{background:var(--bg);color:var(--text-tertiary);border-color:var(--border);}
/* Info */
.mtc-info{flex:1;min-width:0;}
.mtc-name{font-size:14px;font-weight:800;color:var(--text-primary);}
.mtc-sub{font-size:11.5px;color:var(--text-secondary);margin-top:2px;line-height:1.4;}
.mtc-status{display:inline-flex;align-items:center;gap:5px;margin-top:7px;padding:3px 10px;border-radius:20px;font-size:10.5px;font-weight:700;}
.mtc-status.available{background:var(--green-bg);color:var(--green);}
.mtc-status.pending{background:var(--orange-bg);color:var(--orange);}
.mtc-status.placed{background:var(--blue-bg);color:var(--blue);}
/* Score badge (remplace le ring) */
.mtc-score{flex-shrink:0;width:62px;height:62px;border-radius:14px;display:flex;flex-direction:column;align-items:center;justify-content:center;gap:1px;border:2px solid;}
.mtc-score.green{background:var(--green-bg);border-color:rgba(46,204,113,0.25);}
.mtc-score.orange{background:var(--orange-bg);border-color:rgba(243,156,18,0.25);}
.mtc-score.red{background:var(--red-bg);border-color:rgba(231,76,60,0.25);}
.mtc-score-num{font:800 20px 'Space Mono',monospace;line-height:1;}
.mtc-score.green .mtc-score-num{color:var(--green);}
.mtc-score.orange .mtc-score-num{color:var(--orange);}
.mtc-score.red .mtc-score-num{color:var(--red);}
.mtc-score-lbl{font-size:9px;font-weight:600;text-transform:uppercase;letter-spacing:0.3px;color:var(--text-tertiary);}
/* Criteria pills */
.mtc-crits{padding:0 16px 12px;display:flex;flex-wrap:wrap;gap:5px;}
.mtc-crit{display:flex;align-items:center;gap:3px;padding:3px 9px;border-radius:20px;font-size:11px;font-weight:600;}
.mtc-crit.ok{background:var(--green-bg);color:var(--green);}
.mtc-crit.partial{background:var(--orange-bg);color:var(--orange);}
.mtc-crit.no{background:var(--red-bg);color:var(--red);}
/* Actions */
.mtc-foot{padding:10px 16px 14px;border-top:1px solid var(--border-light);display:flex;gap:6px;}
.mtc-act{flex:1;display:flex;align-items:center;justify-content:center;gap:4px;padding:8px 4px;border-radius:9px;border:1.5px solid var(--border);background:var(--surface);font:700 11.5px 'DM Sans',sans-serif;color:var(--text-secondary);cursor:pointer;transition:var(--transition);}
.mtc-act:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.mtc-act.contact:hover{border-color:var(--green);color:var(--green);background:var(--green-bg);}
.mtc-act.primary{background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;border-color:transparent;}
.mtc-act.primary:hover{transform:translateY(-1px);box-shadow:var(--shadow-accent);}
/* Results panel header */
.mtc-results-head{padding:16px 20px 14px;background:linear-gradient(135deg,rgba(108,92,231,0.03),rgba(74,144,217,0.03));border-bottom:1px solid var(--border-light);}
.mtc-results-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
.mtc-results-left{display:flex;align-items:center;gap:14px;}
.mtc-count{font:700 30px 'Space Mono',monospace;color:var(--accent);line-height:1;}
.mtc-count-label{font-size:13px;font-weight:600;color:var(--text-secondary);}
.mtc-count-sub{font-size:11px;color:var(--text-tertiary);margin-top:2px;}
.mtc-filters{display:flex;gap:6px;flex-wrap:wrap;}
/* Filter chip for matching (scoped to avoid conflict with scoring) */
.mtc-filter-chip{padding:5px 14px;border:1px solid var(--border);border-radius:20px;font-size:12px;font-weight:600;color:var(--text-secondary);cursor:pointer;transition:var(--transition);background:var(--surface);}
.mtc-filter-chip:hover,.mtc-filter-chip.active{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
/* Mission summary KPIs in fiche */
.mtc-mission-kpis{display:grid;grid-template-columns:repeat(3,1fr);border-bottom:1px solid var(--border-light);}
.mtc-kpi{padding:14px 12px;text-align:center;border-right:1px solid var(--border-light);}
.mtc-kpi:last-child{border-right:none;}
.mtc-kpi-val{font:700 20px 'Space Mono',monospace;color:var(--text-primary);}
.mtc-kpi-label{font-size:9.5px;color:var(--text-tertiary);text-transform:uppercase;letter-spacing:0.5px;margin-top:3px;font-weight:600;}
.mtc-urgency-badge{display:inline-flex;align-items:center;gap:5px;padding:3px 10px;border-radius:20px;font-size:10.5px;font-weight:700;}
.mtc-urgency-badge.high{background:var(--red-bg);color:var(--red);}
.mtc-urgency-badge.medium{background:var(--orange-bg);color:var(--orange);}
.mtc-urgency-badge.low{background:var(--green-bg);color:var(--green);}
/* Périmètre radius pills */
.fiche-radius-pills{display:flex;flex-wrap:wrap;gap:6px;margin-top:8px;}
.fiche-radius-pill{padding:5px 13px;border:1.5px solid var(--border);border-radius:20px;font-size:12px;font-weight:700;color:var(--text-secondary);cursor:pointer;transition:var(--transition);background:var(--surface);}
.fiche-radius-pill:hover{border-color:var(--accent);color:var(--accent);}
.fiche-radius-pill.active{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
/* Localisation group */
.fiche-loc-group{position:relative;}
.fiche-loc-icon{position:absolute;left:12px;top:50%;transform:translateY(-50%);color:var(--text-tertiary);pointer-events:none;}
.fiche-loc-group .fiche-input{padding-left:34px;}
/* Compact section label */
.fiche-section-label{font-size:10px;font-weight:700;text-transform:uppercase;letter-spacing:0.7px;color:var(--text-tertiary);margin-bottom:6px;margin-top:2px;}

/* ========================================== */
/* JOBBOARDS PAGE — WORKABLE STYLE            */
/* ========================================== */
/* Platform logo base */
.jb-logo{display:inline-flex;align-items:center;justify-content:center;font-size:8px;font-weight:800;color:#fff;font-family:'Space Mono',monospace;border-radius:5px;flex-shrink:0;}
.jb-logo.ft{background:#003189;}
.jb-logo.in{background:#2D64BC;}
.jb-logo.hw{background:#E85D04;}
.jb-logo.mo{background:#6A1EFF;}
.jb-logo.ap{background:#005C8B;}
.jb-logo.mj{background:#0081C9;}
/* Stats bar */
.jb-statsbar{display:flex;align-items:stretch;border-bottom:1px solid var(--border);background:var(--surface);}
.jb-stat{padding:18px 28px;border-right:1px solid var(--border-light);display:flex;flex-direction:column;gap:2px;}
.jb-stat:last-child{border-right:none;}
.jb-stat-val{font-size:22px;font-weight:800;font-family:'Space Mono',monospace;letter-spacing:-0.5px;}
.jb-stat-label{font-size:11px;color:var(--text-tertiary);font-weight:500;}
.jb-stat-trend{font-size:10px;font-weight:700;color:var(--green);}
/* Top toolbar */
.jb-toolbar{display:flex;align-items:center;gap:12px;padding:14px 28px;border-bottom:1px solid var(--border);background:var(--surface);}
.jb-search{display:flex;align-items:center;gap:8px;padding:8px 14px;border:1.5px solid var(--border);border-radius:10px;font-size:13px;color:var(--text-tertiary);flex:1;max-width:320px;background:var(--bg);transition:var(--transition);}
.jb-search:focus-within{border-color:var(--accent);background:white;}
.jb-search input{border:none;background:none;font-family:inherit;font-size:13px;color:var(--text-primary);outline:none;width:100%;}
.jb-search input::placeholder{color:var(--text-tertiary);}
/* Status tabs (Workable style — underline) */
.jb-filter-tabs{display:flex;gap:0;padding:0 28px;border-bottom:1px solid var(--border);background:var(--surface);}
.jb-ftab{padding:12px 16px;font-size:13px;font-weight:500;color:var(--text-secondary);cursor:pointer;border-bottom:2px solid transparent;transition:var(--transition);white-space:nowrap;display:flex;align-items:center;gap:6px;}
.jb-ftab:hover{color:var(--text-primary);}
.jb-ftab.active{color:var(--accent);border-bottom-color:var(--accent);font-weight:600;}
.jb-ftab-count{font-size:11px;font-weight:700;background:var(--bg);border-radius:20px;padding:1px 7px;color:var(--text-secondary);}
.jb-ftab.active .jb-ftab-count{background:var(--accent-bg);color:var(--accent);}
/* Main layout */
.jb-body{display:grid;grid-template-columns:1fr 300px;min-height:calc(100vh - 280px);}
.jb-main{border-right:1px solid var(--border);}
/* Jobs table */
.jb-table{width:100%;border-collapse:collapse;}
.jb-thead tr{border-bottom:1px solid var(--border);}
.jb-th{padding:10px 16px;text-align:left;font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:0.8px;color:var(--text-tertiary);white-space:nowrap;background:var(--surface);}
.jb-th:first-child{padding-left:28px;}
.jb-th:last-child{padding-right:28px;}
.jb-row{border-bottom:1px solid var(--border-light);transition:background 0.15s;cursor:pointer;position:relative;}
.jb-row:hover{background:#FAFBFF;}
.jb-td{padding:14px 16px;vertical-align:middle;}
.jb-td:first-child{padding-left:28px;}
.jb-td:last-child{padding-right:28px;}
/* Job title */
.jb-title{font-size:13.5px;font-weight:700;color:var(--text-primary);margin-bottom:3px;}
.jb-meta{font-size:11.5px;color:var(--text-secondary);display:flex;align-items:center;gap:6px;}
/* Platform row */
.jb-plat-row{display:flex;gap:5px;align-items:center;}
.jb-plat-chip{display:flex;align-items:center;gap:4px;padding:3px 8px;border-radius:20px;border:1px solid var(--border-light);background:white;font-size:11px;font-weight:600;color:var(--text-secondary);}
.jb-plat-chip-count{font-family:'Space Mono',monospace;font-size:10px;font-weight:700;color:var(--accent);}
/* Pipeline stages */
.jb-pipeline{display:flex;gap:2px;align-items:center;}
.jb-pip-stage{display:flex;align-items:center;gap:3px;padding:3px 7px;border-radius:5px;font-size:11px;}
.jb-pip-stage.new{background:#EEF2FF;color:#4F46E5;}
.jb-pip-stage.screen{background:#F0FDF4;color:#16A34A;}
.jb-pip-stage.interview{background:#FFF7ED;color:#EA580C;}
.jb-pip-sep{color:var(--border);font-size:14px;margin:0 1px;}
/* Status badge */
.jb-status{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:20px;font-size:11px;font-weight:700;}
.jb-status.active{background:#ECFDF5;color:#059669;}
.jb-status.active::before{content:'';width:6px;height:6px;border-radius:50%;background:#10B981;display:inline-block;}
.jb-status.paused{background:#FFF7ED;color:#EA580C;}
.jb-status.paused::before{content:'';width:6px;height:6px;border-radius:50%;background:#F97316;display:inline-block;}
/* Hover actions */
.jb-actions{display:flex;gap:5px;align-items:center;opacity:0;transition:opacity 0.15s;}
.jb-row:hover .jb-actions{opacity:1;}
.jb-act-btn{padding:5px 11px;border-radius:7px;border:1px solid var(--border);background:white;font-family:inherit;font-size:11.5px;font-weight:600;cursor:pointer;transition:var(--transition);color:var(--text-secondary);white-space:nowrap;}
.jb-act-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.jb-act-btn.danger:hover{border-color:var(--red);color:var(--red);background:var(--red-bg);}
/* Sidebar connections */
.jb-sidebar{padding:0;}
.jb-sb-section{padding:16px 20px;border-bottom:1px solid var(--border-light);}
.jb-sb-title{font-size:11px;font-weight:700;text-transform:uppercase;letter-spacing:0.8px;color:var(--text-tertiary);margin-bottom:12px;}
.jb-conn-row{display:flex;align-items:center;gap:10px;padding:9px 0;border-bottom:1px solid var(--border-light);}
.jb-conn-row:last-child{border-bottom:none;}
.jb-conn-info{flex:1;min-width:0;}
.jb-conn-name{font-size:12.5px;font-weight:600;}
.jb-conn-count{font-size:11px;color:var(--text-tertiary);}
.jb-conn-btn{font-size:11px;font-weight:700;padding:4px 10px;border-radius:20px;cursor:pointer;border:none;transition:var(--transition);flex-shrink:0;}
.jb-conn-btn.on{background:#ECFDF5;color:#059669;}
.jb-conn-btn.on:hover{background:#D1FAE5;}
.jb-conn-btn.off{background:var(--bg);color:var(--text-tertiary);border:1px solid var(--border);}
.jb-conn-btn.off:hover{background:var(--accent-bg);color:var(--accent);border-color:var(--accent);}
/* Bar stats per platform */
.jb-bar-row{display:flex;align-items:center;gap:8px;margin-bottom:8px;}
.jb-bar-label{display:flex;align-items:center;gap:5px;font-size:12px;font-weight:500;min-width:100px;}
.jb-bar-track{flex:1;height:5px;background:var(--bg);border-radius:10px;overflow:hidden;}
.jb-bar-fill{height:100%;border-radius:10px;}
.jb-bar-count{font-family:'Space Mono',monospace;font-size:11px;font-weight:700;color:var(--text-secondary);min-width:22px;text-align:right;}
/* Candidatures tab */
.jb-cand-row{display:flex;align-items:center;gap:12px;padding:12px 28px;border-bottom:1px solid var(--border-light);cursor:pointer;transition:background 0.15s;}
.jb-cand-row:hover{background:#FAFBFF;}
.jb-cand-av{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:12px;color:#fff;flex-shrink:0;}
.jb-cand-info{flex:1;min-width:0;}
.jb-cand-name{font-size:13px;font-weight:600;}
.jb-cand-sub{font-size:11.5px;color:var(--text-secondary);display:flex;align-items:center;gap:6px;margin-top:2px;}
.jb-new-dot{width:7px;height:7px;border-radius:50%;background:var(--accent);flex-shrink:0;}
.jb-cand-time{font-size:11px;color:var(--text-tertiary);white-space:nowrap;}
/* Publish modal */
.jb-modal{background:var(--surface);border-radius:20px;width:560px;max-height:90vh;overflow-y:auto;box-shadow:var(--shadow-lg);}
.jb-platform-sel{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.jb-platform-opt{display:flex;flex-direction:column;align-items:center;gap:6px;padding:12px;border:2px solid var(--border);border-radius:12px;cursor:pointer;transition:var(--transition);font-size:12px;font-weight:600;color:var(--text-secondary);}
.jb-platform-opt:hover{border-color:rgba(108,92,231,0.3);background:var(--accent-bg);}
.jb-platform-opt.selected{border-color:var(--accent);background:var(--accent-bg);color:var(--accent);}
.jb-platform-opt.disabled{opacity:0.4;cursor:not-allowed;}
.jb-platform-opt-logo{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:11px;font-weight:800;color:#fff;font-family:'Space Mono',monospace;}
/* Source filter pills */
.jb-src-pills{display:flex;gap:6px;flex-wrap:wrap;margin-bottom:12px;padding:12px 28px 0;}
.jb-src-pill{padding:5px 12px;border-radius:20px;border:1.5px solid var(--border);background:white;font-size:12px;font-weight:600;color:var(--text-secondary);cursor:pointer;transition:var(--transition);display:flex;align-items:center;gap:5px;}
.jb-src-pill:hover{border-color:var(--accent);color:var(--accent);}
.jb-src-pill.active{border-color:var(--accent);background:var(--accent-bg);color:var(--accent);}
</style>
</head>
<body>

<!-- ===== SIDEBAR ===== -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="logo-icon">IZ</div>
    <div class="logo-text">IZYSS</div>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-section-label">Principal</div>
    <div class="nav-item" data-page="dashboard" onclick="navigateTo('dashboard')">
      <div class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="3" y="3" width="7" height="7" rx="1.5"/><rect x="14" y="3" width="7" height="7" rx="1.5"/><rect x="3" y="14" width="7" height="7" rx="1.5"/><rect x="14" y="14" width="7" height="7" rx="1.5"/></svg></div>
      Dashboard
    </div>
    <div class="nav-item" data-page="candidats" onclick="navigateTo('candidats')">
      <div class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg></div>
      Candidats
      <span class="nav-badge">847</span>
    </div>
    <div class="nav-item" data-page="missions" onclick="navigateTo('missions')">
      <div class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/></svg></div>
      Missions
      <span class="nav-badge">12</span>
    </div>
    <div class="nav-item" data-page="contrats" onclick="navigateTo('contrats')">
      <div class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></div>
      Contrats
    </div>
    <div class="nav-section-label">Outils IA</div>
    <div class="nav-item active" data-page="matching" onclick="navigateTo('matching')">
      <div class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div>
      Matching
    </div>
    <div class="nav-item" data-page="scoring" onclick="navigateTo('scoring')">
      <div class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg></div>
      Scoring CV
    </div>
    <div class="nav-item" data-page="relances" onclick="navigateTo('relances')">
      <div class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.362 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.338 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg></div>
      Relances
    </div>
    <div class="nav-item" data-page="jobboards" onclick="navigateTo('jobboards')">
      <div class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="2" y="3" width="20" height="14" rx="2"/><path d="M8 21h8"/><path d="M12 17v4"/><circle cx="17" cy="8" r="2"/><path d="M19 8h1"/><path d="M15 8h-1"/><path d="M17 6V5"/><path d="M17 10v1"/></svg></div>
      Jobboards
      <span class="nav-badge" style="background:var(--green)">4</span>
    </div>
    <div class="nav-section-label">Espace Client</div>
    <div class="nav-item" data-page="portail" onclick="navigateTo('portail')">
      <div class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.32 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></div>
      Portail Client
    </div>
  </nav>
  <div class="sidebar-footer">
    <div class="agency-card">
      <div class="agency-avatar">TS</div>
      <div class="agency-info">
        <div class="agency-name">TalentStaff Lyon</div>
        <div class="agency-role">Administrateur</div>
      </div>
    </div>
  </div>
</aside>

<!-- ============================= -->
<!-- PAGE: MATCHING (default)      -->
<!-- ============================= -->
<div class="page-section active" id="page-matching">
<!-- SIDEBAR -->
<!-- MAIN -->
<div class="main">
  <header class="header">
    <div class="header-left">
      <div class="header-title">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        Matching IA
      </div>
      <div class="header-subtitle">Trouvez les meilleurs candidats pour chaque mission en un clic</div>
    </div>
    <div class="header-right">
      <div style="display:flex;align-items:center;gap:8px;padding:7px 14px;background:var(--green-bg);border-radius:20px;font-size:12px;font-weight:600;color:var(--green);">
        <span class="live-dot"></span> IA active
      </div>
      <div class="header-btn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
        <div class="notif-dot"></div>
      </div>
    </div>
  </header>

  <div class="content">
    <!-- MISSIONS TABS -->
    <div class="missions-tabs" id="missionTabs">
      <div class="mission-tab active" onclick="selectMission(0, this)">
        <div class="mission-tab-urgency high"></div>
        <div class="mission-tab-info">
          <div class="mission-tab-title">5 Caristes CACES 3</div>
          <div class="mission-tab-meta">📍 Carrefour — Lyon 7e</div>
        </div>
        <div class="mission-tab-match">8</div>
      </div>
      <div class="mission-tab" onclick="selectMission(1, this)">
        <div class="mission-tab-urgency high"></div>
        <div class="mission-tab-info">
          <div class="mission-tab-title">3 Prépa. commandes</div>
          <div class="mission-tab-meta">📍 Amazon — Saint-Priest</div>
        </div>
        <div class="mission-tab-match">5</div>
      </div>
      <div class="mission-tab" onclick="selectMission(2, this)">
        <div class="mission-tab-urgency medium"></div>
        <div class="mission-tab-info">
          <div class="mission-tab-title">2 Agents production</div>
          <div class="mission-tab-meta">📍 Sanofi — Gerland</div>
        </div>
        <div class="mission-tab-match">3</div>
      </div>
      <div class="new-mission-tab" onclick="openNewFiche()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Nouvelle fiche
      </div>
    </div>

    <div class="matching-layout">
      <!-- LEFT: FICHE DE POSTE -->
      <div class="card">
        <div class="card-header">
          <div>
            <div class="card-title">📋 Fiche de poste</div>
            <div class="card-subtitle" id="ficheSubtitle">Carrefour Supply Chain · Lyon 7e</div>
          </div>
          <div class="card-action" onclick="editFiche()">Modifier</div>
        </div>

        <!-- KPIs résumé mission -->
        <div class="mtc-mission-kpis" id="ficheKpis">
          <div class="mtc-kpi">
            <div class="mtc-kpi-val" id="kpiPostes">5</div>
            <div class="mtc-kpi-label">Postes</div>
          </div>
          <div class="mtc-kpi">
            <div class="mtc-kpi-val" id="kpiRayon">20 km</div>
            <div class="mtc-kpi-label">Rayon</div>
          </div>
          <div class="mtc-kpi">
            <div id="kpiUrgency" class="mtc-urgency-badge high">🔴 Urgent</div>
            <div class="mtc-kpi-label" style="margin-top:6px;">Priorité</div>
          </div>
        </div>

        <div class="fiche-content" id="ficheContent">
          <!-- Intitulé -->
          <div class="fiche-field">
            <div class="fiche-label">Intitulé du poste</div>
            <input class="fiche-input" id="fichePoste" value="Cariste CACES 3" placeholder="Ex : Cariste CACES 3, Agent de prod..." />
          </div>

          <!-- Client -->
          <div class="fiche-field">
            <div class="fiche-label">Client</div>
            <input class="fiche-input" id="ficheClient" value="Carrefour Supply Chain" placeholder="Nom du client" />
          </div>

          <!-- Localisation + Périmètre -->
          <div class="fiche-field">
            <div class="fiche-label">Ville de la mission</div>
            <div class="fiche-loc-group">
              <svg class="fiche-loc-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
              <input class="fiche-input" id="ficheLieu" value="Lyon 7e" placeholder="Ex : Lyon, Villeurbanne, Saint-Priest..." />
            </div>
            <div class="fiche-section-label" style="margin-top:12px;">Périmètre de recherche candidats</div>
            <div class="fiche-radius-pills" id="ficheRadiusPills">
              <div class="fiche-radius-pill" onclick="setRadius(5,this)">5 km</div>
              <div class="fiche-radius-pill" onclick="setRadius(10,this)">10 km</div>
              <div class="fiche-radius-pill active" onclick="setRadius(20,this)">20 km</div>
              <div class="fiche-radius-pill" onclick="setRadius(30,this)">30 km</div>
              <div class="fiche-radius-pill" onclick="setRadius(50,this)">50 km</div>
            </div>
          </div>

          <!-- Postes + Horaires -->
          <div class="fiche-row">
            <div class="fiche-field">
              <div class="fiche-label">Postes à pourvoir</div>
              <input class="fiche-input" type="number" id="ficheNb" value="5" min="1" />
            </div>
            <div class="fiche-field">
              <div class="fiche-label">Horaires</div>
              <select class="fiche-input" id="ficheHoraires">
                <option selected>Journée (8h-16h)</option>
                <option>Matin (5h-13h)</option>
                <option>Après-midi (13h-21h)</option>
                <option>Nuit (21h-5h)</option>
                <option>2x8</option>
                <option>3x8</option>
              </select>
            </div>
          </div>

          <!-- Compétences / CACES -->
          <div class="fiche-field">
            <div class="fiche-label">Compétences & CACES requis</div>
            <div class="fiche-tags" id="ficheTags">
              <div class="fiche-tag">CACES 3 <span class="fiche-tag-remove" onclick="removeTag(this)">×</span></div>
              <div class="fiche-tag">Expérience entrepôt <span class="fiche-tag-remove" onclick="removeTag(this)">×</span></div>
              <div class="fiche-tag">Visite médicale à jour <span class="fiche-tag-remove" onclick="removeTag(this)">×</span></div>
            </div>
            <div class="fiche-tag-input-wrap">
              <input class="fiche-tag-input" id="newTagInput" placeholder="Ajouter une compétence..." onkeydown="if(event.key==='Enter')addTag()" />
              <div class="fiche-tag-add" onclick="addTag()">+</div>
            </div>
          </div>
        </div>

        <div class="match-actions">
          <button class="match-btn match-btn-primary" onclick="runMatching()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
            Lancer le matching IA
          </button>
          <button class="match-btn match-btn-secondary" onclick="runMatching()">
            🔄 Relancer l'analyse
          </button>
        </div>
      </div>

      <!-- RIGHT: RESULTS -->
      <div class="card" id="resultsCard">
        <div class="mtc-results-head">
          <div class="mtc-results-top">
            <div class="mtc-results-left">
              <div class="mtc-count" id="resultsCount">8</div>
              <div>
                <div class="mtc-count-label">candidats compatibles</div>
                <div class="mtc-count-sub">sur 847 analysés · 2.3s</div>
              </div>
            </div>
            <div class="results-sort">
              Trier par
              <select class="sort-select">
                <option>% compatibilité</option>
                <option>Disponibilité</option>
                <option>Score CV</option>
                <option>Proximité</option>
              </select>
            </div>
          </div>
          <div class="mtc-filters">
            <div class="mtc-filter-chip active" onclick="filterMatches('all', this)">Tous</div>
            <div class="mtc-filter-chip" onclick="filterMatches('top', this)">≥ 85%</div>
            <div class="mtc-filter-chip" onclick="filterMatches('available', this)">Disponibles</div>
          </div>
        </div>

        <div class="mtc-grid" id="matchList"></div>

        <div class="scanning-overlay" id="scanOverlay">
          <div class="scan-spinner"></div>
          <div class="scan-text">Analyse de la CVthèque en cours...</div>
          <div class="scan-sub" id="scanSub">0 / 847 profils analysés</div>
          <div class="scan-progress-bar">
            <div class="scan-progress-fill" id="scanFill"></div>
          </div>
        </div>

        <div class="powered-by">
          Propulsé par <span>IZYSS</span> — Intelligence Artificielle au service de l'intérim
        </div>
      </div>
    </div>
  </div>
</div>

<!-- NEW FICHE MODAL -->
<div class="modal-overlay" id="newFicheModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">📋 Nouvelle fiche de poste</div>
      <button class="modal-close" onclick="closeModal()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="fiche-field">
        <div class="fiche-label">Intitulé du poste</div>
        <input class="fiche-input" id="modalPoste" placeholder="Ex: Cariste CACES 5, Préparateur de commandes..." />
      </div>
      <div class="fiche-field">
        <div class="fiche-label">Client</div>
        <input class="fiche-input" id="modalClient" placeholder="Nom du client" />
      </div>
      <div class="fiche-field">
        <div class="fiche-label">Ville de la mission</div>
        <div class="fiche-loc-group">
          <svg class="fiche-loc-icon" width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>
          <input class="fiche-input" id="modalLieu" placeholder="Ex : Lyon, Villeurbanne, Saint-Priest..." />
        </div>
        <div class="fiche-section-label" style="margin-top:12px;">Périmètre de recherche candidats</div>
        <div class="fiche-radius-pills" id="modalRadiusPills">
          <div class="fiche-radius-pill" onclick="setModalRadius(5,this)">5 km</div>
          <div class="fiche-radius-pill" onclick="setModalRadius(10,this)">10 km</div>
          <div class="fiche-radius-pill active" onclick="setModalRadius(20,this)">20 km</div>
          <div class="fiche-radius-pill" onclick="setModalRadius(30,this)">30 km</div>
          <div class="fiche-radius-pill" onclick="setModalRadius(50,this)">50 km</div>
        </div>
      </div>
      <div class="fiche-row">
        <div class="fiche-field">
          <div class="fiche-label">Postes à pourvoir</div>
          <input class="fiche-input" type="number" id="modalNb" value="1" min="1" />
        </div>
        <div class="fiche-field">
          <div class="fiche-label">Horaires</div>
          <select class="fiche-input" id="modalHoraires">
            <option selected>Journée (8h-16h)</option>
            <option>Matin (5h-13h)</option>
            <option>Après-midi (13h-21h)</option>
            <option>Nuit (21h-5h)</option>
            <option>2x8</option>
            <option>3x8</option>
          </select>
        </div>
      </div>
      <div class="fiche-field">
        <div class="fiche-label">Compétences & CACES (séparés par des virgules)</div>
        <input class="fiche-input" id="modalComp" placeholder="Ex: CACES 1, Expérience logistique, Permis B..." />
      </div>
    </div>
    <div class="modal-footer">
      <button class="match-btn match-btn-secondary" onclick="closeModal()" style="width:auto;padding:10px 20px;">Annuler</button>
      <button class="match-btn match-btn-primary" onclick="createFiche()" style="width:auto;padding:10px 20px;">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        Créer & Matcher
      </button>
    </div>
  </div>
</div>

<!-- CHAT WIDGET -->
<div class="chat-widget">
  <div class="chat-bubble" onclick="alert('Agent IA IZYSS — Chat disponible sur toutes les pages')">
    <div class="pulse"></div>
    <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
  </div>
</div>

</div>

<!-- ============================= -->
<!-- PLACEHOLDER PAGES             -->
<!-- ============================= -->
<div class="page-section" id="page-dashboard">
<div class="main">
  <header class="header">
    <div class="header-left">
      <div class="header-title" style="font-size:22px;">Bonjour, Sophie 👋</div>
      <div class="header-subtitle">Voici l'activité de votre agence aujourd'hui</div>
    </div>
    <div class="header-right">
      <div class="db-header-search">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        Rechercher...
        <kbd>⌘K</kbd>
      </div>
      <div class="header-btn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
        <div class="notif-dot"></div>
      </div>
    </div>
  </header>

  <div class="content">
    <div class="db-kpi-grid">
      <div class="db-kpi-card">
        <div class="db-kpi-header"><div class="db-kpi-icon">👥</div><div class="db-kpi-trend up">↑ 12%</div></div>
        <div class="db-kpi-value" id="kpi-db-total-candidates">847</div><div class="db-kpi-label">Candidats en base</div>
      </div>
      <div class="db-kpi-card">
        <div class="db-kpi-header"><div class="db-kpi-icon">🎯</div><div class="db-kpi-trend up">↑ 8%</div></div>
        <div class="db-kpi-value" id="kpi-db-active-missions">12</div><div class="db-kpi-label">Missions actives</div>
      </div>
      <div class="db-kpi-card">
        <div class="db-kpi-header"><div class="db-kpi-icon">📄</div><div class="db-kpi-trend up">↑ 23%</div></div>
        <div class="db-kpi-value" id="kpi-db-contracts-month">34</div><div class="db-kpi-label">Contrats ce mois</div>
      </div>
      <div class="db-kpi-card">
        <div class="db-kpi-header"><div class="db-kpi-icon">⚡</div><div class="db-kpi-trend up">↑ 5%</div></div>
        <div class="db-kpi-value" id="kpi-db-placement-rate">78%</div><div class="db-kpi-label">Taux de placement</div>
      </div>
    </div>

    <div class="db-grid">
      <div class="db-left-col">
        <!-- CANDIDATES TABLE -->
        <div class="db-card">
          <div class="db-card-header">
            <div class="db-card-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>Candidats à traiter</div>
            <div class="db-card-action">Voir tout →</div>
          </div>
          <table class="db-candidates-table">
            <thead><tr><th>Candidat</th><th>Poste</th><th>Score IA</th><th>Statut</th></tr></thead>
            <tbody>
              <tr><td><div class="db-candidate-cell"><div class="db-candidate-avatar" style="background:linear-gradient(135deg,#6C5CE7,#A29BFE)">ML</div><div class="db-candidate-name">Marc Lefèvre</div></div></td><td style="color:var(--text-secondary);font-size:13px">Cariste CACES 3</td><td><div class="db-score-bar"><div class="db-score-track"><div class="db-score-fill" style="width:92%;background:linear-gradient(90deg,var(--green),#55E6A5)"></div></div><div class="db-score-value" style="color:var(--green)">92</div></div></td><td><span class="db-status-badge available"><span class="db-status-dot"></span>Disponible</span></td></tr>
              <tr><td><div class="db-candidate-cell"><div class="db-candidate-avatar" style="background:linear-gradient(135deg,#4A90D9,#74B9FF)">SD</div><div class="db-candidate-name">Sarah Dubois</div></div></td><td style="color:var(--text-secondary);font-size:13px">Préparatrice commandes</td><td><div class="db-score-bar"><div class="db-score-track"><div class="db-score-fill" style="width:87%;background:linear-gradient(90deg,var(--green),#55E6A5)"></div></div><div class="db-score-value" style="color:var(--green)">87</div></div></td><td><span class="db-status-badge available"><span class="db-status-dot"></span>Disponible</span></td></tr>
              <tr><td><div class="db-candidate-cell"><div class="db-candidate-avatar" style="background:linear-gradient(135deg,#F39C12,#FDCB6E)">KB</div><div class="db-candidate-name">Karim Benali</div></div></td><td style="color:var(--text-secondary);font-size:13px">Manutentionnaire</td><td><div class="db-score-bar"><div class="db-score-track"><div class="db-score-fill" style="width:74%;background:linear-gradient(90deg,var(--orange),#FDCB6E)"></div></div><div class="db-score-value" style="color:var(--orange)">74</div></div></td><td><span class="db-status-badge pending"><span class="db-status-dot"></span>En attente</span></td></tr>
              <tr><td><div class="db-candidate-cell"><div class="db-candidate-avatar" style="background:linear-gradient(135deg,#E74C3C,#FF7675)">JM</div><div class="db-candidate-name">Julie Martin</div></div></td><td style="color:var(--text-secondary);font-size:13px">Agent de production</td><td><div class="db-score-bar"><div class="db-score-track"><div class="db-score-fill" style="width:81%;background:linear-gradient(90deg,var(--green),#55E6A5)"></div></div><div class="db-score-value" style="color:var(--green)">81</div></div></td><td><span class="db-status-badge placed"><span class="db-status-dot"></span>Placé</span></td></tr>
            </tbody>
          </table>
        </div>

        <!-- MISSIONS -->
        <div class="db-card">
          <div class="db-card-header">
            <div class="db-card-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/></svg>Missions ouvertes</div>
            <div class="db-card-action">Voir tout →</div>
          </div>
          <div class="db-missions-list">
            <div class="db-mission-item"><div class="db-mission-urgency high"></div><div class="db-mission-info"><div class="db-mission-title">5 Caristes CACES 3 — Entrepôt Carrefour</div><div class="db-mission-meta"><span>📍 Lyon 7e</span><span>🕐 Début : 14 fév.</span></div></div><div class="db-mission-match"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>8 matchs</div></div>
            <div class="db-mission-item"><div class="db-mission-urgency high"></div><div class="db-mission-info"><div class="db-mission-title">3 Préparateurs commandes — Amazon FBA</div><div class="db-mission-meta"><span>📍 Saint-Priest</span><span>🕐 Début : 12 fév.</span></div></div><div class="db-mission-match"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>5 matchs</div></div>
            <div class="db-mission-item"><div class="db-mission-urgency medium"></div><div class="db-mission-info"><div class="db-mission-title">2 Agents de production — Sanofi</div><div class="db-mission-meta"><span>📍 Gerland</span><span>🕐 Début : 17 fév.</span></div></div><div class="db-mission-match"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>3 matchs</div></div>
            <div class="db-mission-item"><div class="db-mission-urgency low"></div><div class="db-mission-info"><div class="db-mission-title">1 Technicien maintenance — Veolia</div><div class="db-mission-meta"><span>📍 Villeurbanne</span><span>🕐 Début : 24 fév.</span></div></div><div class="db-mission-match"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>11 matchs</div></div>
          </div>
        </div>
      </div>

      <!-- RIGHT: ACTIVITY FEED -->
      <div style="display:flex;flex-direction:column;gap:22px;">
        <div class="db-card" style="flex:1;">
          <div class="db-card-header">
            <div class="db-card-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>Activité récente</div>
            <div class="db-card-action">Tout voir →</div>
          </div>
          <div class="db-activity-list">
            <div class="db-activity-item"><div class="db-activity-dot purple">🤖</div><div class="db-activity-content"><div class="db-activity-text"><strong>Agent IA</strong> a relancé 23 candidats inactifs par SMS</div><div class="db-activity-time">Il y a 12 min</div></div></div>
            <div class="db-activity-item"><div class="db-activity-dot green">📄</div><div class="db-activity-content"><div class="db-activity-text"><strong>Contrat</strong> généré pour Marc Lefèvre — Mission Carrefour</div><div class="db-activity-time">Il y a 34 min</div></div></div>
            <div class="db-activity-item"><div class="db-activity-dot blue">🎯</div><div class="db-activity-content"><div class="db-activity-text"><strong>Matching</strong> : 8 profils trouvés pour "Cariste CACES 3"</div><div class="db-activity-time">Il y a 1h</div></div></div>
            <div class="db-activity-item"><div class="db-activity-dot orange">⭐</div><div class="db-activity-content"><div class="db-activity-text"><strong>Scoring</strong> : 15 nouveaux CVs analysés et notés</div><div class="db-activity-time">Il y a 2h</div></div></div>
            <div class="db-activity-item"><div class="db-activity-dot green">✅</div><div class="db-activity-content"><div class="db-activity-text"><strong>6 candidats</strong> ont confirmé leur disponibilité suite aux relances</div><div class="db-activity-time">Il y a 3h</div></div></div>
            <div class="db-activity-item"><div class="db-activity-dot purple">📊</div><div class="db-activity-content"><div class="db-activity-text"><strong>Portail client</strong> : Carrefour a consulté 4 profils disponibles</div><div class="db-activity-time">Il y a 4h</div></div></div>
          </div>
        </div>
        <div class="powered">Propulsé par <span>IZYSS</span> — Intelligence Artificielle au service de l'intérim</div>
      </div>
    </div>
  </div>
</div>

<!-- DASHBOARD CHAT WIDGET -->
<div class="db-chat-widget" id="dbChatWidget">
  <div class="db-chat-panel" id="dbChatPanel">
    <div class="db-chat-header">
      <div class="db-chat-ai-avatar">✨</div>
      <div class="db-chat-ai-info"><div class="db-chat-ai-name">Agent IZYSS</div><div class="db-chat-ai-status">En ligne — prêt à vous aider</div></div>
      <button class="db-chat-close" onclick="dbToggleChat()"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
    </div>
    <div class="db-chat-messages">
      <div class="db-msg ai">Bonjour Sophie ! 👋 Je suis votre assistant IA IZYSS. Je peux vous aider à trouver des candidats, créer des contrats, lancer des relances... Que puis-je faire pour vous ?</div>
      <div class="db-msg user">Trouve-moi des caristes disponibles sur Lyon pour la semaine prochaine</div>
      <div class="db-msg ai">J'ai trouvé <strong>8 caristes CACES 3</strong> disponibles sur Lyon la semaine prochaine. Les 3 meilleurs scores :<br><br>🥇 Marc Lefèvre — Score 92/100<br>🥈 Thomas Roche — Score 89/100<br>🥉 Fatima El Amrani — Score 85/100<br><br>Voulez-vous que je génère les contrats pour ces candidats ?</div>
    </div>
    <div class="db-chat-suggestions">
      <div class="db-chat-suggestion">📄 Créer un contrat</div>
      <div class="db-chat-suggestion">📱 Relancer candidats</div>
      <div class="db-chat-suggestion">🎯 Matching mission</div>
    </div>
    <div class="db-chat-input-area">
      <input class="db-chat-input" placeholder="Demandez-moi n'importe quoi..."/>
      <div class="db-chat-voice-btn" title="Message vocal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg></div>
      <button class="db-chat-send-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></button>
    </div>
  </div>
  <div class="db-chat-bubble" onclick="dbToggleChat()"><div class="db-pulse"></div><svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></div>
</div>
</div>
<div class="page-section" id="page-candidats">
<div class="main">
  <header class="header">
    <div class="header-left">
      <div class="header-title"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>CVthèque</div>
      <div class="header-subtitle">847 candidats en base — 234 disponibles cette semaine</div>
    </div>
    <div class="header-right">
      <button class="cd-h-btn" onclick="cdOpenImport()">📥 Importer CVs</button>
      <button class="cd-h-btn cd-h-btn-primary" onclick="showToast('Ajout candidat manuel')">+ Ajouter</button>
      <div class="header-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg><div class="notif-dot"></div></div>
    </div>
  </header>
  <div class="content">
    <div class="kpis" style="grid-template-columns:repeat(4,1fr);">
      <div class="kpi" style="animation-delay:0s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--accent-bg)">👥</div><div class="kpi-trend" style="background:var(--green-bg);color:var(--green)">+23 ce mois</div></div><div class="kpi-val" id="kpi-cd-total" style="color:var(--accent)">847</div><div class="kpi-label">Total candidats</div></div>
      <div class="kpi" style="animation-delay:0.05s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--green-bg)">✅</div></div><div class="kpi-val" id="kpi-cd-available" style="color:var(--green)">234</div><div class="kpi-label">Disponibles</div></div>
      <div class="kpi" style="animation-delay:0.1s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--blue-bg)">🏗️</div></div><div class="kpi-val" id="kpi-cd-on-mission" style="color:var(--blue)">67</div><div class="kpi-label">En mission</div></div>
      <div class="kpi" style="animation-delay:0.15s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--orange-bg)">💤</div></div><div class="kpi-val" id="kpi-cd-inactive" style="color:var(--orange)">156</div><div class="kpi-label">Inactifs +90j</div></div>
    </div>
    <div class="toolbar">
      <div class="search-box"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="var(--text-tertiary)" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input placeholder="Nom, compétence, ville..." id="cdSearchInput" oninput="cdDoFilter()"/></div>
      <div class="cd-pill on" data-cf="all" onclick="cdSetFilter(this)">Tous</div>
      <div class="cd-pill" data-cf="dispo" onclick="cdSetFilter(this)">● Disponibles</div>
      <div class="cd-pill" data-cf="mission" onclick="cdSetFilter(this)">🏗 En mission</div>
      <div class="cd-pill" data-cf="indispo" onclick="cdSetFilter(this)">✗ Indisponibles</div>
      <div class="cd-pill" data-cf="dormant" onclick="cdSetFilter(this)">💤 Dormants</div>
    </div>
    <div class="cv-results-head">
      <div class="cv-count"><span id="cdTotalCount">15</span> candidats</div>
    </div>
    <div class="cv-grid" id="cvGrid"></div>
    <div class="powered">Propulsé par <span>IZYSS</span> — Intelligence Artificielle au service de l'intérim</div>
  </div>
</div>

<!-- CANDIDATS IMPORT MODAL -->
<div class="modal-ov" id="cdImportModal">
  <div class="modal">
    <div class="modal-h"><div class="modal-t">📥 Importer des CVs</div><button class="modal-x" onclick="cdCloseImport()">✕</button></div>
    <div class="modal-body">
      <div class="cd-drop-zone" onclick="document.getElementById('cdFileInput').click()">
        <div class="cd-drop-icon">📄</div>
        <div class="cd-drop-title">Glissez-déposez vos CVs ici</div>
        <div class="cd-drop-desc">ou cliquez pour sélectionner des fichiers</div>
        <div class="cd-drop-formats">PDF, DOCX, JPG — jusqu'à 50 fichiers simultanés</div>
        <input type="file" id="cdFileInput" multiple accept=".pdf,.docx,.doc,.jpg,.png" style="display:none" onchange="showToast('📄 '+this.files.length+' fichiers sélectionnés')"/>
      </div>
      <div style="margin-top:16px;padding:12px 16px;background:var(--accent-bg);border-radius:10px;font-size:12px;color:var(--accent);display:flex;align-items:center;gap:8px;">🤖 <b>L'IA extrait automatiquement</b> les informations : nom, compétences, expériences, certifications, coordonnées.</div>
    </div>
    <div class="modal-footer"><button class="btn-secondary" onclick="cdCloseImport()">Annuler</button><button class="btn-primary" onclick="cdCloseImport();showToast('🤖 Extraction IA en cours... 12 CVs détectés')">🚀 Lancer l'extraction IA</button></div>
  </div>
</div>

<!-- CANDIDATS DRAWER -->
<div class="cd-dov" id="cdDOverlay" onclick="cdCloseDrawer()"></div>
<div class="cd-dw" id="cdDrawer">
  <div class="cd-dw-head"><span style="font-size:15px;font-weight:800;">📄 Fiche candidat</span><button class="cd-dw-x" onclick="cdCloseDrawer()">✕</button></div>
  <div id="cdDrawerContent"></div>
</div>
</div>
<div class="page-section" id="page-missions">
<div class="main">
  <header class="header">
    <div class="header-left">
      <div class="header-title"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/></svg>Missions</div>
      <div class="header-subtitle">12 missions actives — 5 à pourvoir en urgence</div>
    </div>
    <div class="header-right">
      <button class="ms-h-btn" onclick="showToast('Export missions')">📊 Exporter</button>
      <button class="ms-h-btn ms-h-btn-primary" onclick="msOpenModal()">+ Nouvelle mission</button>
      <div class="header-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/></svg><div class="notif-dot"></div></div>
    </div>
  </header>
  <div class="content">
    <div class="kpis" style="grid-template-columns:repeat(5,1fr);">
      <div class="kpi" style="animation-delay:0s;cursor:pointer" onclick="msFilterByKpi('all')"><div class="kpi-top"><div class="kpi-icon" style="background:var(--accent-bg)">📋</div></div><div class="kpi-val" id="kpi-ms-active" style="color:var(--accent)">12</div><div class="kpi-label">Missions actives</div></div>
      <div class="kpi" style="animation-delay:0.05s;cursor:pointer" onclick="msFilterByKpi('urgent')"><div class="kpi-top"><div class="kpi-icon" style="background:var(--red-bg)">🔥</div></div><div class="kpi-val" id="kpi-ms-urgent" style="color:var(--red)">5</div><div class="kpi-label">Urgentes</div></div>
      <div class="kpi" style="animation-delay:0.1s;cursor:pointer" onclick="msFilterByKpi('filled')"><div class="kpi-top"><div class="kpi-icon" style="background:var(--green-bg)">✅</div></div><div class="kpi-val" id="kpi-ms-filled" style="color:var(--green)">34</div><div class="kpi-label">Postes pourvus ce mois</div></div>
      <div class="kpi" style="animation-delay:0.15s;cursor:pointer" onclick="msFilterByKpi('progress')"><div class="kpi-top"><div class="kpi-icon" style="background:var(--blue-bg)">👥</div></div><div class="kpi-val" id="kpi-ms-on-site" style="color:var(--blue)">67</div><div class="kpi-label">Intérimaires en poste</div></div>
      <div class="kpi" style="animation-delay:0.2s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--orange-bg)">⏱</div><div class="kpi-trend" style="background:var(--green-bg);color:var(--green)">-18%</div></div><div class="kpi-val" id="kpi-ms-avg-days" style="color:var(--orange)">2.1j</div><div class="kpi-label">Temps moyen placement</div></div>
    </div>

    <div class="ms-toolbar">
      <div class="ms-search"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="var(--text-tertiary)" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input placeholder="Rechercher une mission, client..." id="msSearchInput" oninput="msDoFilter()"/></div>
      <div class="ms-pill on" data-msf="all" onclick="msSetFilter(this)">Toutes</div>
      <div class="ms-pill" data-msf="open" onclick="msSetFilter(this)">🟢 Ouvertes</div>
      <div class="ms-pill" data-msf="urgent" onclick="msSetFilter(this)">🔥 Urgentes</div>
      <div class="ms-pill" data-msf="progress" onclick="msSetFilter(this)">🔵 En cours</div>
      <div class="ms-pill" data-msf="filled" onclick="msSetFilter(this)">✅ Pourvues</div>
      <div class="ms-toolbar-right">
        <div class="ms-view-toggle">
          <div class="ms-view-btn on" id="msVTable" onclick="msSetView('table')">☰ Table</div>
          <div class="ms-view-btn" id="msVKanban" onclick="msSetView('kanban')">⊞ Kanban</div>
        </div>
      </div>
    </div>

    <div class="ms-table-card" id="msTableView"><div style="overflow-x:auto"><table><thead><tr><th>Mission</th><th>Statut</th><th>Postes</th><th>Candidats affectés</th><th>Matchings IA</th><th>Dates</th><th>Lieu</th><th>Actions</th></tr></thead><tbody id="msTableBody"></tbody></table></div></div>
    <div class="ms-kanban" id="msKanbanView"></div>

    <div class="powered">Propulsé par <span>IZYSS</span> — Intelligence Artificielle au service de l'intérim</div>
  </div>
</div>

<!-- MISSIONS DRAWER -->
<div class="ms-dov" id="msDOverlay" onclick="msCloseDrawer()"></div>
<div class="ms-dw" id="msDrawer">
  <div class="ms-dw-head"><span style="font-size:15px;font-weight:800;">📋 Détails mission</span><button class="ms-dw-x" onclick="msCloseDrawer()">✕</button></div>
  <div id="msDrawerContent"></div>
</div>

<!-- MISSIONS NEW MODAL -->
<div class="modal-ov" id="msNewModal">
  <div class="modal" style="width:560px;">
    <div class="modal-h"><div class="modal-t">📋 Nouvelle mission</div><button class="modal-x" onclick="msCloseModal()">✕</button></div>
    <div class="modal-body">
      <div class="field"><div class="field-label">Intitulé du poste</div><input class="field-input" id="msMTitle" placeholder="Ex: Cariste CACES 3"/></div>
      <div class="field-row">
        <div class="field"><div class="field-label">Client</div><select class="field-input" id="msMClient"><option>Carrefour Supply Chain</option><option>Amazon FBA</option><option>Sanofi</option><option>Rhenus Logistics</option><option>FM Logistic</option></select></div>
        <div class="field"><div class="field-label">Localisation</div><input class="field-input" id="msMLoc" placeholder="Ex: Lyon 7e"/></div>
      </div>
      <div class="field-row">
        <div class="field"><div class="field-label">Date début</div><input class="field-input" type="date" id="msMStart"/></div>
        <div class="field"><div class="field-label">Date fin</div><input class="field-input" type="date" id="msMEnd"/></div>
      </div>
      <div class="field-row">
        <div class="field"><div class="field-label">Nb postes à pourvoir</div><input class="field-input" type="number" id="msMNb" value="1" min="1"/></div>
        <div class="field"><div class="field-label">Horaires</div><select class="field-input"><option>Journée</option><option>Matin (6h-14h)</option><option>Après-midi (14h-22h)</option><option>Nuit (22h-6h)</option><option>2x8</option><option>3x8</option></select></div>
      </div>
      <div class="field">
        <div class="field-label">Urgence</div>
        <div class="ms-urg-pills">
          <div class="ms-urg-pill on high" onclick="msPickUrg(this,'high')">🔴 Critique</div>
          <div class="ms-urg-pill" onclick="msPickUrg(this,'med')">🟠 Moyen</div>
          <div class="ms-urg-pill" onclick="msPickUrg(this,'low')">🟢 Normal</div>
        </div>
      </div>
      <div class="field"><div class="field-label">Compétences requises</div><textarea class="field-input" placeholder="CACES 3, expérience entrepôt, visite médicale à jour..."></textarea></div>
      <div style="padding:12px 16px;background:var(--accent-bg);border-radius:10px;font-size:12px;color:var(--accent);display:flex;align-items:center;gap:8px;">🤖 <b>L'IA lancera automatiquement le matching</b> dès la création de la mission</div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="msCloseModal()">Annuler</button>
      <button class="ms-h-btn ms-h-btn-primary" onclick="msCreateMission()">🚀 Créer et lancer le matching</button>
    </div>
  </div>
</div>
</div>
<div class="page-section" id="page-contrats">
<div class="main">
  <header class="header">
    <div class="header-left">
      <div class="header-title"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>Contrats</div>
      <div class="header-subtitle">Gérez vos contrats et avenants en quelques clics</div>
    </div>
    <div class="header-right">
      <button class="ct-h-btn" onclick="showToast('Export Excel en cours...')">📊 Exporter</button>
      <button class="ct-h-btn ct-h-btn-primary" onclick="ctOpenNewContrat()">+ Nouveau contrat</button>
    </div>
  </header>
  <div class="content">
    <div class="kpis" style="grid-template-columns:repeat(5,1fr);">
      <div class="kpi" style="animation-delay:0s;cursor:pointer" onclick="ctFilterByKpi('active')"><div class="kpi-top"><div class="kpi-icon" style="background:var(--green-bg)">📝</div><div class="kpi-trend" style="background:var(--green-bg);color:var(--green)">+8 ce mois</div></div><div class="kpi-val" id="kpi-ct-active" style="color:var(--green)">34</div><div class="kpi-label">Contrats actifs</div></div>
      <div class="kpi" style="animation-delay:0.05s;cursor:pointer" onclick="ctFilterByKpi('sign')"><div class="kpi-top"><div class="kpi-icon" style="background:var(--blue-bg)">✍️</div></div><div class="kpi-val" id="kpi-ct-sign" style="color:var(--blue)">6</div><div class="kpi-label">En attente signature</div></div>
      <div class="kpi" style="animation-delay:0.1s;cursor:pointer" onclick="ctFilterByKpi('all')"><div class="kpi-top"><div class="kpi-icon" style="background:#FDE8F3">📎</div></div><div class="kpi-val" id="kpi-ct-amendments" style="color:#E84393">12</div><div class="kpi-label">Avenants ce mois</div></div>
      <div class="kpi" style="animation-delay:0.15s;cursor:pointer" onclick="ctFilterByKpi('expiring')"><div class="kpi-top"><div class="kpi-icon" style="background:var(--orange-bg)">⏰</div></div><div class="kpi-val" id="kpi-ct-expiring" style="color:var(--orange)">5</div><div class="kpi-label">Expirent sous 7j</div></div>
      <div class="kpi" style="animation-delay:0.2s;cursor:pointer" onclick="ctFilterByKpi('ended')"><div class="kpi-top"><div class="kpi-icon" style="background:var(--accent-bg)">📄</div></div><div class="kpi-val" id="kpi-ct-yearly" style="color:var(--accent)">187</div><div class="kpi-label">Total annuel</div></div>
    </div>
    <div class="ct-toolbar">
      <div class="ct-search"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="var(--text-tertiary)" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input placeholder="Rechercher un contrat, candidat, client..." id="ctSearchInput" oninput="ctDoFilter()"/></div>
      <div class="ct-pill on" data-ctf="all" onclick="ctSf(this)">Tous</div>
      <div class="ct-pill" data-ctf="active" onclick="ctSf(this)">✅ Actifs</div>
      <div class="ct-pill" data-ctf="sign" onclick="ctSf(this)">✍️ À signer</div>
      <div class="ct-pill" data-ctf="expiring" onclick="ctSf(this)">⏰ Expirent bientôt</div>
      <div class="ct-pill" data-ctf="ended" onclick="ctSf(this)">🏁 Terminés</div>
    </div>
    <div class="ct-tcard">
      <div class="table-wrap"><table><thead><tr><th>Candidat</th><th>Client / Mission</th><th>Période</th><th>Avancement</th><th>Statut</th><th>Avenants</th><th>Actions</th></tr></thead><tbody id="ctTableBody"></tbody></table></div>
      <div class="ct-pagination"><div class="pag-info" id="ctPagInfo"></div></div>
    </div>
    <div class="powered">Propulsé par <span>IZYSS</span> — Intelligence Artificielle au service de l'intérim</div>
  </div>
</div>

<!-- CONTRATS DRAWER -->
<div class="ct-dov" id="ctDOverlay" onclick="ctCd()"></div>
<div class="ct-dw" id="ctDrawer">
  <div class="ct-dw-head"><span style="font-size:15px;font-weight:800;">📄 Détail contrat</span><button class="ct-dw-x" onclick="ctCd()">✕</button></div>
  <div id="ctDC"></div>
</div>

<!-- CONTRATS AVENANT MODAL -->
<div class="modal-ov" id="ctAvenantModal">
  <div class="modal">
    <div class="modal-h"><div class="modal-t" id="ctAvenModalTitle">📎 Nouvel avenant</div><button class="modal-x" onclick="ctCloseAven()">✕</button></div>
    <div class="modal-body" id="ctAvenModalBody"></div>
    <div class="modal-footer"><button class="btn-secondary" onclick="ctCloseAven()">Annuler</button><button class="ct-btn-p" onclick="ctConfirmAven()">📎 Générer l'avenant</button></div>
  </div>
</div>

<!-- CONTRATS NEW CONTRACT MODAL -->
<div class="modal-ov" id="ctNewContratModal">
  <div class="modal" style="width:540px;">
    <div class="modal-h"><div class="modal-t">📝 Nouveau contrat</div><button class="modal-x" onclick="ctCloseNewContrat()">✕</button></div>
    <div class="modal-body">
      <div class="field"><div class="field-label">Candidat</div><select class="field-input"><option>Marc Lefèvre — Cariste CACES 3</option><option>Thomas Roche — Cariste CACES 1,3,5</option><option>Sarah Dubois — Préparatrice commandes</option><option>Omar Sayed — Cariste CACES 5</option></select></div>
      <div class="field"><div class="field-label">Client</div><select class="field-input"><option>Carrefour Supply Chain</option><option>Amazon — Saint-Priest</option><option>Sanofi — Gerland</option><option>FM Logistic</option></select></div>
      <div class="field"><div class="field-label">Poste / Qualification</div><input class="field-input" placeholder="Ex: Cariste CACES 3" value="Cariste CACES 3"/></div>
      <div class="field-row"><div class="field"><div class="field-label">Date début</div><input class="field-input" type="date" value="2026-02-17"/></div><div class="field"><div class="field-label">Date fin</div><input class="field-input" type="date" value="2026-03-14"/></div></div>
      <div class="field-row"><div class="field"><div class="field-label">Horaires</div><input class="field-input" placeholder="Ex: 6h-14h" value="6h — 14h"/></div><div class="field"><div class="field-label">Taux horaire</div><input class="field-input" placeholder="Ex: 12.50€" value="12.50 €"/></div></div>
      <div class="field"><div class="field-label">Lieu de mission</div><input class="field-input" placeholder="Adresse" value="Entrepôt Carrefour — Vénissieux"/></div>
      <div style="padding:10px 14px;background:var(--accent-bg);border-radius:8px;font-size:11.5px;color:var(--accent);display:flex;align-items:center;gap:6px;">🤖 Le contrat sera pré-rempli par l'IA avec les infos du candidat et du client</div>
    </div>
    <div class="modal-footer"><button class="btn-secondary" onclick="ctCloseNewContrat()">Annuler</button><button class="ct-btn-ac" onclick="ctCreateContrat()">📝 Générer le contrat</button></div>
  </div>
</div>
</div>
<div class="page-section" id="page-scoring">
<div class="main">
  <header class="header">
    <div class="header-left">
      <div class="header-title">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg>
        Scoring CV
      </div>
      <div class="header-subtitle">Configurez vos critères et consultez les scores de vos candidats</div>
    </div>
  </header>

  <div class="content">
    <div class="scoring-layout">

      <!-- LEFT: CONFIG PANEL -->
      <div class="card" id="configCard">
        <div class="card-header">
          <div>
            <div class="card-title">Critères d'évaluation</div>
            <div class="card-subtitle">Attribuez des points à chaque critère</div>
          </div>
        </div>

        <!-- Upload CV -->
        <div class="sc-upload-area" onclick="scAnalyzeCv()">
          <svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
          <div class="sc-upload-title">Analyser un CV</div>
          <div class="sc-upload-sub">Cliquez pour uploader un PDF — score calculé automatiquement</div>
          <div class="sc-upload-progress" id="scUploadProgress">
            <div class="sc-upload-progress-fill" id="scUploadFill"></div>
          </div>
        </div>

        <div class="total-bar">
          <div>
            <div class="total-label">Total des points</div>
            <div style="display:flex;align-items:baseline;gap:2px;margin-top:4px;">
              <div class="total-value valid" id="totalValue">100</div>
              <div class="total-target">/ 100 pts</div>
            </div>
          </div>
          <div style="font-size:12px;color:var(--text-tertiary);">
            <span id="activeCount">6</span> critères actifs
          </div>
        </div>
        <div style="padding:0 20px;">
          <div class="total-progress">
            <div class="total-progress-fill" id="totalProgressFill" style="width:100%;background:var(--green);"></div>
          </div>
        </div>

        <div class="criteria-section">
          <div class="criteria-section-title">Critères prédéfinis</div>
        </div>
        <div id="predefinedCriteria"></div>

        <div class="criteria-section">
          <div class="criteria-section-title">Critères personnalisés</div>
        </div>
        <div id="customCriteria"></div>

        <div class="add-criterion-area">
          <button class="add-criterion-btn" id="addBtn" onclick="showAddForm()">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Ajouter un critère
          </button>
          <div class="add-form" id="addForm">
            <input type="text" id="newCriterionName" placeholder="Nom du critère (ex : Permis B)" />
            <input type="text" id="newCriterionDesc" placeholder="Description courte (optionnel)" />
            <div class="add-form-actions">
              <button class="btn-primary" onclick="addCustomCriterion()">Ajouter</button>
              <button class="btn-secondary" onclick="hideAddForm()">Annuler</button>
            </div>
          </div>
        </div>

        <div class="save-bar">
          <div class="save-info">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
            Scores recalculés automatiquement
          </div>
          <button class="save-btn" onclick="saveConfig()">
            <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
            Sauvegarder
          </button>
        </div>
      </div>

      <!-- RIGHT: CARDS RESULTS -->
      <div class="card" style="overflow:hidden;">
        <div class="results-header">
          <div class="card-title">Candidats scorés</div>
          <div class="results-filters">
            <div class="filter-chip active" onclick="filterCandidates('all', this)">Tous</div>
            <div class="filter-chip" onclick="filterCandidates('high', this)">Score élevé</div>
            <div class="filter-chip" onclick="filterCandidates('available', this)">Disponibles</div>
          </div>
        </div>
        <div class="sc-grid" id="scGrid"></div>
      </div>

    </div>
  </div>
</div>
</div>
<div class="page-section" id="page-relances">
<div class="main">
  <header class="header">
    <div class="header-left">
      <div class="header-title"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.362 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.338 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg>Relances & Suivi</div>
      <div class="header-subtitle">Automatisez vos relances, pointages et suivis candidats</div>
    </div>
    <div class="header-right">
      <div style="display:flex;align-items:center;gap:8px;padding:7px 14px;background:var(--green-bg);border-radius:20px;font-size:12px;font-weight:600;color:var(--green);"><span class="live-dot"></span> 3 campagnes actives</div>
      <div class="header-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg><div class="notif-dot"></div></div>
    </div>
  </header>

  <div class="content">
    <div class="kpis">
      <div class="kpi" style="animation-delay:0s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--accent-bg)">📤</div><div class="kpi-trend" style="background:var(--green-bg);color:var(--green)">+12 auj.</div></div><div class="kpi-val" style="color:var(--accent)">156</div><div class="kpi-label">Relances envoyées</div></div>
      <div class="kpi" style="animation-delay:0.05s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--green-bg)">✅</div><div class="kpi-trend" style="background:var(--green-bg);color:var(--green)">78%</div></div><div class="kpi-val" style="color:var(--green)">122</div><div class="kpi-label">Réponses reçues</div></div>
      <div class="kpi" style="animation-delay:0.1s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--blue-bg)">📍</div></div><div class="kpi-val" style="color:var(--blue)">18</div><div class="kpi-label">Présences confirmées</div></div>
      <div class="kpi" style="animation-delay:0.15s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--orange-bg)">⏳</div></div><div class="kpi-val" style="color:var(--orange)">34</div><div class="kpi-label">En attente de réponse</div></div>
      <div class="kpi" style="animation-delay:0.2s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--red-bg)">🚨</div></div><div class="kpi-val" style="color:var(--red)">3</div><div class="kpi-label">Alertes (pas de réponse)</div></div>
    </div>

    <div class="layout">
      <div>
        <div class="card" style="margin-bottom:24px;">
          <div class="card-h">
            <div class="card-t">🚀 Campagnes actives</div>
            <div class="card-a" onclick="openRelanceModal()">+ Nouvelle campagne</div>
          </div>
          <div class="campaigns" id="campList"></div>
        </div>
        <div class="card presence">
          <div class="card-h">
            <div class="card-t">📍 Pointage du jour <span style="font-size:12px;color:var(--text-tertiary);font-weight:500;margin-left:4px;">— Lundi 10 fév.</span></div>
            <div class="card-a" onclick="relanceToast('Relance envoyée aux non-confirmés')">Relancer tous</div>
          </div>
          <div class="presence-grid" id="presenceGrid"></div>
        </div>
      </div>
      <div class="card">
        <div class="card-h">
          <div class="card-t"><span class="live-dot" style="margin-right:4px;"></span> Activité en direct</div>
        </div>
        <div class="feed" id="feed"></div>
      </div>
    </div>
    <div class="powered">Propulsé par <span>IZYSS</span> — Intelligence Artificielle au service de l'intérim</div>
  </div>
</div>

<!-- RELANCE CAMPAIGN MODAL -->
<div class="modal-ov" id="relanceModal">
  <div class="modal">
    <div class="modal-h">
      <div class="modal-t">🚀 Nouvelle campagne de relance</div>
      <button class="modal-x" onclick="closeRelanceModal()">✕</button>
    </div>
    <div class="modal-body">
      <div class="field">
        <div class="field-label">Type de relance</div>
        <div class="type-grid">
          <div class="type-card on" onclick="pickType(this)"><div class="type-card-icon">📋</div><div class="type-card-name">Disponibilité</div><div class="type-card-desc">Dispo cette semaine ?</div></div>
          <div class="type-card" onclick="pickType(this)"><div class="type-card-icon">✅</div><div class="type-card-name">Confirmation</div><div class="type-card-desc">Confirmer une mission</div></div>
          <div class="type-card" onclick="pickType(this)"><div class="type-card-icon">💤</div><div class="type-card-name">Réactivation</div><div class="type-card-desc">Candidats dormants</div></div>
          <div class="type-card" onclick="pickType(this)"><div class="type-card-icon">⭐</div><div class="type-card-name">Satisfaction</div><div class="type-card-desc">Retour fin de mission</div></div>
          <div class="type-card" onclick="pickType(this)"><div class="type-card-icon">📄</div><div class="type-card-name">Documents</div><div class="type-card-desc">Visite méd., CACES...</div></div>
          <div class="type-card" onclick="pickType(this)"><div class="type-card-icon">✍️</div><div class="type-card-name">Personnalisé</div><div class="type-card-desc">Message libre</div></div>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Canal d'envoi</div>
        <div class="ch-pills">
          <div class="ch-pill on" onclick="pickCh(this)">📱 SMS</div>
          <div class="ch-pill" onclick="pickCh(this)">💬 WhatsApp</div>
          <div class="ch-pill" onclick="pickCh(this)">📧 Email</div>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Nom de la campagne</div>
        <input class="field-input" id="campName" placeholder="Ex: Dispo semaine 7" />
      </div>
      <div class="field-row">
        <div class="field">
          <div class="field-label">Candidats ciblés</div>
          <select class="field-input">
            <option>Tous les candidats actifs (847)</option>
            <option>Caristes CACES (234)</option>
            <option>Prépa. commandes (189)</option>
            <option>Sans mission depuis 30j (156)</option>
            <option>Sans mission depuis 90j (89)</option>
            <option>Mission cette semaine (34)</option>
          </select>
        </div>
        <div class="field">
          <div class="field-label">Programmation</div>
          <select class="field-input">
            <option>Envoyer maintenant</option>
            <option>Demain 8h</option>
            <option>Lundi prochain 8h</option>
            <option>Chaque lundi 8h (récurrent)</option>
            <option>Chaque vendredi 17h (récurrent)</option>
            <option>Personnalisé...</option>
          </select>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Message (personnalisable)</div>
        <textarea class="field-input" id="campMsg">Bonjour {prénom}, êtes-vous disponible cette semaine pour une mission en intérim ? Répondez OUI ou NON. Merci !</textarea>
      </div>
      <div style="padding:12px 16px;background:var(--accent-bg);border-radius:10px;font-size:12px;color:var(--accent);display:flex;align-items:center;gap:8px;">
        💡 <b>L'IA comprend les réponses libres</b> — "oui dispo lundi", "non pas cette semaine", "à partir de mercredi" → mise à jour automatique de la fiche candidat
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeRelanceModal()">Annuler</button>
      <button class="btn-primary" onclick="createCampaign()">🚀 Lancer la campagne</button>
    </div>
  </div>
</div>
</div>
<div class="page-section" id="page-portail">
<div class="main">
  <nav class="pc-topbar">
    <div class="pc-tbl">
      <div class="pc-logo">TS</div>
      <div class="pc-brand">
        <div class="pc-nm">TalentStaff</div>
        <div class="pc-pw">Propulsé par <b>IZYSS</b></div>
      </div>
      <div class="pc-sep"></div>
      <div class="pc-cl">Carrefour Supply Chain</div>
    </div>
    <div class="pc-tbr">
      <div class="pc-usr">
        <div class="pc-av">PD</div>
        <div class="pc-un">Philippe D.</div>
      </div>
    </div>
  </nav>

  <!-- Écran 0 : Sélecteur de rôle -->
  <div id="pcScreenRole">
    <div class="pc-selector-page">
      <div class="pc-selector-header">
        <h1>Bienvenue sur le Portail IZYSS</h1>
        <p>Choisissez votre espace pour accéder à vos outils</p>
      </div>
      <div class="pc-role-cards">
        <div class="pc-role-card agency" onclick="pcShowAgencyView()">
          <div class="pc-role-icon agency">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#6C5CE7" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/><line x1="12" y1="12" x2="12" y2="16"/><line x1="10" y1="14" x2="14" y2="14"/></svg>
          </div>
          <div class="pc-role-title">Espace Agence</div>
          <div class="pc-role-desc">Gérez les profils envoyés à vos clients, suivez les réponses et proposez de nouveaux candidats.</div>
          <div class="pc-role-badge agency">Sophie — TalentStaff Lyon</div>
        </div>
        <div class="pc-role-card client" onclick="pcShowClientView()">
          <div class="pc-role-icon client">
            <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#E74C3C" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>
          </div>
          <div class="pc-role-title">Espace Client</div>
          <div class="pc-role-desc">Consultez les candidats proposés pour vos missions, donnez votre avis et faites vos demandes.</div>
          <div class="pc-role-badge client">Philippe D. — Carrefour Supply Chain</div>
        </div>
      </div>
      <div class="powered" style="margin-top:48px">Propulsé par <b>IZYSS</b> — IA au service de l'intérim</div>
    </div>
  </div>

  <!-- Écran Agence -->
  <div id="pcScreenAgency" style="display:none">
    <div class="pc-page">
      <div class="pc-screen-header">
        <button class="pc-back-btn" onclick="pcShowRoleSelector()">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="15 18 9 12 15 6"/></svg>
          Retour
        </button>
        <div class="pc-screen-mission-info">
          <div class="pc-screen-mission-title">Espace Agence</div>
          <div class="pc-screen-mission-sub">Sophie — TalentStaff Lyon</div>
        </div>
      </div>
      <div id="pcAgencyContent"></div>
      <div class="powered">Propulsé par <b>IZYSS</b> — IA au service de l'intérim</div>
    </div>
  </div>

  <!-- Écran 1 : Liste des missions (vue client) -->
  <div id="pcScreenMissions" style="display:none">
    <div class="pc-page">
      <div class="pc-screen-header">
        <button class="pc-back-btn" onclick="pcShowRoleSelector()">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="15 18 9 12 15 6"/></svg>
          Retour
        </button>
        <div class="pc-screen-mission-info">
          <div class="pc-screen-mission-title">Vos missions en cours</div>
          <div class="pc-screen-mission-sub">Carrefour Supply Chain — Philippe D.</div>
        </div>
        <button class="pc-request-btn" onclick="pcOpenRequest()">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          Faire une demande
        </button>
      </div>
      <div class="pc-missions-grid" id="pcMissionsGrid"></div>
      <div class="powered">Propulsé par <b>IZYSS</b> — IA au service de l'intérim</div>
    </div>
  </div>

  <!-- Modal demande de candidats -->

  <div class="pc-modal-ov" id="pcRequestModal" onclick="pcCloseRequest(event)">
    <div class="pc-modal" onclick="event.stopPropagation()">
      <div class="pc-modal-head">
        <div class="pc-modal-title">Nouvelle demande de candidats</div>
        <button class="pc-modal-x" onclick="pcCloseRequest()">✕</button>
      </div>
      <div class="pc-modal-body">
        <div class="pc-form-group">
          <label class="pc-form-label">Poste recherché</label>
          <input class="pc-form-input" id="pcReqPoste" type="text" placeholder="Ex : Cariste CACES 3, Préparateur de commandes...">
        </div>
        <div class="pc-form-row">
          <div class="pc-form-group">
            <label class="pc-form-label">Nombre de candidats</label>
            <input class="pc-form-input" id="pcReqNb" type="number" min="1" placeholder="Ex : 3">
          </div>
          <div class="pc-form-group">
            <label class="pc-form-label">Type de contrat</label>
            <select class="pc-form-select" id="pcReqType">
              <option value="">Sélectionner...</option>
              <option value="interim">Intérim</option>
              <option value="cdd">CDD</option>
              <option value="cdi">CDI</option>
            </select>
          </div>
        </div>
        <div class="pc-form-row">
          <div class="pc-form-group">
            <label class="pc-form-label">Date de début</label>
            <input class="pc-form-input" id="pcReqFrom" type="date">
          </div>
          <div class="pc-form-group">
            <label class="pc-form-label">Date de fin</label>
            <input class="pc-form-input" id="pcReqTo" type="date">
          </div>
        </div>
        <div class="pc-form-group">
          <label class="pc-form-label">Compétences ou précisions</label>
          <textarea class="pc-form-textarea" id="pcReqNotes" placeholder="Ex : CACES 3 obligatoire, horaires 2x8, démarrage urgent..."></textarea>
        </div>
      </div>
      <div class="pc-modal-foot">
        <button class="pc-modal-cancel" onclick="pcCloseRequest()">Annuler</button>
        <button class="pc-modal-submit" onclick="pcSubmitRequest()">Envoyer la demande à l'agence</button>
      </div>
    </div>
  </div>

  <!-- Écran 2 : Candidats d'une mission -->
  <div id="pcScreenCandidates" style="display:none">
    <div class="pc-page">
      <div class="pc-screen-header">
        <button class="pc-back-btn" onclick="pcShowMissions()">
          <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="15 18 9 12 15 6"/></svg>
          Retour aux missions
        </button>
        <div class="pc-screen-mission-info">
          <div class="pc-screen-mission-title" id="pcMissionTitle"></div>
          <div class="pc-screen-mission-sub" id="pcMissionSub"></div>
        </div>
        <div class="pc-candidates-count" id="pcCandidatesCount"></div>
      </div>
      <div class="pc-grid" id="pcGrid"></div>
      <div class="powered">Propulsé par <b>IZYSS</b> — IA au service de l'intérim</div>
    </div>
  </div>
</div>

<div class="pc-dov" id="pcDO" onclick="pcCloseDrawer()"></div>
<div class="pc-dw" id="pcDW">
  <div class="pc-dw-head">
    <span style="font-size:14px;font-weight:800;color:var(--pc-text)">Profil candidat</span>
    <button class="pc-dw-x" onclick="pcCloseDrawer()">✕</button>
  </div>
  <div id="pcDC"></div>
</div>
</div>

<!-- TOAST (global) -->
<div class="toast" id="toast"></div>

<script>
// ===== SOURCE DE VÉRITÉ — DONNÉES MÉTIER =====
// Source: IZYSS-Details-Application.csv — mise à jour manuelle requise
const IZYSS_DATA = {
  candidates: [
    {id:1,  name:'Marc Lefèvre',     initials:'ML', role:'Cariste CACES 3',          aiScore:92, status:'dispo',    location:'Lyon 7e',         skills:['CACES 3','Entrepôt','Picking']},
    {id:2,  name:'Thomas Roche',     initials:'TR', role:'Cariste CACES 1,3,5',      aiScore:89, status:'dispo',    location:'Villeurbanne',    skills:['CACES 1,3,5','Gerbage']},
    {id:3,  name:'Sarah Dubois',     initials:'SD', role:'Préparatrice commandes',   aiScore:87, status:'dispo',    location:'Saint-Priest',    skills:['Prépa','Scan RF','PDA']},
    {id:4,  name:'Fatima El Amrani', initials:'FA', role:'Cariste CACES 3,5',        aiScore:85, status:'mission',  location:'Vénissieux',      skills:['CACES 3,5','Chargement']},
    {id:5,  name:'Antoine Girard',   initials:'AG', role:'Manutentionnaire',         aiScore:78, status:'dispo',    location:'Décines',         skills:['Manutention','Port charges']},
    {id:6,  name:'Julie Martin',     initials:'JM', role:'Agent de production',      aiScore:81, status:'mission',  location:'Oullins',         skills:['Production','BPF']},
    {id:7,  name:'Sophie Morel',     initials:'SM', role:'Cariste junior',           aiScore:72, status:'dispo',    location:'Bron',            skills:['CACES 3','Formation récente']},
    {id:8,  name:'Nadia Khelif',     initials:'NK', role:'Agent logistique',         aiScore:76, status:'mission',  location:'Saint-Priest',    skills:['Logistique','Scan RF']},
    {id:9,  name:'Karim Benali',     initials:'KB', role:'Manutentionnaire',         aiScore:74, status:'indispo',  location:'Vaulx-en-Velin',  skills:['Manutention','Port charges']},
    {id:10, name:'Pierre Blanc',     initials:'PB', role:'Cariste confirmé',         aiScore:88, status:'dispo',    location:'Gerland',         skills:['CACES 1,3,5','8 ans exp.']},
    {id:11, name:'Lucas Ferreira',   initials:'LF', role:'Préparateur commandes',    aiScore:69, status:'dormant',  location:'Meyzieu',         skills:['Prépa','Commande vocale']},
    {id:12, name:'Amina Diallo',     initials:'AD', role:'Agent de production',      aiScore:82, status:'dispo',    location:'Gerland',         skills:['Production','Qualité']},
    {id:13, name:'Hugo Mercier',     initials:'HM', role:'Manutentionnaire',         aiScore:65, status:'dormant',  location:'Corbas',          skills:['Manutention basique']},
    {id:14, name:'Emma Laurent',     initials:'EL', role:'Prépa. commandes frais',   aiScore:79, status:'dispo',    location:'Décines',         skills:['Froid','Prépa','CACES 1']},
    {id:15, name:'Omar Sayed',       initials:'OS', role:'Cariste CACES 5',          aiScore:58, status:'indispo',  location:'Corbas',          skills:['CACES 5','Grande hauteur']}
  ],
  missions: [
    {id:1, title:'Caristes CACES 3',                    client:'Carrefour Supply Chain', location:'Saint-Priest', urgency:'high',   status:'open',     totalPositions:4, filledPositions:2, matchings:12},
    {id:2, title:'Prépa. commandes',                    client:'Amazon FBA',             location:'Saint-Priest', urgency:'high',   status:'open',     totalPositions:6, filledPositions:3, matchings:18},
    {id:3, title:'Agents de production',                client:'Sanofi',                 location:'Gerland',      urgency:'medium', status:'progress', totalPositions:3, filledPositions:2, matchings:8},
    {id:4, title:'Cariste CACES 5 — Grande hauteur',   client:'FM Logistic',            location:'Vénissieux',   urgency:'high',   status:'urgent',   totalPositions:2, filledPositions:0, matchings:5},
    {id:5, title:'Manutentionnaires',                   client:'Rhenus Logistics',       location:'Corbas',       urgency:'medium', status:'open',     totalPositions:5, filledPositions:3, matchings:14},
    {id:6, title:'Préparateur commandes frais',         client:'Carrefour Supply Chain', location:'Décines',      urgency:'low',    status:'progress', totalPositions:2, filledPositions:2, matchings:6},
    {id:7, title:'Cariste CACES 1',                     client:'Amazon FBA',             location:'Saint-Priest', urgency:'low',    status:'filled',   totalPositions:3, filledPositions:3, matchings:9},
    {id:8, title:'Agents logistiques polyvalents',      client:'Rhenus Logistics',       location:'Corbas',       urgency:'medium', status:'open',     totalPositions:4, filledPositions:1, matchings:11}
  ],
  contracts: [
    {id:1,  candidateName:'Marc Lefèvre',     role:'Cariste CACES 3',       client:'Carrefour Supply Chain', startDate:'2026-01-13', endDate:'2026-03-14', hourlyRate:12.50, status:'active',   amendmentCount:2, contractNumber:'CTT-2026-0087'},
    {id:2,  candidateName:'Thomas Roche',     role:'Cariste CACES 1,3,5',   client:'Carrefour Supply Chain', startDate:'2026-02-03', endDate:'2026-02-28', hourlyRate:13.20, status:'active',   amendmentCount:0, contractNumber:'CTT-2026-0091'},
    {id:3,  candidateName:'Julie Martin',     role:'Préparatrice commandes', client:'Amazon — Saint-Priest',  startDate:'2026-02-03', endDate:'2026-02-21', hourlyRate:11.80, status:'active',   amendmentCount:1, contractNumber:'CTT-2026-0093'},
    {id:4,  candidateName:'Nadia Khelif',     role:'Agent logistique',       client:'Amazon — Saint-Priest',  startDate:'2026-02-03', endDate:'2026-02-14', hourlyRate:11.52, status:'expiring', amendmentCount:0, contractNumber:'CTT-2026-0094'},
    {id:5,  candidateName:'Karim Benali',     role:'Cariste',                client:'Carrefour Supply Chain', startDate:'2026-02-10', endDate:'2026-03-07', hourlyRate:12.00, status:'active',   amendmentCount:0, contractNumber:'CTT-2026-0096'},
    {id:6,  candidateName:'Pierre Blanc',     role:'Cariste confirmé',       client:'Sanofi — Gerland',       startDate:'2026-02-10', endDate:'2026-05-09', hourlyRate:13.80, status:'sign',     amendmentCount:0, contractNumber:'CTT-2026-0097'},
    {id:7,  candidateName:'Omar Sayed',       role:'Cariste CACES 5',        client:'FM Logistic',            startDate:'2026-02-17', endDate:'2026-03-14', hourlyRate:13.00, status:'sign',     amendmentCount:0, contractNumber:'CTT-2026-0098'},
    {id:8,  candidateName:'Sarah Dubois',     role:'Préparatrice commandes', client:'Amazon — Saint-Priest',  startDate:'2025-12-01', endDate:'2026-01-31', hourlyRate:11.52, status:'ended',    amendmentCount:1, contractNumber:'CTT-2025-0412'},
    {id:9,  candidateName:'Fatima El Amrani', role:'Cariste',                client:'Sanofi — Gerland',       startDate:'2025-11-04', endDate:'2026-01-17', hourlyRate:12.00, status:'ended',    amendmentCount:2, contractNumber:'CTT-2025-0378'},
    {id:10, candidateName:'Sophie Morel',     role:'Cariste junior',         client:'Carrefour Supply Chain', startDate:'2026-02-12', endDate:'2026-02-14', hourlyRate:11.88, status:'expiring', amendmentCount:0, contractNumber:'CTT-2026-0099'}
  ],
  clients: [
    {name:'Carrefour Supply Chain', emoji:'🏪', sector:'Grande distribution / Logistique', location:'Vénissieux, Décines'},
    {name:'Amazon — Saint-Priest',  emoji:'📦', sector:'E-commerce / Logistique',          location:'Saint-Priest (Centre STR1)'},
    {name:'Sanofi — Gerland',       emoji:'💊', sector:'Pharmaceutique',                    location:'Gerland, Saint-Fons'},
    {name:'FM Logistic',            emoji:'🏭', sector:'Logistique',                        location:'Vénissieux, Corbas'},
    {name:'Rhenus Logistics',       emoji:'🚛', sector:'Transport / Logistique',            location:'Corbas'}
  ]
};

// ===== MOTEUR KPI — CALCUL DYNAMIQUE =====
const KPIEngine = {
  dashboard() {
    // activeMissions : calculé dynamiquement depuis IZYSS_DATA.missions
    const activeMissions = IZYSS_DATA.missions.filter(m => ['open','progress','urgent'].includes(m.status)).length;
    return {
      totalCandidates: 847,    // Volume agence (PRD)
      activeMissions,           // Calculé depuis statuts IZYSS_DATA
      contractsThisMonth: 34,   // Volume mensuel agence (PRD)
      placementRate: 78         // Taux placement agence (PRD)
    };
  },
  candidates() {
    return {
      total: 847,      // Volume agence (PRD)
      available: 234,  // Disponibles cette semaine agence (PRD)
      onMission: 67,   // En mission agence (PRD)
      inactive: 156    // Inactifs +90j agence (PRD)
    };
  },
  missions() {
    const data = IZYSS_DATA.missions;
    // active et urgent : calculés depuis IZYSS_DATA
    const active = data.filter(m => ['open','progress','urgent'].includes(m.status)).length;
    const urgent = data.filter(m => m.urgency === 'high').length;
    return {
      active,                  // Calculé depuis statuts (open/progress/urgent)
      urgent,                  // Calculé depuis urgency=high
      filledThisMonth: 34,     // Postes pourvus agence (PRD)
      onSite: 67,              // Intérimaires en poste agence (PRD)
      avgPlacementDays: 2.1    // Délai moyen placement agence (PRD)
    };
  },
  contracts() {
    const data = IZYSS_DATA.contracts;
    // active, toSign, expiringSoon : calculés depuis IZYSS_DATA
    const active = data.filter(c => c.status === 'active').length;
    const toSign = data.filter(c => c.status === 'sign').length;
    const expiringSoon = data.filter(c => c.status === 'expiring').length;
    return {
      active,                  // Calculé depuis status=active
      toSign,                  // Calculé depuis status=sign
      amendmentsThisMonth: 12, // Avenants ce mois agence (PRD)
      expiringSoon,            // Calculé depuis status=expiring
      yearlyTotal: 187         // Total annuel agence (PRD)
    };
  }
};

// ===== INJECTION DES KPIs DANS LE DOM =====
function initKPIs() {
  // Dashboard KPIs
  const db = KPIEngine.dashboard();
  document.getElementById('kpi-db-total-candidates').textContent  = db.totalCandidates;
  document.getElementById('kpi-db-active-missions').textContent   = db.activeMissions;
  document.getElementById('kpi-db-contracts-month').textContent   = db.contractsThisMonth;
  document.getElementById('kpi-db-placement-rate').textContent    = db.placementRate + '%';

  // Candidats KPIs
  const cd = KPIEngine.candidates();
  document.getElementById('kpi-cd-total').textContent    = cd.total;
  document.getElementById('kpi-cd-available').textContent = cd.available;
  document.getElementById('kpi-cd-on-mission').textContent = cd.onMission;
  document.getElementById('kpi-cd-inactive').textContent  = cd.inactive;

  // Missions KPIs
  const ms = KPIEngine.missions();
  document.getElementById('kpi-ms-active').textContent       = ms.active;
  document.getElementById('kpi-ms-urgent').textContent       = ms.urgent;
  document.getElementById('kpi-ms-filled').textContent       = ms.filledThisMonth;
  document.getElementById('kpi-ms-on-site').textContent      = ms.onSite;
  document.getElementById('kpi-ms-avg-days').textContent     = ms.avgPlacementDays + 'j';

  // Contrats KPIs
  const ct = KPIEngine.contracts();
  document.getElementById('kpi-ct-active').textContent      = ct.active;
  document.getElementById('kpi-ct-sign').textContent        = ct.toSign;
  document.getElementById('kpi-ct-amendments').textContent  = ct.amendmentsThisMonth;
  document.getElementById('kpi-ct-expiring').textContent    = ct.expiringSoon;
  document.getElementById('kpi-ct-yearly').textContent      = ct.yearlyTotal;
}

document.addEventListener('DOMContentLoaded', function() {
  initKPIs();
});

// ===== NAVIGATION =====
let currentPage = 'matching';

function navigateTo(pageId) {
  if (currentPage === pageId) return;
  document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
  const target = document.getElementById('page-' + pageId);
  if (target) target.classList.add('active');
  document.querySelectorAll('.sidebar .nav-item').forEach(item => {
    item.classList.toggle('active', item.dataset.page === pageId);
  });
  currentPage = pageId;
  window.scrollTo(0, 0);
}

// ===== MATCHING PAGE JS (verbatim from original) =====
// ===== MISSIONS DATA =====
const missions = [
  {
    title: 'Cariste CACES 3', client: 'Carrefour Supply Chain', lieu: 'Lyon 7e',
    radius: 20, nb: 5, horaires: 'Journée (8h-16h)',
    tags: ['CACES 3', 'Expérience entrepôt', 'Visite médicale à jour'],
    candidates: [
      { name: 'Marc Lefèvre', initials: 'ML', sub: 'Cariste · Lyon 7e · 4 ans exp.', gradient: 'linear-gradient(135deg,#6C5CE7,#A29BFE)', pct: 95, status: 'Disponible', statusClass: 'available', crits: [{t:'CACES 3',s:'ok'},{t:'Expérience',s:'ok'},{t:'Proximité',s:'ok'},{t:'Visite méd.',s:'ok'}] },
      { name: 'Thomas Roche', initials: 'TR', sub: 'Cariste CACES 1,3,5 · Vénissieux · 6 ans', gradient: 'linear-gradient(135deg,#00B894,#55E6A5)', pct: 91, status: 'Disponible', statusClass: 'available', crits: [{t:'CACES 3',s:'ok'},{t:'Expérience',s:'ok'},{t:'Proximité',s:'partial'},{t:'Visite méd.',s:'ok'}] },
      { name: 'Fatima El Amrani', initials: 'FA', sub: 'Cariste · Gerland · 3 ans exp.', gradient: 'linear-gradient(135deg,#F39C12,#FDCB6E)', pct: 87, status: 'Disponible', statusClass: 'available', crits: [{t:'CACES 3',s:'ok'},{t:'Expérience',s:'ok'},{t:'Proximité',s:'ok'},{t:'Visite méd.',s:'partial'}] },
      { name: 'Karim Benali', initials: 'KB', sub: 'Cariste · Saint-Priest · 2 ans', gradient: 'linear-gradient(135deg,#E74C3C,#FF7675)', pct: 82, status: 'En attente', statusClass: 'pending', crits: [{t:'CACES 3',s:'ok'},{t:'Expérience',s:'partial'},{t:'Proximité',s:'partial'},{t:'Visite méd.',s:'ok'}] },
      { name: 'Antoine Girard', initials: 'AG', sub: 'Cariste · Décines · 5 ans exp.', gradient: 'linear-gradient(135deg,#4A90D9,#74B9FF)', pct: 79, status: 'Disponible', statusClass: 'available', crits: [{t:'CACES 3',s:'ok'},{t:'Expérience',s:'ok'},{t:'Proximité',s:'partial'},{t:'Visite méd.',s:'no'}] },
      { name: 'Sophie Morel', initials: 'SM', sub: 'Cariste · Bron · 1 an exp.', gradient: 'linear-gradient(135deg,#A29BFE,#DDA0DD)', pct: 74, status: 'Disponible', statusClass: 'available', crits: [{t:'CACES 3',s:'ok'},{t:'Expérience',s:'partial'},{t:'Proximité',s:'ok'},{t:'Visite méd.',s:'ok'}] },
      { name: 'Youssef Amara', initials: 'YA', sub: 'Magasinier · Oullins · 3 ans', gradient: 'linear-gradient(135deg,#00CEC9,#81ECEC)', pct: 68, status: 'Disponible', statusClass: 'available', crits: [{t:'CACES 3',s:'partial'},{t:'Expérience',s:'partial'},{t:'Proximité',s:'ok'},{t:'Visite méd.',s:'ok'}] },
      { name: 'Claire Dupont', initials: 'CD', sub: 'Cariste · Villeurbanne · 2 ans', gradient: 'linear-gradient(135deg,#FD79A8,#FDCB6E)', pct: 63, status: 'En attente', statusClass: 'pending', crits: [{t:'CACES 3',s:'ok'},{t:'Expérience',s:'partial'},{t:'Proximité',s:'partial'},{t:'Visite méd.',s:'no'}] },
    ]
  },
  {
    title: 'Préparateur commandes', client: 'Amazon FBA', lieu: 'Saint-Priest',
    radius: 15, nb: 3, horaires: '2x8',
    tags: ['Préparation commandes', 'Scan RF', 'Port de charges'],
    candidates: [
      { name: 'Sarah Dubois', initials: 'SD', sub: 'Prépa. commandes · Villeurbanne · 3 ans', gradient: 'linear-gradient(135deg,#4A90D9,#74B9FF)', pct: 93, status: 'Disponible', statusClass: 'available', crits: [{t:'Prépa. cmd',s:'ok'},{t:'Scan RF',s:'ok'},{t:'Proximité',s:'ok'}] },
      { name: 'Julie Martin', initials: 'JM', sub: 'Opératrice · Décines · 2 ans', gradient: 'linear-gradient(135deg,#A29BFE,#DDA0DD)', pct: 85, status: 'Disponible', statusClass: 'available', crits: [{t:'Prépa. cmd',s:'ok'},{t:'Scan RF',s:'partial'},{t:'Proximité',s:'ok'}] },
      { name: 'Nadia Khelif', initials: 'NK', sub: 'Manutentionnaire · Vénissieux · 1 an', gradient: 'linear-gradient(135deg,#00B894,#55E6A5)', pct: 76, status: 'Disponible', statusClass: 'available', crits: [{t:'Prépa. cmd',s:'partial'},{t:'Scan RF',s:'ok'},{t:'Proximité',s:'ok'}] },
      { name: 'Lucas Ferreira', initials: 'LF', sub: 'Logistique · Lyon 8e · 4 ans', gradient: 'linear-gradient(135deg,#F39C12,#FDCB6E)', pct: 71, status: 'En attente', statusClass: 'pending', crits: [{t:'Prépa. cmd',s:'ok'},{t:'Scan RF',s:'partial'},{t:'Proximité',s:'partial'}] },
      { name: 'Emma Laurent', initials: 'EL', sub: 'Prépa. commandes · Meyzieu · 2 ans', gradient: 'linear-gradient(135deg,#E74C3C,#FF7675)', pct: 67, status: 'Disponible', statusClass: 'available', crits: [{t:'Prépa. cmd',s:'ok'},{t:'Scan RF',s:'no'},{t:'Proximité',s:'partial'}] },
    ]
  },
  {
    title: 'Agent de production', client: 'Sanofi', lieu: 'Gerland',
    radius: 10, nb: 2, horaires: '3x8',
    tags: ['Production pharma', 'Salle blanche', 'BPF'],
    candidates: [
      { name: 'Pierre Blanc', initials: 'PB', sub: 'Agent prod. pharma · Lyon 7e · 5 ans', gradient: 'linear-gradient(135deg,#6C5CE7,#A29BFE)', pct: 90, status: 'Disponible', statusClass: 'available', crits: [{t:'Prod. pharma',s:'ok'},{t:'Salle blanche',s:'ok'},{t:'BPF',s:'ok'}] },
      { name: 'Amina Diallo', initials: 'AD', sub: 'Opératrice · Gerland · 3 ans', gradient: 'linear-gradient(135deg,#00CEC9,#81ECEC)', pct: 84, status: 'Disponible', statusClass: 'available', crits: [{t:'Prod. pharma',s:'ok'},{t:'Salle blanche',s:'ok'},{t:'BPF',s:'partial'}] },
      { name: 'Romain Faure', initials: 'RF', sub: 'Agent conditionnement · Bron · 2 ans', gradient: 'linear-gradient(135deg,#F39C12,#FDCB6E)', pct: 72, status: 'En attente', statusClass: 'pending', crits: [{t:'Prod. pharma',s:'partial'},{t:'Salle blanche',s:'ok'},{t:'BPF',s:'no'}] },
    ]
  }
];

let currentMission = 0;

// ===== RENDER MATCHES =====
let matchCurrentFilter = 'all';

function renderMatches(missionIdx, filter) {
  filter = filter || matchCurrentFilter;
  const m = missions[missionIdx];
  const list = document.getElementById('matchList');
  const count = document.getElementById('resultsCount');

  let filtered = m.candidates;
  if (filter === 'top') filtered = m.candidates.filter(c => c.pct >= 85);
  if (filter === 'available') filtered = m.candidates.filter(c => c.statusClass === 'available');
  count.textContent = filtered.length;

  if (filtered.length === 0) {
    list.innerHTML = `<div style="grid-column:1/-1;display:flex;flex-direction:column;align-items:center;padding:48px 20px;gap:10px;color:var(--text-tertiary);">
      <svg width="40" height="40" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <div style="font-size:15px;font-weight:700;color:var(--text-secondary);">Aucun candidat</div>
      <div style="font-size:13px;text-align:center;">Essayez un autre filtre ou relancez le matching</div>
    </div>`;
    return;
  }

  const rankLabels = ['🥇 #1', '🥈 #2', '🥉 #3'];
  const rankClasses = ['gold', 'silver', 'bronze'];

  list.innerHTML = filtered.map((c, i) => {
    const barCol = c.pct >= 85 ? '#2ECC71' : c.pct >= 70 ? '#F39C12' : '#E74C3C';
    const rankClass = i < 3 ? rankClasses[i] : 'other';

    const statusDot = `<span style="width:6px;height:6px;border-radius:50%;background:currentColor;display:inline-block;"></span>`;
    const scoreClass = c.pct >= 85 ? 'green' : c.pct >= 70 ? 'orange' : 'red';
    const rankEmojis = ['1', '2', '3'];
    const rankDotLabel = i < 3 ? rankEmojis[i] : `${i+1}`;

    const critIcons = { ok: `<svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><polyline points="20 6 9 17 4 12"/></svg>`, partial: `<svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="5" y1="12" x2="19" y2="12"/></svg>`, no: `<svg width="10" height="10" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="3"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>` };

    return `
      <div class="mtc-card" style="animation-delay:${i * 0.06}s;">
        <div class="mtc-bar" style="background:linear-gradient(90deg,${barCol},${barCol}55);"></div>
        <div class="mtc-head">
          <div class="mtc-av-group">
            <div class="mtc-av" style="background:${c.gradient};">${c.initials}</div>
            <div class="mtc-rank-dot ${rankClass}">${rankDotLabel}</div>
          </div>
          <div class="mtc-info">
            <div class="mtc-name">${c.name}</div>
            <div class="mtc-sub">${c.sub}</div>
            <span class="mtc-status ${c.statusClass}">${statusDot} ${c.status}</span>
          </div>
          <div class="mtc-score ${scoreClass}">
            <div class="mtc-score-num">${c.pct}%</div>
            <div class="mtc-score-lbl">compat.</div>
          </div>
        </div>
        <div class="mtc-crits">
          ${c.crits.map(cr => `<div class="mtc-crit ${cr.s}">${critIcons[cr.s]} ${cr.t}</div>`).join('')}
        </div>
        <div class="mtc-foot">
          <button class="mtc-act" onclick="cdOpenFromMatching('${c.name}')">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
            Fiche
          </button>
          <button class="mtc-act contact" onclick="showToast('Appel ${c.name}...')">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07A19.5 19.5 0 0 1 4.69 12 19.79 19.79 0 0 1 1.62 3.38 2 2 0 0 1 3.6 1.22h3a2 2 0 0 1 2 1.72c.127.96.362 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91A16 16 0 0 0 14 15.91l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 22 16.92z"/></svg>
            Contacter
          </button>
          <button class="mtc-act primary" onclick="scPropose('${c.name}')">
            <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
            Proposer
          </button>
        </div>
      </div>`;
  }).join('');
}

function filterMatches(filter, el) {
  matchCurrentFilter = filter;
  document.querySelectorAll('.mtc-filter-chip').forEach(c => c.classList.remove('active'));
  if (el) el.classList.add('active');
  renderMatches(currentMission, filter);
}

function cdOpenFromMatching(name) {
  // Try to find candidate in cvtheque data
  const found = typeof candidates !== 'undefined' ? candidates.find(c => c.nm === name) : null;
  if (found) {
    cdOpenDrawer(found, typeof statusMap !== 'undefined' ? statusMap : {});
  } else {
    showToast('Fiche de ' + name);
  }
}

let ficheCurrentRadius = 20;

function updateFiche(missionIdx) {
  const m = missions[missionIdx];
  document.getElementById('fichePoste').value = m.title;
  document.getElementById('ficheClient').value = m.client;
  document.getElementById('ficheLieu').value = m.lieu;
  document.getElementById('ficheNb').value = m.nb;

  // Radius pills
  ficheCurrentRadius = m.radius || 20;
  document.querySelectorAll('.fiche-radius-pill').forEach(p => {
    const val = parseInt(p.textContent);
    p.classList.toggle('active', val === ficheCurrentRadius);
  });

  // KPIs
  document.getElementById('kpiPostes').textContent = m.nb;
  document.getElementById('kpiRayon').textContent = ficheCurrentRadius + ' km';
  document.getElementById('ficheSubtitle').textContent = m.client + ' · ' + m.lieu;

  // Urgency
  const urgEl = document.getElementById('kpiUrgency');
  const urgency = missionIdx === 0 || missionIdx === 1 ? 'high' : 'medium';
  urgEl.className = 'mtc-urgency-badge ' + urgency;
  urgEl.textContent = urgency === 'high' ? '🔴 Urgent' : '🟡 Normal';

  const tagsEl = document.getElementById('ficheTags');
  tagsEl.innerHTML = m.tags.map(t => `<div class="fiche-tag">${t} <span class="fiche-tag-remove" onclick="removeTag(this)">×</span></div>`).join('');
}

function setRadius(km, el) {
  ficheCurrentRadius = km;
  document.querySelectorAll('.fiche-radius-pill').forEach(p => p.classList.remove('active'));
  el.classList.add('active');
  document.getElementById('kpiRayon').textContent = km + ' km';
  missions[currentMission].radius = km;
  showToast('Périmètre mis à jour : ' + km + ' km autour de ' + (document.getElementById('ficheLieu').value || 'la ville'));
}

function selectMission(idx, el) {
  currentMission = idx;
  matchCurrentFilter = 'all';
  document.querySelectorAll('.mission-tab').forEach(t => t.classList.remove('active'));
  if (el) el.classList.add('active');
  document.querySelectorAll('.mtc-filter-chip').forEach(c => {
    c.classList.toggle('active', c.textContent.trim() === 'Tous');
  });
  updateFiche(idx);
  renderMatches(idx);
}

// ===== TAGS =====
function removeTag(el) { el.parentElement.remove(); }
function addTag() {
  const input = document.getElementById('newTagInput');
  const val = input.value.trim();
  if (!val) return;
  const tag = document.createElement('div');
  tag.className = 'fiche-tag';
  tag.innerHTML = val + ' <span class="fiche-tag-remove" onclick="removeTag(this)">×</span>';
  document.getElementById('ficheTags').appendChild(tag);
  input.value = '';
}

// ===== MATCHING =====
function runMatching() {
  const list = document.getElementById('matchList');
  const overlay = document.getElementById('scanOverlay');
  const fill = document.getElementById('scanFill');
  const sub = document.getElementById('scanSub');

  list.style.display = 'none';
  overlay.classList.add('show');

  let progress = 0;
  const total = 847;
  const interval = setInterval(() => {
    progress += Math.floor(Math.random() * 120) + 40;
    if (progress > total) progress = total;
    fill.style.width = (progress / total * 100) + '%';
    sub.textContent = progress + ' / ' + total + ' profils analysés';
    if (progress >= total) {
      clearInterval(interval);
      setTimeout(() => {
        overlay.classList.remove('show');
        list.style.display = 'block';
        renderMatches(currentMission);
        showToast('✅ Matching terminé — ' + missions[currentMission].candidates.length + ' candidats compatibles trouvés');
      }, 400);
    }
  }, 200);
}

// ===== NEW FICHE MODAL =====
function openNewFiche() {
  document.getElementById('newFicheModal').classList.add('show');
}
function closeModal() {
  document.getElementById('newFicheModal').classList.remove('show');
}
let modalRadius = 20;
function setModalRadius(km, el) {
  modalRadius = km;
  document.querySelectorAll('#modalRadiusPills .fiche-radius-pill').forEach(p => p.classList.remove('active'));
  el.classList.add('active');
}

function createFiche() {
  const poste = document.getElementById('modalPoste').value.trim();
  const client = document.getElementById('modalClient').value.trim();
  const lieu = document.getElementById('modalLieu').value.trim();
  if (!poste) { showToast('⚠️ Veuillez renseigner un intitulé de poste'); return; }
  if (!lieu) { showToast('⚠️ Veuillez renseigner la ville de la mission'); return; }

  const tabs = document.getElementById('missionTabs');
  const newTab = document.createElement('div');
  newTab.className = 'mission-tab';
  newTab.innerHTML = `
    <div class="mission-tab-urgency medium"></div>
    <div class="mission-tab-info">
      <div class="mission-tab-title">${poste}</div>
      <div class="mission-tab-meta">📍 ${client || 'Client'} — ${lieu}</div>
    </div>
    <div class="mission-tab-match">0</div>
  `;
  tabs.insertBefore(newTab, tabs.lastElementChild);

  const comps = document.getElementById('modalComp').value.split(',').map(s => s.trim()).filter(Boolean);
  missions.push({
    title: poste, client: client || 'Nouveau client', lieu,
    radius: modalRadius,
    nb: parseInt(document.getElementById('modalNb').value) || 1,
    horaires: document.getElementById('modalHoraires').value,
    tags: comps.length ? comps : [poste],
    candidates: []
  });

  const newIdx = missions.length - 1;
  newTab.onclick = () => selectMission(newIdx, newTab);

  // Reset modal radius
  modalRadius = 20;
  document.querySelectorAll('#modalRadiusPills .fiche-radius-pill').forEach(p => p.classList.toggle('active', parseInt(p.textContent) === 20));

  closeModal();
  selectMission(newIdx, newTab);
  showToast('✅ Fiche "' + poste + '" créée · ' + lieu + ' · ' + modalRadius + ' km — Lancez le matching !');
}

// ===== TOAST =====
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// ===== INIT =====
renderMatches(0);

// ===== SCORING PAGE JS =====
const predefined = [
  { id: 'exp',  name: 'Expérience métier',        desc: 'Années dans le secteur',        icon: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/></svg>', color: '#6C5CE7', bg: '#F0EEFF', points: 25, active: true },
  { id: 'cert', name: 'Certifications / CACES',   desc: 'Habilitations et permis',        icon: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="6"/><path d="M15.477 12.89L17 22l-5-3-5 3 1.523-9.11"/></svg>', color: '#4A90D9', bg: '#EBF3FC', points: 20, active: true },
  { id: 'dispo',name: 'Disponibilité',            desc: 'Rapidité de démarrage',          icon: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>', color: '#2ECC71', bg: '#E8F8F0', points: 20, active: true },
  { id: 'geo',  name: 'Proximité géographique',   desc: 'Distance au lieu de mission',    icon: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/></svg>', color: '#F39C12', bg: '#FEF5E7', points: 15, active: true },
  { id: 'eval', name: 'Évaluations précédentes',  desc: 'Notes des missions passées',     icon: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polygon points="12 2 15.09 8.26 22 9.27 17 14.14 18.18 21.02 12 17.77 5.82 21.02 7 14.14 2 9.27 8.91 8.26 12 2"/></svg>', color: '#E74C3C', bg: '#FDECEB', points: 10, active: true },
  { id: 'lang', name: 'Compétences linguistiques',desc: 'Langues parlées',                icon: '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="2" y1="12" x2="22" y2="12"/><path d="M12 2a15.3 15.3 0 0 1 4 10 15.3 15.3 0 0 1-4 10 15.3 15.3 0 0 1-4-10 15.3 15.3 0 0 1 4-10z"/></svg>', color: '#00B894', bg: '#E8F8F5', points: 10, active: true },
];

let customCriteria = [];
let customIdCounter = 0;

const scoringCandidates = [
  {
    name: 'Marc Lefèvre', initials: 'ML', sub: 'Cariste CACES 3 · Lyon 7e',
    gradient: 'linear-gradient(135deg, #6C5CE7, #A29BFE)',
    status: 'available', statusText: 'Disponible',
    scores: { exp: 23, cert: 20, dispo: 18, geo: 14, eval: 9, lang: 8 }
  },
  {
    name: 'Sarah Dubois', initials: 'SD', sub: 'Préparatrice commandes · Villeurbanne',
    gradient: 'linear-gradient(135deg, #4A90D9, #74B9FF)',
    status: 'available', statusText: 'Disponible',
    scores: { exp: 20, cert: 18, dispo: 20, geo: 12, eval: 10, lang: 7 }
  },
  {
    name: 'Thomas Roche', initials: 'TR', sub: 'Cariste CACES 1,3,5 · Vénissieux',
    gradient: 'linear-gradient(135deg, #00B894, #55E6A5)',
    status: 'available', statusText: 'Disponible',
    scores: { exp: 25, cert: 20, dispo: 15, geo: 10, eval: 8, lang: 6 }
  },
  {
    name: 'Fatima El Amrani', initials: 'FA', sub: 'Agent de production · Gerland',
    gradient: 'linear-gradient(135deg, #F39C12, #FDCB6E)',
    status: 'pending', statusText: 'En attente',
    scores: { exp: 18, cert: 14, dispo: 16, geo: 15, eval: 7, lang: 10 }
  },
  {
    name: 'Karim Benali', initials: 'KB', sub: 'Manutentionnaire · Saint-Priest',
    gradient: 'linear-gradient(135deg, #E74C3C, #FF7675)',
    status: 'placed', statusText: 'Placé',
    scores: { exp: 15, cert: 12, dispo: 10, geo: 13, eval: 6, lang: 5 }
  },
  {
    name: 'Julie Martin', initials: 'JM', sub: 'Opératrice conditionnement · Décines',
    gradient: 'linear-gradient(135deg, #A29BFE, #DDA0DD)',
    status: 'available', statusText: 'Disponible',
    scores: { exp: 21, cert: 16, dispo: 19, geo: 11, eval: 9, lang: 8 }
  },
];

function renderCriteria() {
  const predContainer = document.getElementById('predefinedCriteria');
  const custContainer = document.getElementById('customCriteria');

  predContainer.innerHTML = predefined.map((c, i) => criterionHTML(c, 'pred', i)).join('');
  custContainer.innerHTML = customCriteria.map((c, i) => criterionHTML(c, 'cust', i)).join('');

  updateTotal();
  renderScoringCandidates();
}

function criterionHTML(c, type, index) {
  return `
    <div class="criterion">
      <label class="criterion-toggle">
        <input type="checkbox" ${c.active ? 'checked' : ''} onchange="toggleCriterion('${type}', ${index})" />
        <span class="toggle-slider"></span>
      </label>
      <div class="criterion-icon" style="background:${c.bg};">${c.icon}</div>
      <div class="criterion-info">
        <div class="criterion-name">${c.name}</div>
        <div class="criterion-desc">${c.desc || ''}</div>
      </div>
      <div class="criterion-points">
        <div class="points-btn" onclick="changePoints('${type}', ${index}, -5)">−</div>
        <div class="points-value ${c.active ? '' : 'disabled'}">${c.points}</div>
        <div class="points-btn" onclick="changePoints('${type}', ${index}, 5)">+</div>
      </div>
    </div>
  `;
}

function toggleCriterion(type, index) {
  const list = type === 'pred' ? predefined : customCriteria;
  list[index].active = !list[index].active;
  renderCriteria();
}

function changePoints(type, index, delta) {
  const list = type === 'pred' ? predefined : customCriteria;
  list[index].points = Math.max(0, Math.min(100, list[index].points + delta));
  renderCriteria();
}

function updateTotal() {
  const allCriteria = [...predefined, ...customCriteria];
  const active = allCriteria.filter(c => c.active);
  const total = active.reduce((sum, c) => sum + c.points, 0);

  const el = document.getElementById('totalValue');
  const fill = document.getElementById('totalProgressFill');
  const countEl = document.getElementById('activeCount');

  el.textContent = total;
  countEl.textContent = active.length;

  const pct = Math.min(total / 100 * 100, 150);
  fill.style.width = Math.min(pct, 100) + '%';

  if (total === 100) {
    el.className = 'total-value valid';
    fill.style.background = 'var(--green)';
  } else if (total > 100) {
    el.className = 'total-value over';
    fill.style.background = 'var(--red)';
  } else {
    el.className = 'total-value warning';
    fill.style.background = 'var(--orange)';
  }
}

function showAddForm() {
  document.getElementById('addBtn').style.display = 'none';
  document.getElementById('addForm').classList.add('show');
  document.getElementById('newCriterionName').focus();
}

function hideAddForm() {
  document.getElementById('addBtn').style.display = 'flex';
  document.getElementById('addForm').classList.remove('show');
  document.getElementById('newCriterionName').value = '';
  document.getElementById('newCriterionDesc').value = '';
}

function addCustomCriterion() {
  const name = document.getElementById('newCriterionName').value.trim();
  const desc = document.getElementById('newCriterionDesc').value.trim();
  if (!name) return;

  const icons = [
    '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14.7 6.3a1 1 0 0 0 0 1.4l1.6 1.6a1 1 0 0 0 1.4 0l3.77-3.77a6 6 0 0 1-7.94 7.94l-6.91 6.91a2.12 2.12 0 0 1-3-3l6.91-6.91a6 6 0 0 1 7.94-7.94l-3.76 3.76z"/></svg>',
    '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>',
    '<svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="12"/><line x1="12" y1="16" x2="12.01" y2="16"/></svg>',
  ];
  const colors = ['#6C5CE7', '#4A90D9', '#2ECC71', '#F39C12', '#E74C3C', '#00B894'];
  const bgs    = ['#F0EEFF', '#EBF3FC', '#E8F8F0', '#FEF5E7', '#FDECEB', '#E8F8F5'];
  const idx    = customIdCounter % colors.length;

  customCriteria.push({
    id: 'custom_' + customIdCounter++,
    name, desc,
    icon: icons[idx % icons.length],
    color: colors[idx],
    bg: bgs[idx],
    points: 10,
    active: true
  });

  hideAddForm();
  renderCriteria();
  showToast('Critère "' + name + '" ajouté');
}

function renderScoringCandidates(filter) {
  const grid = document.getElementById('scGrid');
  const activeCriteria = [...predefined, ...customCriteria].filter(c => c.active);
  const maxTotal = activeCriteria.reduce((s, c) => s + c.points, 0) || 1;

  let filtered = scoringCandidates;
  if (filter === 'high') filtered = scoringCandidates.filter(c => calcTotal(c, activeCriteria) / maxTotal >= 0.8);
  if (filter === 'available') filtered = scoringCandidates.filter(c => c.status === 'available');

  filtered.sort((a, b) => calcTotal(b, activeCriteria) - calcTotal(a, activeCriteria));

  grid.innerHTML = filtered.map((c, i) => {
    const total = calcTotal(c, activeCriteria);
    const pct = Math.round((total / maxTotal) * 100);
    const circumference = 2 * Math.PI * 28;
    const offset = circumference - (pct / 100) * circumference;
    const scoreColor = pct >= 80 ? 'var(--green)' : pct >= 60 ? 'var(--orange)' : 'var(--red)';

    const bars = activeCriteria.slice(0, 4).map(cr => {
      const pts = c.scores[cr.id] || Math.round(Math.random() * cr.points * 0.8);
      const bPct = Math.round((pts / cr.points) * 100);
      return `
        <div class="sc-bar-row">
          <div class="sc-bar-label">${cr.name.substring(0, 14)}</div>
          <div class="sc-bar-track"><div class="sc-bar-fill" style="width:${bPct}%;background:${cr.color};"></div></div>
          <div class="sc-bar-pts" style="color:${cr.color};">${bPct}%</div>
        </div>`;
    }).join('');

    return `
      <div class="sc-card" style="animation:fadeUp 0.35s ease backwards;animation-delay:${i * 0.07}s;">
        <div class="sc-card-top">
          <div class="sc-card-avatar" style="background:${c.gradient};">${c.initials}</div>
          <div class="sc-card-info">
            <div class="sc-card-name">${c.name}</div>
            <div class="sc-card-sub">${c.sub}</div>
            <span class="status-badge ${c.status}" style="margin-top:4px;"><span class="status-dot"></span>${c.statusText}</span>
          </div>
          <div class="sc-ring-wrap">
            <svg viewBox="0 0 60 60" width="60" height="60">
              <circle cx="30" cy="30" r="28" fill="none" stroke="#e8eaf0" stroke-width="4"/>
              <circle cx="30" cy="30" r="28" fill="none" stroke="${scoreColor}" stroke-width="4"
                stroke-dasharray="${circumference.toFixed(1)}"
                stroke-dashoffset="${offset.toFixed(1)}"
                stroke-linecap="round"
                transform="rotate(-90 30 30)"/>
            </svg>
            <div class="sc-ring-text" style="color:${scoreColor};">${pct}</div>
          </div>
        </div>
        <div class="sc-bars">${bars}</div>
        <div class="sc-act">
          <button class="sc-btn-cv" onclick="showToast('Ouverture du CV...')">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
            CV
          </button>
          <button class="sc-btn-contact" onclick="showToast('Ouverture de la fiche contact...')">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07A19.5 19.5 0 0 1 4.17 12a19.79 19.79 0 0 1-3.07-8.63A2 2 0 0 1 3.12 1.18h3a2 2 0 0 1 2 1.72 12.84 12.84 0 0 0 .7 2.81 2 2 0 0 1-.45 2.11L7.91 8.27a16 16 0 0 0 8 8l1.27-1.27a2 2 0 0 1 2.11-.45 12.84 12.84 0 0 0 2.81.7A2 2 0 0 1 24 17z"/></svg>
            Contacter
          </button>
          <button class="sc-btn-mission" onclick="scPropose('${c.name}')">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="8" x2="12" y2="16"/><line x1="8" y1="12" x2="16" y2="12"/></svg>
            Proposer
          </button>
        </div>
      </div>`;
  }).join('');
}

function scAnalyzeCv() {
  const area = document.querySelector('.sc-upload-area');
  const prog = document.getElementById('scUploadProgress');
  const fill = document.getElementById('scUploadFill');
  if (!area || !prog || !fill) return;
  prog.style.display = 'block';
  fill.style.width = '0%';
  let pct = 0;
  const iv = setInterval(() => {
    pct += Math.random() * 18 + 5;
    if (pct >= 100) { pct = 100; clearInterval(iv); }
    fill.style.width = pct + '%';
    if (pct >= 100) {
      setTimeout(() => { prog.style.display = 'none'; fill.style.width = '0%'; }, 1200);
      showToast('CV analysé — Score ajouté à la liste');
      const newCandidate = {
        id: Date.now(), name: 'Nouveau Candidat', initials: 'NC', sub: 'CV importé',
        gradient: 'linear-gradient(135deg,#6C5CE7,#a29bfe)',
        status: 'available', statusText: 'Disponible',
        scores: {}
      };
      scoringCandidates.unshift(newCandidate);
      renderScoringCandidates();
    }
  }, 180);
}

// ===== SCORING — MODAL PROPOSITION CLIENT =====
let scProposeCandidate = null;
let scProposeSelectedClient = null;
let scProposeSelectedMission = null;
let scProposeVisibility = 'full'; // 'full' | 'anon'

function scPropose(candidateName) {
  scProposeCandidate = candidateName;
  scProposeSelectedClient = null;
  scProposeSelectedMission = null;
  scProposeVisibility = 'full';
  document.getElementById('scVisOptFull').classList.add('on');
  document.getElementById('scVisOptAnon').classList.remove('on');
  document.getElementById('scProposeCandidateName').textContent = 'Proposer : ' + candidateName;
  document.getElementById('scProposeConfirmBtn').disabled = true;
  const list = document.getElementById('scProposeClientList');
  list.innerHTML = pcAgencyClients.map(client => `
    <div class="sc-propose-client" id="scPC_${client.id}" onclick="scSelectClient(${client.id})">
      <div class="sc-propose-client-head">
        <div class="sc-propose-client-av" style="background:${client.color};">${client.initials}</div>
        <div>
          <div class="sc-propose-client-name">${client.name}</div>
          <div class="sc-propose-client-missions">${client.missions.length} mission${client.missions.length > 1 ? 's' : ''} active${client.missions.length > 1 ? 's' : ''}</div>
        </div>
        <div class="sc-propose-client-check" id="scPCC_${client.id}"></div>
      </div>
      <div class="sc-propose-missions" id="scPM_${client.id}" style="display:none;">
        ${client.missions.map((m, mi) => `
          <div class="sc-propose-mission" id="scPMI_${client.id}_${mi}" onclick="event.stopPropagation();scSelectMission(${client.id},${mi})">
            <div class="sc-propose-mission-name">${m.name}</div>
            <div class="sc-propose-mission-date">${m.date}</div>
          </div>`).join('')}
      </div>
    </div>`).join('');
  document.getElementById('scProposeModal').classList.add('open');
}

function scSelectClient(clientId) {
  // deselect all
  pcAgencyClients.forEach(c => {
    const el = document.getElementById('scPC_' + c.id);
    const pm = document.getElementById('scPM_' + c.id);
    if (el) el.classList.remove('selected');
    if (pm) pm.style.display = 'none';
    document.querySelectorAll('[id^="scPMI_' + c.id + '_"]').forEach(m => m.classList.remove('selected'));
  });
  scProposeSelectedMission = null;
  if (scProposeSelectedClient === clientId) {
    scProposeSelectedClient = null;
    document.getElementById('scProposeConfirmBtn').disabled = true;
    return;
  }
  scProposeSelectedClient = clientId;
  const el = document.getElementById('scPC_' + clientId);
  const pm = document.getElementById('scPM_' + clientId);
  if (el) el.classList.add('selected');
  if (pm) pm.style.display = 'flex';
  document.getElementById('scProposeConfirmBtn').disabled = false;
}

function scSelectMission(clientId, missionIdx) {
  // deselect all missions for this client
  const client = pcAgencyClients.find(c => c.id === clientId);
  if (!client) return;
  client.missions.forEach((_, i) => {
    const el = document.getElementById('scPMI_' + clientId + '_' + i);
    if (el) el.classList.remove('selected');
  });
  if (scProposeSelectedMission && scProposeSelectedMission.clientId === clientId && scProposeSelectedMission.idx === missionIdx) {
    scProposeSelectedMission = null;
  } else {
    scProposeSelectedMission = {clientId, idx: missionIdx};
    const el = document.getElementById('scPMI_' + clientId + '_' + missionIdx);
    if (el) el.classList.add('selected');
  }
}

function scCloseProposeModal(e) {
  if (e && e.target !== document.getElementById('scProposeModal')) return;
  document.getElementById('scProposeModal').classList.remove('open');
}

function scSetVisibility(v) {
  scProposeVisibility = v;
  document.getElementById('scVisOptFull').classList.toggle('on', v === 'full');
  document.getElementById('scVisOptAnon').classList.toggle('on', v === 'anon');
}

function scConfirmPropose() {
  const client = pcAgencyClients.find(c => c.id === scProposeSelectedClient);
  if (!client) return;
  const visLabel = scProposeVisibility === 'anon' ? ' 🔒 Anonymisé' : ' 👤 Profil complet';
  let msg = 'Profil proposé à ' + client.name + visLabel;
  if (scProposeSelectedMission !== null) {
    const m = client.missions[scProposeSelectedMission.idx];
    if (m) msg += ' — ' + m.name;
  }
  document.getElementById('scProposeModal').classList.remove('open');
  showToast(msg);
}

function calcTotal(candidate, activeCriteria) {
  return activeCriteria.reduce((sum, cr) => {
    return sum + (candidate.scores[cr.id] || Math.round(Math.random() * cr.points * 0.7));
  }, 0);
}

function filterCandidates(filter, el) {
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
  if (el) el.classList.add('active');
  renderScoringCandidates(filter);
}

function saveConfig() {
  const allActive = [...predefined, ...customCriteria].filter(c => c.active);
  const total = allActive.reduce((s, c) => s + c.points, 0);

  if (total !== 100) {
    showToast('Le total doit être de 100 points (actuellement ' + total + ')');
    return;
  }

  showToast('Configuration sauvegardée — Scores recalculés en temps réel');
  renderScoringCandidates();
}

renderCriteria();

// ===== RELANCES PAGE JS =====
const relanceCampaigns = [
  {id:1,name:'Dispo semaine 7',type:'📋',desc:'Disponibilité — 234 caristes ciblés',status:'running',sent:234,replied:187,rate:80,channel:'SMS',color:'var(--green)'},
  {id:2,name:'Confirmation lundi — Carrefour',type:'✅',desc:'Confirmation mission — 18 candidats placés',status:'running',sent:18,replied:15,rate:83,channel:'SMS',color:'var(--green)'},
  {id:3,name:'Réactivation dormants +90j',type:'💤',desc:'Candidats inactifs depuis 3 mois — 89 ciblés',status:'running',sent:89,replied:34,rate:38,channel:'WhatsApp',color:'var(--orange)'},
  {id:4,name:'Satisfaction mission Sanofi',type:'⭐',desc:'Retour fin de mission — 8 candidats',status:'done',sent:8,replied:7,rate:88,channel:'SMS',color:'var(--accent)'},
  {id:5,name:'Docs CACES expirés',type:'📄',desc:'Renouvellement CACES — 12 candidats',status:'scheduled',sent:0,replied:0,rate:0,channel:'Email',color:'var(--blue)'},
  {id:6,name:'Dispo semaine 8',type:'📋',desc:'Disponibilité — Tous les actifs',status:'scheduled',sent:0,replied:0,rate:0,channel:'SMS',color:'var(--blue)'},
];

function renderCampaigns(){
  const el=document.getElementById('campList');
  if(!el) return;
  el.innerHTML=relanceCampaigns.map((c,i)=>{
    const barW=c.sent?Math.round(c.replied/c.sent*100):0;
    const barCol=barW>=70?'linear-gradient(90deg,var(--green),#55E6A5)':barW>=40?'linear-gradient(90deg,var(--orange),#FDCB6E)':'linear-gradient(90deg,var(--red),#FF7675)';
    return`<div class="camp ${c.status}" style="animation:fadeUp 0.4s ease backwards;animation-delay:${i*0.05}s;">
      <div class="camp-top">
        <div class="camp-icon" style="background:${c.status==='running'?'var(--green-bg)':c.status==='scheduled'?'var(--blue-bg)':c.status==='done'?'var(--accent-bg)':'var(--orange-bg)'}">${c.type}</div>
        <div class="camp-info"><div class="camp-name">${c.name}</div><div class="camp-desc">${c.desc}</div></div>
        <div class="camp-status ${c.status}">${c.status==='running'?'● En cours':c.status==='scheduled'?'⏰ Programmé':c.status==='done'?'✓ Terminé':'⏸ Pause'}</div>
      </div>
      ${c.sent?`<div class="camp-stats">
        <div class="camp-stat"><div class="camp-stat-val">${c.sent}</div><div class="camp-stat-label">envoyés</div></div>
        <div class="camp-stat"><div class="camp-stat-val">${c.replied}</div><div class="camp-stat-label">réponses</div></div>
        <div class="camp-stat"><div class="camp-stat-val" style="color:${c.color}">${c.rate}%</div><div class="camp-stat-label">taux</div></div>
        <div class="camp-stat"><div class="camp-stat-val">📱</div><div class="camp-stat-label">${c.channel}</div></div>
      </div>
      <div class="camp-bar"><div class="camp-bar-fill" style="width:${barW}%;background:${barCol}"></div></div>`:''}
      <div class="camp-actions">
        ${c.status==='running'?`<div class="camp-btn pause" onclick="event.stopPropagation();pauseCamp(${c.id})">⏸ Pause</div><div class="camp-btn" onclick="event.stopPropagation();showToast('Détails campagne')">📊 Détails</div>`:''}
        ${c.status==='scheduled'?`<div class="camp-btn" onclick="event.stopPropagation();launchCamp(${c.id})">▶ Lancer maintenant</div><div class="camp-btn stop" onclick="event.stopPropagation();cancelCamp(${c.id})">✕ Annuler</div>`:''}
        ${c.status==='done'?`<div class="camp-btn" onclick="event.stopPropagation();showToast('Rapport campagne')">📊 Voir rapport</div><div class="camp-btn" onclick="event.stopPropagation();showToast('Campagne dupliquée')">🔄 Relancer</div>`:''}
        ${c.status==='paused'?`<div class="camp-btn" onclick="event.stopPropagation();resumeCamp(${c.id})">▶ Reprendre</div>`:''}
      </div>
    </div>`;
  }).join('');
}

const presence=[
  {nm:'Marc L.',i:'ML',gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)',mission:'Carrefour — Cariste',st:'confirmed',time:'Confirmé à 7h42'},
  {nm:'Thomas R.',i:'TR',gr:'linear-gradient(135deg,#00C48C,#55E6A5)',mission:'Carrefour — Cariste',st:'confirmed',time:'Confirmé à 7h38'},
  {nm:'Fatima E.',i:'FA',gr:'linear-gradient(135deg,#FF9F43,#FDCB6E)',mission:'Carrefour — Cariste',st:'confirmed',time:'Confirmé à 7h55'},
  {nm:'Karim B.',i:'KB',gr:'linear-gradient(135deg,#FF6B6B,#FF8E53)',mission:'Carrefour — Cariste',st:'waiting',time:'SMS envoyé à 7h30'},
  {nm:'Sophie M.',i:'SM',gr:'linear-gradient(135deg,#FD79A8,#FDCB6E)',mission:'Carrefour — Cariste',st:'waiting',time:'SMS envoyé à 7h30'},
  {nm:'Julie M.',i:'JM',gr:'linear-gradient(135deg,#A29BFE,#DDA0DD)',mission:'Amazon — Prépa.',st:'confirmed',time:'Confirmé à 7h35'},
  {nm:'Nadia K.',i:'NK',gr:'linear-gradient(135deg,#00C48C,#81ECEC)',mission:'Amazon — Prépa.',st:'confirmed',time:'Confirmé à 7h50'},
  {nm:'Claire D.',i:'CD',gr:'linear-gradient(135deg,#4A90D9,#74B9FF)',mission:'Amazon — Prépa.',st:'absent',time:'⚠ Aucune réponse depuis 8h15'},
];

function renderPresence(){
  const el=document.getElementById('presenceGrid');
  if(!el) return;
  el.innerHTML=presence.map(p=>`
    <div class="pres-card ${p.st}">
      <div class="pres-av" style="background:${p.gr}">${p.i}</div>
      <div class="pres-info"><div class="pres-nm">${p.nm}</div><div class="pres-mission">${p.mission}</div><div class="pres-time">${p.time}</div></div>
      <div class="pres-status ${p.st}">${p.st==='confirmed'?'✓ Présent':p.st==='waiting'?'⏳ Attente':'🚨 Absent'}</div>
    </div>
  `).join('');
}

const feedItems=[
  {icon:'✅',bg:'var(--green-bg)',msg:'<b>Marc L.</b> a confirmé sa présence — Carrefour',time:'Il y a 2 min',tag:'Présence',tagBg:'var(--green-bg)',tagC:'var(--green)'},
  {icon:'📱',bg:'var(--accent-bg)',msg:'<b>Thomas R.</b> a répondu "oui dispo toute la semaine"',time:'Il y a 5 min',tag:'Dispo',tagBg:'var(--accent-bg)',tagC:'var(--accent)'},
  {icon:'❌',bg:'var(--red-bg)',msg:'<b>Sophie M.</b> a répondu "pas dispo avant le 24"',time:'Il y a 8 min',tag:'Indispo',tagBg:'var(--red-bg)',tagC:'var(--red)'},
  {icon:'🔄',bg:'var(--blue-bg)',msg:'<b>Campagne Dispo S7</b> : 187/234 réponses (80%)',time:'Il y a 12 min',tag:'Campagne',tagBg:'var(--blue-bg)',tagC:'var(--blue)'},
  {icon:'⭐',bg:'var(--orange-bg)',msg:'<b>Pierre B.</b> a noté sa mission Sanofi : 5/5',time:'Il y a 18 min',tag:'Satisfaction',tagBg:'var(--orange-bg)',tagC:'var(--orange)'},
  {icon:'💤',bg:'#E3F6FC',msg:'<b>Lucas F.</b> réactivé après 3 mois — "je recherche"',time:'Il y a 25 min',tag:'Réactivé',tagBg:'#E3F6FC',tagC:'#00B4D8'},
  {icon:'📄',bg:'#FDE8F3',msg:'<b>Amina D.</b> a envoyé son nouveau CACES',time:'Il y a 32 min',tag:'Document',tagBg:'#FDE8F3',tagC:'#E84393'},
  {icon:'✅',bg:'var(--green-bg)',msg:'<b>Nadia K.</b> a confirmé sa présence — Amazon',time:'Il y a 40 min',tag:'Présence',tagBg:'var(--green-bg)',tagC:'var(--green)'},
  {icon:'🚨',bg:'var(--red-bg)',msg:'<b>Claire D.</b> — aucune réponse depuis 45 min ⚠',time:'Il y a 45 min',tag:'Alerte',tagBg:'var(--red-bg)',tagC:'var(--red)'},
  {icon:'📱',bg:'var(--accent-bg)',msg:'<b>Karim B.</b> a répondu "oui je serai là lundi"',time:'Il y a 1h',tag:'Confirmation',tagBg:'var(--accent-bg)',tagC:'var(--accent)'},
  {icon:'💬',bg:'var(--green-bg)',msg:'<b>Youssef A.</b> a répondu "dispo le matin uniquement"',time:'Il y a 1h15',tag:'Dispo partiel',tagBg:'var(--orange-bg)',tagC:'var(--orange)'},
  {icon:'🔄',bg:'var(--blue-bg)',msg:'<b>Campagne Réactivation</b> : 34/89 réponses (38%)',time:'Il y a 2h',tag:'Campagne',tagBg:'var(--blue-bg)',tagC:'var(--blue)'},
];

function renderFeed(){
  const el=document.getElementById('feed');
  if(!el) return;
  el.innerHTML=feedItems.map((f,i)=>`
    <div class="feed-item" style="animation-delay:${i*0.04}s">
      <div class="feed-icon" style="background:${f.bg}">${f.icon}</div>
      <div class="feed-content">
        <div class="feed-msg">${f.msg} <span class="feed-tag" style="background:${f.tagBg};color:${f.tagC}">${f.tag}</span></div>
        <div class="feed-time">${f.time}</div>
      </div>
    </div>
  `).join('');
}

function pauseCamp(id){const c=relanceCampaigns.find(x=>x.id===id);c.status='paused';renderCampaigns();showToast('⏸ Campagne "'+c.name+'" en pause');}
function resumeCamp(id){const c=relanceCampaigns.find(x=>x.id===id);c.status='running';renderCampaigns();showToast('▶ Campagne "'+c.name+'" reprise');}
function launchCamp(id){const c=relanceCampaigns.find(x=>x.id===id);c.status='running';renderCampaigns();showToast('🚀 Campagne "'+c.name+'" lancée !');}
function cancelCamp(id){const i=relanceCampaigns.findIndex(x=>x.id===id);relanceCampaigns.splice(i,1);renderCampaigns();showToast('Campagne annulée');}

function openRelanceModal(){document.getElementById('relanceModal').classList.add('show');}
function closeRelanceModal(){document.getElementById('relanceModal').classList.remove('show');}
function pickType(el){document.querySelectorAll('.type-card').forEach(c=>c.classList.remove('on'));el.classList.add('on');}
function pickCh(el){document.querySelectorAll('.ch-pill').forEach(c=>c.classList.remove('on'));el.classList.add('on');}

function createCampaign(){
  const name=document.getElementById('campName').value.trim()||'Nouvelle campagne';
  relanceCampaigns.unshift({id:Date.now(),name,type:'📋',desc:'Campagne personnalisée',status:'running',sent:0,replied:0,rate:0,channel:'SMS',color:'var(--blue)'});
  renderCampaigns();
  closeRelanceModal();
  showToast('🚀 Campagne "'+name+'" lancée !');
  setTimeout(()=>{
    const c=relanceCampaigns[0];
    c.sent=42;c.replied=0;
    renderCampaigns();
    let rep=0;
    const iv=setInterval(()=>{
      rep+=Math.floor(Math.random()*5)+1;
      if(rep>c.sent)rep=c.sent;
      c.replied=rep;c.rate=Math.round(rep/c.sent*100);
      c.color=c.rate>=70?'var(--green)':c.rate>=40?'var(--orange)':'var(--red)';
      renderCampaigns();
      if(rep>=c.sent)clearInterval(iv);
    },800);
  },1500);
}

renderCampaigns();
renderPresence();
renderFeed();

setInterval(()=>{
  const names=['Emma L.','Paul V.','Léa B.','Omar S.','Inès M.','Hugo R.'];
  const nm=names[Math.floor(Math.random()*names.length)];
  const actions=[
    {icon:'✅',bg:'var(--green-bg)',msg:`<b>${nm}</b> a répondu "oui disponible"`,tag:'Dispo',tagBg:'var(--green-bg)',tagC:'var(--green)'},
    {icon:'❌',bg:'var(--red-bg)',msg:`<b>${nm}</b> a répondu "pas cette semaine"`,tag:'Indispo',tagBg:'var(--red-bg)',tagC:'var(--red)'},
    {icon:'✅',bg:'var(--green-bg)',msg:`<b>${nm}</b> a confirmé sa présence`,tag:'Présence',tagBg:'var(--green-bg)',tagC:'var(--green)'},
  ];
  const a=actions[Math.floor(Math.random()*actions.length)];
  a.time='À l\'instant';
  feedItems.unshift(a);
  if(feedItems.length>20)feedItems.pop();
  renderFeed();
},8000);

// ===== PORTAIL CLIENT PAGE JS =====
// ===== PORTAIL CLIENT JS =====
const pcMissions = [
  {id:1, title:'Caristes CACES 3', client:'Carrefour Supply Chain', postes:4, status:'active', date:'14 fév. → 30 mars', candidateIds:[1,2,4,5,7,9,10]},
  {id:2, title:'Préparateurs de commandes', client:'Carrefour Supply Chain', postes:3, status:'active', date:'12 fév. → 28 fév.', candidateIds:[3,6,8,11]},
  {id:3, title:'Agents logistiques polyvalents', client:'Carrefour Supply Chain', postes:2, status:'active', date:'17 fév. → 30 avril', candidateIds:[8,12]}
];

const pcCandidates = [
  {id:1, nm:'Marc Lefèvre',     an:'Marc L.',    i:'ML', rl:'Cariste CACES 3',          gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)', p:95, lk:0, av:'g', at:'Disponible',     aw:'Dès le 14 fév.',     enPoste:false, sk:[{t:'CACES 3',s:'g'},{t:'Entrepôt',s:'g'},{t:'Manutention',s:'g'}],         dt:{age:'32 ans',pe:'B + CACES 1,3',   mo:'15 km',ho:'Journée / 2x8',   xp:'4 ans', ex:[{t:'Cariste CACES 3',      c:'XPO Logistics',      p:'2022 — Présent · 4 ans'},{t:'Magasinier-Cariste',c:'Kuehne+Nagel',     p:'2020 — 2022 · 2 ans'}]}},
  {id:2, nm:'Thomas Roche',     an:'Thomas R.',  i:'TR', rl:'Cariste CACES 1,3,5',      gr:'linear-gradient(135deg,#00C48C,#55E6A5)', p:91, lk:0, av:'g', at:'En poste',       aw:'Mission en cours',   enPoste:true,  sk:[{t:'CACES 1,3,5',s:'g'},{t:"Chef d'équipe",s:'g'},{t:'Gerbage 9m',s:'b'}],  dt:{age:'35 ans',pe:'B + CACES 1,3,5', mo:'20 km',ho:'Tous horaires',   xp:'6 ans', ex:[{t:'Cariste polyvalent',    c:'FM Logistic',        p:'2020 — Présent · 6 ans'}]}},
  {id:3, nm:'Sarah Dubois',     an:'Sarah D.',   i:'SD', rl:'Préparatrice commandes',    gr:'linear-gradient(135deg,#4A90D9,#74B9FF)', p:93, lk:1, av:'g', at:'Disponible',     aw:'Dès le 12 fév.',     enPoste:false, sk:[{t:'Prépa. commandes',s:'g'},{t:'Scan RF',s:'g'},{t:'CACES 1',s:'g'}],      dt:{age:'28 ans',pe:'B + CACES 1',     mo:'25 km',ho:'2x8',             xp:'3 ans', ex:[{t:'Préparatrice commandes',c:'Confidentiel',        p:'2023 — 2025 · 2 ans'},{t:'Agent logistique',   c:'Confidentiel',       p:'2022 — 2023 · 1 an'}]}},
  {id:4, nm:'Fatima El Amrani', an:'Fatima E.',  i:'FA', rl:'Cariste',                   gr:'linear-gradient(135deg,#FF9F43,#FDCB6E)', p:87, lk:1, av:'g', at:'Disponible',     aw:'Dès le 17 fév.',     enPoste:false, sk:[{t:'CACES 3',s:'g'},{t:'Entrepôt',s:'g'},{t:'Visite méd. à jour',s:'o'}],   dt:{age:'30 ans',pe:'B + CACES 3',     mo:'10 km',ho:'Journée',         xp:'3 ans', ex:[{t:'Cariste',               c:'Confidentiel',        p:'2023 — 2025 · 3 ans'}]}},
  {id:5, nm:'Antoine Girard',   an:'Antoine G.', i:'AG', rl:'Cariste expérimenté',       gr:'linear-gradient(135deg,#4A90D9,#74B9FF)', p:79, lk:1, av:'g', at:'Disponible',     aw:'Sous 1 semaine',     enPoste:false, sk:[{t:'CACES 3',s:'g'},{t:'5 ans exp.',s:'g'},{t:'Visite méd. KO',s:'o'}],     dt:{age:'38 ans',pe:'B + CACES 3,5',   mo:'15 km',ho:'Journée / Matin', xp:'5 ans', ex:[{t:'Cariste',               c:'Confidentiel',        p:'2021 — 2025 · 5 ans'}]}},
  {id:6, nm:'Julie Martin',     an:'Julie M.',   i:'JM', rl:'Préparatrice commandes',    gr:'linear-gradient(135deg,#A29BFE,#DDA0DD)', p:85, lk:0, av:'g', at:'En poste',       aw:'Mission en cours',   enPoste:true,  sk:[{t:'Prépa. commandes',s:'g'},{t:'Conditionnement',s:'g'},{t:'Scan RF',s:'o'}],dt:{age:'26 ans',pe:'B',              mo:'20 km',ho:'2x8 / 3x8',       xp:'2 ans', ex:[{t:'Opératrice',            c:"L'Oréal",             p:'2024 — 2025 · 2 ans'}]}},
  {id:7, nm:'Sophie Morel',     an:'Sophie M.',  i:'SM', rl:'Cariste junior',            gr:'linear-gradient(135deg,#FD79A8,#FDCB6E)', p:74, lk:1, av:'o', at:'Sous conditions', aw:'À partir du 24 fév.',enPoste:false, sk:[{t:'CACES 3',s:'g'},{t:'1 an exp.',s:'o'}],                               dt:{age:'24 ans',pe:'B + CACES 3',     mo:'15 km',ho:'Journée',         xp:'1 an',  ex:[{t:'Cariste',               c:'Confidentiel',        p:'2025 · 1 an'}]}},
  {id:8, nm:'Nadia Khelif',     an:'Nadia K.',   i:'NK', rl:'Agent logistique',          gr:'linear-gradient(135deg,#00C48C,#81ECEC)', p:76, lk:0, av:'g', at:'Disponible',     aw:'Dès le 12 fév.',     enPoste:false, sk:[{t:'Manutention',s:'g'},{t:'Scan RF',s:'g'},{t:'Prépa.',s:'o'}],          dt:{age:'29 ans',pe:'B',              mo:'10 km',ho:'Matin / Après-midi',xp:'1 an', ex:[{t:'Manutentionnaire',      c:'DHL Supply Chain',    p:'2024 — 2025 · 1 an'}]}},
  {id:9, nm:'Karim Benali',     an:'Karim B.',   i:'KB', rl:'Cariste',                   gr:'linear-gradient(135deg,#FF6B6B,#FF8E53)', p:82, lk:0, av:'g', at:'En poste',       aw:'Mission en cours',   enPoste:true,  sk:[{t:'CACES 3',s:'g'},{t:'Entrepôt',s:'g'}],                               dt:{age:'27 ans',pe:'B + CACES 3',     mo:'20 km',ho:'Tous horaires',   xp:'2 ans', ex:[{t:'Cariste',               c:'Geodis',              p:'2024 — 2025 · 2 ans'}]}},
  {id:10,nm:'Pierre Blanc',     an:'Pierre B.',  i:'PB', rl:'Cariste confirmé',          gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)', p:90, lk:0, av:'g', at:'Disponible',     aw:'Dès le 12 fév.',     enPoste:false, sk:[{t:'CACES 3,5',s:'g'},{t:"Chef d'équipe",s:'g'},{t:'5 ans exp.',s:'b'}],  dt:{age:'34 ans',pe:'B + CACES 1,3,5', mo:'15 km',ho:'Tous horaires',   xp:'5 ans', ex:[{t:"Cariste chef d'équipe",  c:'Kuehne+Nagel',        p:'2021 — 2025 · 5 ans'}]}},
  {id:11,nm:'Lucas Ferreira',   an:'Lucas F.',   i:'LF', rl:'Agent logistique',          gr:'linear-gradient(135deg,#FF9F43,#FDCB6E)', p:71, lk:1, av:'o', at:'En attente',     aw:'Relancé le 8 fév.',  enPoste:false, sk:[{t:'Prépa. commandes',s:'g'},{t:'Scan RF',s:'o'},{t:'CACES 1',s:'g'}],    dt:{age:'33 ans',pe:'B + CACES 1',     mo:'20 km',ho:'2x8',             xp:'4 ans', ex:[{t:'Préparateur commandes',  c:'Confidentiel',        p:'2022 — 2025 · 4 ans'}]}},
  {id:12,nm:'Amina Diallo',     an:'Amina D.',   i:'AD', rl:'Agent de production',       gr:'linear-gradient(135deg,#00B4D8,#81ECEC)', p:84, lk:0, av:'g', at:'Disponible',     aw:'Dès le 15 fév.',     enPoste:false, sk:[{t:'Production',s:'g'},{t:'CACES 1',s:'g'},{t:'BPF',s:'o'}],              dt:{age:'31 ans',pe:'B + CACES 1',     mo:'10 km',ho:'3x8',             xp:'3 ans', ex:[{t:'Agent de production',    c:'Sanofi',              p:'2022 — 2025 · 3 ans'}]}}
];

// État par candidat : status ('interested'|'not-interested'|null) + commentaire
let pcCurrentMission = null;
const pcState = {};
pcCandidates.forEach(c => { pcState[c.id] = {status: null, comment: ''}; });

// Données agence (missions envoyées aux clients)
const pcAgencyClients = [
  {
    id:1, name:'Carrefour Supply Chain', initials:'CS', color:'linear-gradient(135deg,#6C5CE7,#A29BFE)',
    missions:[
      {name:'Caristes CACES 3', date:'14 fév. → 30 mars', sent:7, accepted:2, pending:5},
      {name:'Préparateurs de commandes', date:'12 fév. → 28 fév.', sent:4, accepted:1, pending:3},
      {name:'Agents logistiques polyvalents', date:'17 fév. → 30 avril', sent:2, accepted:0, pending:2}
    ]
  },
  {
    id:2, name:'Amazon — Saint-Priest', initials:'AM', color:'linear-gradient(135deg,#FF9F43,#FDCB6E)',
    missions:[
      {name:'Préparateurs de commandes', date:'01 fév. → 28 fév.', sent:6, accepted:3, pending:3}
    ]
  },
  {
    id:3, name:'Sanofi — Gerland', initials:'SA', color:'linear-gradient(135deg,#00C48C,#55E6A5)',
    missions:[
      {name:'Agents de production', date:'03 fév. → 31 mars', sent:3, accepted:2, pending:1}
    ]
  }
];

function pcShowRoleSelector() {
  document.getElementById('pcScreenAgency').style.display = 'none';
  document.getElementById('pcScreenMissions').style.display = 'none';
  document.getElementById('pcScreenCandidates').style.display = 'none';
  document.getElementById('pcScreenRole').style.display = 'block';
}

function pcShowAgencyView() {
  document.getElementById('pcScreenRole').style.display = 'none';
  document.getElementById('pcScreenAgency').style.display = 'block';
  pcRenderAgency();
}

function pcShowClientView() {
  document.getElementById('pcScreenRole').style.display = 'none';
  document.getElementById('pcScreenMissions').style.display = 'block';
  pcRenderMissions();
}

function pcRenderAgency() {
  const container = document.getElementById('pcAgencyContent');
  if (!container) return;
  container.innerHTML = pcAgencyClients.map((client, ci) => {
    const totalSent = client.missions.reduce((s, m) => s + m.sent, 0);
    const totalAccepted = client.missions.reduce((s, m) => s + m.accepted, 0);
    const totalPending = client.missions.reduce((s, m) => s + m.pending, 0);
    const missionsHtml = client.missions.map(m => `
      <div class="pc-agency-mission-row">
        <div style="flex:1">
          <div class="pc-agency-mission-name">${m.name}</div>
          <div class="pc-agency-mission-sub">${m.date}</div>
        </div>
        <div class="pc-agency-stat sent">${m.sent} envoyés</div>
        <div class="pc-agency-stat accepted">${m.accepted} acceptés</div>
        <div class="pc-agency-stat pending">${m.pending} en attente</div>
        <button class="pc-agency-send-btn" onclick="showToast('Envoi de nouveaux profils pour ${m.name}')">+ Envoyer des profils</button>
      </div>`).join('');
    return `<div class="pc-agency-client-card" style="animation-delay:${ci*0.08}s">
      <div class="pc-agency-client-head">
        <div class="pc-agency-client-avatar" style="background:${client.color}">${client.initials}</div>
        <div class="pc-agency-client-info">
          <div class="pc-agency-client-name">${client.name}</div>
          <div class="pc-agency-client-meta">${client.missions.length} mission${client.missions.length > 1 ? 's' : ''} en cours</div>
        </div>
        <div class="pc-agency-client-stats">
          <div class="pc-agency-stat sent">${totalSent} profils</div>
          <div class="pc-agency-stat accepted">${totalAccepted} acceptés</div>
          <div class="pc-agency-stat pending">${totalPending} en attente</div>
        </div>
      </div>
      <div class="pc-agency-missions">${missionsHtml}</div>
    </div>`;
  }).join('');
}

function pcRenderMissions() {
  const grid = document.getElementById('pcMissionsGrid');
  if (!grid) return;
  grid.innerHTML = pcMissions.map((m, i) => {
    const count = m.candidateIds.length;
    const statusLabel = m.status === 'active' ? 'En cours' : 'Pourvue';
    return `<div class="pc-mission-card" style="animation-delay:${i*0.07}s" onclick="pcShowCandidates(${m.id})">
      <div class="pc-mission-status-badge ${m.status}">${statusLabel}</div>
      <div class="pc-mission-title-text">${m.title}</div>
      <div class="pc-mission-client-name">${m.client}</div>
      <div class="pc-mission-meta">
        <div class="pc-mission-meta-item">
          <span class="pc-mission-meta-label">Postes</span>
          <span class="pc-mission-meta-value">${m.postes}</span>
        </div>
        <div class="pc-mission-meta-item">
          <span class="pc-mission-meta-label">Candidats</span>
          <span class="pc-mission-meta-value">${count}</span>
        </div>
        <div class="pc-mission-meta-item">
          <span class="pc-mission-meta-label">Période</span>
          <span class="pc-mission-meta-value" style="font-size:12px">${m.date}</span>
        </div>
        <div class="pc-mission-arrow">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><polyline points="9 18 15 12 9 6"/></svg>
        </div>
      </div>
    </div>`;
  }).join('');
}

function pcShowCandidates(missionId) {
  const mission = pcMissions.find(m => m.id === missionId);
  if (!mission) return;
  pcCurrentMission = mission;
  document.getElementById('pcScreenMissions').style.display = 'none';
  document.getElementById('pcScreenCandidates').style.display = 'block';
  document.getElementById('pcMissionTitle').textContent = mission.title;
  document.getElementById('pcMissionSub').textContent = mission.client + ' · ' + mission.date;
  pcRenderCandidates();
}

function pcShowMissions() {
  pcCurrentMission = null;
  document.getElementById('pcScreenCandidates').style.display = 'none';
  document.getElementById('pcScreenMissions').style.display = 'block';
}

function pcRenderCandidates() {
  const grid = document.getElementById('pcGrid');
  const countEl = document.getElementById('pcCandidatesCount');
  if (!grid || !pcCurrentMission) return;
  const candidates = pcCurrentMission.candidateIds
    .map(id => pcCandidates.find(c => c.id === id))
    .filter(Boolean)
    .filter(c => pcState[c.id].status !== 'not-interested')
    .sort((a, b) => b.p - a.p);
  if (countEl) countEl.textContent = candidates.length + ' profil' + (candidates.length > 1 ? 's' : '');
  if (!candidates.length) {
    grid.innerHTML = '<div class="pc-empty"><div style="font-size:40px;color:var(--pc-border)">—</div><div style="font-size:15px;font-weight:700;color:var(--pc-text)">Aucun profil disponible</div></div>';
    return;
  }
  grid.innerHTML = candidates.map((c, i) => {
    const state = pcState[c.id];
    const isAnon = !c.enPoste;
    const displayName = isAnon ? c.an : c.nm;
    const ci = 2 * Math.PI * 20;
    const offset = ci - (c.p / 100) * ci;
    const scoreColor = c.p >= 85 ? 'var(--pc-success)' : c.p >= 70 ? 'var(--pc-warning)' : 'var(--pc-danger)';
    const barColor = c.p >= 85 ? '#00C48C' : c.p >= 70 ? '#FF9F43' : '#FF6B6B';
    const availColor = c.av === 'g' ? 'var(--pc-success)' : c.av === 'o' ? 'var(--pc-warning)' : '#4A90D9';
    const commentBadge = state.comment ? `<div class="pc-comment-saved">${state.comment}</div>` : '';
    const lockIcon = isAnon ? `<div class="pc-lock-badge"><svg width="9" height="9" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><rect x="3" y="11" width="18" height="11" rx="2"/><path d="M7 11V7a5 5 0 0 1 10 0v4"/></svg></div>` : '';
    const commentIcon = `<svg width="13" height="13" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>`;
    let actionButtons = '';
    if (c.enPoste) {
      actionButtons = `<button class="pc-btn-a prolong" onclick="pcStopProp(event);pcToggleProlong(${c.id})">Prolonger</button>
        <button class="pc-btn-a stop" onclick="pcStopProp(event);pcStop(${c.id})">Arrêter</button>
        <button class="pc-btn-a comment-btn${state.comment ? ' active' : ''}" onclick="pcStopProp(event);pcToggleComment(${c.id})" title="Commenter">${commentIcon}</button>`;
    } else if (state.status === 'interested') {
      actionButtons = `<button class="pc-btn-a interested-done">Demandé</button>
        <button class="pc-btn-a comment-btn${state.comment ? ' active' : ''}" onclick="pcStopProp(event);pcToggleComment(${c.id})" title="Commenter">${commentIcon}</button>`;
    } else {
      actionButtons = `<button class="pc-btn-a interested" onclick="pcStopProp(event);pcInterested(${c.id})">Intéressé</button>
        <button class="pc-btn-a not-interested" onclick="pcStopProp(event);pcNotInterested(${c.id})">Pas intéressé</button>
        <button class="pc-btn-a comment-btn${state.comment ? ' active' : ''}" onclick="pcStopProp(event);pcToggleComment(${c.id})" title="Commenter">${commentIcon}</button>`;
    }
    return `<div class="pc-card" id="pcCard${c.id}" style="animation-delay:${i*0.04}s" onclick="pcOpenDrawer(${c.id})">
      <div class="pc-bar"><i style="width:${c.p}%;background:${barColor}"></i></div>
      <div class="pc-body">
        <div class="pc-avatar" style="background:${c.gr}">${c.i}${lockIcon}</div>
        <div class="pc-info">
          <div class="pc-cname">${displayName}</div>
          <div class="pc-role">${c.rl}</div>
          <div class="pc-chips">${c.sk.slice(0,3).map(s=>`<div class="pc-chip ${s.s}">${s.t}</div>`).join('')}</div>
          ${commentBadge}
        </div>
        <div class="pc-pct">
          <div class="pc-ring"><svg viewBox="0 0 50 50"><circle class="pc-ring-bg" cx="25" cy="25" r="20"/><circle class="pc-ring-fg" cx="25" cy="25" r="20" stroke="${scoreColor}" stroke-dasharray="${ci}" stroke-dashoffset="${offset}"/></svg><div class="pc-ring-t" style="color:${scoreColor}">${c.p}%</div></div>
          <div class="pc-ring-l">match</div>
        </div>
      </div>
      <div class="pc-avail"><div class="pc-avail-dot ${c.av}"></div><div class="pc-at" style="color:${availColor}">${c.at}</div><div class="pc-aw">${c.aw}</div></div>
      <div class="pc-prolong-picker" id="pcProlongPicker${c.id}" onclick="pcStopProp(event)">
        <div class="pc-prolong-picker-title">Choisir la période de prolongation</div>
        <div class="pc-prolong-picker-row">
          <label>Du</label>
          <input type="date" id="pcProlongFrom${c.id}">
          <label>Au</label>
          <input type="date" id="pcProlongTo${c.id}">
        </div>
        <button class="pc-prolong-confirm-btn" onclick="pcStopProp(event);pcConfirmProlong(${c.id})">Confirmer la prolongation</button>
      </div>
      <div class="pc-comment-area" id="pcCommentArea${c.id}" onclick="pcStopProp(event)">
        <textarea class="pc-comment-input" id="pcCommentInput${c.id}" rows="2" placeholder="Votre commentaire pour l'agence..." onblur="pcSaveComment(${c.id})">${state.comment}</textarea>
      </div>
      <div class="pc-act" onclick="pcStopProp(event)">${actionButtons}</div>
    </div>`;
  }).join('');
}

function pcStopProp(e) { e.stopPropagation(); }

function pcInterested(id) {
  const c = pcCandidates.find(x => x.id === id);
  pcState[id].status = 'interested';
  showToast('Demande envoyée pour ' + (!c.enPoste ? c.an : c.nm));
  pcRenderCandidates();
}

function pcNotInterested(id) {
  const card = document.getElementById('pcCard' + id);
  if (card) {
    card.classList.add('dismissed');
    setTimeout(() => { pcState[id].status = 'not-interested'; pcRenderCandidates(); }, 250);
  } else {
    pcState[id].status = 'not-interested';
    pcRenderCandidates();
  }
  showToast('Profil retiré');
}

function pcToggleProlong(id) {
  const picker = document.getElementById('pcProlongPicker' + id);
  if (!picker) return;
  picker.classList.toggle('open');
  if (picker.classList.contains('open')) {
    const today = new Date().toISOString().split('T')[0];
    const fromEl = document.getElementById('pcProlongFrom' + id);
    if (fromEl && !fromEl.value) fromEl.value = today;
  }
}

function pcConfirmProlong(id) {
  const c = pcCandidates.find(x => x.id === id);
  const fromEl = document.getElementById('pcProlongFrom' + id);
  const toEl = document.getElementById('pcProlongTo' + id);
  const from = fromEl ? fromEl.value : '';
  const to = toEl ? toEl.value : '';
  if (!from || !to) { showToast('Veuillez sélectionner les deux dates'); return; }
  const name = !c.enPoste ? c.an : c.nm;
  showToast('Prolongation envoyée pour ' + name + ' : ' + from + ' → ' + to);
  document.getElementById('pcProlongPicker' + id).classList.remove('open');
}

function pcStop(id) {
  const c = pcCandidates.find(x => x.id === id);
  const name = !c.enPoste ? c.an : c.nm;
  showToast('Demande d\'arrêt de mission envoyée pour ' + name);
}

function pcToggleDwProlong(id) {
  const form = document.getElementById('pcDwProlongForm' + id);
  if (!form) return;
  const isVisible = form.style.display !== 'none';
  form.style.display = isVisible ? 'none' : 'block';
  if (!isVisible) {
    const today = new Date().toISOString().split('T')[0];
    const fromEl = document.getElementById('pcDwProlongFrom' + id);
    if (fromEl && !fromEl.value) fromEl.value = today;
  }
}

function pcConfirmProlongDw(id) {
  const c = pcCandidates.find(x => x.id === id);
  const fromEl = document.getElementById('pcDwProlongFrom' + id);
  const toEl = document.getElementById('pcDwProlongTo' + id);
  const from = fromEl ? fromEl.value : '';
  const to = toEl ? toEl.value : '';
  if (!from || !to) { showToast('Veuillez sélectionner les deux dates'); return; }
  const name = !c.enPoste ? c.an : c.nm;
  showToast('Prolongation confirmée pour ' + name + ' : ' + from + ' → ' + to);
  pcCloseDrawer();
}

function pcToggleComment(id) {
  const area = document.getElementById('pcCommentArea' + id);
  if (!area) return;
  const isOpen = area.classList.contains('open');
  area.classList.toggle('open');
  if (!isOpen) { setTimeout(() => { const input = document.getElementById('pcCommentInput' + id); if (input) input.focus(); }, 50); }
}

function pcSaveComment(id) {
  const input = document.getElementById('pcCommentInput' + id);
  if (input) { pcState[id].comment = input.value.trim(); pcRenderCandidates(); }
}

function pcOpenDrawer(id) {
  const c = pcCandidates.find(x => x.id === id);
  if (!c) return;
  const d = c.dt;
  const state = pcState[c.id];
  const isAnon = !c.enPoste;
  const displayName = isAnon ? c.an : c.nm;
  let footerBtns = '';
  if (c.enPoste) {
    footerBtns = `<button class="pc-dw-btn stop" onclick="pcStop(${c.id});pcCloseDrawer()">Arrêter la mission</button><button class="pc-dw-btn prolong" onclick="pcToggleDwProlong(${c.id})">Prolonger</button>`;
  } else if (state.status === 'interested') {
    footerBtns = `<button class="pc-dw-btn interested-done">Déjà demandé</button>`;
  } else {
    footerBtns = `<button class="pc-dw-btn not-interested" onclick="pcNotInterested(${c.id});pcCloseDrawer()">Pas intéressé</button><button class="pc-dw-btn interested" onclick="pcInterested(${c.id});pcCloseDrawer()">Intéressé par ce profil</button>`;
  }
  document.getElementById('pcDC').innerHTML = `
    <div class="pc-dw-body">
      <div class="pc-dw-av" style="background:${c.gr}">${c.i}</div>
      <div class="pc-dw-nm">${displayName}</div>
      <div class="pc-dw-rl">${c.rl} · ${d.xp} d'expérience</div>
      ${isAnon ? '<div class="pc-dw-anon">Profil anonymisé — Cliquez sur Intéressé pour accéder au profil complet.</div>' : ''}
      <div class="pc-dw-sec">
        <div class="pc-dw-sec-t">Informations</div>
        <div class="pc-dw-grid">
          ${!isAnon ? `<div class="pc-dw-it"><div class="pc-dw-it-l">Âge</div><div class="pc-dw-it-v">${d.age}</div></div>` : ''}
          <div class="pc-dw-it"><div class="pc-dw-it-l">Expérience</div><div class="pc-dw-it-v">${d.xp}</div></div>
          <div class="pc-dw-it"><div class="pc-dw-it-l">Permis</div><div class="pc-dw-it-v">${d.pe}</div></div>
          <div class="pc-dw-it"><div class="pc-dw-it-l">Mobilité</div><div class="pc-dw-it-v">${d.mo}</div></div>
          <div class="pc-dw-it"><div class="pc-dw-it-l">Horaires</div><div class="pc-dw-it-v">${d.ho}</div></div>
          <div class="pc-dw-it"><div class="pc-dw-it-l">Disponibilité</div><div class="pc-dw-it-v" style="color:var(--pc-success)">${c.aw}</div></div>
        </div>
      </div>
      <div class="pc-dw-sec">
        <div class="pc-dw-sec-t">Compétences</div>
        <div class="pc-dw-chips">${c.sk.map(s=>`<div class="pc-chip ${s.s}" style="font-size:12px;padding:5px 13px">${s.t}</div>`).join('')}</div>
      </div>
      <div class="pc-dw-sec">
        <div class="pc-dw-sec-t">Expériences</div>
        ${d.ex.map(e=>`<div class="pc-dw-exp-i"><div class="pc-dw-exp-t">${e.t}</div><div class="pc-dw-exp-c">${e.c}</div><div class="pc-dw-exp-p">${e.p}</div></div>`).join('')}
      </div>
      ${c.enPoste ? `<div class="pc-dw-sec" id="pcDwProlongForm${c.id}" style="display:none">
        <div class="pc-dw-prolong-form">
          <div class="pc-prolong-picker-title">Période de prolongation</div>
          <div class="pc-dw-prolong-dates">
            <div><label>Date de début</label><input type="date" id="pcDwProlongFrom${c.id}"></div>
            <div><label>Date de fin</label><input type="date" id="pcDwProlongTo${c.id}"></div>
          </div>
          <button class="pc-prolong-confirm-btn" onclick="pcConfirmProlongDw(${c.id})">Confirmer et envoyer à l'agence</button>
        </div>
      </div>` : ''}
      <div class="pc-dw-comment">
        <div class="pc-dw-sec-t">Votre commentaire</div>
        <textarea id="pcDwComment${c.id}" placeholder="Ajouter une note pour l'agence..." onblur="pcSaveCommentFromDrawer(${c.id})">${state.comment}</textarea>
      </div>
    </div>
    <div class="pc-dw-foot">${footerBtns}</div>`;
  document.getElementById('pcDO').classList.add('on');
  document.getElementById('pcDW').classList.add('on');
}

function pcSaveCommentFromDrawer(id) {
  const input = document.getElementById('pcDwComment' + id);
  if (input) pcState[id].comment = input.value.trim();
}

function pcCloseDrawer() {
  document.getElementById('pcDO').classList.remove('on');
  document.getElementById('pcDW').classList.remove('on');
}

function pcOpenRequest() {
  document.getElementById('pcRequestModal').classList.add('open');
}

function pcCloseRequest(e) {
  if (e && e.target !== document.getElementById('pcRequestModal')) return;
  document.getElementById('pcRequestModal').classList.remove('open');
}

function pcSubmitRequest() {
  const poste = document.getElementById('pcReqPoste').value.trim();
  const nb = document.getElementById('pcReqNb').value;
  const type = document.getElementById('pcReqType').value;
  const from = document.getElementById('pcReqFrom').value;
  const to = document.getElementById('pcReqTo').value;
  if (!poste) { document.getElementById('pcReqPoste').focus(); return; }
  if (!nb) { document.getElementById('pcReqNb').focus(); return; }
  const typeLabel = {interim:'Intérim', cdd:'CDD', cdi:'CDI'}[type] || '';
  const msg = 'Demande envoyée' + (poste ? ' — ' + poste : '') + (nb ? ' · ' + nb + ' candidat' + (nb > 1 ? 's' : '') : '') + (typeLabel ? ' · ' + typeLabel : '');
  showToast(msg);
  // Réinitialiser le formulaire
  ['pcReqPoste','pcReqNb','pcReqNotes'].forEach(id => { document.getElementById(id).value = ''; });
  document.getElementById('pcReqType').value = '';
  document.getElementById('pcReqFrom').value = '';
  document.getElementById('pcReqTo').value = '';
  document.getElementById('pcRequestModal').classList.remove('open');
}

// Portail Client — sélecteur de rôle affiché au démarrage (pcScreenRole visible par défaut)

// ===== CANDIDATS PAGE JS =====

const cdCands=[
  {id:1,nm:'Marc Lefèvre',i:'ML',rl:'Cariste CACES 3',gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)',sc:92,st:'dispo',lc:'Lyon 7e',date:'Aujourd\'hui',sk:[{t:'CACES 1,3',s:'g'},{t:'Entrepôt',s:'g'},{t:'Manutention',s:'g'}],xp:'4 ans',tel:'06 12 34 56 78',email:'marc.l@email.com',pe:'B + CACES 1,3',mo:'15 km',ho:'Journée / 2x8',age:'32 ans',exps:[{t:'Cariste CACES 3',c:'XPO Logistics',p:'2022 — Présent'},{t:'Magasinier',c:'Kuehne+Nagel',p:'2020 — 2022'}],tl:[{d:'gn',m:'Confirmé présent — Carrefour',t:'Aujourd\'hui 7h42'},{d:'bl',m:'Mission proposée — Carrefour Supply',t:'Hier 14h30'},{d:'gn',m:'A répondu "dispo cette semaine"',t:'Lundi 8h15'}]},
  {id:2,nm:'Thomas Roche',i:'TR',rl:'Cariste CACES 1,3,5',gr:'linear-gradient(135deg,#00B894,#55E6A5)',sc:89,st:'mission',lc:'Vénissieux',date:'Aujourd\'hui',sk:[{t:'CACES 1,3,5',s:'g'},{t:'Chef d\'équipe',s:'g'},{t:'Gerbage 9m',s:'b'}],xp:'6 ans',tel:'06 23 45 67 89',email:'thomas.r@email.com',pe:'B + CACES 1,3,5',mo:'20 km',ho:'Tous horaires',age:'35 ans',exps:[{t:'Cariste polyvalent',c:'FM Logistic',p:'2020 — Présent'}],tl:[{d:'bl',m:'En mission chez Carrefour — Sem. 7',t:'Depuis lundi'},{d:'gn',m:'Score IA : 89/100',t:'Il y a 3j'}]},
  {id:3,nm:'Sarah Dubois',i:'SD',rl:'Préparatrice commandes',gr:'linear-gradient(135deg,#4A90D9,#74B9FF)',sc:87,st:'dispo',lc:'Villeurbanne',date:'Hier',sk:[{t:'Prépa. cmd',s:'g'},{t:'Scan RF',s:'g'},{t:'CACES 1',s:'g'},{t:'Pick & Pack',s:'b'}],xp:'3 ans',tel:'06 34 56 78 90',email:'sarah.d@email.com',pe:'B + CACES 1',mo:'25 km',ho:'2x8',age:'28 ans',exps:[{t:'Préparatrice',c:'Amazon',p:'2023 — 2025'},{t:'Agent logistique',c:'Easydis',p:'2022 — 2023'}],tl:[{d:'gn',m:'A répondu "disponible immédiatement"',t:'Hier 10h20'},{d:'or',m:'Visite médicale à renouveler',t:'Il y a 5j'}]},
  {id:4,nm:'Fatima El Amrani',i:'FA',rl:'Cariste',gr:'linear-gradient(135deg,#F39C12,#FDCB6E)',sc:78,st:'dispo',lc:'Gerland',date:'Hier',sk:[{t:'CACES 3',s:'g'},{t:'Entrepôt',s:'g'},{t:'Visite méd. ⚠',s:'o'}],xp:'3 ans',tel:'06 45 67 89 01',email:'fatima.e@email.com',pe:'B + CACES 3',mo:'10 km',ho:'Journée',age:'30 ans',exps:[{t:'Cariste',c:'Stef Logistique',p:'2023 — 2025'}],tl:[{d:'or',m:'Visite médicale expirée depuis 15j',t:'Il y a 2j'}]},
  {id:5,nm:'Antoine Girard',i:'AG',rl:'Cariste expérimenté',gr:'linear-gradient(135deg,#4A90D9,#74B9FF)',sc:82,st:'dispo',lc:'Décines',date:'Il y a 3j',sk:[{t:'CACES 3,5',s:'g'},{t:'5 ans exp.',s:'g'},{t:'Visite méd. ✗',s:'o'}],xp:'5 ans',tel:'06 56 78 90 12',email:'antoine.g@email.com',pe:'B + CACES 3,5',mo:'15 km',ho:'Journée',age:'38 ans',exps:[{t:'Cariste',c:'Rhenus Logistics',p:'2021 — 2025'}],tl:[{d:'gn',m:'Dispo confirmé',t:'Il y a 3j'}]},
  {id:6,nm:'Julie Martin',i:'JM',rl:'Préparatrice commandes',gr:'linear-gradient(135deg,#A29BFE,#DDA0DD)',sc:75,st:'mission',lc:'Décines',date:'Aujourd\'hui',sk:[{t:'Prépa. cmd',s:'g'},{t:'Conditionnement',s:'g'},{t:'Scan RF',s:'o'}],xp:'2 ans',tel:'06 67 89 01 23',email:'julie.m@email.com',pe:'B',mo:'20 km',ho:'2x8 / 3x8',age:'26 ans',exps:[{t:'Opératrice',c:'L\'Oréal',p:'2024 — 2025'}],tl:[{d:'bl',m:'En mission chez Amazon — Sem. 7',t:'Depuis lundi'}]},
  {id:7,nm:'Sophie Morel',i:'SM',rl:'Cariste junior',gr:'linear-gradient(135deg,#FD79A8,#FDCB6E)',sc:65,st:'indispo',lc:'Bron',date:'Il y a 5j',sk:[{t:'CACES 3',s:'g'},{t:'1 an exp.',s:'o'}],xp:'1 an',tel:'06 78 90 12 34',email:'sophie.m@email.com',pe:'B + CACES 3',mo:'15 km',ho:'Journée',age:'24 ans',exps:[{t:'Cariste',c:'Bolloré',p:'2025'}],tl:[{d:'or',m:'Indisponible jusqu\'au 24 fév.',t:'Il y a 5j'}]},
  {id:8,nm:'Nadia Khelif',i:'NK',rl:'Agent logistique',gr:'linear-gradient(135deg,#00B894,#81ECEC)',sc:73,st:'dispo',lc:'Vénissieux',date:'Hier',sk:[{t:'Manutention',s:'g'},{t:'Scan RF',s:'g'},{t:'Prépa.',s:'o'}],xp:'1 an',tel:'06 89 01 23 45',email:'nadia.k@email.com',pe:'B',mo:'10 km',ho:'Matin / AM',age:'29 ans',exps:[{t:'Manutentionnaire',c:'DHL',p:'2024 — 2025'}],tl:[{d:'gn',m:'Disponible confirmé',t:'Hier 9h'}]},
  {id:9,nm:'Karim Benali',i:'KB',rl:'Cariste',gr:'linear-gradient(135deg,#E74C3C,#FF7675)',sc:77,st:'mission',lc:'Saint-Priest',date:'Aujourd\'hui',sk:[{t:'CACES 3',s:'g'},{t:'Entrepôt',s:'g'}],xp:'2 ans',tel:'06 90 12 34 56',email:'karim.b@email.com',pe:'B + CACES 3',mo:'20 km',ho:'Tous horaires',age:'27 ans',exps:[{t:'Cariste',c:'Geodis',p:'2024 — 2025'}],tl:[{d:'bl',m:'En mission chez Carrefour',t:'Depuis lundi'}]},
  {id:10,nm:'Pierre Blanc',i:'PB',rl:'Cariste confirmé',gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)',sc:90,st:'mission',lc:'Lyon 7e',date:'Aujourd\'hui',sk:[{t:'CACES 3,5',s:'g'},{t:'Chef d\'équipe',s:'g'},{t:'5 ans exp.',s:'b'}],xp:'5 ans',tel:'06 01 23 45 67',email:'pierre.b@email.com',pe:'B + CACES 1,3,5',mo:'15 km',ho:'Tous horaires',age:'34 ans',exps:[{t:'Cariste chef d\'équipe',c:'Kuehne+Nagel',p:'2021 — 2025'}],tl:[{d:'bl',m:'Contrat signé — Sanofi 3 mois',t:'Hier'}]},
  {id:11,nm:'Lucas Ferreira',i:'LF',rl:'Agent logistique',gr:'linear-gradient(135deg,#F39C12,#FDCB6E)',sc:62,st:'dormant',lc:'Lyon 8e',date:'Il y a 92j',sk:[{t:'Prépa. cmd',s:'g'},{t:'Scan RF',s:'o'},{t:'CACES 1',s:'g'}],xp:'4 ans',tel:'06 12 34 56 00',email:'lucas.f@email.com',pe:'B + CACES 1',mo:'20 km',ho:'2x8',age:'33 ans',exps:[{t:'Préparateur',c:'Casino Logistique',p:'2022 — 2025'}],tl:[{d:'or',m:'Aucune activité depuis 92 jours',t:'Il y a 92j'}]},
  {id:12,nm:'Amina Diallo',i:'AD',rl:'Agent de production',gr:'linear-gradient(135deg,#00B4D8,#81ECEC)',sc:80,st:'dispo',lc:'Gerland',date:'Il y a 2j',sk:[{t:'Production',s:'g'},{t:'CACES 1',s:'g'},{t:'BPF',s:'o'}],xp:'3 ans',tel:'06 23 45 67 00',email:'amina.d@email.com',pe:'B + CACES 1',mo:'10 km',ho:'3x8',age:'31 ans',exps:[{t:'Agent production',c:'Sanofi',p:'2022 — 2025'}],tl:[{d:'gn',m:'Nouveau CACES envoyé',t:'Il y a 2j'}]},
  {id:13,nm:'Hugo Mercier',i:'HM',rl:'Manutentionnaire',gr:'linear-gradient(135deg,#636e72,#b2bec3)',sc:58,st:'dormant',lc:'Caluire',date:'Il y a 120j',sk:[{t:'Manutention',s:'g'},{t:'Port de charges',s:'g'}],xp:'6 mois',tel:'06 34 56 78 00',email:'hugo.m@email.com',pe:'B',mo:'10 km',ho:'Journée',age:'22 ans',exps:[{t:'Manutentionnaire',c:'DPD',p:'2025'}],tl:[{d:'or',m:'Aucune activité depuis 120 jours',t:'Il y a 120j'}]},
  {id:14,nm:'Emma Laurent',i:'EL',rl:'Préparatrice commandes',gr:'linear-gradient(135deg,#fd79a8,#e17055)',sc:71,st:'indispo',lc:'Meyzieu',date:'Il y a 7j',sk:[{t:'Prépa. cmd',s:'g'},{t:'Scan RF',s:'o'}],xp:'2 ans',tel:'06 45 67 89 00',email:'emma.l@email.com',pe:'B',mo:'15 km',ho:'Matin',age:'25 ans',exps:[{t:'Préparatrice',c:'Chronopost',p:'2024 — 2025'}],tl:[{d:'or',m:'En arrêt maladie jusqu\'au 20 fév.',t:'Il y a 7j'}]},
  {id:15,nm:'Omar Sayed',i:'OS',rl:'Cariste CACES 5',gr:'linear-gradient(135deg,#00cec9,#55efc4)',sc:85,st:'dispo',lc:'Vaulx-en-Velin',date:'Aujourd\'hui',sk:[{t:'CACES 5',s:'g'},{t:'Grande hauteur',s:'g'},{t:'3 ans exp.',s:'b'}],xp:'3 ans',tel:'06 56 78 90 00',email:'omar.s@email.com',pe:'B + CACES 1,3,5',mo:'25 km',ho:'Tous horaires',age:'30 ans',exps:[{t:'Cariste CACES 5',c:'FM Logistic',p:'2023 — 2025'}],tl:[{d:'gn',m:'Disponible immédiatement',t:'Aujourd\'hui 8h'}]},
];

let cdFilter='all',cdView='table',cdSearchQ='';
const cdStMap={dispo:{l:'Disponible',c:'st-dispo',e:'●'},mission:{l:'En mission',c:'st-mission',e:'🏗️'},indispo:{l:'Indisponible',c:'st-indispo',e:'✗'},dormant:{l:'Dormant',c:'st-attente',e:'💤'}};

function cdFiltered(){
  let l=[...cdCands];
  if(cdFilter!=='all')l=l.filter(c=>c.st===cdFilter);
  if(cdSearchQ)l=l.filter(c=>c.nm.toLowerCase().includes(cdSearchQ)||c.rl.toLowerCase().includes(cdSearchQ)||c.lc.toLowerCase().includes(cdSearchQ)||c.sk.some(s=>s.t.toLowerCase().includes(cdSearchQ)));
  return l;
}

function cdRenderCards(){
  const l=cdFiltered();
  document.getElementById('cdTotalCount').textContent=l.length;
  const scCl=sc=>sc>=80?'high':sc>=65?'mid':'low';
  const stDot={dispo:'●',mission:'🏗',indispo:'✗',dormant:'💤'};
  document.getElementById('cvGrid').innerHTML=l.map((c,i)=>{
    const s=cdStMap[c.st];
    const sc=scCl(c.sc);
    return`<div class="cv-card" style="animation-delay:${i*0.025}s" onclick="cdOpenDrawer(${c.id})">
      <div class="cv-card-bar ${c.st}"></div>
      <div class="cv-card-body">
        <div class="cv-av" style="background:${c.gr}">${c.i}</div>
        <div class="cv-meta">
          <div class="cv-nm">${c.nm}</div>
          <div class="cv-rl">${c.rl}</div>
          <div class="cv-status-row">
            <div class="cv-st ${c.st}">${stDot[c.st]||''} ${s.l}</div>
            <div class="cv-score ${sc}"><div class="cv-score-n">${c.sc}</div><div class="cv-score-l">score</div></div>
          </div>
          <div class="cv-skills">${c.sk.slice(0,3).map(s=>`<div class="cv-sk ${s.s}">${s.t}</div>`).join('')}</div>
        </div>
      </div>
      <div class="cv-card-foot">
        <div class="cv-foot-info">
          <div class="cv-loc">📍 ${c.lc}</div>
          <div class="cv-date">${c.date}</div>
        </div>
        <div class="cv-foot-acts" onclick="event.stopPropagation()">
          <div class="cv-act" title="Appeler" onclick="showToast('Appel ${c.nm}...')">📱</div>
          <div class="cv-act" title="Matcher" onclick="showToast('${c.nm} → matching')">🎯</div>
          <button class="cv-act-propose" onclick="scPropose('${c.nm}')">👁 Proposer</button>
        </div>
      </div>
    </div>`;
  }).join('');
}

function cdRender(){cdRenderCards();}

function cdSetFilter(el){
  cdFilter=el.dataset.cf;
  document.querySelectorAll('.cd-pill[data-cf]').forEach(p=>p.classList.remove('on'));
  el.classList.add('on');cdRender();
}
function cdDoFilter(){cdSearchQ=document.getElementById('cdSearchInput').value.toLowerCase().trim();cdRender();}

// DRAWER
function cdOpenDrawer(id){
  const c=cdCands.find(x=>x.id===id);if(!c)return;
  const s=cdStMap[c.st];
  document.getElementById('cdDrawerContent').innerHTML=`
    <div class="cd-dw-profile">
      <div class="cd-dw-hero">
        <div class="cd-dw-av" style="background:${c.gr}">${c.i}</div>
        <div><div class="cd-dw-nm">${c.nm}</div><div class="cd-dw-rl">${c.rl} · ${c.lc}</div><div class="cd-dw-st" style="margin-top:8px"><span class="cv-st ${c.st}">${s.e} ${s.l}</span></div></div>
      </div>
      <div class="cd-dw-quick">
        <button class="cd-dw-qbtn" onclick="showToast('Appel ${c.nm}...')">📱 Appeler</button>
        <button class="cd-dw-qbtn" onclick="showToast('SMS envoyé')">💬 SMS</button>
        <button class="cd-dw-qbtn" onclick="showToast('${c.nm} → matching')">🎯 Matcher</button>
        <button class="cd-dw-qbtn primary" onclick="scPropose('${c.nm}')">👁 Proposer</button>
      </div>
      <div class="cd-dw-sec"><div class="cd-dw-sec-t">Informations</div>
        <div class="cd-dw-grid">
          <div class="cd-dw-it"><div class="cd-dw-it-l">Âge</div><div class="cd-dw-it-v">${c.age}</div></div>
          <div class="cd-dw-it"><div class="cd-dw-it-l">Expérience</div><div class="cd-dw-it-v">${c.xp}</div></div>
          <div class="cd-dw-it"><div class="cd-dw-it-l">Téléphone</div><div class="cd-dw-it-v">${c.tel}</div></div>
          <div class="cd-dw-it"><div class="cd-dw-it-l">Email</div><div class="cd-dw-it-v" style="font-size:12px">${c.email}</div></div>
          <div class="cd-dw-it"><div class="cd-dw-it-l">Permis</div><div class="cd-dw-it-v">${c.pe}</div></div>
          <div class="cd-dw-it"><div class="cd-dw-it-l">Mobilité</div><div class="cd-dw-it-v">${c.mo}</div></div>
          <div class="cd-dw-it"><div class="cd-dw-it-l">Horaires</div><div class="cd-dw-it-v">${c.ho}</div></div>
          <div class="cd-dw-it"><div class="cd-dw-it-l">Score IA</div><div class="cd-dw-it-v" style="color:${c.sc>=80?'var(--gn)':c.sc>=65?'var(--or)':'var(--rd)'};font-size:18px">${c.sc}/100</div></div>
        </div>
      </div>
      <div class="cd-dw-sec"><div class="cd-dw-sec-t">Compétences</div>
        <div class="cd-dw-chips">${c.sk.map(s=>`<div class="cv-sk ${s.s}" style="font-size:12px;padding:5px 14px">${s.t}</div>`).join('')}</div>
      </div>
      <div class="cd-dw-sec"><div class="cd-dw-sec-t">Expériences</div>
        ${c.exps.map(e=>`<div class="cd-dw-exp-i"><div class="cd-dw-exp-t">${e.t}</div><div class="cd-dw-exp-c">${e.c}</div><div class="cd-dw-exp-p">${e.p}</div></div>`).join('')}
      </div>
      <div class="cd-dw-sec"><div class="cd-dw-sec-t">Historique d'activité</div>
        <div class="cd-dw-timeline">${c.tl.map(t=>`<div class="cd-dw-tl-item"><div class="cd-dw-tl-dot ${t.d}"></div><div><div class="cd-dw-tl-msg">${t.m}</div><div class="cd-dw-tl-time">${t.t}</div></div></div>`).join('')}</div>
      </div>
    </div>`;
  document.getElementById('cdDOverlay').classList.add('on');
  document.getElementById('cdDrawer').classList.add('on');
}
function cdCloseDrawer(){document.getElementById('cdDOverlay').classList.remove('on');document.getElementById('cdDrawer').classList.remove('on');}

// IMPORT
function cdOpenImport(){document.getElementById('cdImportModal').classList.add('show');}
function cdCloseImport(){document.getElementById('cdImportModal').classList.remove('show');}
function cdHandleDrop(e){showToast('📄 '+e.dataTransfer.files.length+' fichiers reçus');}
function cdHandleFiles(f){showToast('📄 '+f.length+' fichiers sélectionnés');}
function cdSimulateImport(){closeImport();showToast('🤖 Extraction IA en cours... 12 CVs détectés');}

function cdToastIgnored(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3000);}

// PORTAL PUSH
let cdPortalCandId=null;
function cdOpenPortalPush(id){
  const c=cdCands.find(x=>x.id===id);if(!c)return;
  cdPortalCandId=id;
  document.getElementById('cdPortalCandInfo').innerHTML=`<div class="td-av" style="background:${c.gr};width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px;color:#fff;flex-shrink:0">${c.i}</div><div><div style="font-weight:700;font-size:14px">${c.nm}</div><div style="font-size:12px;color:var(--tx2)">${c.rl} · ${c.lc}</div></div>`;
  document.querySelectorAll('.cd-vis-opt').forEach((el,i)=>{
    if(i===0){el.style.borderColor='var(--gn)';el.style.background='var(--gnbg)';el.classList.add('on');}
    else{el.style.borderColor='var(--bd)';el.style.background='var(--sf)';el.classList.remove('on');}
  });
  document.getElementById('cdPortalModal').classList.add('show');
}
function cdClosePortal(){document.getElementById('cdPortalModal').classList.remove('show');}
function cdPickVis(el,v){
  document.querySelectorAll('.cd-vis-opt').forEach(e=>{e.style.borderColor='var(--bd)';e.style.background='var(--sf)';e.classList.remove('on');});
  const cols={full:['var(--gn)','var(--gnbg)'],partial:['var(--or)','var(--orbg)'],anon:['var(--tx3)','var(--sf2)']};
  el.style.borderColor=cols[v][0];el.style.background=cols[v][1];el.classList.add('on');
}
function cdConfirmPortalPush(){
  const c=cdCands.find(x=>x.id===cdPortalCandId);
  const client=document.getElementById('cdPortalClient').value;
  const vis=document.querySelector('.cd-vis-opt.on')?.dataset.v||'full';
  const visLabel={full:'complet',partial:'partiel',anon:'anonymisé'}[vis];
  closePortal();
  showToast(`✅ ${c.nm} envoyé au portail ${client} (profil ${visLabel})`);
}

cdRender();


// ===== DASHBOARD PAGE JS =====
function dbToggleChat(){
  const panel=document.getElementById('dbChatPanel');
  panel.classList.toggle('open');
}

// Show/hide chat widget based on active page
const dbObserver=new MutationObserver(()=>{
  const dbPage=document.getElementById('page-dashboard');
  const chatW=document.getElementById('dbChatWidget');
  if(dbPage && chatW){
    chatW.style.display=dbPage.style.display==='none'?'none':'block';
  }
});
document.querySelectorAll('.page-section').forEach(el=>{
  dbObserver.observe(el,{attributes:true,attributeFilter:['style']});
});
// Initial state
setTimeout(()=>{
  const dbPage=document.getElementById('page-dashboard');
  const chatW=document.getElementById('dbChatWidget');
  if(dbPage && chatW){
    chatW.style.display=dbPage.style.display==='none'?'none':'block';
  }
},100);


// ===== CONTRATS PAGE JS =====
function ctFilterByKpi(status){
  ctFf=status;
  document.querySelectorAll('.ct-pill[data-ctf]').forEach(p=>{
    p.classList.toggle('on',p.dataset.ctf===status);
  });
  ctRender();
  // Scroll vers la table
  document.querySelector('.ct-tcard')?.scrollIntoView({behavior:'smooth',block:'nearest'});
}

const ctContrats=[
  {id:1,nm:'Marc Lefèvre',i:'ML',gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)',rl:'Cariste CACES 3',cl:'Carrefour Supply Chain',cli:'🏪',lieu:'Entrepôt Vénissieux',d1:'2026-01-13',d2:'2026-03-14',h:'6h — 14h',tx:'12.50 €',st:'active',aven:[{num:1,type:'Prolongation',detail:'Fin repoussée du 28/02 au 14/03',date:'2026-02-03',st:'signed'},{num:2,type:'Horaires',detail:'Passage en 2x8 : 6h-14h / 14h-22h',date:'2026-02-10',st:'signed'}],num:'CTT-2026-0087'},
  {id:2,nm:'Thomas Roche',i:'TR',gr:'linear-gradient(135deg,#00B894,#55E6A5)',rl:'Cariste CACES 1,3,5',cl:'Carrefour Supply Chain',cli:'🏪',lieu:'Entrepôt Vénissieux',d1:'2026-02-03',d2:'2026-02-28',h:'14h — 22h',tx:'13.20 €',st:'active',aven:[],num:'CTT-2026-0091'},
  {id:3,nm:'Julie Martin',i:'JM',gr:'linear-gradient(135deg,#A29BFE,#DDA0DD)',rl:'Préparatrice commandes',cl:'Amazon — Saint-Priest',cli:'📦',lieu:'Centre Amazon STR1',d1:'2026-02-03',d2:'2026-02-21',h:'5h — 13h',tx:'11.80 €',st:'active',aven:[{num:1,type:'Taux horaire',detail:'Passage de 11.52€ à 11.80€ / heure',date:'2026-02-07',st:'signed'}],num:'CTT-2026-0093'},
  {id:4,nm:'Nadia Khelif',i:'NK',gr:'linear-gradient(135deg,#00B894,#81ECEC)',rl:'Agent logistique',cl:'Amazon — Saint-Priest',cli:'📦',lieu:'Centre Amazon STR1',d1:'2026-02-03',d2:'2026-02-14',h:'5h — 13h',tx:'11.52 €',st:'expiring',aven:[],num:'CTT-2026-0094'},
  {id:5,nm:'Karim Benali',i:'KB',gr:'linear-gradient(135deg,#E74C3C,#FF7675)',rl:'Cariste',cl:'Carrefour Supply Chain',cli:'🏪',lieu:'Entrepôt Vénissieux',d1:'2026-02-10',d2:'2026-03-07',h:'6h — 14h',tx:'12.00 €',st:'active',aven:[],num:'CTT-2026-0096'},
  {id:6,nm:'Pierre Blanc',i:'PB',gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)',rl:'Cariste confirmé',cl:'Sanofi — Gerland',cli:'💊',lieu:'Site Sanofi Gerland',d1:'2026-02-10',d2:'2026-05-09',h:'7h — 15h',tx:'13.80 €',st:'sign',aven:[],num:'CTT-2026-0097'},
  {id:7,nm:'Omar Sayed',i:'OS',gr:'linear-gradient(135deg,#00cec9,#55efc4)',rl:'Cariste CACES 5',cl:'FM Logistic',cli:'🏭',lieu:'Plateforme Corbas',d1:'2026-02-17',d2:'2026-03-14',h:'6h — 14h',tx:'13.00 €',st:'sign',aven:[],num:'CTT-2026-0098'},
  {id:8,nm:'Sarah Dubois',i:'SD',gr:'linear-gradient(135deg,#4A90D9,#74B9FF)',rl:'Préparatrice commandes',cl:'Amazon — Saint-Priest',cli:'📦',lieu:'Centre Amazon STR1',d1:'2025-12-01',d2:'2026-01-31',h:'5h — 13h',tx:'11.52 €',st:'ended',aven:[{num:1,type:'Prolongation',detail:'Fin repoussée du 31/12 au 31/01',date:'2025-12-20',st:'signed'}],num:'CTT-2025-0412'},
  {id:9,nm:'Fatima El Amrani',i:'FA',gr:'linear-gradient(135deg,#F39C12,#FDCB6E)',rl:'Cariste',cl:'Sanofi — Gerland',cli:'💊',lieu:'Site Sanofi Gerland',d1:'2025-11-04',d2:'2026-01-17',h:'7h — 15h',tx:'12.00 €',st:'ended',aven:[{num:1,type:'Lieu de mission',detail:'Transfert de Gerland vers Saint-Fons',date:'2025-12-02',st:'signed'},{num:2,type:'Prolongation',detail:'Fin repoussée du 20/12 au 17/01',date:'2025-12-15',st:'signed'}],num:'CTT-2025-0378'},
  {id:10,nm:'Sophie Morel',i:'SM',gr:'linear-gradient(135deg,#FD79A8,#FDCB6E)',rl:'Cariste junior',cl:'Carrefour Supply Chain',cli:'🏪',lieu:'Entrepôt Vénissieux',d1:'2026-02-12',d2:'2026-02-14',h:'6h — 14h',tx:'11.88 €',st:'expiring',aven:[],num:'CTT-2026-0099'},
];

const ctStMap={active:{l:'Actif',c:'st-active',e:'●'},sign:{l:'À signer',c:'st-sign',e:'✍️'},expiring:{l:'Expire bientôt',c:'st-pending',e:'⏰'},ended:{l:'Terminé',c:'st-ended',e:'🏁'}};

let ctFf='all',ctSq='';

function ctDaysBetween(a,b){return Math.round((new Date(b)-new Date(a))/(1000*60*60*24));}
function ctFmtDate(d){const p=d.split('-');return p[2]+'/'+p[1]+'/'+p[0].slice(2);}
function ctProgress(c){
  const total=ctDaysBetween(c.d1,c.d2);
  const now=ctDaysBetween(c.d1,'2026-02-11');
  return Math.min(100,Math.max(0,Math.round(now/total*100)));
}

function ctFiltered(){
  let l=[...ctContrats];
  if(ctFf==='active')l=l.filter(c=>c.st==='active');
  else if(ctFf==='sign')l=l.filter(c=>c.st==='sign');
  else if(ctFf==='expiring')l=l.filter(c=>c.st==='expiring');
  else if(ctFf==='ended')l=l.filter(c=>c.st==='ended');
  if(ctSq)l=l.filter(c=>c.nm.toLowerCase().includes(ctSq)||c.cl.toLowerCase().includes(ctSq)||c.rl.toLowerCase().includes(ctSq)||c.num.toLowerCase().includes(ctSq));
  return l;
}

function ctRender(){
  const l=ctFiltered();
  document.getElementById('ctPagInfo').textContent=l.length+' contrat'+(l.length>1?'s':'');
  document.getElementById('ctTableBody').innerHTML=l.map((c,i)=>{
    const s=ctStMap[c.st];
    const pct=ctProgress(c);
    const pCol=c.st==='ended'?'var(--tx3)':pct>=80?'var(--or)':'var(--gn)';
    const pBg=c.st==='ended'?'var(--bd)':pct>=80?'linear-gradient(90deg,var(--or),#FDCB6E)':'linear-gradient(90deg,var(--gn),#55E6A5)';
    const daysLeft=ctDaysBetween('2026-02-11',c.d2);
    return`<tr onclick="ctOd(${c.id})" style="animation:up 0.3s ease backwards;animation-delay:${i*0.02}s">
      <td><div class="ct-td-c"><div class="ct-td-av" style="background:${c.gr}">${c.i}</div><div><div class="ct-td-nm">${c.nm}</div><div class="ct-td-sub">${c.rl}</div></div></div></td>
      <td><div class="ct-td-client"><div class="ct-td-cl-logo">${c.cli}</div><div><div class="ct-td-cl-nm">${c.cl}</div></div></div></td>
      <td><div class="ct-td-dates"><b>${ctFmtDate(c.d1)}</b> → <b>${ctFmtDate(c.d2)}</b><div style="font-size:10px;color:${daysLeft<=7&&c.st!=='ended'?'var(--or)':'var(--tx3)'};">${c.st==='ended'?'Terminé':daysLeft+'j restants'}</div></div></td>
      <td><div class="ct-td-bar"><div class="ct-progress-bar"><div class="ct-progress-fill" style="width:${pct}%;background:${pBg}"></div></div><div class="ct-progress-pct" style="color:${pCol}">${pct}%</div></div></td>
      <td><div class="ct-st-badge ${s.c}">${s.e} ${s.l}</div></td>
      <td><div class="ct-td-avenant">${c.aven.length?'<span style="color:var(--pk)">📎 '+c.aven.length+'</span>':'<span style="color:var(--tx3)">—</span>'}</div></td>
      <td><div class="td-actions" onclick="event.stopPropagation()">
        <div class="ct-act-btn" title="Voir détail" onclick="ctOd(${c.id})">📄</div>
        <div class="ct-act-btn aven" title="Faire un avenant" onclick="ctOpenQuickAven(${c.id})">📎</div>
        ${c.st==='active'||c.st==='expiring'?'<div class="ct-act-btn warn" title="Prolonger" onclick="ctOpenAvenType('+c.id+',\'prolong\')">🔄</div>':''}
        ${c.st==='sign'?'<div class="ct-act-btn" title="Envoyer signature" onclick="toast(\'Lien de signature envoyé par SMS\')" style="color:var(--bl)">✍️</div>':''}
      </div></td>
    </tr>`;
  }).join('');
}

function ctSf(el){ctFf=el.dataset.ctf;document.querySelectorAll('.ct-pill[data-ctf]').forEach(p=>p.classList.remove('on'));el.classList.add('on');ctRender();}
function ctDoFilter(){ctSq=document.getElementById('ctSearchInput').value.toLowerCase().trim();ctRender();}

// DRAWER
function ctOd(id){
  const c=ctContrats.find(x=>x.id===id);if(!c)return;
  const s=ctStMap[c.st];
  const pct=ctProgress(c);
  const totalDays=ctDaysBetween(c.d1,c.d2);
  const daysLeft=ctDaysBetween('2026-02-11',c.d2);
  const pCol=pct>=80?'var(--or)':'var(--gn)';
  const pBg=c.st==='ended'?'var(--tx3)':pct>=80?'linear-gradient(90deg,var(--or),#FDCB6E)':'linear-gradient(90deg,var(--gn),#55E6A5)';

  document.getElementById('ctDC').innerHTML=`
    <div class="ct-dw-body">
      <div class="ct-dw-hero">
        <div class="ct-dw-av">${c.i}</div>
        <div style="flex:1"><div class="ct-dw-nm">${c.nm}</div><div class="ct-dw-rl">${c.rl} — ${c.cl}</div><div class="ct-dw-num">${c.num}</div></div>
        <div class="ct-st-badge ${s.c}" style="align-self:flex-start;">${s.e} ${s.l}</div>
      </div>

      <div class="ct-tl-bar">
        <div class="ct-tl-bar-label"><span>${ctFmtDate(c.d1)}</span><span style="font-weight:700;color:${c.st==='ended'?'var(--tx3)':daysLeft<=7?'var(--or)':'var(--tx)'}">${c.st==='ended'?'Terminé':daysLeft+'j restants'}</span><span>${ctFmtDate(c.d2)}</span></div>
        <div class="ct-tl-bar-track"><div class="ct-tl-bar-fill" style="width:${pct}%;background:${pBg}"></div></div>
      </div>

      ${c.st!=='ended'?`<div class="ct-dw-sec"><div class="ct-dw-sec-t">⚡ Avenant rapide</div>
        <div class="ct-quick-aven">
          <div class="ct-qa-btn" onclick="ctOpenAvenType(${c.id},'prolong')"><div class="ct-qa-ico">🔄</div><div class="ct-qa-t">Prolonger</div><div class="ct-qa-d">Modifier la date de fin</div></div>
          <div class="ct-qa-btn" onclick="ctOpenAvenType(${c.id},'horaires')"><div class="ct-qa-ico">🕐</div><div class="ct-qa-t">Modifier horaires</div><div class="ct-qa-d">Changer les heures</div></div>
          <div class="ct-qa-btn" onclick="ctOpenAvenType(${c.id},'lieu')"><div class="ct-qa-ico">📍</div><div class="ct-qa-t">Changer le lieu</div><div class="ct-qa-d">Nouveau site de mission</div></div>
          <div class="ct-qa-btn" onclick="ctOpenAvenType(${c.id},'taux')"><div class="ct-qa-ico">💰</div><div class="ct-qa-t">Modifier le taux</div><div class="ct-qa-d">Ajuster la rémunération</div></div>
        </div>
      </div>`:''}

      <div class="ct-dw-sec"><div class="ct-dw-sec-t">Informations du contrat</div>
        <div class="ct-dw-grid">
          <div class="ct-dw-it"><div class="ct-dw-it-l">Client</div><div class="ct-dw-it-v">${c.cli} ${c.cl}</div></div>
          <div class="ct-dw-it"><div class="ct-dw-it-l">Lieu</div><div class="ct-dw-it-v">${c.lieu}</div></div>
          <div class="ct-dw-it"><div class="ct-dw-it-l">Horaires</div><div class="ct-dw-it-v">${c.h}</div></div>
          <div class="ct-dw-it"><div class="ct-dw-it-l">Taux horaire</div><div class="ct-dw-it-v" style="color:var(--ac);font-size:16px">${c.tx}</div></div>
          <div class="ct-dw-it"><div class="ct-dw-it-l">Début</div><div class="ct-dw-it-v">${ctFmtDate(c.d1)}</div></div>
          <div class="ct-dw-it"><div class="ct-dw-it-l">Fin</div><div class="ct-dw-it-v">${ctFmtDate(c.d2)}</div></div>
          <div class="ct-dw-it"><div class="ct-dw-it-l">Durée totale</div><div class="ct-dw-it-v">${totalDays} jours</div></div>
          <div class="ct-dw-it"><div class="ct-dw-it-l">N° contrat</div><div class="ct-dw-it-v" style="font-family:'Space Mono',monospace;font-size:12px">${c.num}</div></div>
        </div>
      </div>

      <div class="ct-dw-sec">
        <div class="ct-dw-sec-t">📎 Avenants (${c.aven.length}) ${c.st!=='ended'?'<span style="color:var(--pk);cursor:pointer" onclick="ctOpenQuickAven('+c.id+')">+ Ajouter</span>':''}</div>
        <div class="ct-aven-list">
          ${c.aven.length?c.aven.map(a=>`
            <div class="ct-aven-card">
              <div class="ct-aven-card-top"><div class="ct-aven-num">Avenant n°${a.num}</div><div class="ct-aven-date">${a.date.split('-').reverse().join('/')}</div></div>
              <div class="ct-aven-type">${a.type==='Prolongation'?'🔄':a.type==='Horaires'?'🕐':a.type==='Lieu de mission'?'📍':'💰'} ${a.type}</div>
              <div class="ct-aven-detail">${a.detail}</div>
              <div class="ct-aven-badge" style="background:var(--gnbg);color:var(--gn);">✓ Signé</div>
            </div>
          `).join(''):`<div style="padding:24px;text-align:center;color:var(--tx3);font-size:13px;">Aucun avenant pour ce contrat</div>`}
        </div>
      </div>
    </div>
  `;
  document.getElementById('ctDOverlay').classList.add('on');
  document.getElementById('ctDrawer').classList.add('on');
}
function ctCd(){document.getElementById('ctDOverlay').classList.remove('on');document.getElementById('ctDrawer').classList.remove('on');}

// AVENANT
let ctAvenContratId=null,ctAvenType='';
function ctOpenQuickAven(id){ctAvenContratId=id;openAvenType(id,'prolong');}

function ctOpenAvenType(id,type){
  ctAvenContratId=id;ctAvenType=type;
  const c=ctContrats.find(x=>x.id===id);
  const titles={prolong:'🔄 Prolonger le contrat',horaires:'🕐 Modifier les horaires',lieu:'📍 Changer le lieu',taux:'💰 Modifier le taux horaire'};
  document.getElementById('ctAvenModalTitle').textContent=titles[type]||'📎 Nouvel avenant';

  let html=`<div style="display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--bg);border-radius:var(--rs);margin-bottom:20px;">
    <div style="width:38px;height:38px;border-radius:10px;background:${c.gr};display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:13px">${c.i}</div>
    <div><div style="font-weight:700">${c.nm}</div><div style="font-size:12px;color:var(--tx2)">${c.num} — ${c.cl}</div></div>
  </div>`;

  if(type==='prolong'){
    html+=`
      <div class="field"><div class="field-label">Date de fin actuelle</div><input class="field-input" value="${ctFmtDate(c.d2)}" disabled style="opacity:0.6"/></div>
      <div class="field"><div class="field-label">Nouvelle date de fin</div><input class="field-input" type="date" id="ctAvenVal" value="${c.d2.replace(/(\d{4})-(\d{2})-(\d{2})/,(m,y,mo,d)=>{const nd=new Date(y,mo-1,parseInt(d)+14);return nd.toISOString().split('T')[0];})}"/></div>
      <div class="field-hint">💡 L'avenant sera généré automatiquement avec la nouvelle date</div>`;
  } else if(type==='horaires'){
    html+=`
      <div class="field"><div class="field-label">Horaires actuels</div><input class="field-input" value="${c.h}" disabled style="opacity:0.6"/></div>
      <div class="field"><div class="field-label">Nouveaux horaires</div><input class="field-input" id="ctAvenVal" placeholder="Ex: 14h — 22h" value="14h — 22h"/></div>`;
  } else if(type==='lieu'){
    html+=`
      <div class="field"><div class="field-label">Lieu actuel</div><input class="field-input" value="${c.lieu}" disabled style="opacity:0.6"/></div>
      <div class="field"><div class="field-label">Nouveau lieu</div><input class="field-input" id="ctAvenVal" placeholder="Nouvelle adresse"/></div>`;
  } else if(type==='taux'){
    html+=`
      <div class="field"><div class="field-label">Taux horaire actuel</div><input class="field-input" value="${c.tx}" disabled style="opacity:0.6"/></div>
      <div class="field"><div class="field-label">Nouveau taux horaire</div><input class="field-input" id="ctAvenVal" placeholder="Ex: 13.50 €"/></div>`;
  }
  html+=`<div style="margin-top:16px;padding:10px 14px;background:var(--pkbg);border-radius:8px;font-size:11.5px;color:var(--pk);display:flex;align-items:center;gap:6px;">📎 L'avenant sera envoyé pour signature électronique au candidat</div>`;

  document.getElementById('ctAvenModalBody').innerHTML=html;
  document.getElementById('ctAvenantModal').classList.add('show');
}

function ctCloseAven(){document.getElementById('ctAvenantModal').classList.remove('show');}

function ctConfirmAven(){
  const c=ctContrats.find(x=>x.id===ctAvenContratId);
  const val=document.getElementById('ctAvenVal')?.value||'';
  const typeLabels={prolong:'Prolongation',horaires:'Horaires',lieu:'Lieu de mission',taux:'Taux horaire'};
  const details={
    prolong:'Fin repoussée au '+val,
    horaires:'Passage en '+val,
    lieu:'Transfert vers '+val,
    taux:'Nouveau taux : '+val
  };
  c.aven.push({num:c.aven.length+1,type:typeLabels[ctAvenType],detail:details[ctAvenType],date:'2026-02-11',st:'pending'});
  
  if(ctAvenType==='prolong'&&val){c.d2=val;}
  if(ctAvenType==='horaires'&&val){c.h=val;}
  if(ctAvenType==='lieu'&&val){c.lieu=val;}
  if(ctAvenType==='taux'&&val){c.tx=val;}

  closeAven();ctCd();render();
  showToast('📎 Avenant n°'+c.aven.length+' généré — '+typeLabels[ctAvenType]+' — envoyé pour signature');
}

// NEW CONTRACT
function ctOpenNewContrat(){document.getElementById('ctNewContratModal').classList.add('show');}
function ctCloseNewContrat(){document.getElementById('ctNewContratModal').classList.remove('show');}
function ctCreateContrat(){closeNewContrat();showToast('📝 Contrat généré et envoyé pour signature !');}

function ctToastIgnored(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3500);}

ctRender();


// ===== MISSIONS PAGE JS =====
const msMissions=[
  {id:1,title:'Caristes CACES 3',client:'Carrefour Supply Chain',loc:'Saint-Priest',urg:'high',st:'open',postes:4,filled:2,matchs:12,dates:'10 fév. → 28 mars',ho:'2x8',sk:['CACES 3','Entrepôt','Visite méd.'],
    cands:[{nm:'Marc L.',i:'ML',gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)',st:'Confirmé',stc:'green-bg',stcc:'green'},{nm:'Thomas R.',i:'TR',gr:'linear-gradient(135deg,#00B894,#55E6A5)',st:'Confirmé',stc:'green-bg',stcc:'green'},{nm:'Karim B.',i:'KB',gr:'linear-gradient(135deg,#E74C3C,#FF7675)',st:'En attente',stc:'orange-bg',stcc:'orange'}]},
  {id:2,title:'Prépa. commandes',client:'Amazon FBA',loc:'Saint-Priest',urg:'high',st:'open',postes:6,filled:3,matchs:18,dates:'12 fév. → 15 avril',ho:'3x8',sk:['Prépa. commandes','Scan RF','Port de charges'],
    cands:[{nm:'Sarah D.',i:'SD',gr:'linear-gradient(135deg,#4A90D9,#74B9FF)',st:'Confirmé',stc:'green-bg',stcc:'green'},{nm:'Julie M.',i:'JM',gr:'linear-gradient(135deg,#A29BFE,#DDA0DD)',st:'Confirmé',stc:'green-bg',stcc:'green'},{nm:'Nadia K.',i:'NK',gr:'linear-gradient(135deg,#00B894,#81ECEC)',st:'Confirmé',stc:'green-bg',stcc:'green'}]},
  {id:3,title:'Agents de production',client:'Sanofi',loc:'Gerland',urg:'medium',st:'progress',postes:3,filled:2,matchs:8,dates:'17 fév. → 30 juin',ho:'3x8',sk:['Production','BPF','CACES 1'],
    cands:[{nm:'Amina D.',i:'AD',gr:'linear-gradient(135deg,#00B4D8,#81ECEC)',st:'Confirmé',stc:'green-bg',stcc:'green'},{nm:'Pierre B.',i:'PB',gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)',st:'Contrat signé',stc:'accent-bg',stcc:'accent'}]},
  {id:4,title:'Cariste CACES 5 — Grande hauteur',client:'FM Logistic',loc:'Vénissieux',urg:'high',st:'urgent',postes:2,filled:0,matchs:5,dates:'14 fév. → 28 fév.',ho:'Journée',sk:['CACES 5','Grande hauteur','3 ans exp.'],cands:[]},
  {id:5,title:'Manutentionnaires',client:'Rhenus Logistics',loc:'Corbas',urg:'medium',st:'open',postes:5,filled:3,matchs:14,dates:'10 fév. → 31 mars',ho:'2x8',sk:['Manutention','Port charges','Visite méd.'],
    cands:[{nm:'Hugo M.',i:'HM',gr:'linear-gradient(135deg,#636e72,#b2bec3)',st:'En attente',stc:'orange-bg',stcc:'orange'}]},
  {id:6,title:'Préparateur commandes frais',client:'Carrefour Supply Chain',loc:'Décines',urg:'low',st:'progress',postes:2,filled:2,matchs:6,dates:'3 fév. → 28 fév.',ho:'Matin',sk:['Prépa. commandes','Froid','CACES 1'],
    cands:[{nm:'Emma L.',i:'EL',gr:'linear-gradient(135deg,#fd79a8,#e17055)',st:'Confirmé',stc:'green-bg',stcc:'green'},{nm:'Lucas F.',i:'LF',gr:'linear-gradient(135deg,#F39C12,#FDCB6E)',st:'Confirmé',stc:'green-bg',stcc:'green'}]},
  {id:7,title:'Cariste CACES 1',client:'Amazon FBA',loc:'Saint-Priest',urg:'low',st:'filled',postes:3,filled:3,matchs:9,dates:'3 fév. → 15 mars',ho:'3x8',sk:['CACES 1','Entrepôt'],
    cands:[{nm:'Omar S.',i:'OS',gr:'linear-gradient(135deg,#00cec9,#55efc4)',st:'En poste',stc:'green-bg',stcc:'green'},{nm:'Fatima E.',i:'FA',gr:'linear-gradient(135deg,#F39C12,#FDCB6E)',st:'En poste',stc:'green-bg',stcc:'green'},{nm:'Antoine G.',i:'AG',gr:'linear-gradient(135deg,#4A90D9,#74B9FF)',st:'En poste',stc:'green-bg',stcc:'green'}]},
  {id:8,title:'Agents logistiques polyvalents',client:'Rhenus Logistics',loc:'Corbas',urg:'medium',st:'open',postes:4,filled:1,matchs:11,dates:'17 fév. → 30 avril',ho:'2x8',sk:['Logistique','Polyvalent','Scan RF'],
    cands:[{nm:'Sophie M.',i:'SM',gr:'linear-gradient(135deg,#FD79A8,#FDCB6E)',st:'Proposé',stc:'blue-bg',stcc:'blue'}]},
];

const msStMap={open:{l:'Ouverte',c:'ms-st-open',e:'🟢'},progress:{l:'En cours',c:'ms-st-progress',e:'🔵'},urgent:{l:'Urgente',c:'ms-st-urgent',e:'🔥'},filled:{l:'Pourvue',c:'ms-st-filled',e:'✅'},done:{l:'Terminée',c:'ms-st-done',e:'—'}};
const msUrgMap={high:'ms-td-urgency high',medium:'ms-td-urgency medium',low:'ms-td-urgency low'};

let msFilter='all',msViewMode='table',msSearchQ='';

function msFiltered(){
  let l=[...msMissions];
  if(msFilter==='open')l=l.filter(m=>m.st==='open');
  else if(msFilter==='urgent')l=l.filter(m=>m.urg==='high'||m.st==='urgent');
  else if(msFilter==='progress')l=l.filter(m=>m.st==='progress');
  else if(msFilter==='filled')l=l.filter(m=>m.st==='filled');
  if(msSearchQ)l=l.filter(m=>m.title.toLowerCase().includes(msSearchQ)||m.client.toLowerCase().includes(msSearchQ)||m.loc.toLowerCase().includes(msSearchQ));
  return l;
}

function msRenderTable(){
  const l=msFiltered();
  document.getElementById('msTableBody').innerHTML=l.map((m,i)=>{
    const s=msStMap[m.st]||msStMap.open;
    const fillPct=m.postes?Math.round(m.filled/m.postes*100):0;
    const fillCol=fillPct>=100?'var(--green)':fillPct>=50?'var(--orange)':'var(--red)';
    return`<tr onclick="msOpenDrawer(${m.id})" style="animation:fadeUp 0.3s ease backwards;animation-delay:${i*0.03}s">
      <td><div class="ms-td-mission"><div class="${msUrgMap[m.urg]}"></div><div class="ms-td-m-info"><div class="ms-td-m-title">${m.title}</div><div class="ms-td-m-client">${m.client}</div></div></div></td>
      <td><div class="ms-td-status ${s.c}">${s.e} ${s.l}</div></td>
      <td><span style="font-family:'Space Mono',monospace;font-weight:700;color:${fillCol}">${m.filled}/${m.postes}</span></td>
      <td><div class="ms-td-avatars">${m.cands.slice(0,3).map(c=>`<div style="background:${c.gr}">${c.i}</div>`).join('')}${m.cands.length>3?`<div class="ms-td-plus">+${m.cands.length-3}</div>`:m.cands.length===0?'<span style="font-size:12px;color:var(--text-tertiary)">—</span>':''}</div></td>
      <td><div class="ms-td-match"><div class="ms-match-num" style="color:var(--accent)">${m.matchs}</div><div class="ms-match-bar"><div class="ms-match-fill" style="width:${Math.min(m.matchs*5,100)}%;background:linear-gradient(90deg,var(--accent),var(--accent-light))"></div></div></div></td>
      <td><div class="ms-td-dates">📅 ${m.dates}</div></td>
      <td><div class="ms-td-loc">📍 ${m.loc}</div></td>
      <td><div class="td-actions" onclick="event.stopPropagation()">
        <div class="ms-act-btn" title="Voir détails" onclick="msOpenDrawer(${m.id})">📋</div>
        <div class="ms-act-btn" title="Lancer matching" onclick="showToast('🎯 Matching IA lancé pour ${m.title}')">🎯</div>
        <div class="ms-act-btn" title="Relancer candidats" onclick="showToast('📱 Relance envoyée')">📱</div>
      </div></td>
    </tr>`;
  }).join('');
}

function msRenderKanban(){
  const cols=[
    {key:'urgent',title:'🔥 Urgentes',filter:m=>m.st==='urgent'||m.urg==='high'},
    {key:'open',title:'🟢 Ouvertes',filter:m=>m.st==='open'&&m.urg!=='high'},
    {key:'progress',title:'🔵 En cours',filter:m=>m.st==='progress'},
    {key:'filled',title:'✅ Pourvues',filter:m=>m.st==='filled'},
  ];
  const all=msFiltered();
  document.getElementById('msKanbanView').innerHTML=cols.map(col=>{
    const items=all.filter(col.filter);
    return`<div class="ms-kb-col">
      <div class="ms-kb-col-h"><div class="ms-kb-col-title">${col.title}</div><div class="ms-kb-col-count">${items.length}</div></div>
      <div class="ms-kb-col-body">${items.map((m,i)=>{
        return`<div class="ms-kb-card" style="animation-delay:${i*0.04}s" onclick="msOpenDrawer(${m.id})">
          <div class="ms-kb-top"><div class="ms-kb-urg" style="background:${m.urg==='high'?'var(--red)':m.urg==='medium'?'var(--orange)':'var(--green)'}"></div><div class="ms-kb-title">${m.title}</div></div>
          <div class="ms-kb-client">🏢 ${m.client}</div>
          <div class="ms-kb-meta">
            <div class="ms-kb-meta-i">📍 ${m.loc}</div>
            <div class="ms-kb-meta-i">👥 ${m.filled}/${m.postes} pourvus</div>
            <div class="ms-kb-meta-i">📅 ${m.dates.split(' → ')[0]}</div>
          </div>
          <div class="ms-kb-footer">
            <div class="ms-kb-avatars">${m.cands.slice(0,4).map(c=>`<div style="background:${c.gr}">${c.i}</div>`).join('')}${m.cands.length===0?'<span style="font-size:11px;color:var(--text-tertiary)">Aucun candidat</span>':''}</div>
            <div class="ms-kb-match">🎯 ${m.matchs} matchs</div>
          </div>
        </div>`;
      }).join('')}</div>
    </div>`;
  }).join('');
}

function msRender(){msRenderTable();msRenderKanban();}

function msSetFilter(el){msFilter=el.dataset.msf;document.querySelectorAll('.ms-pill[data-msf]').forEach(p=>p.classList.remove('on'));el.classList.add('on');msRender();}
function msDoFilter(){msSearchQ=document.getElementById('msSearchInput').value.toLowerCase().trim();msRender();}
function msFilterByKpi(status){
  msFilter=status;
  document.querySelectorAll('.ms-pill[data-msf]').forEach(p=>p.classList.toggle('on',p.dataset.msf===status));
  msRender();
  document.querySelector('.ms-table-card')?.scrollIntoView({behavior:'smooth',block:'nearest'});
}
function msSetView(v){
  msViewMode=v;
  document.getElementById('msVTable').classList.toggle('on',v==='table');
  document.getElementById('msVKanban').classList.toggle('on',v==='kanban');
  document.getElementById('msTableView').classList.toggle('off',v==='kanban');
  document.getElementById('msKanbanView').classList.toggle('on',v==='kanban');
}

function msOpenDrawer(id){
  const m=msMissions.find(x=>x.id===id);if(!m)return;
  const s=msStMap[m.st]||msStMap.open;
  const fillPct=m.postes?Math.round(m.filled/m.postes*100):0;
  document.getElementById('msDrawerContent').innerHTML=`
    <div class="ms-dw-body">
      <div class="ms-dw-m-header">
        <div class="ms-dw-m-title"><div class="${msUrgMap[m.urg]}" style="width:12px;height:12px"></div>${m.title}</div>
        <div class="ms-dw-m-client">🏢 ${m.client} · 📍 ${m.loc}</div>
        <div class="ms-dw-m-status"><span class="ms-td-status ${s.c}" style="font-size:12px">${s.e} ${s.l}</span></div>
      </div>
      <div class="ms-dw-quick">
        <button class="ms-dw-qbtn primary" onclick="showToast('🎯 Matching IA lancé')">🎯 Matching IA</button>
        <button class="ms-dw-qbtn" onclick="showToast('📱 Relance envoyée')">📱 Relancer</button>
        <button class="ms-dw-qbtn" onclick="showToast('👁 Envoyé au portail')">👁 Portail</button>
      </div>
      <div class="ms-dw-sec"><div class="ms-dw-sec-t">Détails de la mission</div>
        <div class="ms-dw-grid">
          <div class="ms-dw-it"><div class="ms-dw-it-l">Postes</div><div class="ms-dw-it-v" style="color:${fillPct>=100?'var(--green)':'var(--orange)'}">${m.filled} / ${m.postes} pourvus</div></div>
          <div class="ms-dw-it"><div class="ms-dw-it-l">Matchings IA</div><div class="ms-dw-it-v" style="color:var(--accent)">${m.matchs} candidats</div></div>
          <div class="ms-dw-it"><div class="ms-dw-it-l">Dates</div><div class="ms-dw-it-v">${m.dates}</div></div>
          <div class="ms-dw-it"><div class="ms-dw-it-l">Horaires</div><div class="ms-dw-it-v">${m.ho}</div></div>
          <div class="ms-dw-it"><div class="ms-dw-it-l">Localisation</div><div class="ms-dw-it-v">${m.loc}</div></div>
          <div class="ms-dw-it"><div class="ms-dw-it-l">Urgence</div><div class="ms-dw-it-v" style="color:${m.urg==='high'?'var(--red)':m.urg==='medium'?'var(--orange)':'var(--green)'}">${m.urg==='high'?'🔴 Critique':m.urg==='medium'?'🟠 Moyen':'🟢 Normal'}</div></div>
        </div>
      </div>
      <div class="ms-dw-sec"><div class="ms-dw-sec-t">Compétences requises</div>
        <div class="ms-dw-chips">${m.sk.map(s=>`<div class="ms-tag">${s}</div>`).join('')}</div>
      </div>
      <div class="ms-dw-sec"><div class="ms-dw-sec-t">Candidats affectés (${m.cands.length})</div>
        ${m.cands.length?m.cands.map(c=>`<div class="ms-dw-cand">
          <div class="ms-dw-cand-av" style="background:${c.gr}">${c.i}</div>
          <div class="ms-dw-cand-info"><div class="ms-dw-cand-nm">${c.nm}</div><div class="ms-dw-cand-rl">${c.st}</div></div>
          <div class="ms-dw-cand-status" style="background:var(--${c.stc});color:var(--${c.stcc})">${c.st}</div>
        </div>`).join(''):'<div style="padding:20px;text-align:center;color:var(--text-tertiary);font-size:13px;">Aucun candidat affecté — <span style="color:var(--accent);cursor:pointer;font-weight:600" onclick="showToast(\'🎯 Matching IA lancé\')">Lancer le matching IA</span></div>'}
      </div>
    </div>`;
  document.getElementById('msDOverlay').classList.add('on');
  document.getElementById('msDrawer').classList.add('on');
}
function msCloseDrawer(){document.getElementById('msDOverlay').classList.remove('on');document.getElementById('msDrawer').classList.remove('on');}

function msOpenModal(){document.getElementById('msNewModal').classList.add('show');}
function msCloseModal(){document.getElementById('msNewModal').classList.remove('show');}
function msPickUrg(el,v){
  document.querySelectorAll('.ms-urg-pill').forEach(p=>{p.classList.remove('on','high','med','low');});
  el.classList.add('on',v);
}
function msCreateMission(){
  const title=document.getElementById('msMTitle').value.trim()||'Nouvelle mission';
  msCloseModal();
  showToast('🚀 Mission "'+title+'" créée — Matching IA en cours...');
}

msRender();

// ===== JOBBOARDS PAGE JS =====
const jbCandidatures = [
  { initials:'JP', gradient:'linear-gradient(135deg,#6C5CE7,#A29BFE)', name:'Jean-Paul Martin', poste:'Cariste CACES 3', source:'ft', time:'Il y a 12 min', isNew:true },
  { initials:'AB', gradient:'linear-gradient(135deg,#4A90D9,#74B9FF)', name:'Amina Boukhris', poste:'Préparateur commandes', source:'in', time:'Il y a 35 min', isNew:true },
  { initials:'RF', gradient:'linear-gradient(135deg,#00B894,#55E6A5)', name:'Romain Favre', poste:'Cariste CACES 3', source:'hw', time:'Il y a 1h', isNew:true },
  { initials:'LC', gradient:'linear-gradient(135deg,#F39C12,#FDCB6E)', name:'Léa Constant', poste:'Agent de production', source:'ft', time:'Il y a 2h', isNew:false },
  { initials:'MA', gradient:'linear-gradient(135deg,#E74C3C,#FF7675)', name:'Mohamed Alaoui', poste:'Cariste CACES 3', source:'in', time:'Il y a 3h', isNew:false },
  { initials:'VB', gradient:'linear-gradient(135deg,#6A1EFF,#A29BFE)', name:'Vanessa Blanc', poste:'Préparateur commandes', source:'mo', time:'Il y a 4h', isNew:false },
  { initials:'TK', gradient:'linear-gradient(135deg,#003189,#4A90D9)', name:'Thomas Klein', poste:'Agent de production', source:'ft', time:'Il y a 5h', isNew:false },
  { initials:'SD', gradient:'linear-gradient(135deg,#E85D04,#FDCB6E)', name:'Sandra Dupuis', poste:'Cariste CACES 3', source:'hw', time:'Il y a 6h', isNew:false },
  { initials:'PG', gradient:'linear-gradient(135deg,#2D64BC,#74B9FF)', name:'Pierre Guérin', poste:'Technicien maintenance', source:'in', time:'Il y a 8h', isNew:false },
  { initials:'NM', gradient:'linear-gradient(135deg,#003189,#6C5CE7)', name:'Nadia Mansouri', poste:'Cariste CACES 3', source:'ft', time:'Hier', isNew:false },
];

const jbSourceLabels = { ft:'FT', in:'IN', hw:'HW', mo:'MO' };
const jbSourceColors = { ft:'#003189', in:'#2D64BC', hw:'#E85D04', mo:'#6A1EFF' };
const jbSourceNames = { ft:'France Travail', in:'Indeed', hw:'HelloWork', mo:'Monster' };

let jbCurrentSource = 'all';

function jbRenderCands(source) {
  const list = document.getElementById('jbCandList');
  if(!list) return;
  const filtered = source === 'all' ? jbCandidatures : jbCandidatures.filter(c => c.source === source);
  list.innerHTML = filtered.map(c => `
    <div class="jb-cand-item" onclick="jbShowToast('Ouvrir la fiche de ${c.name}')">
      <div class="jb-cand-avatar" style="background:${c.gradient}">${c.initials}</div>
      <div class="jb-cand-info">
        <div style="display:flex;align-items:center;gap:8px;">
          <div class="jb-cand-name">${c.name}</div>
          ${c.isNew ? '<span class="jb-new-badge">Nouveau</span>' : ''}
        </div>
        <div class="jb-cand-sub">
          <span>${c.poste}</span>
          <span>·</span>
          <div class="jb-cand-source">
            <div class="jb-platform-logo ${c.source}" style="width:16px;height:16px;font-size:7px;border-radius:4px;">${jbSourceLabels[c.source]}</div>
            <span style="color:var(--text-secondary)">${jbSourceNames[c.source]}</span>
          </div>
        </div>
      </div>
      <div style="display:flex;flex-direction:column;align-items:flex-end;gap:6px;">
        <div class="jb-cand-time">${c.time}</div>
        <div style="display:flex;gap:5px;">
          <button onclick="event.stopPropagation();jbShowToast('Ajouter ${c.name} à la CVthèque')" style="padding:4px 10px;border-radius:7px;border:1px solid var(--border);background:var(--surface);font-family:inherit;font-size:11px;font-weight:600;cursor:pointer;color:var(--text-secondary);transition:var(--transition);" onmouseover="this.style.borderColor='var(--accent)';this.style.color='var(--accent)'" onmouseout="this.style.borderColor='var(--border)';this.style.color='var(--text-secondary)'">+ CVthèque</button>
          <button onclick="event.stopPropagation();jbShowToast('Lancer le matching pour ${c.name}')" style="padding:4px 10px;border-radius:7px;border:none;background:var(--accent-bg);font-family:inherit;font-size:11px;font-weight:600;cursor:pointer;color:var(--accent);">Matcher</button>
        </div>
      </div>
    </div>
  `).join('');
}

function jbSwitchView(view, el) {
  ['jbViewOffres','jbViewCands','jbViewConnexions'].forEach(id => {
    const el2 = document.getElementById(id);
    if(el2) el2.style.display = 'none';
  });
  const target = document.getElementById('jbView' + view.charAt(0).toUpperCase() + view.slice(1));
  if(target) target.style.display = 'block';
  if(el) {
    el.closest('.jb-filter-tabs').querySelectorAll('.jb-ftab').forEach(t => t.classList.remove('active'));
    el.classList.add('active');
  }
  if(view === 'cands') jbRenderCands2('all');
}

function jbFilterSource2(el, source) {
  el.closest('.jb-src-pills').querySelectorAll('.jb-src-pill').forEach(p => p.classList.remove('active'));
  el.classList.add('active');
  jbRenderCands2(source);
}

function jbRenderCands2(source) {
  const list = document.getElementById('jbCandList2');
  if(!list) return;
  const filtered = source === 'all' ? jbCandidatures : jbCandidatures.filter(c => c.source === source);
  list.innerHTML = filtered.map(c => `
    <div class="jb-row" style="cursor:pointer;" onclick="jbShowToast('Profil de ${c.name} ouvert')">
      <div class="jb-td" style="flex:2;gap:12px;display:flex;align-items:center;">
        <div style="width:34px;height:34px;border-radius:50%;background:${c.gradient};display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:13px;flex-shrink:0;">${c.initials}</div>
        <div>
          <div style="font-weight:600;font-size:13px;color:var(--text-primary);">${c.name}</div>
          <div style="font-size:11px;color:var(--text-muted);">${c.poste}</div>
        </div>
      </div>
      <div class="jb-td" style="flex:1.5;">
        <div class="jb-plat-chip"><div class="jb-logo ${c.source}" style="width:18px;height:18px;border-radius:4px;font-size:7px;">${c.source.toUpperCase()}</div>${jbSourceNames[c.source]||c.source}</div>
      </div>
      <div class="jb-td" style="flex:1;font-size:12px;color:var(--text-muted);">${c.time}</div>
      <div class="jb-td jb-actions" style="flex:0.8;justify-content:flex-end;">
        <button class="jb-act-btn" onclick="event.stopPropagation();navigateTo('cvtheque')">Voir CV</button>
        <button class="jb-act-btn" onclick="event.stopPropagation();navigateTo('matching')">Matcher</button>
      </div>
    </div>
  `).join('');
}

function jbShowTab(tab) {
  jbSwitchView(tab === 'offres' ? 'offres' : 'cands', null);
}

function jbToggleConn(btn) {
  const isOn = btn.classList.contains('on');
  btn.classList.toggle('on', !isOn);
  btn.classList.toggle('off', isOn);
  btn.closest('.jb-conn-item').classList.toggle('connected', !isOn);
  btn.textContent = isOn ? 'Connecter' : 'Connecté';
  jbShowToast(isOn ? 'Plateforme déconnectée' : 'Plateforme connectée');
}

function jbOpenPublishModal() {
  document.getElementById('jbPublishModal').classList.add('show');
}
function jbClosePublishModal(e) {
  if(!e || e.target === document.getElementById('jbPublishModal'))
    document.getElementById('jbPublishModal').classList.remove('show');
}
function jbPublishOffer() {
  jbClosePublishModal();
  jbShowToast('Offre publiée sur les plateformes sélectionnées');
}

function jbShowToast(msg) {
  if(typeof showToast === 'function') showToast(msg);
  else { const t=document.createElement('div'); t.style.cssText='position:fixed;bottom:28px;left:50%;transform:translateX(-50%);background:#1A1D2E;color:#fff;padding:12px 22px;border-radius:12px;font-size:13px;font-weight:600;z-index:9999;box-shadow:0 8px 32px rgba(0,0,0,0.2);'; t.textContent=msg; document.body.appendChild(t); setTimeout(()=>t.remove(),2800); }
}

</script>

<!-- ============================= -->
<!-- PAGE: JOBBOARDS               -->
<!-- ============================= -->
<div class="page-section" id="page-jobboards">
<div class="main">
  <header class="header">
    <div class="header-left">
      <div class="header-title">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round"><rect x="2" y="3" width="20" height="14" rx="2"/><circle cx="8" cy="8" r="1.5" fill="var(--accent)" stroke="none"/><path d="M11 8h5"/><path d="M8 11h8"/></svg>
        Jobboards
      </div>
      <div class="header-subtitle">Publiez vos offres, centralisez les candidatures de toutes les plateformes</div>
    </div>
    <div class="header-right">
      <div style="display:flex;align-items:center;gap:8px;padding:7px 14px;background:var(--green-bg);border-radius:20px;font-size:12px;font-weight:600;color:var(--green);">
        <span class="live-dot"></span> 4 plateformes actives
      </div>
      <button class="btn-primary" onclick="jbOpenPublishModal()" style="display:flex;align-items:center;gap:8px;padding:10px 20px;background:var(--accent);color:#fff;border:none;border-radius:12px;font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;box-shadow:var(--shadow-accent);">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Publier une offre
      </button>
      <div class="header-btn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
        <div class="notif-dot"></div>
      </div>
    </div>
  </header>

  <!-- Stats bar -->
  <div class="jb-statsbar">
    <div class="jb-stat">
      <div class="jb-stat-val" style="color:var(--accent)">6</div>
      <div class="jb-stat-label">Offres publiées</div>
      <div class="jb-stat-trend">4 actives</div>
    </div>
    <div class="jb-stat">
      <div class="jb-stat-val" style="color:#059669">76</div>
      <div class="jb-stat-label">Candidatures reçues</div>
      <div class="jb-stat-trend">+12 aujourd'hui</div>
    </div>
    <div class="jb-stat">
      <div class="jb-stat-val" style="color:var(--blue)">4</div>
      <div class="jb-stat-label">Plateformes actives</div>
    </div>
    <div class="jb-stat">
      <div class="jb-stat-val" style="color:var(--orange)">72%</div>
      <div class="jb-stat-label">Taux de conversion</div>
      <div class="jb-stat-trend">+4% ce mois</div>
    </div>
  </div>
  <!-- Toolbar -->
  <div class="jb-toolbar">
    <div class="jb-search">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
      <input type="text" placeholder="Rechercher une offre..." />
    </div>
    <div style="flex:1;"></div>
    <button onclick="jbOpenPublishModal()" style="display:flex;align-items:center;gap:7px;padding:9px 18px;background:var(--accent);color:#fff;border:none;border-radius:9px;font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;box-shadow:var(--shadow-accent);">
      <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
      Publier une offre
    </button>
  </div>
  <!-- Filter tabs -->
  <div class="jb-filter-tabs">
    <div class="jb-ftab active" onclick="jbSwitchView('offres',this)">
      Offres <span class="jb-ftab-count">6</span>
    </div>
    <div class="jb-ftab" onclick="jbSwitchView('cands',this)">
      Candidatures <span class="jb-ftab-count">76</span>
    </div>
    <div class="jb-ftab" onclick="jbSwitchView('connexions',this)">
      Connexions <span class="jb-ftab-count">4</span>
    </div>
  </div>
  <!-- Body -->
  <div class="jb-body">
    <!-- MAIN -->
    <div class="jb-main">
      <!-- === VUE OFFRES === -->
      <div id="jbViewOffres">
        <table class="jb-table">
          <thead class="jb-thead">
            <tr>
              <th class="jb-th">Offre</th>
              <th class="jb-th">Plateformes</th>
              <th class="jb-th">Pipeline</th>
              <th class="jb-th">Total</th>
              <th class="jb-th">Statut</th>
              <th class="jb-th"></th>
            </tr>
          </thead>
          <tbody>
            <!-- Row 1 -->
            <tr class="jb-row" onclick="jbShowToast('Ouvrir l\'offre Cariste CACES 3')">
              <td class="jb-td">
                <div class="jb-title">5 Caristes CACES 3 — Carrefour</div>
                <div class="jb-meta"><span>📍 Lyon 7e</span><span>·</span><span>Publiée le 10 fév. 2026</span></div>
              </td>
              <td class="jb-td">
                <div class="jb-plat-row">
                  <div class="jb-plat-chip"><div class="jb-logo ft" style="width:16px;height:16px;">FT</div><span class="jb-plat-chip-count">23</span></div>
                  <div class="jb-plat-chip"><div class="jb-logo in" style="width:16px;height:16px;">IN</div><span class="jb-plat-chip-count">15</span></div>
                  <div class="jb-plat-chip"><div class="jb-logo hw" style="width:16px;height:16px;">HW</div><span class="jb-plat-chip-count">9</span></div>
                </div>
              </td>
              <td class="jb-td">
                <div class="jb-pipeline">
                  <span class="jb-pip-stage new">Reçus <b>47</b></span>
                  <span class="jb-pip-sep">›</span>
                  <span class="jb-pip-stage screen">Screening <b>12</b></span>
                  <span class="jb-pip-sep">›</span>
                  <span class="jb-pip-stage interview">Entretien <b>4</b></span>
                </div>
              </td>
              <td class="jb-td"><b style="font-family:'Space Mono',monospace;font-size:14px;">47</b></td>
              <td class="jb-td"><span class="jb-status active">Publiée</span></td>
              <td class="jb-td">
                <div class="jb-actions">
                  <button class="jb-act-btn" onclick="event.stopPropagation();jbShowToast('Modifier l\'offre')">Modifier</button>
                  <button class="jb-act-btn" onclick="event.stopPropagation();navigateTo('matching')">Matchs</button>
                  <button class="jb-act-btn danger" onclick="event.stopPropagation();jbShowToast('Offre mise en pause')">Pause</button>
                </div>
              </td>
            </tr>
            <!-- Row 2 -->
            <tr class="jb-row" onclick="jbShowToast('Ouvrir l\'offre Prépa. commandes')">
              <td class="jb-td">
                <div class="jb-title">3 Préparateurs commandes — Amazon</div>
                <div class="jb-meta"><span>📍 Saint-Priest</span><span>·</span><span>Publiée le 8 fév. 2026</span></div>
              </td>
              <td class="jb-td">
                <div class="jb-plat-row">
                  <div class="jb-plat-chip"><div class="jb-logo ft" style="width:16px;height:16px;">FT</div><span class="jb-plat-chip-count">12</span></div>
                  <div class="jb-plat-chip"><div class="jb-logo in" style="width:16px;height:16px;">IN</div><span class="jb-plat-chip-count">8</span></div>
                </div>
              </td>
              <td class="jb-td">
                <div class="jb-pipeline">
                  <span class="jb-pip-stage new">Reçus <b>20</b></span>
                  <span class="jb-pip-sep">›</span>
                  <span class="jb-pip-stage screen">Screening <b>7</b></span>
                  <span class="jb-pip-sep">›</span>
                  <span class="jb-pip-stage interview">Entretien <b>2</b></span>
                </div>
              </td>
              <td class="jb-td"><b style="font-family:'Space Mono',monospace;font-size:14px;">20</b></td>
              <td class="jb-td"><span class="jb-status active">Publiée</span></td>
              <td class="jb-td">
                <div class="jb-actions">
                  <button class="jb-act-btn" onclick="event.stopPropagation();jbShowToast('Modifier l\'offre')">Modifier</button>
                  <button class="jb-act-btn" onclick="event.stopPropagation();navigateTo('matching')">Matchs</button>
                  <button class="jb-act-btn danger" onclick="event.stopPropagation();jbShowToast('Offre mise en pause')">Pause</button>
                </div>
              </td>
            </tr>
            <!-- Row 3 -->
            <tr class="jb-row" onclick="jbShowToast('Ouvrir l\'offre Agents production')">
              <td class="jb-td">
                <div class="jb-title">2 Agents de production — Sanofi</div>
                <div class="jb-meta"><span>📍 Gerland</span><span>·</span><span>Publiée le 12 fév. 2026</span></div>
              </td>
              <td class="jb-td">
                <div class="jb-plat-row">
                  <div class="jb-plat-chip"><div class="jb-logo ft" style="width:16px;height:16px;">FT</div><span class="jb-plat-chip-count">6</span></div>
                  <div class="jb-plat-chip"><div class="jb-logo mo" style="width:16px;height:16px;">MO</div><span class="jb-plat-chip-count">2</span></div>
                </div>
              </td>
              <td class="jb-td">
                <div class="jb-pipeline">
                  <span class="jb-pip-stage new">Reçus <b>8</b></span>
                  <span class="jb-pip-sep">›</span>
                  <span class="jb-pip-stage screen">Screening <b>3</b></span>
                  <span class="jb-pip-sep">›</span>
                  <span class="jb-pip-stage interview">Entretien <b>1</b></span>
                </div>
              </td>
              <td class="jb-td"><b style="font-family:'Space Mono',monospace;font-size:14px;">8</b></td>
              <td class="jb-td"><span class="jb-status active">Publiée</span></td>
              <td class="jb-td">
                <div class="jb-actions">
                  <button class="jb-act-btn" onclick="event.stopPropagation();jbShowToast('Modifier l\'offre')">Modifier</button>
                  <button class="jb-act-btn" onclick="event.stopPropagation();navigateTo('matching')">Matchs</button>
                  <button class="jb-act-btn danger" onclick="event.stopPropagation();jbShowToast('Offre mise en pause')">Pause</button>
                </div>
              </td>
            </tr>
            <!-- Row 4 (paused) -->
            <tr class="jb-row" style="opacity:0.7;" onclick="jbShowToast('Ouvrir l\'offre Technicien maintenance')">
              <td class="jb-td">
                <div class="jb-title">1 Technicien maintenance — Veolia</div>
                <div class="jb-meta"><span>📍 Villeurbanne</span><span>·</span><span>Publiée le 5 fév. 2026</span></div>
              </td>
              <td class="jb-td">
                <div class="jb-plat-row">
                  <div class="jb-plat-chip"><div class="jb-logo in" style="width:16px;height:16px;">IN</div><span class="jb-plat-chip-count">3</span></div>
                </div>
              </td>
              <td class="jb-td">
                <div class="jb-pipeline">
                  <span class="jb-pip-stage new">Reçus <b>3</b></span>
                  <span class="jb-pip-sep">›</span>
                  <span class="jb-pip-stage screen">Screening <b>1</b></span>
                </div>
              </td>
              <td class="jb-td"><b style="font-family:'Space Mono',monospace;font-size:14px;">3</b></td>
              <td class="jb-td"><span class="jb-status paused">En pause</span></td>
              <td class="jb-td">
                <div class="jb-actions">
                  <button class="jb-act-btn" onclick="event.stopPropagation();jbShowToast('Offre réactivée')">Réactiver</button>
                  <button class="jb-act-btn" onclick="event.stopPropagation();navigateTo('matching')">Matchs</button>
                  <button class="jb-act-btn danger" onclick="event.stopPropagation();jbShowToast('Offre supprimée')">Supprimer</button>
                </div>
              </td>
            </tr>
          </tbody>
        </table>
      </div>
      <!-- === VUE CANDIDATURES === -->
      <div id="jbViewCands" style="display:none;">
        <div class="jb-src-pills">
          <div class="jb-src-pill active" onclick="jbFilterSource2(this,'all')">Toutes sources</div>
          <div class="jb-src-pill" onclick="jbFilterSource2(this,'ft')"><div class="jb-logo ft" style="width:15px;height:15px;">FT</div> France Travail</div>
          <div class="jb-src-pill" onclick="jbFilterSource2(this,'in')"><div class="jb-logo in" style="width:15px;height:15px;">IN</div> Indeed</div>
          <div class="jb-src-pill" onclick="jbFilterSource2(this,'hw')"><div class="jb-logo hw" style="width:15px;height:15px;">HW</div> HelloWork</div>
          <div class="jb-src-pill" onclick="jbFilterSource2(this,'mo')"><div class="jb-logo mo" style="width:15px;height:15px;">MO</div> Monster</div>
        </div>
        <div id="jbCandList2"></div>
      </div>
      <!-- === VUE CONNEXIONS (mobile / tab) === -->
      <div id="jbViewConnexions" style="display:none;padding:24px 28px;">
        <p style="font-size:13px;color:var(--text-secondary);margin-bottom:20px;">Connectez vos comptes jobboards pour publier vos offres en un clic et centraliser les candidatures.</p>
        <div style="display:grid;grid-template-columns:repeat(2,1fr);gap:12px;">
          <div style="border:1.5px solid rgba(5,150,105,0.3);border-radius:12px;padding:16px;background:rgba(5,150,105,0.02);display:flex;align-items:center;gap:12px;">
            <div class="jb-logo ft" style="width:36px;height:36px;border-radius:10px;font-size:10px;">FT</div>
            <div style="flex:1;"><div style="font-size:13px;font-weight:700;">France Travail</div><div style="font-size:11px;color:var(--text-tertiary);">41 candidatures · Gratuit</div></div>
            <button class="jb-conn-btn on" onclick="jbToggleConn(this)">Connecté</button>
          </div>
          <div style="border:1.5px solid rgba(5,150,105,0.3);border-radius:12px;padding:16px;background:rgba(5,150,105,0.02);display:flex;align-items:center;gap:12px;">
            <div class="jb-logo in" style="width:36px;height:36px;border-radius:10px;font-size:10px;">IN</div>
            <div style="flex:1;"><div style="font-size:13px;font-weight:700;">Indeed</div><div style="font-size:11px;color:var(--text-tertiary);">26 candidatures</div></div>
            <button class="jb-conn-btn on" onclick="jbToggleConn(this)">Connecté</button>
          </div>
          <div style="border:1.5px solid rgba(5,150,105,0.3);border-radius:12px;padding:16px;background:rgba(5,150,105,0.02);display:flex;align-items:center;gap:12px;">
            <div class="jb-logo hw" style="width:36px;height:36px;border-radius:10px;font-size:10px;">HW</div>
            <div style="flex:1;"><div style="font-size:13px;font-weight:700;">HelloWork</div><div style="font-size:11px;color:var(--text-tertiary);">9 candidatures</div></div>
            <button class="jb-conn-btn on" onclick="jbToggleConn(this)">Connecté</button>
          </div>
          <div style="border:1.5px solid rgba(5,150,105,0.3);border-radius:12px;padding:16px;background:rgba(5,150,105,0.02);display:flex;align-items:center;gap:12px;">
            <div class="jb-logo mo" style="width:36px;height:36px;border-radius:10px;font-size:10px;">MO</div>
            <div style="flex:1;"><div style="font-size:13px;font-weight:700;">Monster</div><div style="font-size:11px;color:var(--text-tertiary);">2 candidatures</div></div>
            <button class="jb-conn-btn on" onclick="jbToggleConn(this)">Connecté</button>
          </div>
          <div style="border:1.5px solid var(--border);border-radius:12px;padding:16px;display:flex;align-items:center;gap:12px;">
            <div class="jb-logo ap" style="width:36px;height:36px;border-radius:10px;font-size:10px;opacity:0.5;">AP</div>
            <div style="flex:1;"><div style="font-size:13px;font-weight:700;">APEC</div><div style="font-size:11px;color:var(--text-tertiary);">Non connecté</div></div>
            <button class="jb-conn-btn off" onclick="jbShowToast('Configurer APEC')">Connecter</button>
          </div>
          <div style="border:1.5px solid var(--border);border-radius:12px;padding:16px;display:flex;align-items:center;gap:12px;">
            <div class="jb-logo mj" style="width:36px;height:36px;border-radius:10px;font-size:10px;opacity:0.5;">MJ</div>
            <div style="flex:1;"><div style="font-size:13px;font-weight:700;">Meteojob</div><div style="font-size:11px;color:var(--text-tertiary);">Non connecté</div></div>
            <button class="jb-conn-btn off" onclick="jbShowToast('Configurer Meteojob')">Connecter</button>
          </div>
        </div>
      </div>
    </div>
    <!-- SIDEBAR -->
    <div class="jb-sidebar">
      <!-- Connexions compactes -->
      <div class="jb-sb-section">
        <div class="jb-sb-title">Connexions</div>
        <div class="jb-conn-row"><div class="jb-logo ft" style="width:28px;height:28px;border-radius:7px;font-size:9px;">FT</div><div class="jb-conn-info"><div class="jb-conn-name">France Travail</div><div class="jb-conn-count">41 candidatures · Gratuit</div></div><button class="jb-conn-btn on" onclick="jbToggleConn(this)">Connecté</button></div>
        <div class="jb-conn-row"><div class="jb-logo in" style="width:28px;height:28px;border-radius:7px;font-size:9px;">IN</div><div class="jb-conn-info"><div class="jb-conn-name">Indeed</div><div class="jb-conn-count">26 candidatures</div></div><button class="jb-conn-btn on" onclick="jbToggleConn(this)">Connecté</button></div>
        <div class="jb-conn-row"><div class="jb-logo hw" style="width:28px;height:28px;border-radius:7px;font-size:9px;">HW</div><div class="jb-conn-info"><div class="jb-conn-name">HelloWork</div><div class="jb-conn-count">9 candidatures</div></div><button class="jb-conn-btn on" onclick="jbToggleConn(this)">Connecté</button></div>
        <div class="jb-conn-row"><div class="jb-logo mo" style="width:28px;height:28px;border-radius:7px;font-size:9px;">MO</div><div class="jb-conn-info"><div class="jb-conn-name">Monster</div><div class="jb-conn-count">2 candidatures</div></div><button class="jb-conn-btn on" onclick="jbToggleConn(this)">Connecté</button></div>
        <div class="jb-conn-row"><div class="jb-logo ap" style="width:28px;height:28px;border-radius:7px;font-size:9px;opacity:0.5;">AP</div><div class="jb-conn-info"><div class="jb-conn-name">APEC</div><div class="jb-conn-count">Non connecté</div></div><button class="jb-conn-btn off" onclick="jbShowToast('Configurer APEC')">Connecter</button></div>
        <div class="jb-conn-row"><div class="jb-logo mj" style="width:28px;height:28px;border-radius:7px;font-size:9px;opacity:0.5;">MJ</div><div class="jb-conn-info"><div class="jb-conn-name">Meteojob</div><div class="jb-conn-count">Non connecté</div></div><button class="jb-conn-btn off" onclick="jbShowToast('Configurer Meteojob')">Connecter</button></div>
      </div>
      <!-- Stats 30 jours -->
      <div class="jb-sb-section">
        <div class="jb-sb-title">Sources — 30 derniers jours</div>
        <div class="jb-bar-row"><div class="jb-bar-label"><div class="jb-logo ft" style="width:18px;height:18px;border-radius:4px;font-size:7px;">FT</div><span>France Travail</span></div><div class="jb-bar-track"><div class="jb-bar-fill" style="width:54%;background:#003189;"></div></div><div class="jb-bar-count">41</div></div>
        <div class="jb-bar-row"><div class="jb-bar-label"><div class="jb-logo in" style="width:18px;height:18px;border-radius:4px;font-size:7px;">IN</div><span>Indeed</span></div><div class="jb-bar-track"><div class="jb-bar-fill" style="width:34%;background:#2D64BC;"></div></div><div class="jb-bar-count">26</div></div>
        <div class="jb-bar-row"><div class="jb-bar-label"><div class="jb-logo hw" style="width:18px;height:18px;border-radius:4px;font-size:7px;">HW</div><span>HelloWork</span></div><div class="jb-bar-track"><div class="jb-bar-fill" style="width:12%;background:#E85D04;"></div></div><div class="jb-bar-count">9</div></div>
        <div class="jb-bar-row"><div class="jb-bar-label"><div class="jb-logo mo" style="width:18px;height:18px;border-radius:4px;font-size:7px;">MO</div><span>Monster</span></div><div class="jb-bar-track"><div class="jb-bar-fill" style="width:3%;background:#6A1EFF;"></div></div><div class="jb-bar-count">2</div></div>
      </div>
    </div>
  </div>


<!-- MODAL PUBLIER UNE OFFRE -->
<div class="modal-ov" id="jbPublishModal" onclick="jbClosePublishModal(event)">
  <div class="jb-modal" onclick="event.stopPropagation()">
    <div class="modal-h">
      <div class="modal-t">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        Publier une offre
      </div>
      <button class="modal-x" onclick="jbClosePublishModal()">✕</button>
    </div>
    <div class="modal-body">
      <div class="field">
        <div class="field-label">Mission à publier</div>
        <select class="field-input" style="appearance:none;cursor:pointer;">
          <option>5 Caristes CACES 3 — Carrefour Lyon 7e</option>
          <option>3 Préparateurs commandes — Amazon Saint-Priest</option>
          <option>2 Agents de production — Sanofi Gerland</option>
          <option>1 Technicien maintenance — Veolia Villeurbanne</option>
        </select>
      </div>
      <div class="field">
        <div class="field-label">Titre de l'annonce</div>
        <input class="field-input" value="Cariste CACES 3 H/F — Intérim Lyon" />
      </div>
      <div class="field">
        <div class="field-label">Plateformes de diffusion</div>
        <div class="jb-platform-sel">
          <div class="jb-platform-opt selected" onclick="this.classList.toggle('selected')">
            <div class="jb-platform-opt-logo ft">FT</div>
            France Travail
            <span style="font-size:10px;color:var(--green);font-weight:700;">Gratuit</span>
          </div>
          <div class="jb-platform-opt selected" onclick="this.classList.toggle('selected')">
            <div class="jb-platform-opt-logo in">IN</div>
            Indeed
          </div>
          <div class="jb-platform-opt selected" onclick="this.classList.toggle('selected')">
            <div class="jb-platform-opt-logo hw">HW</div>
            HelloWork
          </div>
          <div class="jb-platform-opt selected" onclick="this.classList.toggle('selected')">
            <div class="jb-platform-opt-logo mo">MO</div>
            Monster
          </div>
          <div class="jb-platform-opt disabled">
            <div class="jb-platform-opt-logo ap">AP</div>
            APEC
            <span style="font-size:10px;color:var(--text-tertiary);">Non connecté</span>
          </div>
          <div class="jb-platform-opt disabled">
            <div class="jb-platform-opt-logo mj">MJ</div>
            Meteojob
            <span style="font-size:10px;color:var(--text-tertiary);">Non connecté</span>
          </div>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Description du poste</div>
        <textarea class="field-input" rows="4" style="resize:vertical;">TalentStaff Lyon recrute pour son client Carrefour Supply Chain un Cariste CACES 3 H/F en intérim.

Vos missions : conduite d'engins de manutention CACES 3, gestion des stocks, chargement/déchargement.
Profil : CACES 3 valide, expérience entrepôt exigée, visite médicale à jour.
Durée : mission de 3 mois renouvelable.</textarea>
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="jbClosePublishModal()" style="padding:10px 20px;border:1px solid var(--border);background:var(--surface);border-radius:10px;font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;color:var(--text-secondary);">Annuler</button>
      <button onclick="jbPublishOffer()" style="padding:10px 20px;background:var(--accent);color:#fff;border:none;border-radius:10px;font-family:inherit;font-size:13px;font-weight:600;cursor:pointer;box-shadow:var(--shadow-accent);display:flex;align-items:center;gap:8px;">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
        Publier sur les plateformes
      </button>
    </div>
  </div>
</div>
</div>

<!-- MODALE GLOBALE — Proposer candidat au portail client (accessible depuis toutes les pages) -->
<div class="sc-propose-ov" id="scProposeModal" onclick="scCloseProposeModal(event)">
  <div class="sc-propose-modal" onclick="event.stopPropagation()">
    <div class="sc-propose-head">
      <div class="sc-propose-head-icon">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="#fff" stroke-width="2.5"><path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/></svg>
      </div>
      <div class="sc-propose-head-text">
        <div class="sc-propose-title" id="scProposeCandidateName">Proposer le profil</div>
        <div class="sc-propose-sub">Sélectionnez le client et la mission cible</div>
      </div>
      <button class="sc-propose-close" onclick="scCloseProposeModal()">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="sc-propose-body">
      <div class="sc-propose-label">Clients actifs</div>
      <div id="scProposeClientList"></div>
    </div>
    <div class="sc-propose-visibility">
      <div class="sc-propose-visibility-label">Visibilité des coordonnées</div>
      <div class="sc-propose-vis-opts">
        <div class="sc-propose-vis-opt full on" id="scVisOptFull" onclick="scSetVisibility('full')">
          <div class="sc-propose-vis-icon">👤</div>
          <div class="sc-propose-vis-title">Profil complet</div>
          <div class="sc-propose-vis-desc">Nom, tél, email visibles</div>
        </div>
        <div class="sc-propose-vis-opt anon" id="scVisOptAnon" onclick="scSetVisibility('anon')">
          <div class="sc-propose-vis-icon">🔒</div>
          <div class="sc-propose-vis-title">Anonymisé</div>
          <div class="sc-propose-vis-desc">CV uniquement, sans coordonnées</div>
        </div>
      </div>
    </div>
    <div class="sc-propose-foot">
      <button class="sc-propose-cancel" onclick="scCloseProposeModal()">Annuler</button>
      <button class="sc-propose-confirm" id="scProposeConfirmBtn" onclick="scConfirmPropose()" disabled>Envoyer la proposition</button>
    </div>
  </div>
</div>

</body>
</html>
