<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>IZYSS — Plateforme IA Intérim</title>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,opsz,wght@0,9..40,300;0,9..40,400;0,9..40,500;0,9..40,600;0,9..40,700&family=Space+Mono:wght@400;700&display=swap" rel="stylesheet">
<style>
/* ===== GLOBAL VARS ===== */
:root {
  --bg: #F4F6FB;
  --surface: #FFFFFF;
  --surface-hover: #F8F9FD;
  --border: #E8ECF4;
  --border-light: #F0F2F8;
  --text-primary: #1A1D2E;
  --text-secondary: #6B7294;
  --text-tertiary: #9CA3C4;
  --accent: #6C5CE7;
  --accent-light: #A29BFE;
  --accent-bg: #F0EEFF;
  --accent-glow: rgba(108, 92, 231, 0.12);
  --blue: #4A90D9;
  --blue-bg: #EBF3FC;
  --green: #2ECC71;
  --green-bg: #E8F8F0;
  --orange: #F39C12;
  --orange-bg: #FEF5E7;
  --red: #E74C3C;
  --red-bg: #FDECEB;
  --sidebar-w: 260px;
  --header-h: 72px;
  --radius: 16px;
  --radius-sm: 10px;
  --shadow-sm: 0 1px 3px rgba(26,29,46,0.04);
  --shadow-md: 0 4px 20px rgba(26,29,46,0.06);
  --shadow-lg: 0 8px 40px rgba(26,29,46,0.08);
  --shadow-accent: 0 4px 24px rgba(108,92,231,0.18);
  --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'DM Sans', -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text-primary);
  overflow-x: hidden;
}

/* ===== MASTER SIDEBAR ===== */
.sidebar {
  position: fixed; left: 0; top: 0; bottom: 0;
  width: var(--sidebar-w);
  background: var(--surface);
  border-right: 1px solid var(--border);
  display: flex; flex-direction: column; z-index: 100;
}
.sidebar-logo {
  padding: 24px 28px;
  display: flex; align-items: center; gap: 12px;
  border-bottom: 1px solid var(--border-light);
}
.logo-icon {
  width: 40px; height: 40px;
  background: linear-gradient(135deg, var(--accent), var(--accent-light));
  border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  color: white; font-family: 'Space Mono', monospace; font-weight: 700; font-size: 16px;
  box-shadow: var(--shadow-accent);
}
.logo-text {
  font-size: 20px; font-weight: 700; letter-spacing: -0.5px;
  background: linear-gradient(135deg, var(--accent), var(--blue));
  -webkit-background-clip: text; -webkit-text-fill-color: transparent;
}
.sidebar-nav { flex: 1; padding: 20px 16px; display: flex; flex-direction: column; gap: 4px; overflow-y: auto; }
.nav-section-label {
  font-size: 10px; font-weight: 600; text-transform: uppercase;
  letter-spacing: 1.2px; color: var(--text-tertiary); padding: 16px 12px 8px;
}
.nav-item {
  display: flex; align-items: center; gap: 12px; padding: 11px 14px;
  border-radius: var(--radius-sm); cursor: pointer; transition: var(--transition);
  font-size: 14px; font-weight: 500; color: var(--text-secondary);
  position: relative; text-decoration: none; user-select: none;
}
.nav-item:hover { background: var(--surface-hover); color: var(--text-primary); }
.nav-item.active { background: var(--accent-bg); color: var(--accent); font-weight: 600; }
.nav-item.active::before {
  content: ''; position: absolute; left: -16px; top: 50%; transform: translateY(-50%);
  width: 3px; height: 24px; background: var(--accent); border-radius: 0 4px 4px 0;
}
.nav-icon { width: 20px; height: 20px; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
.nav-badge { margin-left: auto; background: var(--accent); color: white; font-size: 11px; font-weight: 600; padding: 2px 8px; border-radius: 20px; }
.sidebar-footer { padding: 16px; border-top: 1px solid var(--border-light); }
.agency-card { display: flex; align-items: center; gap: 12px; padding: 12px; border-radius: var(--radius-sm); background: var(--surface-hover); }
.agency-avatar { width: 36px; height: 36px; background: linear-gradient(135deg, #FF6B6B, #FFA07A); border-radius: 10px; display: flex; align-items: center; justify-content: center; color: white; font-weight: 700; font-size: 13px; }
.agency-info { flex: 1; }
.agency-name { font-size: 13px; font-weight: 600; }
.agency-role { font-size: 11px; color: var(--text-tertiary); }

/* Page sections - hidden by default */
.page-section { display: none; }
.page-section.active { display: block; }

/* Placeholder pages */
.placeholder-page {
  display: flex; align-items: center; justify-content: center; min-height: 80vh; text-align: center;
}

::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }
::-webkit-scrollbar-thumb:hover { background: var(--text-tertiary); }

/* ========================================== */
/* SCORING PAGE STYLES                        */
/* ========================================== */
.scoring-layout {
  display: grid;
  grid-template-columns: 420px 1fr;
  gap: 24px;
}

.card-subtitle {
  font-size: 12px;
  color: var(--text-secondary);
  margin-top: 2px;
}

.total-bar {
  padding: 16px 24px;
  background: linear-gradient(135deg, rgba(108,92,231,0.04), rgba(74,144,217,0.04));
  border-bottom: 1px solid var(--border-light);
  display: flex;
  align-items: center;
  justify-content: space-between;
}

.total-label {
  font-size: 13px;
  font-weight: 600;
  color: var(--text-secondary);
}

.total-value {
  font-family: 'Space Mono', monospace;
  font-size: 22px;
  font-weight: 700;
  transition: var(--transition);
}

.total-value.valid { color: var(--green); }
.total-value.warning { color: var(--orange); }
.total-value.over { color: var(--red); }

.total-target {
  font-size: 12px;
  color: var(--text-tertiary);
  margin-left: 4px;
  font-family: 'DM Sans', sans-serif;
  font-weight: 500;
}

.total-progress {
  width: 100%;
  height: 6px;
  background: var(--bg);
  border-radius: 10px;
  margin-top: 10px;
  overflow: hidden;
}

.total-progress-fill {
  height: 100%;
  border-radius: 10px;
  transition: width 0.4s ease, background 0.3s ease;
}

.criteria-section {
  padding: 16px 24px 8px;
}

.criteria-section-title {
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 1px;
  color: var(--text-tertiary);
  margin-bottom: 12px;
  display: flex;
  align-items: center;
  gap: 8px;
}

.criteria-section-title::after {
  content: '';
  flex: 1;
  height: 1px;
  background: var(--border-light);
}

.criterion {
  display: flex;
  align-items: center;
  gap: 12px;
  padding: 12px 14px;
  border-radius: var(--radius-sm);
  margin-bottom: 6px;
  transition: var(--transition);
  cursor: default;
  border: 1px solid transparent;
}

.criterion:hover {
  background: var(--surface-hover);
  border-color: var(--border-light);
}

.criterion-toggle {
  position: relative;
  width: 38px;
  height: 22px;
  flex-shrink: 0;
}

.criterion-toggle input {
  opacity: 0;
  width: 0;
  height: 0;
}

.toggle-slider {
  position: absolute;
  cursor: pointer;
  top: 0; left: 0; right: 0; bottom: 0;
  background: var(--border);
  border-radius: 22px;
  transition: var(--transition);
}

.toggle-slider::before {
  content: '';
  position: absolute;
  height: 16px;
  width: 16px;
  left: 3px;
  bottom: 3px;
  background: white;
  border-radius: 50%;
  transition: var(--transition);
  box-shadow: 0 1px 3px rgba(0,0,0,0.15);
}

.criterion-toggle input:checked + .toggle-slider {
  background: var(--accent);
}

.criterion-toggle input:checked + .toggle-slider::before {
  transform: translateX(16px);
}

.criterion-icon {
  width: 32px; height: 32px;
  border-radius: 8px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-size: 15px;
  flex-shrink: 0;
}

.criterion-info {
  flex: 1;
  min-width: 0;
}

.criterion-name {
  font-size: 13.5px;
  font-weight: 600;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.criterion-desc {
  font-size: 11.5px;
  color: var(--text-tertiary);
  margin-top: 1px;
}

.criterion-points {
  display: flex;
  align-items: center;
  gap: 6px;
  flex-shrink: 0;
}

.points-btn {
  width: 28px; height: 28px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--surface);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  font-size: 16px;
  color: var(--text-secondary);
  transition: var(--transition);
  font-weight: 600;
  user-select: none;
}

.points-btn:hover {
  border-color: var(--accent);
  color: var(--accent);
  background: var(--accent-bg);
}

.points-btn:active {
  transform: scale(0.92);
}

.points-value {
  font-family: 'Space Mono', monospace;
  font-size: 16px;
  font-weight: 700;
  min-width: 36px;
  text-align: center;
  color: var(--accent);
}

.points-value.disabled {
  color: var(--text-tertiary);
}

.add-criterion-area {
  padding: 12px 24px 20px;
}

.add-criterion-btn {
  width: 100%;
  padding: 12px;
  border: 2px dashed var(--border);
  border-radius: var(--radius-sm);
  background: transparent;
  font-family: inherit;
  font-size: 13px;
  font-weight: 600;
  color: var(--text-tertiary);
  cursor: pointer;
  transition: var(--transition);
  display: flex;
  align-items: center;
  justify-content: center;
  gap: 8px;
}

.add-criterion-btn:hover {
  border-color: var(--accent);
  color: var(--accent);
  background: var(--accent-bg);
}

.add-form {
  display: none;
  flex-direction: column;
  gap: 10px;
  padding: 16px;
  background: var(--surface-hover);
  border-radius: var(--radius-sm);
  border: 1px solid var(--border-light);
}

.add-form.show { display: flex; }

.add-form input {
  padding: 10px 14px;
  border: 1px solid var(--border);
  border-radius: 8px;
  font-family: inherit;
  font-size: 13px;
  outline: none;
  transition: var(--transition);
}

.add-form input:focus {
  border-color: var(--accent);
  box-shadow: 0 0 0 3px var(--accent-glow);
}

.add-form-actions {
  display: flex;
  gap: 8px;
}

.btn-primary {
  padding: 9px 18px;
  background: linear-gradient(135deg, var(--accent), #8B7CF6);
  color: white;
  border: none;
  border-radius: 8px;
  font-family: inherit;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
}

.btn-primary:hover {
  box-shadow: var(--shadow-accent);
  transform: translateY(-1px);
}

.btn-secondary {
  padding: 9px 18px;
  background: var(--surface);
  color: var(--text-secondary);
  border: 1px solid var(--border);
  border-radius: 8px;
  font-family: inherit;
  font-size: 13px;
  font-weight: 600;
  cursor: pointer;
  transition: var(--transition);
}

.btn-secondary:hover {
  background: var(--bg);
}

.save-bar {
  padding: 16px 24px;
  border-top: 1px solid var(--border-light);
  display: flex;
  align-items: center;
  justify-content: space-between;
  background: linear-gradient(135deg, rgba(108,92,231,0.02), rgba(74,144,217,0.02));
}

.save-info {
  font-size: 12px;
  color: var(--text-tertiary);
  display: flex;
  align-items: center;
  gap: 6px;
}

.save-btn {
  padding: 10px 24px;
  background: linear-gradient(135deg, var(--accent), #8B7CF6);
  color: white;
  border: none;
  border-radius: var(--radius-sm);
  font-family: inherit;
  font-size: 13.5px;
  font-weight: 700;
  cursor: pointer;
  transition: var(--transition);
  box-shadow: var(--shadow-accent);
  display: flex;
  align-items: center;
  gap: 8px;
}

.save-btn:hover {
  transform: translateY(-2px);
  box-shadow: 0 6px 28px rgba(108,92,231,0.3);
}

.results-filters {
  display: flex;
  gap: 8px;
}

.filter-chip {
  padding: 6px 14px;
  border: 1px solid var(--border);
  border-radius: 20px;
  font-size: 12px;
  font-weight: 500;
  color: var(--text-secondary);
  cursor: pointer;
  transition: var(--transition);
  background: var(--surface);
}

.filter-chip:hover, .filter-chip.active {
  border-color: var(--accent);
  color: var(--accent);
  background: var(--accent-bg);
}

.cv-table {
  width: 100%;
}

.cv-table th {
  text-align: left;
  padding: 12px 20px;
  font-size: 11px;
  font-weight: 600;
  text-transform: uppercase;
  letter-spacing: 0.8px;
  color: var(--text-tertiary);
  background: var(--surface-hover);
  border-bottom: 1px solid var(--border-light);
}

.cv-table td {
  padding: 16px 20px;
  font-size: 13.5px;
  border-bottom: 1px solid var(--border-light);
  vertical-align: middle;
}

.cv-table tr {
  transition: var(--transition);
  cursor: pointer;
}

.cv-table tbody tr:hover td {
  background: var(--surface-hover);
}

.cv-table tr:last-child td { border-bottom: none; }

.candidate-cell {
  display: flex;
  align-items: center;
  gap: 12px;
}

.candidate-avatar {
  width: 38px; height: 38px;
  border-radius: 10px;
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 700;
  font-size: 13px;
  color: white;
  flex-shrink: 0;
}

.candidate-name { font-weight: 600; }
.candidate-sub { font-size: 12px; color: var(--text-tertiary); margin-top: 1px; }

.score-ring {
  position: relative;
  width: 52px; height: 52px;
}

.score-ring svg {
  transform: rotate(-90deg);
  width: 52px; height: 52px;
}

.score-ring-bg {
  fill: none;
  stroke: var(--bg);
  stroke-width: 4;
}

.score-ring-fill {
  fill: none;
  stroke-width: 4;
  stroke-linecap: round;
  transition: stroke-dashoffset 1s ease, stroke 0.3s ease;
}

.score-ring-text {
  position: absolute;
  inset: 0;
  display: flex;
  align-items: center;
  justify-content: center;
  font-family: 'Space Mono', monospace;
  font-size: 13px;
  font-weight: 700;
}

.score-breakdown {
  display: flex;
  flex-direction: column;
  gap: 4px;
  min-width: 180px;
}

.breakdown-row {
  display: flex;
  align-items: center;
  gap: 8px;
}

.breakdown-label {
  font-size: 11px;
  color: var(--text-tertiary);
  min-width: 70px;
  white-space: nowrap;
  overflow: hidden;
  text-overflow: ellipsis;
}

.breakdown-track {
  flex: 1;
  height: 4px;
  background: var(--bg);
  border-radius: 10px;
  overflow: hidden;
}

.breakdown-fill {
  height: 100%;
  border-radius: 10px;
  transition: width 0.8s ease;
}

.breakdown-pts {
  font-size: 11px;
  font-family: 'Space Mono', monospace;
  font-weight: 700;
  min-width: 28px;
  text-align: right;
}

.status-badge {
  display: inline-flex;
  align-items: center;
  gap: 5px;
  padding: 4px 10px;
  border-radius: 20px;
  font-size: 12px;
  font-weight: 600;
}

.status-badge.available { background: var(--green-bg); color: var(--green); }
.status-badge.pending { background: var(--orange-bg); color: var(--orange); }
.status-badge.placed { background: var(--blue-bg); color: var(--blue); }

.status-dot {
  width: 6px; height: 6px;
  border-radius: 50%;
  background: currentColor;
}

.row-actions {
  display: flex;
  gap: 6px;
}

.row-action-btn {
  width: 32px; height: 32px;
  border-radius: 8px;
  border: 1px solid var(--border);
  background: var(--surface);
  display: flex;
  align-items: center;
  justify-content: center;
  cursor: pointer;
  color: var(--text-tertiary);
  transition: var(--transition);
  font-size: 14px;
}

.row-action-btn:hover {
  border-color: var(--accent);
  color: var(--accent);
  background: var(--accent-bg);
}





/* ========================================== */
/* MISSIONS PAGE STYLES                       */
/* ========================================== */
#page-missions .ms-toolbar{display:flex;align-items:center;gap:10px;margin-bottom:20px;flex-wrap:wrap;}
#page-missions .ms-search{display:flex;align-items:center;gap:8px;padding:9px 18px;border-radius:50px;border:1.5px solid var(--border);background:var(--surface);transition:var(--transition);min-width:260px;}
#page-missions .ms-search:focus-within{border-color:var(--accent);box-shadow:0 0 0 4px var(--accent-glow);}
#page-missions .ms-search input{border:none;outline:none;font-family:inherit;font-size:13px;width:100%;background:transparent;}
#page-missions .ms-search input::placeholder{color:var(--text-tertiary);}
.ms-pill{padding:8px 16px;border-radius:50px;font-size:12.5px;font-weight:600;cursor:pointer;transition:var(--transition);border:1.5px solid var(--border);background:var(--surface);color:var(--text-secondary);user-select:none;white-space:nowrap;}
.ms-pill:hover{border-color:var(--accent);color:var(--accent);}
.ms-pill.on{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 4px 16px rgba(108,92,231,0.2);}
.ms-toolbar-sep{width:1px;height:28px;background:var(--border);}
.ms-toolbar-right{margin-left:auto;display:flex;gap:8px;}
.ms-view-toggle{display:flex;border:1.5px solid var(--border);border-radius:var(--radius-sm);overflow:hidden;}
.ms-view-btn{padding:8px 14px;cursor:pointer;transition:var(--transition);background:var(--surface);color:var(--text-tertiary);display:flex;align-items:center;gap:5px;font-size:12px;font-weight:600;}
.ms-view-btn:hover{color:var(--accent);}
.ms-view-btn.on{background:var(--accent-bg);color:var(--accent);}
.ms-table-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;animation:fadeUp 0.5s ease backwards;}
.ms-table-card.off{display:none;}
#page-missions .ms-table-card table{width:100%;border-collapse:collapse;font-size:13px;}
#page-missions .ms-table-card thead{background:var(--surface-hover);}
#page-missions .ms-table-card th{padding:12px 16px;text-align:left;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.8px;color:var(--text-tertiary);border-bottom:1px solid var(--border);white-space:nowrap;}
#page-missions .ms-table-card td{padding:14px 16px;border-bottom:1px solid var(--border-light);vertical-align:middle;}
#page-missions .ms-table-card tr{transition:var(--transition);cursor:pointer;}
#page-missions .ms-table-card tbody tr:hover{background:var(--surface-hover);}
#page-missions .ms-table-card tr:last-child td{border-bottom:none;}
.ms-td-mission{display:flex;align-items:center;gap:12px;}
.ms-td-urgency{width:10px;height:10px;border-radius:50%;flex-shrink:0;}
.ms-td-urgency.high{background:var(--red);box-shadow:0 0 8px rgba(231,76,60,0.4);}
.ms-td-urgency.medium{background:var(--orange);box-shadow:0 0 8px rgba(243,156,18,0.4);}
.ms-td-urgency.low{background:var(--green);}
.ms-td-m-info{min-width:0;}
.ms-td-m-title{font-size:14px;font-weight:700;}
.ms-td-m-client{font-size:11.5px;color:var(--text-secondary);}
.ms-td-status{padding:5px 12px;border-radius:20px;font-size:11px;font-weight:700;display:inline-flex;align-items:center;gap:5px;white-space:nowrap;}
.ms-st-open{background:var(--green-bg);color:var(--green);}
.ms-st-progress{background:var(--blue-bg);color:var(--blue);}
.ms-st-urgent{background:var(--red-bg);color:var(--red);}
.ms-st-filled{background:var(--accent-bg);color:var(--accent);}
.ms-st-done{background:var(--surface-hover);color:var(--text-tertiary);}
.ms-td-avatars{display:flex;}
.ms-td-avatars>div{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:10px;color:#fff;margin-left:-6px;border:2px solid var(--surface);}
.ms-td-avatars>div:first-child{margin-left:0;}
.ms-td-plus{background:var(--bg) !important;color:var(--text-tertiary) !important;font-size:10px;}
.ms-td-dates{font-size:12px;color:var(--text-secondary);white-space:nowrap;}
.ms-td-loc{font-size:12px;color:var(--text-secondary);}
.ms-td-match{display:flex;align-items:center;gap:6px;}
.ms-match-num{font-family:'Space Mono',monospace;font-size:14px;font-weight:700;}
.ms-match-bar{width:40px;height:5px;background:var(--border-light);border-radius:10px;overflow:hidden;}
.ms-match-fill{height:100%;border-radius:10px;}
.ms-act-btn{width:30px;height:30px;border-radius:8px;border:1px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--transition);font-size:13px;color:var(--text-tertiary);}
.ms-act-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
/* KANBAN */
.ms-kanban{display:none;grid-template-columns:repeat(4,1fr);gap:16px;align-items:start;}
.ms-kanban.on{display:grid;}
.ms-kb-col{background:var(--surface-hover);border-radius:var(--radius);padding:0;min-height:200px;}
.ms-kb-col-h{padding:16px 18px;display:flex;align-items:center;justify-content:space-between;border-bottom:1px solid var(--border);}
.ms-kb-col-title{font-size:13px;font-weight:700;display:flex;align-items:center;gap:8px;}
.ms-kb-col-count{font-size:11px;font-weight:600;padding:2px 8px;border-radius:20px;background:var(--border);color:var(--text-secondary);}
.ms-kb-col-body{padding:12px;display:flex;flex-direction:column;gap:10px;}
.ms-kb-card{background:var(--surface);border:1.5px solid var(--border);border-radius:14px;padding:16px;transition:var(--transition);cursor:pointer;animation:fadeUp 0.4s ease backwards;}
.ms-kb-card:hover{box-shadow:0 6px 24px rgba(26,29,46,0.07);transform:translateY(-3px);border-color:rgba(108,92,231,0.15);}
.ms-kb-top{display:flex;align-items:center;gap:10px;margin-bottom:10px;}
.ms-kb-urg{width:8px;height:8px;border-radius:50%;flex-shrink:0;}
.ms-kb-title{font-size:13.5px;font-weight:700;flex:1;}
.ms-kb-client{font-size:11.5px;color:var(--text-secondary);margin-bottom:8px;display:flex;align-items:center;gap:4px;}
.ms-kb-meta{display:flex;gap:10px;margin-bottom:10px;flex-wrap:wrap;}
.ms-kb-meta-i{font-size:11px;color:var(--text-tertiary);display:flex;align-items:center;gap:3px;}
.ms-kb-footer{display:flex;align-items:center;justify-content:space-between;padding-top:10px;border-top:1px solid var(--border-light);}
.ms-kb-avatars{display:flex;}
.ms-kb-avatars>div{width:24px;height:24px;border-radius:6px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:9px;color:#fff;margin-left:-4px;border:2px solid var(--surface);}
.ms-kb-avatars>div:first-child{margin-left:0;}
.ms-kb-match{font-size:11px;font-weight:600;color:var(--accent);display:flex;align-items:center;gap:4px;}
/* DRAWER */
.ms-dov{display:none;position:fixed;inset:0;background:rgba(26,29,46,0.35);backdrop-filter:blur(6px);z-index:300;}
.ms-dov.on{display:block;}
.ms-dw{position:fixed;top:0;right:-600px;bottom:0;width:580px;max-width:94vw;background:var(--surface);z-index:301;transition:right 0.4s cubic-bezier(0.4,0,0.2,1);overflow-y:auto;box-shadow:-20px 0 60px rgba(26,29,46,0.12);}
.ms-dw.on{right:0;}
.ms-dw-head{position:sticky;top:0;z-index:2;background:rgba(255,255,255,0.92);backdrop-filter:blur(16px);padding:20px 28px;border-bottom:1px solid var(--border-light);display:flex;align-items:center;justify-content:space-between;}
.ms-dw-x{width:38px;height:38px;border-radius:10px;border:none;background:var(--bg);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text-secondary);transition:var(--transition);font-size:18px;}
.ms-dw-x:hover{background:var(--red-bg);color:var(--red);}
.ms-dw-body{padding:28px;}
.ms-dw-m-header{margin-bottom:24px;}
.ms-dw-m-title{font-size:22px;font-weight:800;letter-spacing:-0.3px;display:flex;align-items:center;gap:10px;}
.ms-dw-m-client{font-size:14px;color:var(--text-secondary);margin-top:4px;display:flex;align-items:center;gap:6px;}
.ms-dw-m-status{margin-top:10px;}
.ms-dw-quick{display:flex;gap:8px;margin-bottom:24px;}
.ms-dw-qbtn{flex:1;padding:11px;border-radius:var(--radius-sm);border:1.5px solid var(--border);background:var(--surface);font-family:inherit;font-size:12px;font-weight:700;cursor:pointer;transition:var(--transition);display:flex;align-items:center;justify-content:center;gap:6px;color:var(--text-secondary);}
.ms-dw-qbtn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.ms-dw-qbtn.primary{background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;border:none;box-shadow:0 4px 16px rgba(108,92,231,0.2);}
.ms-dw-sec{margin-bottom:24px;}
.ms-dw-sec-t{font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:1.2px;color:var(--text-tertiary);margin-bottom:12px;}
.ms-dw-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.ms-dw-it{padding:12px 16px;background:var(--bg);border-radius:var(--radius-sm);}
.ms-dw-it-l{font-size:11px;color:var(--text-tertiary);}
.ms-dw-it-v{font-size:14px;font-weight:700;margin-top:3px;}
.ms-dw-chips{display:flex;flex-wrap:wrap;gap:6px;}
.ms-tag{padding:3px 10px;border-radius:50px;font-size:11px;font-weight:700;background:var(--green-bg);color:var(--green);}
.ms-dw-cand{display:flex;align-items:center;gap:12px;padding:14px;background:var(--bg);border-radius:var(--radius-sm);margin-bottom:8px;transition:var(--transition);cursor:pointer;}
.ms-dw-cand:hover{background:var(--accent-bg);}
.ms-dw-cand-av{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;color:#fff;flex-shrink:0;}
.ms-dw-cand-info{flex:1;}
.ms-dw-cand-nm{font-size:13px;font-weight:700;}
.ms-dw-cand-rl{font-size:11px;color:var(--text-secondary);}
.ms-dw-cand-status{font-size:11px;font-weight:600;padding:3px 10px;border-radius:20px;flex-shrink:0;}
.ms-h-btn{height:40px;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-sm);border:1px solid var(--border);background:var(--surface);cursor:pointer;transition:var(--transition);color:var(--text-secondary);padding:0 16px;gap:8px;font-family:inherit;font-size:13px;font-weight:600;}
.ms-h-btn:hover{border-color:var(--accent-light);color:var(--accent);background:var(--accent-bg);}
.ms-h-btn-primary{background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;border:none;box-shadow:0 4px 20px rgba(108,92,231,0.2);}
.ms-h-btn-primary:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(108,92,231,0.3);color:#fff;background:linear-gradient(135deg,var(--accent),#8B7CF6);}
.ms-urg-pills{display:flex;gap:8px;}
.ms-urg-pill{padding:8px 16px;border-radius:50px;border:1.5px solid var(--border);background:var(--surface);font-size:12px;font-weight:600;cursor:pointer;transition:var(--transition);display:flex;align-items:center;gap:6px;color:var(--text-secondary);}
.ms-urg-pill:hover{border-color:var(--accent);}
.ms-urg-pill.on.high{border-color:var(--red);background:var(--red-bg);color:var(--red);}
.ms-urg-pill.on.med{border-color:var(--orange);background:var(--orange-bg);color:var(--orange);}
.ms-urg-pill.on.low{border-color:var(--green);background:var(--green-bg);color:var(--green);}
@media(max-width:1100px){.ms-kanban{grid-template-columns:repeat(2,1fr);}}

/* ========================================== */
/* CONTRATS PAGE STYLES                       */
/* ========================================== */
#page-contrats .ct-toolbar{display:flex;align-items:center;gap:10px;margin-bottom:20px;flex-wrap:wrap;}
#page-contrats .ct-search{display:flex;align-items:center;gap:8px;padding:9px 18px;border-radius:50px;border:1.5px solid var(--border);background:var(--surface);transition:var(--transition);min-width:260px;}
#page-contrats .ct-search:focus-within{border-color:var(--accent);box-shadow:0 0 0 4px var(--accent-glow);}
#page-contrats .ct-search input{border:none;outline:none;font-family:inherit;font-size:13px;width:100%;background:transparent;}
#page-contrats .ct-search input::placeholder{color:var(--text-tertiary);}
.ct-pill{padding:8px 16px;border-radius:50px;font-size:12.5px;font-weight:600;cursor:pointer;transition:var(--transition);border:1.5px solid var(--border);background:var(--surface);color:var(--text-secondary);user-select:none;white-space:nowrap;}
.ct-pill:hover{border-color:var(--accent);color:var(--accent);}
.ct-pill.on{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 4px 16px rgba(108,92,231,0.2);}
.ct-tcard{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;animation:fadeUp 0.5s ease backwards;}
#page-contrats .ct-tcard table{width:100%;border-collapse:collapse;font-size:13px;}
#page-contrats .ct-tcard thead{background:var(--surface-hover);}
#page-contrats .ct-tcard th{padding:12px 16px;text-align:left;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.8px;color:var(--text-tertiary);border-bottom:1px solid var(--border);white-space:nowrap;user-select:none;}
#page-contrats .ct-tcard td{padding:14px 16px;border-bottom:1px solid var(--border-light);vertical-align:middle;}
#page-contrats .ct-tcard tr{transition:var(--transition);cursor:pointer;}
#page-contrats .ct-tcard tbody tr:hover{background:var(--surface-hover);}
#page-contrats .ct-tcard tr:last-child td{border-bottom:none;}
.ct-td-c{display:flex;align-items:center;gap:12px;}
.ct-td-av{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;color:#fff;flex-shrink:0;}
.ct-td-nm{font-size:13.5px;font-weight:700;}
.ct-td-sub{font-size:11.5px;color:var(--text-secondary);}
.ct-td-client{display:flex;align-items:center;gap:8px;}
.ct-td-cl-logo{width:28px;height:28px;border-radius:8px;display:flex;align-items:center;justify-content:center;font-size:14px;flex-shrink:0;}
.ct-td-cl-nm{font-size:13px;font-weight:600;}
.ct-st-badge{padding:5px 12px;border-radius:20px;font-size:11px;font-weight:700;display:inline-flex;align-items:center;gap:5px;white-space:nowrap;}
.ct-st-active{background:var(--green-bg);color:var(--green);}
.ct-st-pending{background:var(--orange-bg);color:var(--orange);}
.ct-st-ended{background:var(--border-light);color:var(--text-tertiary);}
.ct-st-sign{background:var(--blue-bg);color:var(--blue);}
.ct-st-avenant{background:#FDE8F3;color:#E84393;}
.ct-td-dates{font-size:12px;color:var(--text-secondary);white-space:nowrap;}
.ct-td-dates b{color:var(--text-primary);font-weight:600;}
.ct-td-bar{display:flex;align-items:center;gap:8px;}
.ct-progress-bar{width:80px;height:6px;background:var(--border-light);border-radius:10px;overflow:hidden;}
.ct-progress-fill{height:100%;border-radius:10px;transition:width 0.8s ease;}
.ct-progress-pct{font-family:'Space Mono',monospace;font-size:11px;font-weight:700;min-width:28px;}
.ct-td-avenant{font-family:'Space Mono',monospace;font-size:12px;font-weight:700;display:flex;align-items:center;gap:4px;}
.ct-act-btn{width:30px;height:30px;border-radius:8px;border:1px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--transition);font-size:13px;color:var(--text-tertiary);}
.ct-act-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.ct-act-btn.warn:hover{border-color:var(--orange);color:var(--orange);background:var(--orange-bg);}
.ct-act-btn.aven{border-color:#E84393;color:#E84393;background:#FDE8F3;}
.ct-act-btn.aven:hover{box-shadow:0 2px 12px rgba(232,67,147,0.2);}
.ct-pagination{display:flex;align-items:center;justify-content:space-between;padding:16px 24px;border-top:1px solid var(--border-light);}
.ct-dov{display:none;position:fixed;inset:0;background:rgba(26,29,46,0.35);backdrop-filter:blur(6px);z-index:300;}
.ct-dov.on{display:block;}
.ct-dw{position:fixed;top:0;right:-600px;bottom:0;width:580px;max-width:94vw;background:var(--surface);z-index:301;transition:right 0.4s cubic-bezier(0.4,0,0.2,1);overflow-y:auto;box-shadow:-20px 0 60px rgba(26,29,46,0.12);}
.ct-dw.on{right:0;}
.ct-dw-head{position:sticky;top:0;z-index:2;background:rgba(255,255,255,0.92);backdrop-filter:blur(16px);padding:20px 28px;border-bottom:1px solid var(--border-light);display:flex;align-items:center;justify-content:space-between;}
.ct-dw-x{width:38px;height:38px;border-radius:10px;border:none;background:var(--bg);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text-secondary);transition:var(--transition);font-size:18px;}
.ct-dw-x:hover{background:var(--red-bg);color:var(--red);}
.ct-dw-body{padding:28px;}
.ct-dw-hero{display:flex;gap:14px;align-items:center;padding:20px;background:linear-gradient(135deg,var(--accent) 0%,#8B7CF6 100%);border-radius:var(--radius);color:#fff;margin-bottom:24px;}
.ct-dw-av{width:52px;height:52px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:19px;background:rgba(255,255,255,0.2);flex-shrink:0;}
.ct-dw-nm{font-size:18px;font-weight:800;}
.ct-dw-rl{font-size:13px;opacity:0.85;margin-top:2px;}
.ct-dw-num{font-family:'Space Mono',monospace;font-size:11px;opacity:0.7;margin-top:4px;}
.ct-tl-bar{margin-bottom:24px;}
.ct-tl-bar-label{display:flex;justify-content:space-between;font-size:11px;color:var(--text-tertiary);margin-bottom:6px;}
.ct-tl-bar-track{height:10px;background:var(--border-light);border-radius:10px;overflow:hidden;}
.ct-tl-bar-fill{height:100%;border-radius:10px;transition:width 1s ease;}
.ct-dw-sec{margin-bottom:24px;}
.ct-dw-sec-t{font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:1.2px;color:var(--text-tertiary);margin-bottom:12px;display:flex;align-items:center;justify-content:space-between;}
.ct-dw-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.ct-dw-it{padding:12px 16px;background:var(--bg);border-radius:var(--radius-sm);}
.ct-dw-it-l{font-size:11px;color:var(--text-tertiary);}
.ct-dw-it-v{font-size:14px;font-weight:700;margin-top:3px;}
.ct-aven-list{display:flex;flex-direction:column;gap:10px;}
.ct-aven-card{padding:16px 18px;border:1.5px solid var(--border);border-radius:var(--radius-sm);position:relative;transition:var(--transition);}
.ct-aven-card:hover{border-color:var(--accent-light);}
.ct-aven-card-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:8px;}
.ct-aven-num{font-size:12px;font-weight:700;color:#E84393;}
.ct-aven-date{font-size:11px;color:var(--text-tertiary);}
.ct-aven-type{font-size:13px;font-weight:700;}
.ct-aven-detail{font-size:12px;color:var(--text-secondary);margin-top:4px;line-height:1.5;}
.ct-aven-badge{display:inline-flex;padding:3px 8px;border-radius:12px;font-size:10px;font-weight:700;margin-top:6px;}
.ct-quick-aven{display:grid;grid-template-columns:repeat(2,1fr);gap:8px;margin-bottom:24px;}
.ct-qa-btn{padding:16px;border:1.5px solid var(--border);border-radius:var(--radius);cursor:pointer;transition:var(--transition);text-align:center;background:var(--surface);}
.ct-qa-btn:hover{border-color:#E84393;background:#FDE8F3;transform:translateY(-2px);box-shadow:0 4px 16px rgba(232,67,147,0.1);}
.ct-qa-ico{font-size:24px;margin-bottom:6px;}
.ct-qa-t{font-size:13px;font-weight:700;}
.ct-qa-d{font-size:10.5px;color:var(--text-tertiary);margin-top:2px;}
.ct-h-btn{height:40px;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-sm);border:1px solid var(--border);background:var(--surface);cursor:pointer;transition:var(--transition);color:var(--text-secondary);padding:0 16px;gap:8px;font-family:inherit;font-size:13px;font-weight:600;}
.ct-h-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.ct-h-btn-primary{background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;border:none;box-shadow:0 4px 20px rgba(108,92,231,0.2);}
.ct-h-btn-primary:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(108,92,231,0.3);color:#fff;background:linear-gradient(135deg,var(--accent),#8B7CF6);}
.ct-btn-p{padding:10px 24px;border:none;border-radius:var(--radius-sm);background:linear-gradient(135deg,#E84393,#c44dcc);color:#fff;font-family:inherit;font-size:14px;font-weight:700;cursor:pointer;transition:var(--transition);box-shadow:0 4px 20px rgba(232,67,147,0.2);}
.ct-btn-p:hover{transform:translateY(-1px);}
.ct-btn-ac{padding:10px 24px;border:none;border-radius:var(--radius-sm);background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;font-family:inherit;font-size:14px;font-weight:700;cursor:pointer;transition:var(--transition);box-shadow:0 4px 20px rgba(108,92,231,0.2);}
.ct-btn-ac:hover{transform:translateY(-1px);}

/* ========================================== */
/* DASHBOARD PAGE STYLES                      */
/* ========================================== */
.db-kpi-grid{display:grid;grid-template-columns:repeat(4,1fr);gap:18px;margin-bottom:28px;}
.db-kpi-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:22px 24px;transition:var(--transition);cursor:default;position:relative;overflow:hidden;animation:fadeUp 0.5s ease backwards;}
.db-kpi-card::after{content:'';position:absolute;top:0;left:0;right:0;height:3px;border-radius:var(--radius) var(--radius) 0 0;opacity:0;transition:var(--transition);}
.db-kpi-card:hover{box-shadow:0 4px 20px rgba(26,29,46,0.06);transform:translateY(-2px);}
.db-kpi-card:hover::after{opacity:1;}
.db-kpi-card:nth-child(1)::after{background:linear-gradient(90deg,var(--accent),var(--accent-light));}
.db-kpi-card:nth-child(2)::after{background:linear-gradient(90deg,var(--blue),#74B9FF);}
.db-kpi-card:nth-child(3)::after{background:linear-gradient(90deg,var(--green),#55E6A5);}
.db-kpi-card:nth-child(4)::after{background:linear-gradient(90deg,var(--orange),#FDCB6E);}
.db-kpi-card:nth-child(1){animation-delay:0.05s;}
.db-kpi-card:nth-child(2){animation-delay:0.1s;}
.db-kpi-card:nth-child(3){animation-delay:0.15s;}
.db-kpi-card:nth-child(4){animation-delay:0.2s;}
.db-kpi-header{display:flex;align-items:center;justify-content:space-between;margin-bottom:14px;}
.db-kpi-icon{width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:20px;}
.db-kpi-card:nth-child(1) .db-kpi-icon{background:var(--accent-bg);color:var(--accent);}
.db-kpi-card:nth-child(2) .db-kpi-icon{background:var(--blue-bg);color:var(--blue);}
.db-kpi-card:nth-child(3) .db-kpi-icon{background:var(--green-bg);color:var(--green);}
.db-kpi-card:nth-child(4) .db-kpi-icon{background:var(--orange-bg);color:var(--orange);}
.db-kpi-trend{display:flex;align-items:center;gap:4px;font-size:12px;font-weight:600;padding:3px 8px;border-radius:20px;}
.db-kpi-trend.up{color:var(--green);background:var(--green-bg);}
.db-kpi-trend.down{color:var(--red);background:var(--red-bg);}
.db-kpi-value{font-size:32px;font-weight:700;letter-spacing:-1px;line-height:1;margin-bottom:4px;}
.db-kpi-label{font-size:13px;color:var(--text-secondary);font-weight:500;}
.db-grid{display:grid;grid-template-columns:1fr 380px;gap:22px;}
.db-left-col{display:flex;flex-direction:column;gap:22px;}
.db-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;animation:fadeUp 0.5s ease backwards;animation-delay:0.25s;}
.db-card-header{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:1px solid var(--border-light);}
.db-card-title{font-size:15px;font-weight:700;display:flex;align-items:center;gap:8px;}
.db-card-action{font-size:12px;color:var(--accent);font-weight:600;cursor:pointer;padding:5px 12px;border-radius:20px;transition:var(--transition);}
.db-card-action:hover{background:var(--accent-bg);}
.db-activity-list{padding:8px 0;}
.db-activity-item{display:flex;align-items:flex-start;gap:14px;padding:14px 24px;transition:var(--transition);cursor:default;}
.db-activity-item:hover{background:var(--surface-hover);}
.db-activity-dot{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;flex-shrink:0;font-size:15px;margin-top:2px;}
.db-activity-dot.purple{background:var(--accent-bg);}
.db-activity-dot.blue{background:var(--blue-bg);}
.db-activity-dot.green{background:var(--green-bg);}
.db-activity-dot.orange{background:var(--orange-bg);}
.db-activity-content{flex:1;}
.db-activity-text{font-size:13.5px;line-height:1.5;color:var(--text-primary);}
.db-activity-text strong{font-weight:600;color:var(--accent);}
.db-activity-time{font-size:11.5px;color:var(--text-tertiary);margin-top:3px;}
.db-missions-list{padding:8px 0;}
.db-mission-item{display:flex;align-items:center;gap:14px;padding:14px 24px;transition:var(--transition);cursor:pointer;}
.db-mission-item:hover{background:var(--surface-hover);}
.db-mission-urgency{width:4px;height:40px;border-radius:4px;flex-shrink:0;}
.db-mission-urgency.high{background:var(--red);}
.db-mission-urgency.medium{background:var(--orange);}
.db-mission-urgency.low{background:var(--green);}
.db-mission-info{flex:1;}
.db-mission-title{font-size:13.5px;font-weight:600;}
.db-mission-meta{font-size:12px;color:var(--text-secondary);margin-top:3px;display:flex;align-items:center;gap:12px;}
.db-mission-match{display:flex;align-items:center;gap:6px;font-size:12px;font-weight:600;color:var(--accent);background:var(--accent-bg);padding:4px 10px;border-radius:20px;flex-shrink:0;}
.db-candidates-table{width:100%;}
.db-candidates-table th{text-align:left;padding:12px 24px;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.8px;color:var(--text-tertiary);background:var(--surface-hover);border-bottom:1px solid var(--border-light);}
.db-candidates-table td{padding:14px 24px;font-size:13.5px;border-bottom:1px solid var(--border-light);vertical-align:middle;}
.db-candidates-table tr:last-child td{border-bottom:none;}
.db-candidates-table tr:hover td{background:var(--surface-hover);}
.db-candidate-cell{display:flex;align-items:center;gap:12px;}
.db-candidate-avatar{width:34px;height:34px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:12px;color:white;flex-shrink:0;}
.db-candidate-name{font-weight:600;}
.db-score-bar{display:flex;align-items:center;gap:8px;}
.db-score-track{flex:1;height:6px;background:var(--bg);border-radius:10px;overflow:hidden;min-width:60px;}
.db-score-fill{height:100%;border-radius:10px;transition:width 0.6s cubic-bezier(0.4,0,0.2,1);}
.db-score-value{font-size:13px;font-weight:700;font-family:'Space Mono',monospace;min-width:32px;}
.db-status-badge{display:inline-flex;align-items:center;gap:5px;padding:4px 10px;border-radius:20px;font-size:12px;font-weight:600;}
.db-status-badge.available{background:var(--green-bg);color:var(--green);}
.db-status-badge.pending{background:var(--orange-bg);color:var(--orange);}
.db-status-badge.placed{background:var(--blue-bg);color:var(--blue);}
.db-status-dot{width:6px;height:6px;border-radius:50%;background:currentColor;}
.db-chat-widget{position:fixed;bottom:28px;right:28px;z-index:200;}
.db-chat-bubble{width:60px;height:60px;background:linear-gradient(135deg,var(--accent),#8B7CF6);border-radius:20px;display:flex;align-items:center;justify-content:center;cursor:pointer;box-shadow:0 4px 24px rgba(108,92,231,0.18),0 8px 32px rgba(108,92,231,0.3);transition:var(--transition);color:white;font-size:24px;}
.db-chat-bubble:hover{transform:scale(1.08);box-shadow:0 4px 24px rgba(108,92,231,0.18),0 12px 40px rgba(108,92,231,0.4);}
.db-chat-bubble .db-pulse{position:absolute;width:60px;height:60px;border-radius:20px;background:var(--accent);animation:dbPulse 2s ease-in-out infinite;z-index:-1;}
@keyframes dbPulse{0%,100%{opacity:0;transform:scale(1);}50%{opacity:0.3;transform:scale(1.3);}}
.db-chat-panel{position:absolute;bottom:72px;right:0;width:400px;height:520px;background:var(--surface);border-radius:var(--radius);border:1px solid var(--border);box-shadow:0 8px 40px rgba(26,29,46,0.08);display:none;flex-direction:column;overflow:hidden;animation:dbChatSlide 0.3s cubic-bezier(0.34,1.56,0.64,1);}
.db-chat-panel.open{display:flex;}
@keyframes dbChatSlide{from{opacity:0;transform:translateY(12px) scale(0.96);}to{opacity:1;transform:translateY(0) scale(1);}}
.db-chat-header{padding:18px 22px;border-bottom:1px solid var(--border-light);display:flex;align-items:center;gap:12px;background:linear-gradient(135deg,rgba(108,92,231,0.04),rgba(74,144,217,0.04));}
.db-chat-ai-avatar{width:38px;height:38px;background:linear-gradient(135deg,var(--accent),var(--accent-light));border-radius:12px;display:flex;align-items:center;justify-content:center;color:white;font-size:18px;}
.db-chat-ai-info{flex:1;}
.db-chat-ai-name{font-size:14px;font-weight:700;}
.db-chat-ai-status{font-size:11.5px;color:var(--green);display:flex;align-items:center;gap:5px;}
.db-chat-ai-status::before{content:'';width:6px;height:6px;background:var(--green);border-radius:50%;}
.db-chat-close{width:32px;height:32px;display:flex;align-items:center;justify-content:center;border-radius:8px;cursor:pointer;color:var(--text-tertiary);transition:var(--transition);border:none;background:none;}
.db-chat-close:hover{background:var(--bg);color:var(--text-primary);}
.db-chat-messages{flex:1;padding:20px;display:flex;flex-direction:column;gap:16px;overflow-y:auto;}
.db-msg{max-width:85%;padding:12px 16px;border-radius:16px;font-size:13.5px;line-height:1.55;}
.db-msg.ai{background:var(--bg);border-bottom-left-radius:4px;align-self:flex-start;}
.db-msg.user{background:linear-gradient(135deg,var(--accent),#8B7CF6);color:white;border-bottom-right-radius:4px;align-self:flex-end;}
.db-chat-suggestions{display:flex;flex-wrap:wrap;gap:6px;padding:0 20px 12px;}
.db-chat-suggestion{padding:7px 14px;border:1px solid var(--border);border-radius:20px;font-size:12px;color:var(--text-secondary);cursor:pointer;transition:var(--transition);background:var(--surface);}
.db-chat-suggestion:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.db-chat-input-area{padding:16px 20px;border-top:1px solid var(--border-light);display:flex;align-items:center;gap:10px;}
.db-chat-input{flex:1;border:1px solid var(--border);border-radius:12px;padding:11px 16px;font-size:13.5px;font-family:inherit;outline:none;transition:var(--transition);background:var(--bg);}
.db-chat-input:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-glow);background:var(--surface);}
.db-chat-input::placeholder{color:var(--text-tertiary);}
.db-chat-voice-btn{width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:12px;border:1px solid var(--border);background:var(--surface);cursor:pointer;transition:var(--transition);color:var(--text-secondary);}
.db-chat-voice-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.db-chat-send-btn{width:40px;height:40px;display:flex;align-items:center;justify-content:center;border-radius:12px;border:none;background:linear-gradient(135deg,var(--accent),#8B7CF6);cursor:pointer;color:white;transition:var(--transition);box-shadow:0 4px 24px rgba(108,92,231,0.18);}
.db-chat-send-btn:hover{transform:scale(1.05);box-shadow:0 4px 20px rgba(108,92,231,0.35);}
.db-header-search{display:flex;align-items:center;gap:8px;padding:9px 16px;background:var(--bg);border:1px solid var(--border);border-radius:var(--radius-sm);font-size:13px;color:var(--text-tertiary);cursor:pointer;transition:var(--transition);min-width:220px;}
.db-header-search:hover{border-color:var(--accent-light);box-shadow:0 0 0 3px var(--accent-glow);}
.db-header-search kbd{background:var(--surface);border:1px solid var(--border);border-radius:4px;padding:1px 6px;font-size:11px;font-family:'Space Mono',monospace;margin-left:auto;}
.db-activity-item{animation:fadeUp 0.4s ease backwards;}
.db-activity-item:nth-child(1){animation-delay:0.3s;}
.db-activity-item:nth-child(2){animation-delay:0.36s;}
.db-activity-item:nth-child(3){animation-delay:0.42s;}
.db-activity-item:nth-child(4){animation-delay:0.48s;}
.db-activity-item:nth-child(5){animation-delay:0.54s;}
.db-activity-item:nth-child(6){animation-delay:0.60s;}

/* ========================================== */
/* CANDIDATS PAGE STYLES                      */
/* ========================================== */
#page-candidats .toolbar{display:flex;align-items:center;gap:10px;margin-bottom:20px;flex-wrap:wrap;}
#page-candidats .search-box{display:flex;align-items:center;gap:8px;padding:9px 18px;border-radius:50px;border:1.5px solid var(--border);background:var(--surface);transition:var(--transition);min-width:280px;}
#page-candidats .search-box:focus-within{border-color:var(--accent);box-shadow:0 0 0 4px var(--accent-glow);}
#page-candidats .search-box input{border:none;outline:none;font-family:inherit;font-size:13px;width:100%;background:transparent;}
#page-candidats .search-box input::placeholder{color:var(--text-tertiary);}
#page-candidats .cd-pill{padding:8px 16px;border-radius:50px;font-size:12.5px;font-weight:600;cursor:pointer;transition:var(--transition);border:1.5px solid var(--border);background:var(--surface);color:var(--text-secondary);user-select:none;white-space:nowrap;}
#page-candidats .cd-pill:hover{border-color:var(--accent);color:var(--accent);}
#page-candidats .cd-pill.on{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 4px 16px rgba(108,92,231,0.2);}
.toolbar-sep{width:1px;height:28px;background:var(--border);}
.toolbar-right{margin-left:auto;display:flex;align-items:center;gap:8px;}
.view-toggle{display:flex;border:1.5px solid var(--border);border-radius:var(--radius-sm);overflow:hidden;}
.view-btn{padding:8px 14px;cursor:pointer;transition:var(--transition);background:var(--surface);color:var(--text-tertiary);display:flex;align-items:center;gap:5px;font-size:12px;font-weight:600;}
.view-btn:hover{color:var(--accent);}
.view-btn.on{background:var(--accent-bg);color:var(--accent);}
.table-card{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);overflow:hidden;animation:fadeUp 0.5s ease backwards;}
.table-wrap{overflow-x:auto;}
#page-candidats table{width:100%;border-collapse:collapse;font-size:13px;}
#page-candidats thead{background:var(--surface-hover);}
#page-candidats th{padding:12px 16px;text-align:left;font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.8px;color:var(--text-tertiary);border-bottom:1px solid var(--border);white-space:nowrap;cursor:pointer;user-select:none;transition:var(--transition);}
#page-candidats th:hover{color:var(--accent);}
#page-candidats td{padding:14px 16px;border-bottom:1px solid var(--border-light);vertical-align:middle;}
#page-candidats tr{transition:var(--transition);cursor:pointer;}
#page-candidats tbody tr:hover{background:var(--surface-hover);}
#page-candidats tr:last-child td{border-bottom:none;}
.td-candidate{display:flex;align-items:center;gap:12px;}
.td-av{width:38px;height:38px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:13px;color:#fff;flex-shrink:0;}
.td-info{min-width:0;}
.td-nm{font-size:13.5px;font-weight:700;}
.td-role{font-size:11.5px;color:var(--text-secondary);}
.td-tags{display:flex;flex-wrap:wrap;gap:4px;}
.cd-tag{padding:3px 9px;border-radius:50px;font-size:10.5px;font-weight:700;}
.cd-tag.g{background:var(--green-bg);color:var(--green);}
.cd-tag.o{background:var(--orange-bg);color:var(--orange);}
.cd-tag.b{background:var(--blue-bg);color:var(--blue);}
.cd-tag.p{background:var(--accent-bg);color:var(--accent);}
.cd-tag.pk{background:#FDE8F3;color:#E84393;}
.td-score{display:flex;align-items:center;gap:8px;}
.score-bar{width:60px;height:6px;background:var(--border-light);border-radius:10px;overflow:hidden;}
.score-fill{height:100%;border-radius:10px;transition:width 0.8s ease;}
.score-val{font-family:'Space Mono',monospace;font-size:12px;font-weight:700;min-width:28px;}
.td-status{padding:5px 12px;border-radius:20px;font-size:11px;font-weight:700;display:inline-flex;align-items:center;gap:5px;white-space:nowrap;}
.st-dispo{background:var(--green-bg);color:var(--green);}
.st-mission{background:var(--blue-bg);color:var(--blue);}
.st-indispo{background:var(--red-bg);color:var(--red);}
.st-attente{background:var(--orange-bg);color:var(--orange);}
.td-actions{display:flex;gap:5px;}
.act-btn{width:30px;height:30px;border-radius:8px;border:1px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--transition);font-size:13px;color:var(--text-tertiary);}
.act-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.td-date{font-size:12px;color:var(--text-tertiary);white-space:nowrap;}
.td-loc{font-size:12px;color:var(--text-secondary);display:flex;align-items:center;gap:4px;}
.cd-grid-view{display:none;grid-template-columns:repeat(auto-fill,minmax(290px,1fr));gap:16px;}
.cd-grid-view.on{display:grid;}
.table-card.off{display:none;}
.g-card{background:var(--surface);border:1.5px solid var(--border);border-radius:var(--radius);overflow:hidden;transition:var(--transition);cursor:pointer;animation:fadeUp 0.4s ease backwards;}
.g-card:hover{transform:translateY(-4px);box-shadow:0 8px 30px rgba(26,29,46,0.07);border-color:rgba(108,92,231,0.15);}
.g-card-top{padding:20px 20px 14px;display:flex;gap:14px;align-items:flex-start;}
.g-av{width:50px;height:50px;border-radius:14px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:17px;color:#fff;flex-shrink:0;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
.g-info{flex:1;min-width:0;}
.g-nm{font-size:15px;font-weight:800;letter-spacing:-0.2px;}
.g-rl{font-size:12.5px;color:var(--text-secondary);margin-top:1px;}
.g-meta{display:flex;gap:8px;margin-top:6px;flex-wrap:wrap;}
.g-meta-i{font-size:11px;color:var(--text-tertiary);display:flex;align-items:center;gap:3px;}
.g-score{display:flex;flex-direction:column;align-items:center;flex-shrink:0;gap:2px;}
.g-ring{position:relative;width:48px;height:48px;}
.g-ring svg{transform:rotate(-90deg);width:48px;height:48px;}
.g-ring-bg{fill:none;stroke:var(--border-light);stroke-width:4.5;}
.g-ring-fg{fill:none;stroke-width:4.5;stroke-linecap:round;transition:stroke-dashoffset 1s ease;}
.g-ring-t{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-family:'Space Mono',monospace;font-size:12px;font-weight:700;}
.g-ring-l{font-size:8px;color:var(--text-tertiary);font-weight:700;text-transform:uppercase;letter-spacing:0.5px;}
.g-tags{padding:0 20px 14px;display:flex;flex-wrap:wrap;gap:4px;}
.g-bottom{padding:12px 20px;border-top:1px solid var(--border-light);display:flex;align-items:center;justify-content:space-between;}
.g-status{padding:4px 10px;border-radius:20px;font-size:11px;font-weight:700;}
.g-actions{display:flex;gap:5px;}
.cd-pagination{display:flex;align-items:center;justify-content:space-between;padding:16px 24px;border-top:1px solid var(--border-light);}
.pag-info{font-size:12.5px;color:var(--text-secondary);}
.pag-btns{display:flex;gap:4px;}
.pag-btn{width:34px;height:34px;border-radius:8px;border:1px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--transition);font-size:13px;font-weight:600;color:var(--text-secondary);}
.pag-btn:hover{border-color:var(--accent);color:var(--accent);}
.pag-btn.on{background:var(--accent);color:#fff;border-color:var(--accent);}
.cd-dov{display:none;position:fixed;inset:0;background:rgba(26,29,46,0.35);backdrop-filter:blur(6px);z-index:300;}
.cd-dov.on{display:block;}
.cd-dw{position:fixed;top:0;right:-560px;bottom:0;width:540px;max-width:94vw;background:var(--surface);z-index:301;transition:right 0.4s cubic-bezier(0.4,0,0.2,1);overflow-y:auto;box-shadow:-20px 0 60px rgba(26,29,46,0.12);}
.cd-dw.on{right:0;}
.cd-dw-head{position:sticky;top:0;z-index:2;background:rgba(255,255,255,0.92);backdrop-filter:blur(16px);padding:20px 28px;border-bottom:1px solid var(--border-light);display:flex;align-items:center;justify-content:space-between;}
.cd-dw-x{width:38px;height:38px;border-radius:10px;border:none;background:var(--bg);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text-secondary);transition:var(--transition);font-size:18px;}
.cd-dw-x:hover{background:var(--red-bg);color:var(--red);}
.cd-dw-profile{padding:28px;}
.cd-dw-hero{display:flex;gap:18px;align-items:center;margin-bottom:24px;}
.cd-dw-av{width:72px;height:72px;border-radius:20px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:26px;color:#fff;box-shadow:0 6px 20px rgba(0,0,0,0.12);}
.cd-dw-nm{font-size:22px;font-weight:800;letter-spacing:-0.3px;}
.cd-dw-rl{font-size:14px;color:var(--text-secondary);margin-top:3px;}
.cd-dw-quick{display:flex;gap:8px;margin-bottom:28px;}
.cd-dw-qbtn{flex:1;padding:11px;border-radius:var(--radius-sm);border:1.5px solid var(--border);background:var(--surface);font-family:inherit;font-size:12px;font-weight:700;cursor:pointer;transition:var(--transition);display:flex;align-items:center;justify-content:center;gap:6px;color:var(--text-secondary);}
.cd-dw-qbtn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.cd-dw-qbtn.primary{background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;border:none;box-shadow:0 4px 16px rgba(108,92,231,0.2);}
.cd-dw-qbtn.primary:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(108,92,231,0.3);}
.cd-dw-sec{margin-bottom:24px;}
.cd-dw-sec-t{font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:1.2px;color:var(--text-tertiary);margin-bottom:12px;}
.cd-dw-grid{display:grid;grid-template-columns:1fr 1fr;gap:8px;}
.cd-dw-it{padding:12px 16px;background:var(--bg);border-radius:var(--radius-sm);}
.cd-dw-it-l{font-size:11px;color:var(--text-tertiary);}
.cd-dw-it-v{font-size:14px;font-weight:700;margin-top:3px;}
.cd-dw-chips{display:flex;flex-wrap:wrap;gap:6px;}
.cd-dw-exp-i{padding:14px 16px;background:var(--bg);border-radius:var(--radius-sm);margin-bottom:8px;border-left:3px solid var(--accent);}
.cd-dw-exp-t{font-size:14px;font-weight:700;}
.cd-dw-exp-c{font-size:12.5px;color:var(--text-secondary);margin-top:2px;}
.cd-dw-exp-p{font-size:11.5px;color:var(--text-tertiary);margin-top:3px;}
.cd-dw-timeline{display:flex;flex-direction:column;gap:0;}
.cd-dw-tl-item{display:flex;gap:12px;padding:10px 0;position:relative;}
.cd-dw-tl-dot{width:10px;height:10px;border-radius:50%;flex-shrink:0;margin-top:4px;border:2px solid var(--border);background:var(--surface);}
.cd-dw-tl-dot.gn{border-color:var(--green);background:var(--green);}
.cd-dw-tl-dot.bl{border-color:var(--blue);background:var(--blue);}
.cd-dw-tl-dot.or{border-color:var(--orange);background:var(--orange);}
.cd-dw-tl-item:not(:last-child)::before{content:'';position:absolute;left:4px;top:18px;bottom:-4px;width:2px;background:var(--border-light);}
.cd-dw-tl-msg{font-size:13px;line-height:1.5;}
.cd-dw-tl-time{font-size:11px;color:var(--text-tertiary);margin-top:2px;}
.cd-drop-zone{border:2px dashed var(--border);border-radius:var(--radius);padding:48px 24px;text-align:center;cursor:pointer;transition:var(--transition);}
.cd-drop-zone:hover,.cd-drop-zone.over{border-color:var(--accent);background:var(--accent-bg);}
.cd-drop-icon{font-size:48px;margin-bottom:12px;}
.cd-drop-title{font-size:15px;font-weight:700;margin-bottom:4px;}
.cd-drop-desc{font-size:12.5px;color:var(--text-secondary);}
.cd-drop-formats{margin-top:12px;font-size:11px;color:var(--text-tertiary);}
.cd-h-btn{height:40px;display:flex;align-items:center;justify-content:center;border-radius:var(--radius-sm);border:1px solid var(--border);background:var(--surface);cursor:pointer;transition:var(--transition);color:var(--text-secondary);padding:0 16px;gap:8px;font-family:inherit;font-size:13px;font-weight:600;}
.cd-h-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.cd-h-btn-primary{background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;border:none;box-shadow:0 4px 20px rgba(108,92,231,0.2);}
.cd-h-btn-primary:hover{transform:translateY(-1px);box-shadow:0 6px 24px rgba(108,92,231,0.3);color:#fff;background:linear-gradient(135deg,var(--accent),#8B7CF6);}

/* ========================================== */
/* PORTAIL CLIENT PAGE STYLES                 */
/* ========================================== */
.pc-topbar{background:rgba(255,255,255,0.82);backdrop-filter:blur(20px) saturate(180%);border-bottom:1px solid var(--border);padding:0 clamp(20px,4vw,48px);height:64px;display:flex;align-items:center;justify-content:space-between;}
.pc-tbl{display:flex;align-items:center;gap:14px;}
.pc-logo{width:36px;height:36px;background:linear-gradient(135deg,#FF6B6B,#FF8E53);border-radius:11px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:13px;box-shadow:0 4px 12px rgba(255,107,107,0.25);}
.pc-brand{display:flex;flex-direction:column;}
.pc-nm{font-size:16px;font-weight:800;letter-spacing:-0.3px;}
.pc-pw{font-size:9.5px;color:var(--text-tertiary);}
.pc-pw b{background:linear-gradient(135deg,var(--accent),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;font-weight:800;}
.pc-sep{width:1px;height:28px;background:var(--border);margin:0 4px;}
.pc-cl{padding:6px 14px;background:var(--accent-bg);border-radius:20px;font-size:12px;font-weight:700;color:var(--accent);display:flex;align-items:center;gap:6px;}
.pc-tbr{display:flex;align-items:center;gap:10px;}
.pc-btn{width:38px;height:38px;border-radius:var(--radius-sm);border:1px solid var(--border);background:var(--surface);display:flex;align-items:center;justify-content:center;cursor:pointer;transition:var(--transition);color:var(--text-secondary);position:relative;}
.pc-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.pc-dot{position:absolute;top:7px;right:7px;width:7px;height:7px;background:var(--red);border-radius:50%;border:2px solid #fff;}
.pc-usr{display:flex;align-items:center;gap:8px;padding:4px 10px 4px 4px;border-radius:var(--radius-sm);cursor:pointer;transition:var(--transition);}
.pc-usr:hover{background:var(--surface-hover);}
.pc-av{width:32px;height:32px;background:linear-gradient(135deg,var(--blue),#74B9FF);border-radius:10px;display:flex;align-items:center;justify-content:center;color:#fff;font-weight:800;font-size:11px;}
.pc-un{font-size:12.5px;font-weight:700;}
.pc-page{max-width:1240px;margin:0 auto;padding:28px clamp(20px,4vw,48px) 60px;}
.pc-hero{background:linear-gradient(135deg,var(--accent) 0%,#8B7CF6 50%,var(--blue) 100%);border-radius:20px;padding:36px 40px;margin-bottom:28px;color:#fff;position:relative;overflow:hidden;}
.pc-hero::before{content:'';position:absolute;top:-40%;right:-10%;width:300px;height:300px;background:radial-gradient(circle,rgba(255,255,255,0.12) 0%,transparent 70%);border-radius:50%;}
.pc-hero::after{content:'';position:absolute;bottom:-30%;left:10%;width:200px;height:200px;background:radial-gradient(circle,rgba(255,255,255,0.08) 0%,transparent 70%);border-radius:50%;}
.pc-hero-top{display:flex;align-items:center;justify-content:space-between;position:relative;z-index:1;}
.pc-hero h1{font-size:28px;font-weight:800;letter-spacing:-0.5px;}
.pc-hero p{font-size:14px;opacity:0.85;margin-top:6px;}
.pc-hero-stats{display:flex;gap:32px;margin-top:28px;position:relative;z-index:1;}
.pc-hs{text-align:center;}
.pc-hs-v{font-size:38px;font-weight:800;font-family:'Space Mono',monospace;letter-spacing:-1px;}
.pc-hs-l{font-size:11.5px;opacity:0.75;margin-top:2px;}
.pc-hero-badge{background:rgba(255,255,255,0.2);backdrop-filter:blur(8px);padding:7px 16px;border-radius:20px;font-size:12px;font-weight:700;display:flex;align-items:center;gap:6px;animation:pcGl 2s ease-in-out infinite;}
@keyframes pcGl{0%,100%{box-shadow:0 0 0 0 rgba(255,255,255,0.2);}50%{box-shadow:0 0 0 8px rgba(255,255,255,0);}}
.pc-pills{display:flex;gap:8px;margin-bottom:24px;flex-wrap:wrap;align-items:center;}
.pc-pill{padding:9px 20px;border-radius:50px;font-size:13px;font-weight:600;cursor:pointer;transition:var(--transition);border:1.5px solid var(--border);background:var(--surface);color:var(--text-secondary);user-select:none;}
.pc-pill:hover{border-color:var(--accent);color:var(--accent);}
.pc-pill.on{background:var(--accent);color:#fff;border-color:var(--accent);box-shadow:0 8px 32px rgba(108,92,231,0.20);}
.pc-pill-sep{width:1px;height:24px;background:var(--border);margin:0 4px;}
.pc-pill-s{margin-left:auto;display:flex;align-items:center;gap:8px;padding:9px 20px;border-radius:50px;border:1.5px solid var(--border);background:var(--surface);transition:var(--transition);min-width:200px;}
.pc-pill-s:focus-within{border-color:var(--accent);box-shadow:0 0 0 4px var(--accent-glow);}
.pc-pill-s input{border:none;outline:none;font-family:inherit;font-size:13px;width:100%;background:transparent;}
.pc-pill-s input::placeholder{color:var(--text-tertiary);}
.pc-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(310px,1fr));gap:20px;}
.pc-card{background:var(--surface);border-radius:20px;overflow:hidden;transition:var(--transition);cursor:pointer;border:1.5px solid var(--border);position:relative;animation:fadeUp 0.45s ease backwards;}
.pc-card:hover{transform:translateY(-5px);box-shadow:0 12px 40px rgba(27,29,42,0.09);border-color:rgba(108,92,231,0.15);}
.pc-card.nw{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-glow);}
.pc-card.nw::before{content:'✨ NOUVEAU';position:absolute;top:14px;right:14px;background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;font-size:10px;font-weight:800;padding:4px 12px;border-radius:20px;letter-spacing:0.5px;z-index:2;}
.pc-bar{height:4px;width:100%;}
.pc-bar i{display:block;height:100%;border-radius:0 0 4px 0;transition:width 1s ease;}
.pc-body{padding:22px 24px 16px;display:flex;gap:16px;align-items:flex-start;}
.pc-avatar{width:56px;height:56px;border-radius:16px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:19px;color:#fff;flex-shrink:0;position:relative;box-shadow:0 4px 12px rgba(0,0,0,0.1);}
.pc-lk{position:absolute;bottom:-3px;right:-3px;width:22px;height:22px;border-radius:50%;background:var(--surface);border:2px solid var(--border);display:flex;align-items:center;justify-content:center;font-size:11px;}
.pc-info{flex:1;min-width:0;}
.pc-cname{font-size:16.5px;font-weight:800;letter-spacing:-0.2px;}
.pc-role{font-size:13px;color:var(--text-secondary);margin-top:2px;}
.pc-chips{display:flex;flex-wrap:wrap;gap:5px;margin-top:10px;}
.pc-chip{padding:4px 11px;border-radius:50px;font-size:11px;font-weight:700;display:flex;align-items:center;gap:3px;}
.pc-chip.g{background:var(--green-bg);color:var(--green);}
.pc-chip.o{background:var(--orange-bg);color:var(--orange);}
.pc-chip.b{background:var(--blue-bg);color:var(--blue);}
.pc-pct{display:flex;flex-direction:column;align-items:center;flex-shrink:0;gap:3px;}
.pc-ring{position:relative;width:60px;height:60px;}
.pc-ring svg{transform:rotate(-90deg);width:60px;height:60px;}
.pc-ring-bg{fill:none;stroke:var(--border-light);stroke-width:5;}
.pc-ring-fg{fill:none;stroke-width:5;stroke-linecap:round;transition:stroke-dashoffset 1.2s cubic-bezier(0.4,0,0.2,1);}
.pc-ring-t{position:absolute;inset:0;display:flex;align-items:center;justify-content:center;font-family:'Space Mono',monospace;font-size:15px;font-weight:700;}
.pc-ring-l{font-size:9px;color:var(--text-tertiary);font-weight:700;text-transform:uppercase;letter-spacing:0.5px;}
.pc-avail{margin:0 24px;padding:11px 0;border-top:1px solid var(--border-light);display:flex;align-items:center;gap:9px;}
.pc-dot-av{width:10px;height:10px;border-radius:50%;flex-shrink:0;}
.pc-dot-av.g{background:var(--green);box-shadow:0 0 10px rgba(0,196,140,0.45);animation:pcPu 2s ease-in-out infinite;}
.pc-dot-av.o{background:var(--orange);}
.pc-dot-av.b{background:var(--blue);}
@keyframes pcPu{0%,100%{box-shadow:0 0 0 0 rgba(0,196,140,0.3);}50%{box-shadow:0 0 0 7px rgba(0,196,140,0);}}
.pc-at{font-size:13px;font-weight:700;}
.pc-aw{margin-left:auto;font-size:11.5px;color:var(--text-tertiary);}
.pc-act{padding:14px 24px;display:flex;gap:8px;border-top:1px solid var(--border-light);}
.pc-btn-a{flex:1;padding:11px;border-radius:var(--radius-sm);border:none;font-family:inherit;font-size:13px;font-weight:700;cursor:pointer;transition:var(--transition);display:flex;align-items:center;justify-content:center;gap:6px;}
.pc-btn-a.yes{background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;box-shadow:0 4px 16px rgba(108,92,231,0.25);}
.pc-btn-a.yes:hover{transform:translateY(-2px);box-shadow:0 8px 28px rgba(108,92,231,0.35);}
.pc-btn-a.yes:active{transform:scale(0.97);}
.pc-btn-a.done{background:var(--green-bg);color:var(--green);box-shadow:none;pointer-events:none;}
.pc-btn-a.no{background:var(--surface);color:var(--text-tertiary);border:1.5px solid var(--border) !important;}
.pc-btn-a.no:hover{border-color:var(--red) !important;color:var(--red);background:var(--red-bg);}
.pc-btn-a.see{background:var(--surface);color:var(--text-secondary);border:1.5px solid var(--border) !important;}
.pc-btn-a.see:hover{border-color:var(--accent) !important;color:var(--accent);background:var(--accent-bg);}
.pc-dov{display:none;position:fixed;inset:0;background:rgba(27,29,42,0.35);backdrop-filter:blur(6px);z-index:300;}
.pc-dov.on{display:block;}
.pc-dw{position:fixed;top:0;right:-540px;bottom:0;width:520px;max-width:94vw;background:var(--surface);z-index:301;transition:right 0.4s cubic-bezier(0.4,0,0.2,1);overflow-y:auto;box-shadow:-20px 0 60px rgba(27,29,42,0.12);}
.pc-dw.on{right:0;}
.pc-dw-head{position:sticky;top:0;z-index:2;background:rgba(255,255,255,0.92);backdrop-filter:blur(16px);padding:20px 28px;border-bottom:1px solid var(--border-light);display:flex;align-items:center;justify-content:space-between;}
.pc-dw-x{width:38px;height:38px;border-radius:10px;border:none;background:var(--bg);display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text-secondary);transition:var(--transition);font-size:18px;}
.pc-dw-x:hover{background:var(--red-bg);color:var(--red);}
.pc-dw-body{padding:32px 28px;}
.pc-dw-av{width:80px;height:80px;border-radius:22px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:28px;color:#fff;margin-bottom:18px;box-shadow:0 6px 20px rgba(0,0,0,0.12);}
.pc-dw-nm{font-size:24px;font-weight:800;letter-spacing:-0.3px;}
.pc-dw-rl{font-size:15px;color:var(--text-secondary);margin-top:4px;}
.pc-dw-anon{margin-top:18px;padding:16px 20px;background:var(--orange-bg);border-radius:var(--radius-sm);font-size:13.5px;color:var(--orange);display:flex;align-items:center;gap:10px;font-weight:600;line-height:1.5;}
.pc-dw-sec{margin-top:28px;}
.pc-dw-sec-t{font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:1.2px;color:var(--text-tertiary);margin-bottom:14px;}
.pc-dw-grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
.pc-dw-it{padding:14px 18px;background:var(--bg);border-radius:var(--radius-sm);}
.pc-dw-it-l{font-size:11px;color:var(--text-tertiary);}
.pc-dw-it-v{font-size:14.5px;font-weight:700;margin-top:4px;}
.pc-dw-chips{display:flex;flex-wrap:wrap;gap:6px;}
.pc-dw-exp-i{padding:16px 18px;background:var(--bg);border-radius:var(--radius-sm);margin-bottom:10px;border-left:3px solid var(--accent);}
.pc-dw-exp-t{font-size:14.5px;font-weight:700;}
.pc-dw-exp-c{font-size:13px;color:var(--text-secondary);margin-top:3px;}
.pc-dw-exp-p{font-size:12px;color:var(--text-tertiary);margin-top:4px;}
.pc-dw-foot{position:sticky;bottom:0;padding:20px 28px;background:rgba(255,255,255,0.94);backdrop-filter:blur(12px);border-top:1px solid var(--border-light);display:flex;gap:10px;}
.pc-dw-btn{flex:1;padding:14px;border-radius:var(--radius-sm);border:none;font-family:inherit;font-size:15px;font-weight:700;cursor:pointer;transition:var(--transition);display:flex;align-items:center;justify-content:center;gap:8px;}
.pc-dw-btn.yes{background:linear-gradient(135deg,var(--accent),#8B7CF6);color:#fff;box-shadow:0 8px 32px rgba(108,92,231,0.20);}
.pc-dw-btn.yes:hover{transform:translateY(-2px);box-shadow:0 12px 36px rgba(108,92,231,0.3);}
.pc-dw-btn.no{background:var(--bg);color:var(--text-secondary);}
.pc-dw-btn.no:hover{background:var(--red-bg);color:var(--red);}
.pc-empty{grid-column:1/-1;display:flex;flex-direction:column;align-items:center;padding:60px 20px;gap:10px;}

/* ========================================== */
/* RELANCES PAGE STYLES                       */
/* ========================================== */
.kpis{display:grid;grid-template-columns:repeat(5,1fr);gap:16px;margin-bottom:28px;}
.kpi{background:var(--surface);border:1px solid var(--border);border-radius:var(--radius);padding:20px 22px;transition:var(--transition);animation:fadeUp 0.4s ease backwards;}
.kpi:hover{box-shadow:0 4px 20px rgba(26,29,46,0.06);transform:translateY(-2px);}
.kpi-top{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;}
.kpi-icon{width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:18px;}
.kpi-trend{font-size:11px;font-weight:700;padding:3px 8px;border-radius:20px;}
.kpi-val{font-size:30px;font-weight:800;font-family:'Space Mono',monospace;letter-spacing:-1px;}
.kpi-label{font-size:12px;color:var(--text-secondary);margin-top:2px;}
.layout{display:grid;grid-template-columns:1fr 380px;gap:24px;}
.card-h{display:flex;align-items:center;justify-content:space-between;padding:20px 24px;border-bottom:1px solid var(--border-light);}
.card-t{font-size:15px;font-weight:700;display:flex;align-items:center;gap:8px;}
.card-a{font-size:12px;color:var(--accent);font-weight:600;cursor:pointer;padding:5px 12px;border-radius:20px;transition:var(--transition);}
.card-a:hover{background:var(--accent-bg);}
.campaigns{padding:16px 24px;display:flex;flex-direction:column;gap:12px;}
.camp{padding:18px 20px;border:1.5px solid var(--border);border-radius:14px;transition:var(--transition);cursor:pointer;position:relative;overflow:hidden;}
.camp:hover{border-color:rgba(108,92,231,0.2);box-shadow:0 4px 20px rgba(26,29,46,0.05);transform:translateY(-2px);}
.camp.running{border-color:var(--green);background:linear-gradient(135deg,rgba(46,204,113,0.02),rgba(46,204,113,0.05));}
.camp.scheduled{border-color:var(--blue);background:linear-gradient(135deg,rgba(74,144,217,0.02),rgba(74,144,217,0.05));}
.camp.paused{border-color:var(--orange);background:linear-gradient(135deg,rgba(243,156,18,0.02),rgba(243,156,18,0.05));}
.camp-top{display:flex;align-items:center;gap:12px;margin-bottom:12px;}
.camp-icon{width:40px;height:40px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-size:18px;flex-shrink:0;}
.camp-info{flex:1;min-width:0;}
.camp-name{font-size:14px;font-weight:700;}
.camp-desc{font-size:12px;color:var(--text-secondary);margin-top:2px;}
.camp-status{padding:4px 10px;border-radius:20px;font-size:10.5px;font-weight:700;text-transform:uppercase;letter-spacing:0.5px;flex-shrink:0;}
.camp-status.running{background:var(--green-bg);color:var(--green);}
.camp-status.scheduled{background:var(--blue-bg);color:var(--blue);}
.camp-status.paused{background:var(--orange-bg);color:var(--orange);}
.camp-status.done{background:var(--accent-bg);color:var(--accent);}
.camp-stats{display:flex;gap:16px;}
.camp-stat{display:flex;align-items:center;gap:6px;}
.camp-stat-val{font-family:'Space Mono',monospace;font-size:14px;font-weight:700;}
.camp-stat-label{font-size:11px;color:var(--text-tertiary);}
.camp-bar{margin-top:12px;height:6px;background:var(--bg);border-radius:10px;overflow:hidden;}
.camp-bar-fill{height:100%;border-radius:10px;transition:width 1s ease;}
.camp-actions{display:flex;gap:6px;margin-top:12px;}
.camp-btn{padding:6px 14px;border-radius:8px;border:1px solid var(--border);background:var(--surface);font-family:inherit;font-size:11.5px;font-weight:600;cursor:pointer;transition:var(--transition);display:flex;align-items:center;gap:5px;color:var(--text-secondary);}
.camp-btn:hover{border-color:var(--accent);color:var(--accent);background:var(--accent-bg);}
.camp-btn.pause:hover{border-color:var(--orange);color:var(--orange);background:var(--orange-bg);}
.camp-btn.stop:hover{border-color:var(--red);color:var(--red);background:var(--red-bg);}
.feed{padding:8px 0;max-height:600px;overflow-y:auto;}
.feed-item{padding:14px 24px;display:flex;gap:12px;transition:var(--transition);border-bottom:1px solid var(--border-light);animation:slideIn 0.3s ease backwards;}
.feed-item:hover{background:var(--surface-hover);}
.feed-icon{width:36px;height:36px;border-radius:10px;display:flex;align-items:center;justify-content:center;font-size:16px;flex-shrink:0;}
.feed-content{flex:1;min-width:0;}
.feed-msg{font-size:13px;line-height:1.5;}
.feed-msg b{font-weight:700;}
.feed-time{font-size:11px;color:var(--text-tertiary);margin-top:3px;}
.feed-tag{display:inline-block;padding:2px 8px;border-radius:12px;font-size:10px;font-weight:700;margin-left:4px;}
@keyframes slideIn{from{opacity:0;transform:translateX(-10px);}to{opacity:1;transform:translateX(0);}}
.modal-ov{display:none;position:fixed;inset:0;background:rgba(26,29,46,0.4);backdrop-filter:blur(4px);z-index:300;align-items:center;justify-content:center;}
.modal-ov.show{display:flex;}
.modal-h{padding:22px 24px;border-bottom:1px solid var(--border-light);display:flex;align-items:center;justify-content:space-between;}
.modal-t{font-size:17px;font-weight:700;display:flex;align-items:center;gap:8px;}
.modal-x{width:32px;height:32px;border-radius:8px;display:flex;align-items:center;justify-content:center;cursor:pointer;color:var(--text-tertiary);transition:var(--transition);border:none;background:none;font-size:18px;}
.modal-x:hover{background:var(--bg);color:var(--text-primary);}
.modal-body{padding:24px;}
.modal-footer{padding:16px 24px;border-top:1px solid var(--border-light);display:flex;justify-content:flex-end;gap:10px;}
.field{margin-bottom:18px;}
.field-label{font-size:11px;font-weight:600;text-transform:uppercase;letter-spacing:0.8px;color:var(--text-tertiary);margin-bottom:6px;}
.field-input{width:100%;padding:10px 14px;border:1px solid var(--border);border-radius:8px;font-family:inherit;font-size:13.5px;outline:none;transition:var(--transition);background:var(--bg);}
.field-input:focus{border-color:var(--accent);box-shadow:0 0 0 3px var(--accent-glow);background:var(--surface);}
select.field-input{cursor:pointer;appearance:none;background-image:url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%236B7294' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E");background-repeat:no-repeat;background-position:right 14px center;background-color:var(--bg);}
textarea.field-input{resize:vertical;min-height:80px;line-height:1.5;}
.field-row{display:grid;grid-template-columns:1fr 1fr;gap:12px;}
.type-grid{display:grid;grid-template-columns:repeat(3,1fr);gap:8px;}
.type-card{padding:14px 12px;border:1.5px solid var(--border);border-radius:12px;cursor:pointer;transition:var(--transition);text-align:center;}
.type-card:hover{border-color:var(--accent-light);}
.type-card.on{border-color:var(--accent);background:var(--accent-bg);box-shadow:0 0 0 3px var(--accent-glow);}
.type-card-icon{font-size:24px;margin-bottom:6px;}
.type-card-name{font-size:12px;font-weight:700;}
.type-card-desc{font-size:10px;color:var(--text-tertiary);margin-top:2px;}
.ch-pills{display:flex;gap:8px;}
.ch-pill{padding:8px 16px;border-radius:50px;border:1.5px solid var(--border);background:var(--surface);font-size:12px;font-weight:600;cursor:pointer;transition:var(--transition);color:var(--text-secondary);display:flex;align-items:center;gap:6px;}
.ch-pill:hover{border-color:var(--accent);}
.ch-pill.on{background:var(--accent);color:#fff;border-color:var(--accent);}
.presence{margin-top:24px;}
.presence-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(280px,1fr));gap:14px;padding:16px 24px;}
.pres-card{padding:16px 18px;border:1.5px solid var(--border);border-radius:14px;display:flex;align-items:center;gap:14px;transition:var(--transition);}
.pres-card:hover{box-shadow:0 4px 16px rgba(26,29,46,0.05);}
.pres-card.confirmed{border-color:var(--green);background:linear-gradient(135deg,rgba(46,204,113,0.03),rgba(46,204,113,0.06));}
.pres-card.waiting{border-color:var(--orange);background:linear-gradient(135deg,rgba(243,156,18,0.03),rgba(243,156,18,0.06));}
.pres-card.absent{border-color:var(--red);background:linear-gradient(135deg,rgba(231,76,60,0.03),rgba(231,76,60,0.06));}
.pres-av{width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:15px;color:#fff;flex-shrink:0;}
.pres-info{flex:1;min-width:0;}
.pres-nm{font-size:13.5px;font-weight:700;}
.pres-mission{font-size:11.5px;color:var(--text-secondary);margin-top:1px;}
.pres-status{padding:5px 12px;border-radius:20px;font-size:11px;font-weight:700;flex-shrink:0;}
.pres-status.confirmed{background:var(--green-bg);color:var(--green);}
.pres-status.waiting{background:var(--orange-bg);color:var(--orange);}
.pres-status.absent{background:var(--red-bg);color:var(--red);}
.pres-time{font-size:10px;color:var(--text-tertiary);margin-top:3px;}
.powered{text-align:center;padding:20px;font-size:11px;color:var(--text-tertiary);}
.powered span{font-weight:700;background:linear-gradient(135deg,var(--accent),var(--blue));-webkit-background-clip:text;-webkit-text-fill-color:transparent;}

/* ========================================== */
/* MATCHING PAGE STYLES                       */
/* ========================================== */

:root {
  --bg: #F4F6FB;
  --surface: #FFFFFF;
  --surface-hover: #F8F9FD;
  --border: #E8ECF4;
  --border-light: #F0F2F8;
  --text-primary: #1A1D2E;
  --text-secondary: #6B7294;
  --text-tertiary: #9CA3C4;
  --accent: #6C5CE7;
  --accent-light: #A29BFE;
  --accent-bg: #F0EEFF;
  --accent-glow: rgba(108,92,231,0.12);
  --blue: #4A90D9;
  --blue-bg: #EBF3FC;
  --green: #2ECC71;
  --green-bg: #E8F8F0;
  --orange: #F39C12;
  --orange-bg: #FEF5E7;
  --red: #E74C3C;
  --red-bg: #FDECEB;
  --sidebar-w: 260px;
  --header-h: 72px;
  --radius: 16px;
  --radius-sm: 10px;
  --shadow-sm: 0 1px 3px rgba(26,29,46,0.04);
  --shadow-md: 0 4px 20px rgba(26,29,46,0.06);
  --shadow-lg: 0 8px 40px rgba(26,29,46,0.08);
  --shadow-accent: 0 4px 24px rgba(108,92,231,0.18);
  --transition: 0.2s cubic-bezier(0.4, 0, 0.2, 1);
}
* { margin: 0; padding: 0; box-sizing: border-box; }
body {
  font-family: 'DM Sans', -apple-system, sans-serif;
  background: var(--bg);
  color: var(--text-primary);
  overflow-x: hidden;
}

/* ===== MAIN ===== */
.main { margin-left: var(--sidebar-w); min-height: 100vh; }

/* ===== HEADER ===== */
.header {
  height: var(--header-h);
  background: rgba(255,255,255,0.85); backdrop-filter: blur(12px);
  border-bottom: 1px solid var(--border);
  display: flex; align-items: center; justify-content: space-between;
  padding: 0 32px; position: sticky; top: 0; z-index: 50;
}
.header-left { display: flex; flex-direction: column; }
.header-title { font-size: 22px; font-weight: 700; letter-spacing: -0.3px; display: flex; align-items: center; gap: 10px; }
.header-subtitle { font-size: 13px; color: var(--text-secondary); margin-top: 2px; }
.header-right { display: flex; align-items: center; gap: 12px; }
.header-btn {
  width: 40px; height: 40px; display: flex; align-items: center; justify-content: center;
  border-radius: var(--radius-sm); border: 1px solid var(--border); background: var(--surface);
  cursor: pointer; transition: var(--transition); color: var(--text-secondary); position: relative;
}
.header-btn:hover { border-color: var(--accent-light); color: var(--accent); }
.notif-dot { position: absolute; top: 8px; right: 8px; width: 8px; height: 8px; background: var(--red); border-radius: 50%; border: 2px solid var(--surface); }

/* ===== CONTENT ===== */
.content { padding: 28px 32px; max-width: 1400px; }

/* ===== MISSIONS TABS ===== */
.missions-tabs {
  display: flex; gap: 10px; margin-bottom: 24px; align-items: center;
  overflow-x: auto; padding-bottom: 4px;
}
.mission-tab {
  display: flex; align-items: center; gap: 10px;
  padding: 12px 18px; background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius-sm); cursor: pointer; transition: var(--transition);
  white-space: nowrap; min-width: 0;
}
.mission-tab:hover { border-color: var(--accent-light); box-shadow: var(--shadow-sm); }
.mission-tab.active {
  border-color: var(--accent); background: var(--accent-bg);
  box-shadow: 0 0 0 3px var(--accent-glow);
}
.mission-tab-urgency { width: 4px; height: 28px; border-radius: 4px; flex-shrink: 0; }
.mission-tab-urgency.high { background: var(--red); }
.mission-tab-urgency.medium { background: var(--orange); }
.mission-tab-urgency.low { background: var(--green); }
.mission-tab-info { min-width: 0; }
.mission-tab-title { font-size: 13px; font-weight: 600; overflow: hidden; text-overflow: ellipsis; white-space: nowrap; }
.mission-tab-meta { font-size: 11px; color: var(--text-tertiary); margin-top: 2px; }
.mission-tab-match {
  background: var(--accent); color: white; font-size: 11px; font-weight: 700;
  padding: 3px 8px; border-radius: 20px; margin-left: auto; flex-shrink: 0;
}
.new-mission-tab {
  display: flex; align-items: center; justify-content: center; gap: 8px;
  padding: 12px 20px; border: 2px dashed var(--border); border-radius: var(--radius-sm);
  cursor: pointer; transition: var(--transition); font-size: 13px; font-weight: 600;
  color: var(--text-tertiary); background: transparent; white-space: nowrap;
}
.new-mission-tab:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-bg); }

/* ===== MATCHING LAYOUT ===== */
.matching-layout {
  display: grid; grid-template-columns: 380px 1fr; gap: 24px;
}

.card {
  background: var(--surface); border: 1px solid var(--border);
  border-radius: var(--radius); overflow: hidden;
  animation: fadeUp 0.5s ease backwards;
}
.card:nth-child(2) { animation-delay: 0.1s; }

.card-header {
  display: flex; align-items: center; justify-content: space-between;
  padding: 20px 24px; border-bottom: 1px solid var(--border-light);
}
.card-title { font-size: 15px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
.card-action {
  font-size: 12px; color: var(--accent); font-weight: 600; cursor: pointer;
  padding: 5px 12px; border-radius: 20px; transition: var(--transition);
}
.card-action:hover { background: var(--accent-bg); }

/* ===== FICHE DE POSTE ===== */
.fiche-content { padding: 20px 24px; }

.fiche-field { margin-bottom: 16px; }
.fiche-label {
  font-size: 11px; font-weight: 600; text-transform: uppercase;
  letter-spacing: 0.8px; color: var(--text-tertiary); margin-bottom: 6px;
}
.fiche-input {
  width: 100%; padding: 10px 14px; border: 1px solid var(--border);
  border-radius: 8px; font-family: inherit; font-size: 13.5px;
  outline: none; transition: var(--transition); background: var(--bg);
}
.fiche-input:focus { border-color: var(--accent); box-shadow: 0 0 0 3px var(--accent-glow); background: var(--surface); }
.fiche-input::placeholder { color: var(--text-tertiary); }

select.fiche-input { cursor: pointer; appearance: none; background-image: url("data:image/svg+xml,%3Csvg width='12' height='8' viewBox='0 0 12 8' fill='none' xmlns='http://www.w3.org/2000/svg'%3E%3Cpath d='M1 1.5L6 6.5L11 1.5' stroke='%236B7294' stroke-width='2' stroke-linecap='round'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 14px center; background-color: var(--bg); }
select.fiche-input:focus { background-color: var(--surface); }

.fiche-row { display: grid; grid-template-columns: 1fr 1fr; gap: 12px; }

.fiche-tags { display: flex; flex-wrap: wrap; gap: 6px; margin-top: 8px; }
.fiche-tag {
  display: flex; align-items: center; gap: 5px;
  padding: 5px 12px; background: var(--accent-bg); color: var(--accent);
  border-radius: 20px; font-size: 12px; font-weight: 600;
}
.fiche-tag-remove { cursor: pointer; opacity: 0.6; transition: var(--transition); font-size: 14px; }
.fiche-tag-remove:hover { opacity: 1; }

.fiche-tag-input-wrap {
  display: flex; gap: 8px; margin-top: 8px;
}
.fiche-tag-input {
  flex: 1; padding: 7px 12px; border: 1px dashed var(--border);
  border-radius: 20px; font-family: inherit; font-size: 12px;
  outline: none; transition: var(--transition); background: transparent;
}
.fiche-tag-input:focus { border-color: var(--accent); border-style: solid; }
.fiche-tag-input::placeholder { color: var(--text-tertiary); }
.fiche-tag-add {
  width: 30px; height: 30px; border-radius: 50%; border: 1px solid var(--border);
  background: var(--surface); display: flex; align-items: center; justify-content: center;
  cursor: pointer; transition: var(--transition); color: var(--text-tertiary); font-size: 16px;
}
.fiche-tag-add:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-bg); }

/* ===== MATCH BUTTONS ===== */
.match-actions {
  padding: 16px 24px; border-top: 1px solid var(--border-light);
  display: flex; flex-direction: column; gap: 10px;
}

.match-btn {
  width: 100%; padding: 13px; border: none; border-radius: var(--radius-sm);
  font-family: inherit; font-size: 14px; font-weight: 700; cursor: pointer;
  transition: var(--transition); display: flex; align-items: center;
  justify-content: center; gap: 10px;
}

.match-btn-primary {
  background: linear-gradient(135deg, var(--accent), #8B7CF6); color: white;
  box-shadow: var(--shadow-accent);
}
.match-btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 28px rgba(108,92,231,0.3); }

.match-btn-secondary {
  background: var(--surface); color: var(--text-secondary);
  border: 1px solid var(--border) !important;
}
.match-btn-secondary:hover { border-color: var(--accent) !important; color: var(--accent); }

/* ===== MATCHING RESULTS ===== */
.results-status {
  padding: 16px 24px; border-bottom: 1px solid var(--border-light);
  display: flex; align-items: center; justify-content: space-between;
  background: linear-gradient(135deg, rgba(108,92,231,0.03), rgba(74,144,217,0.03));
}
.results-status-left { display: flex; align-items: center; gap: 10px; }
.results-count {
  font-family: 'Space Mono', monospace; font-size: 24px; font-weight: 700; color: var(--accent);
}
.results-count-label { font-size: 13px; color: var(--text-secondary); }
.results-sort {
  display: flex; align-items: center; gap: 8px; font-size: 12px; color: var(--text-tertiary);
}
.sort-select {
  padding: 5px 10px; border: 1px solid var(--border); border-radius: 6px;
  font-family: inherit; font-size: 12px; outline: none; cursor: pointer;
  background: var(--surface);
}

/* ===== CANDIDATE MATCH CARDS ===== */
.match-list { padding: 8px 0; }

.match-card {
  display: flex; align-items: center; gap: 16px;
  padding: 18px 24px; transition: var(--transition); cursor: pointer;
  border-bottom: 1px solid var(--border-light); position: relative;
}
.match-card:last-child { border-bottom: none; }
.match-card:hover { background: var(--surface-hover); }

.match-rank {
  font-family: 'Space Mono', monospace; font-size: 14px; font-weight: 700;
  color: var(--text-tertiary); min-width: 24px; text-align: center;
}
.match-rank.top { color: var(--accent); }

.match-avatar {
  width: 46px; height: 46px; border-radius: 12px;
  display: flex; align-items: center; justify-content: center;
  font-weight: 700; font-size: 15px; color: white; flex-shrink: 0;
}

.match-info { flex: 1; min-width: 0; }
.match-name { font-size: 14px; font-weight: 700; }
.match-sub { font-size: 12px; color: var(--text-secondary); margin-top: 2px; }

.match-criteria { display: flex; gap: 6px; margin-top: 8px; flex-wrap: wrap; }
.match-crit {
  display: flex; align-items: center; gap: 4px;
  padding: 3px 10px; border-radius: 20px; font-size: 11px; font-weight: 600;
}
.match-crit.ok { background: var(--green-bg); color: var(--green); }
.match-crit.partial { background: var(--orange-bg); color: var(--orange); }
.match-crit.no { background: var(--red-bg); color: var(--red); }

/* Match % ring */
.match-pct-wrap {
  display: flex; flex-direction: column; align-items: center; gap: 4px; flex-shrink: 0;
}
.match-ring { position: relative; width: 58px; height: 58px; }
.match-ring svg { transform: rotate(-90deg); width: 58px; height: 58px; }
.match-ring-bg { fill: none; stroke: var(--bg); stroke-width: 4; }
.match-ring-fill { fill: none; stroke-width: 4; stroke-linecap: round; transition: stroke-dashoffset 1s ease; }
.match-ring-text {
  position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;
  font-family: 'Space Mono', monospace; font-size: 14px; font-weight: 700;
}
.match-pct-label { font-size: 10px; color: var(--text-tertiary); font-weight: 600; }

/* Match actions */
.match-card-actions { display: flex; gap: 6px; flex-shrink: 0; }
.match-action-btn {
  width: 34px; height: 34px; border-radius: 8px; border: 1px solid var(--border);
  background: var(--surface); display: flex; align-items: center; justify-content: center;
  cursor: pointer; color: var(--text-tertiary); transition: var(--transition); font-size: 15px;
}
.match-action-btn:hover { border-color: var(--accent); color: var(--accent); background: var(--accent-bg); }

/* ===== SCANNING ANIMATION ===== */
.scanning-overlay {
  display: none; flex-direction: column; align-items: center; justify-content: center;
  padding: 60px 24px; gap: 20px;
}
.scanning-overlay.show { display: flex; }

.scan-spinner {
  width: 64px; height: 64px; border-radius: 50%;
  border: 4px solid var(--border); border-top-color: var(--accent);
  animation: spin 0.8s linear infinite;
}
@keyframes spin { to { transform: rotate(360deg); } }

.scan-text { font-size: 15px; font-weight: 600; color: var(--text-secondary); }
.scan-sub { font-size: 13px; color: var(--text-tertiary); margin-top: -12px; }

.scan-progress-bar {
  width: 240px; height: 6px; background: var(--bg); border-radius: 10px; overflow: hidden;
}
.scan-progress-fill {
  height: 100%; width: 0%; border-radius: 10px;
  background: linear-gradient(90deg, var(--accent), var(--accent-light));
  transition: width 0.3s ease;
}

/* ===== NEW FICHE MODAL ===== */
.modal-overlay {
  display: none; position: fixed; inset: 0; background: rgba(26,29,46,0.4);
  backdrop-filter: blur(4px); z-index: 300; align-items: center; justify-content: center;
}
.modal-overlay.show { display: flex; }

.modal {
  background: var(--surface); border-radius: var(--radius); width: 520px;
  max-height: 90vh; overflow-y: auto; box-shadow: var(--shadow-lg);
  animation: modalIn 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);
}
@keyframes modalIn { from { opacity: 0; transform: scale(0.95) translateY(10px); } to { opacity: 1; transform: scale(1) translateY(0); } }

.modal-header {
  padding: 20px 24px; border-bottom: 1px solid var(--border-light);
  display: flex; align-items: center; justify-content: space-between;
}
.modal-title { font-size: 17px; font-weight: 700; display: flex; align-items: center; gap: 8px; }
.modal-close {
  width: 32px; height: 32px; border-radius: 8px; display: flex;
  align-items: center; justify-content: center; cursor: pointer;
  color: var(--text-tertiary); transition: var(--transition); border: none; background: none;
}
.modal-close:hover { background: var(--bg); color: var(--text-primary); }
.modal-body { padding: 24px; }
.modal-footer {
  padding: 16px 24px; border-top: 1px solid var(--border-light);
  display: flex; justify-content: flex-end; gap: 10px;
}

/* ===== LIVE DOT ===== */
.live-dot {
  width: 8px; height: 8px; background: var(--green); border-radius: 50%;
  display: inline-block; animation: livePulse 2s ease-in-out infinite;
}
@keyframes livePulse {
  0%, 100% { opacity: 1; box-shadow: 0 0 0 0 rgba(46,204,113,0.4); }
  50% { opacity: 0.8; box-shadow: 0 0 0 6px rgba(46,204,113,0); }
}

/* ===== CHAT WIDGET ===== */
.chat-widget { position: fixed; bottom: 28px; right: 28px; z-index: 200; }
.chat-bubble {
  width: 60px; height: 60px;
  background: linear-gradient(135deg, var(--accent), #8B7CF6);
  border-radius: 20px; display: flex; align-items: center; justify-content: center;
  cursor: pointer; box-shadow: var(--shadow-accent), 0 8px 32px rgba(108,92,231,0.3);
  transition: var(--transition); color: white;
}
.chat-bubble:hover { transform: scale(1.08); }
.chat-bubble .pulse {
  position: absolute; width: 60px; height: 60px; border-radius: 20px;
  background: var(--accent); animation: pulse 2s ease-in-out infinite; z-index: -1;
}
@keyframes pulse { 0%, 100% { opacity: 0; transform: scale(1); } 50% { opacity: 0.3; transform: scale(1.3); } }

/* ===== POWERED BY ===== */
.powered-by { text-align: center; padding: 20px; font-size: 11px; color: var(--text-tertiary); }
.powered-by span { font-weight: 700; background: linear-gradient(135deg, var(--accent), var(--blue)); -webkit-background-clip: text; -webkit-text-fill-color: transparent; }

/* ===== TOAST ===== */
.toast {
  position: fixed; bottom: 100px; left: 50%; transform: translateX(-50%) translateY(20px);
  background: var(--text-primary); color: white; padding: 14px 24px; border-radius: var(--radius-sm);
  font-size: 13.5px; font-weight: 600; box-shadow: var(--shadow-lg); opacity: 0;
  transition: all 0.3s ease; pointer-events: none; z-index: 300;
}
.toast.show { opacity: 1; transform: translateX(-50%) translateY(0); }

/* ===== ANIMATIONS ===== */
@keyframes fadeUp { from { opacity: 0; transform: translateY(16px); } to { opacity: 1; transform: translateY(0); } }

::-webkit-scrollbar { width: 6px; }
::-webkit-scrollbar-track { background: transparent; }
::-webkit-scrollbar-thumb { background: var(--border); border-radius: 10px; }

/* ===== EMPTY STATE ===== */
.empty-state {
  display: flex; flex-direction: column; align-items: center;
  justify-content: center; padding: 60px 24px; gap: 12px;
}
.empty-icon { font-size: 48px; margin-bottom: 8px; }
.empty-title { font-size: 16px; font-weight: 700; color: var(--text-primary); }
.empty-desc { font-size: 13px; color: var(--text-tertiary); text-align: center; max-width: 280px; line-height: 1.6; }

</style>
</head>
<body>

<!-- ===== SIDEBAR ===== -->
<aside class="sidebar">
  <div class="sidebar-logo">
    <div class="logo-icon">IZ</div>
    <div class="logo-text">IZYSS</div>
  </div>
  <nav class="sidebar-nav">
    <div class="nav-section-label">Principal</div>
    <div class="nav-item" data-page="dashboard" onclick="navigateTo('dashboard')">
      <div class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="3" y="3" width="7" height="7" rx="1.5"/><rect x="14" y="3" width="7" height="7" rx="1.5"/><rect x="3" y="14" width="7" height="7" rx="1.5"/><rect x="14" y="14" width="7" height="7" rx="1.5"/></svg></div>
      Dashboard
    </div>
    <div class="nav-item" data-page="candidats" onclick="navigateTo('candidats')">
      <div class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg></div>
      Candidats
      <span class="nav-badge">847</span>
    </div>
    <div class="nav-item" data-page="missions" onclick="navigateTo('missions')">
      <div class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/></svg></div>
      Missions
      <span class="nav-badge">12</span>
    </div>
    <div class="nav-item" data-page="contrats" onclick="navigateTo('contrats')">
      <div class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="16" y1="13" x2="8" y2="13"/><line x1="16" y1="17" x2="8" y2="17"/></svg></div>
      Contrats
    </div>
    <div class="nav-section-label">Outils IA</div>
    <div class="nav-item active" data-page="matching" onclick="navigateTo('matching')">
      <div class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg></div>
      Matching
    </div>
    <div class="nav-item" data-page="scoring" onclick="navigateTo('scoring')">
      <div class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg></div>
      Scoring CV
    </div>
    <div class="nav-item" data-page="relances" onclick="navigateTo('relances')">
      <div class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.362 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.338 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg></div>
      Relances
    </div>
    <div class="nav-section-label">Espace Client</div>
    <div class="nav-item" data-page="portail" onclick="navigateTo('portail')">
      <div class="nav-icon"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 1 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 1 1-2.83-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 1 1 2.83-2.83l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 1 1 2.83 2.83l-.06.06A1.65 1.65 0 0 0 19.32 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg></div>
      Portail Client
    </div>
  </nav>
  <div class="sidebar-footer">
    <div class="agency-card">
      <div class="agency-avatar">TS</div>
      <div class="agency-info">
        <div class="agency-name">TalentStaff Lyon</div>
        <div class="agency-role">Administrateur</div>
      </div>
    </div>
  </div>
</aside>

<!-- ============================= -->
<!-- PAGE: MATCHING (default)      -->
<!-- ============================= -->
<div class="page-section active" id="page-matching">
<!-- SIDEBAR -->
<!-- MAIN -->
<div class="main">
  <header class="header">
    <div class="header-left">
      <div class="header-title">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        Matching IA
      </div>
      <div class="header-subtitle">Trouvez les meilleurs candidats pour chaque mission en un clic</div>
    </div>
    <div class="header-right">
      <div style="display:flex;align-items:center;gap:8px;padding:7px 14px;background:var(--green-bg);border-radius:20px;font-size:12px;font-weight:600;color:var(--green);">
        <span class="live-dot"></span> IA active
      </div>
      <div class="header-btn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
        <div class="notif-dot"></div>
      </div>
    </div>
  </header>

  <div class="content">
    <!-- MISSIONS TABS -->
    <div class="missions-tabs" id="missionTabs">
      <div class="mission-tab active" onclick="selectMission(0, this)">
        <div class="mission-tab-urgency high"></div>
        <div class="mission-tab-info">
          <div class="mission-tab-title">5 Caristes CACES 3</div>
          <div class="mission-tab-meta">📍 Carrefour — Lyon 7e</div>
        </div>
        <div class="mission-tab-match">8</div>
      </div>
      <div class="mission-tab" onclick="selectMission(1, this)">
        <div class="mission-tab-urgency high"></div>
        <div class="mission-tab-info">
          <div class="mission-tab-title">3 Prépa. commandes</div>
          <div class="mission-tab-meta">📍 Amazon — Saint-Priest</div>
        </div>
        <div class="mission-tab-match">5</div>
      </div>
      <div class="mission-tab" onclick="selectMission(2, this)">
        <div class="mission-tab-urgency medium"></div>
        <div class="mission-tab-info">
          <div class="mission-tab-title">2 Agents production</div>
          <div class="mission-tab-meta">📍 Sanofi — Gerland</div>
        </div>
        <div class="mission-tab-match">3</div>
      </div>
      <div class="new-mission-tab" onclick="openNewFiche()">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
        Nouvelle fiche
      </div>
    </div>

    <div class="matching-layout">
      <!-- LEFT: FICHE DE POSTE -->
      <div class="card">
        <div class="card-header">
          <div class="card-title">📋 Fiche de poste</div>
          <div class="card-action" onclick="editFiche()">Modifier</div>
        </div>
        <div class="fiche-content" id="ficheContent">
          <div class="fiche-field">
            <div class="fiche-label">Intitulé du poste</div>
            <input class="fiche-input" id="fichePoste" value="Cariste CACES 3" />
          </div>
          <div class="fiche-row">
            <div class="fiche-field">
              <div class="fiche-label">Client</div>
              <input class="fiche-input" id="ficheClient" value="Carrefour Supply Chain" />
            </div>
            <div class="fiche-field">
              <div class="fiche-label">Localisation</div>
              <input class="fiche-input" id="ficheLieu" value="Lyon 7e" />
            </div>
          </div>
          <div class="fiche-row">
            <div class="fiche-field">
              <div class="fiche-label">Date de début</div>
              <input class="fiche-input" type="date" id="ficheDate" value="2026-02-14" />
            </div>
            <div class="fiche-field">
              <div class="fiche-label">Durée</div>
              <select class="fiche-input" id="ficheDuree">
                <option>1 semaine</option>
                <option selected>2 semaines</option>
                <option>1 mois</option>
                <option>3 mois</option>
                <option>6 mois</option>
              </select>
            </div>
          </div>
          <div class="fiche-row">
            <div class="fiche-field">
              <div class="fiche-label">Postes à pourvoir</div>
              <input class="fiche-input" type="number" id="ficheNb" value="5" min="1" />
            </div>
            <div class="fiche-field">
              <div class="fiche-label">Horaires</div>
              <select class="fiche-input" id="ficheHoraires">
                <option selected>Journée (8h-16h)</option>
                <option>Matin (5h-13h)</option>
                <option>Après-midi (13h-21h)</option>
                <option>Nuit (21h-5h)</option>
                <option>2x8</option>
                <option>3x8</option>
              </select>
            </div>
          </div>
          <div class="fiche-field">
            <div class="fiche-label">Compétences requises</div>
            <div class="fiche-tags" id="ficheTags">
              <div class="fiche-tag">CACES 3 <span class="fiche-tag-remove" onclick="removeTag(this)">×</span></div>
              <div class="fiche-tag">Expérience entrepôt <span class="fiche-tag-remove" onclick="removeTag(this)">×</span></div>
              <div class="fiche-tag">Visite médicale à jour <span class="fiche-tag-remove" onclick="removeTag(this)">×</span></div>
            </div>
            <div class="fiche-tag-input-wrap">
              <input class="fiche-tag-input" id="newTagInput" placeholder="Ajouter une compétence..." onkeydown="if(event.key==='Enter')addTag()" />
              <div class="fiche-tag-add" onclick="addTag()">+</div>
            </div>
          </div>
        </div>

        <div class="match-actions">
          <button class="match-btn match-btn-primary" onclick="runMatching()">
            <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
            Lancer le matching IA
          </button>
          <button class="match-btn match-btn-secondary" onclick="runMatching()">
            🔄 Relancer l'analyse
          </button>
        </div>
      </div>

      <!-- RIGHT: RESULTS -->
      <div class="card" id="resultsCard">
        <div class="results-status">
          <div class="results-status-left">
            <div class="results-count" id="resultsCount">8</div>
            <div>
              <div class="results-count-label">candidats compatibles</div>
              <div style="font-size:11px;color:var(--text-tertiary);margin-top:2px;">sur 847 analysés en 2.3s</div>
            </div>
          </div>
          <div class="results-sort">
            Trier par
            <select class="sort-select">
              <option>% compatibilité</option>
              <option>Disponibilité</option>
              <option>Score CV</option>
              <option>Proximité</option>
            </select>
          </div>
        </div>

        <div class="match-list" id="matchList"></div>

        <div class="scanning-overlay" id="scanOverlay">
          <div class="scan-spinner"></div>
          <div class="scan-text">Analyse de la CVthèque en cours...</div>
          <div class="scan-sub" id="scanSub">0 / 847 profils analysés</div>
          <div class="scan-progress-bar">
            <div class="scan-progress-fill" id="scanFill"></div>
          </div>
        </div>

        <div class="powered-by">
          Propulsé par <span>IZYSS</span> — Intelligence Artificielle au service de l'intérim
        </div>
      </div>
    </div>
  </div>
</div>

<!-- NEW FICHE MODAL -->
<div class="modal-overlay" id="newFicheModal">
  <div class="modal">
    <div class="modal-header">
      <div class="modal-title">📋 Nouvelle fiche de poste</div>
      <button class="modal-close" onclick="closeModal()">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
      </button>
    </div>
    <div class="modal-body">
      <div class="fiche-field">
        <div class="fiche-label">Intitulé du poste</div>
        <input class="fiche-input" id="modalPoste" placeholder="Ex: Cariste CACES 5, Préparateur de commandes..." />
      </div>
      <div class="fiche-row">
        <div class="fiche-field">
          <div class="fiche-label">Client</div>
          <input class="fiche-input" id="modalClient" placeholder="Nom du client" />
        </div>
        <div class="fiche-field">
          <div class="fiche-label">Localisation</div>
          <input class="fiche-input" id="modalLieu" placeholder="Ville ou code postal" />
        </div>
      </div>
      <div class="fiche-row">
        <div class="fiche-field">
          <div class="fiche-label">Date de début</div>
          <input class="fiche-input" type="date" id="modalDate" />
        </div>
        <div class="fiche-field">
          <div class="fiche-label">Postes à pourvoir</div>
          <input class="fiche-input" type="number" id="modalNb" value="1" min="1" />
        </div>
      </div>
      <div class="fiche-field">
        <div class="fiche-label">Compétences clés (séparées par des virgules)</div>
        <input class="fiche-input" id="modalComp" placeholder="Ex: CACES 1, Expérience logistique, Permis B..." />
      </div>
    </div>
    <div class="modal-footer">
      <button class="match-btn match-btn-secondary" onclick="closeModal()" style="width:auto;padding:10px 20px;">Annuler</button>
      <button class="match-btn match-btn-primary" onclick="createFiche()" style="width:auto;padding:10px 20px;">
        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>
        Créer & Matcher
      </button>
    </div>
  </div>
</div>

<!-- CHAT WIDGET -->
<div class="chat-widget">
  <div class="chat-bubble" onclick="alert('Agent IA IZYSS — Chat disponible sur toutes les pages')">
    <div class="pulse"></div>
    <svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg>
  </div>
</div>

</div>

<!-- ============================= -->
<!-- PLACEHOLDER PAGES             -->
<!-- ============================= -->
<div class="page-section" id="page-dashboard">
<div class="main">
  <header class="header">
    <div class="header-left">
      <div class="header-title" style="font-size:22px;">Bonjour, Sophie 👋</div>
      <div class="header-subtitle">Voici l'activité de votre agence aujourd'hui</div>
    </div>
    <div class="header-right">
      <div class="db-header-search">
        <svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg>
        Rechercher...
        <kbd>⌘K</kbd>
      </div>
      <div class="header-btn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
        <div class="notif-dot"></div>
      </div>
    </div>
  </header>

  <div class="content">
    <div class="db-kpi-grid">
      <div class="db-kpi-card">
        <div class="db-kpi-header"><div class="db-kpi-icon">👥</div><div class="db-kpi-trend up">↑ 12%</div></div>
        <div class="db-kpi-value" id="kpi-db-total-candidates">847</div><div class="db-kpi-label">Candidats en base</div>
      </div>
      <div class="db-kpi-card">
        <div class="db-kpi-header"><div class="db-kpi-icon">🎯</div><div class="db-kpi-trend up">↑ 8%</div></div>
        <div class="db-kpi-value" id="kpi-db-active-missions">12</div><div class="db-kpi-label">Missions actives</div>
      </div>
      <div class="db-kpi-card">
        <div class="db-kpi-header"><div class="db-kpi-icon">📄</div><div class="db-kpi-trend up">↑ 23%</div></div>
        <div class="db-kpi-value" id="kpi-db-contracts-month">34</div><div class="db-kpi-label">Contrats ce mois</div>
      </div>
      <div class="db-kpi-card">
        <div class="db-kpi-header"><div class="db-kpi-icon">⚡</div><div class="db-kpi-trend up">↑ 5%</div></div>
        <div class="db-kpi-value" id="kpi-db-placement-rate">78%</div><div class="db-kpi-label">Taux de placement</div>
      </div>
    </div>

    <div class="db-grid">
      <div class="db-left-col">
        <!-- CANDIDATES TABLE -->
        <div class="db-card">
          <div class="db-card-header">
            <div class="db-card-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/></svg>Candidats à traiter</div>
            <div class="db-card-action">Voir tout →</div>
          </div>
          <table class="db-candidates-table">
            <thead><tr><th>Candidat</th><th>Poste</th><th>Score IA</th><th>Statut</th></tr></thead>
            <tbody>
              <tr><td><div class="db-candidate-cell"><div class="db-candidate-avatar" style="background:linear-gradient(135deg,#6C5CE7,#A29BFE)">ML</div><div class="db-candidate-name">Marc Lefèvre</div></div></td><td style="color:var(--text-secondary);font-size:13px">Cariste CACES 3</td><td><div class="db-score-bar"><div class="db-score-track"><div class="db-score-fill" style="width:92%;background:linear-gradient(90deg,var(--green),#55E6A5)"></div></div><div class="db-score-value" style="color:var(--green)">92</div></div></td><td><span class="db-status-badge available"><span class="db-status-dot"></span>Disponible</span></td></tr>
              <tr><td><div class="db-candidate-cell"><div class="db-candidate-avatar" style="background:linear-gradient(135deg,#4A90D9,#74B9FF)">SD</div><div class="db-candidate-name">Sarah Dubois</div></div></td><td style="color:var(--text-secondary);font-size:13px">Préparatrice commandes</td><td><div class="db-score-bar"><div class="db-score-track"><div class="db-score-fill" style="width:87%;background:linear-gradient(90deg,var(--green),#55E6A5)"></div></div><div class="db-score-value" style="color:var(--green)">87</div></div></td><td><span class="db-status-badge available"><span class="db-status-dot"></span>Disponible</span></td></tr>
              <tr><td><div class="db-candidate-cell"><div class="db-candidate-avatar" style="background:linear-gradient(135deg,#F39C12,#FDCB6E)">KB</div><div class="db-candidate-name">Karim Benali</div></div></td><td style="color:var(--text-secondary);font-size:13px">Manutentionnaire</td><td><div class="db-score-bar"><div class="db-score-track"><div class="db-score-fill" style="width:74%;background:linear-gradient(90deg,var(--orange),#FDCB6E)"></div></div><div class="db-score-value" style="color:var(--orange)">74</div></div></td><td><span class="db-status-badge pending"><span class="db-status-dot"></span>En attente</span></td></tr>
              <tr><td><div class="db-candidate-cell"><div class="db-candidate-avatar" style="background:linear-gradient(135deg,#E74C3C,#FF7675)">JM</div><div class="db-candidate-name">Julie Martin</div></div></td><td style="color:var(--text-secondary);font-size:13px">Agent de production</td><td><div class="db-score-bar"><div class="db-score-track"><div class="db-score-fill" style="width:81%;background:linear-gradient(90deg,var(--green),#55E6A5)"></div></div><div class="db-score-value" style="color:var(--green)">81</div></div></td><td><span class="db-status-badge placed"><span class="db-status-dot"></span>Placé</span></td></tr>
            </tbody>
          </table>
        </div>

        <!-- MISSIONS -->
        <div class="db-card">
          <div class="db-card-header">
            <div class="db-card-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/></svg>Missions ouvertes</div>
            <div class="db-card-action">Voir tout →</div>
          </div>
          <div class="db-missions-list">
            <div class="db-mission-item"><div class="db-mission-urgency high"></div><div class="db-mission-info"><div class="db-mission-title">5 Caristes CACES 3 — Entrepôt Carrefour</div><div class="db-mission-meta"><span>📍 Lyon 7e</span><span>🕐 Début : 14 fév.</span></div></div><div class="db-mission-match"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>8 matchs</div></div>
            <div class="db-mission-item"><div class="db-mission-urgency high"></div><div class="db-mission-info"><div class="db-mission-title">3 Préparateurs commandes — Amazon FBA</div><div class="db-mission-meta"><span>📍 Saint-Priest</span><span>🕐 Début : 12 fév.</span></div></div><div class="db-mission-match"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>5 matchs</div></div>
            <div class="db-mission-item"><div class="db-mission-urgency medium"></div><div class="db-mission-info"><div class="db-mission-title">2 Agents de production — Sanofi</div><div class="db-mission-meta"><span>📍 Gerland</span><span>🕐 Début : 17 fév.</span></div></div><div class="db-mission-match"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>3 matchs</div></div>
            <div class="db-mission-item"><div class="db-mission-urgency low"></div><div class="db-mission-info"><div class="db-mission-title">1 Technicien maintenance — Veolia</div><div class="db-mission-meta"><span>📍 Villeurbanne</span><span>🕐 Début : 24 fév.</span></div></div><div class="db-mission-match"><svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>11 matchs</div></div>
          </div>
        </div>
      </div>

      <!-- RIGHT: ACTIVITY FEED -->
      <div style="display:flex;flex-direction:column;gap:22px;">
        <div class="db-card" style="flex:1;">
          <div class="db-card-header">
            <div class="db-card-title"><svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/></svg>Activité récente</div>
            <div class="db-card-action">Tout voir →</div>
          </div>
          <div class="db-activity-list">
            <div class="db-activity-item"><div class="db-activity-dot purple">🤖</div><div class="db-activity-content"><div class="db-activity-text"><strong>Agent IA</strong> a relancé 23 candidats inactifs par SMS</div><div class="db-activity-time">Il y a 12 min</div></div></div>
            <div class="db-activity-item"><div class="db-activity-dot green">📄</div><div class="db-activity-content"><div class="db-activity-text"><strong>Contrat</strong> généré pour Marc Lefèvre — Mission Carrefour</div><div class="db-activity-time">Il y a 34 min</div></div></div>
            <div class="db-activity-item"><div class="db-activity-dot blue">🎯</div><div class="db-activity-content"><div class="db-activity-text"><strong>Matching</strong> : 8 profils trouvés pour "Cariste CACES 3"</div><div class="db-activity-time">Il y a 1h</div></div></div>
            <div class="db-activity-item"><div class="db-activity-dot orange">⭐</div><div class="db-activity-content"><div class="db-activity-text"><strong>Scoring</strong> : 15 nouveaux CVs analysés et notés</div><div class="db-activity-time">Il y a 2h</div></div></div>
            <div class="db-activity-item"><div class="db-activity-dot green">✅</div><div class="db-activity-content"><div class="db-activity-text"><strong>6 candidats</strong> ont confirmé leur disponibilité suite aux relances</div><div class="db-activity-time">Il y a 3h</div></div></div>
            <div class="db-activity-item"><div class="db-activity-dot purple">📊</div><div class="db-activity-content"><div class="db-activity-text"><strong>Portail client</strong> : Carrefour a consulté 4 profils disponibles</div><div class="db-activity-time">Il y a 4h</div></div></div>
          </div>
        </div>
        <div class="powered">Propulsé par <span>IZYSS</span> — Intelligence Artificielle au service de l'intérim</div>
      </div>
    </div>
  </div>
</div>

<!-- DASHBOARD CHAT WIDGET -->
<div class="db-chat-widget" id="dbChatWidget">
  <div class="db-chat-panel" id="dbChatPanel">
    <div class="db-chat-header">
      <div class="db-chat-ai-avatar">✨</div>
      <div class="db-chat-ai-info"><div class="db-chat-ai-name">Agent IZYSS</div><div class="db-chat-ai-status">En ligne — prêt à vous aider</div></div>
      <button class="db-chat-close" onclick="dbToggleChat()"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg></button>
    </div>
    <div class="db-chat-messages">
      <div class="db-msg ai">Bonjour Sophie ! 👋 Je suis votre assistant IA IZYSS. Je peux vous aider à trouver des candidats, créer des contrats, lancer des relances... Que puis-je faire pour vous ?</div>
      <div class="db-msg user">Trouve-moi des caristes disponibles sur Lyon pour la semaine prochaine</div>
      <div class="db-msg ai">J'ai trouvé <strong>8 caristes CACES 3</strong> disponibles sur Lyon la semaine prochaine. Les 3 meilleurs scores :<br><br>🥇 Marc Lefèvre — Score 92/100<br>🥈 Thomas Roche — Score 89/100<br>🥉 Fatima El Amrani — Score 85/100<br><br>Voulez-vous que je génère les contrats pour ces candidats ?</div>
    </div>
    <div class="db-chat-suggestions">
      <div class="db-chat-suggestion">📄 Créer un contrat</div>
      <div class="db-chat-suggestion">📱 Relancer candidats</div>
      <div class="db-chat-suggestion">🎯 Matching mission</div>
    </div>
    <div class="db-chat-input-area">
      <input class="db-chat-input" placeholder="Demandez-moi n'importe quoi..."/>
      <div class="db-chat-voice-btn" title="Message vocal"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M12 1a3 3 0 0 0-3 3v8a3 3 0 0 0 6 0V4a3 3 0 0 0-3-3z"/><path d="M19 10v2a7 7 0 0 1-14 0v-2"/><line x1="12" y1="19" x2="12" y2="23"/><line x1="8" y1="23" x2="16" y2="23"/></svg></div>
      <button class="db-chat-send-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/></svg></button>
    </div>
  </div>
  <div class="db-chat-bubble" onclick="dbToggleChat()"><div class="db-pulse"></div><svg width="26" height="26" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z"/></svg></div>
</div>
</div>
<div class="page-section" id="page-candidats">
<div class="main">
  <header class="header">
    <div class="header-left">
      <div class="header-title"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M17 21v-2a4 4 0 0 0-4-4H5a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M23 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/></svg>CVthèque</div>
      <div class="header-subtitle">847 candidats en base — 234 disponibles cette semaine</div>
    </div>
    <div class="header-right">
      <button class="cd-h-btn" onclick="cdOpenImport()">📥 Importer CVs</button>
      <button class="cd-h-btn cd-h-btn-primary" onclick="showToast('Ajout candidat manuel')">+ Ajouter</button>
      <div class="header-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg><div class="notif-dot"></div></div>
    </div>
  </header>
  <div class="content">
    <div class="kpis" style="grid-template-columns:repeat(4,1fr);">
      <div class="kpi" style="animation-delay:0s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--accent-bg)">👥</div><div class="kpi-trend" style="background:var(--green-bg);color:var(--green)">+23 ce mois</div></div><div class="kpi-val" id="kpi-cd-total" style="color:var(--accent)">847</div><div class="kpi-label">Total candidats</div></div>
      <div class="kpi" style="animation-delay:0.05s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--green-bg)">✅</div></div><div class="kpi-val" id="kpi-cd-available" style="color:var(--green)">234</div><div class="kpi-label">Disponibles</div></div>
      <div class="kpi" style="animation-delay:0.1s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--blue-bg)">🏗️</div></div><div class="kpi-val" id="kpi-cd-on-mission" style="color:var(--blue)">67</div><div class="kpi-label">En mission</div></div>
      <div class="kpi" style="animation-delay:0.15s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--orange-bg)">💤</div></div><div class="kpi-val" id="kpi-cd-inactive" style="color:var(--orange)">156</div><div class="kpi-label">Inactifs +90j</div></div>
    </div>
    <div class="toolbar">
      <div class="search-box"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="var(--text-tertiary)" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input placeholder="Rechercher un candidat, compétence, ville..." id="cdSearchInput" oninput="cdDoFilter()"/></div>
      <div class="cd-pill on" data-cf="all" onclick="cdSetFilter(this)">Tous</div>
      <div class="cd-pill" data-cf="dispo" onclick="cdSetFilter(this)">✅ Disponibles</div>
      <div class="cd-pill" data-cf="mission" onclick="cdSetFilter(this)">🏗️ En mission</div>
      <div class="cd-pill" data-cf="indispo" onclick="cdSetFilter(this)">❌ Indisponibles</div>
      <div class="cd-pill" data-cf="dormant" onclick="cdSetFilter(this)">💤 Dormants</div>
      <div class="toolbar-right">
        <div class="view-toggle">
          <div class="view-btn on" id="cdViewTable" onclick="cdSetView('table')">☰ Table</div>
          <div class="view-btn" id="cdViewGrid" onclick="cdSetView('grid')">⊞ Cards</div>
        </div>
      </div>
    </div>
    <div class="table-card" id="cdTableView">
      <div class="table-wrap"><table><thead><tr><th>Candidat</th><th>Compétences</th><th>Score IA</th><th>Statut</th><th>Localisation</th><th>Dernière activité</th><th>Actions</th></tr></thead><tbody id="cdTableBody"></tbody></table></div>
      <div class="cd-pagination"><div class="pag-info">Affichage 1-15 sur <span id="cdTotalCount">847</span> candidats</div><div class="pag-btns"><div class="pag-btn">‹</div><div class="pag-btn on">1</div><div class="pag-btn">2</div><div class="pag-btn">3</div><div class="pag-btn">...</div><div class="pag-btn">43</div><div class="pag-btn">›</div></div></div>
    </div>
    <div class="cd-grid-view" id="cdGridView"></div>
    <div class="powered">Propulsé par <span>IZYSS</span> — Intelligence Artificielle au service de l'intérim</div>
  </div>
</div>

<!-- CANDIDATS IMPORT MODAL -->
<div class="modal-ov" id="cdImportModal">
  <div class="modal">
    <div class="modal-h"><div class="modal-t">📥 Importer des CVs</div><button class="modal-x" onclick="cdCloseImport()">✕</button></div>
    <div class="modal-body">
      <div class="cd-drop-zone" onclick="document.getElementById('cdFileInput').click()">
        <div class="cd-drop-icon">📄</div>
        <div class="cd-drop-title">Glissez-déposez vos CVs ici</div>
        <div class="cd-drop-desc">ou cliquez pour sélectionner des fichiers</div>
        <div class="cd-drop-formats">PDF, DOCX, JPG — jusqu'à 50 fichiers simultanés</div>
        <input type="file" id="cdFileInput" multiple accept=".pdf,.docx,.doc,.jpg,.png" style="display:none" onchange="showToast('📄 '+this.files.length+' fichiers sélectionnés')"/>
      </div>
      <div style="margin-top:16px;padding:12px 16px;background:var(--accent-bg);border-radius:10px;font-size:12px;color:var(--accent);display:flex;align-items:center;gap:8px;">🤖 <b>L'IA extrait automatiquement</b> les informations : nom, compétences, expériences, certifications, coordonnées.</div>
    </div>
    <div class="modal-footer"><button class="btn-secondary" onclick="cdCloseImport()">Annuler</button><button class="btn-primary" onclick="cdCloseImport();showToast('🤖 Extraction IA en cours... 12 CVs détectés')">🚀 Lancer l'extraction IA</button></div>
  </div>
</div>

<!-- CANDIDATS PORTAL PUSH MODAL -->
<div class="modal-ov" id="cdPortalModal">
  <div class="modal" style="width:440px;">
    <div class="modal-h"><div class="modal-t">👁 Envoyer au portail client</div><button class="modal-x" onclick="cdClosePortal()">✕</button></div>
    <div class="modal-body">
      <div id="cdPortalCandInfo" style="display:flex;align-items:center;gap:12px;margin-bottom:20px;padding:14px 16px;background:var(--bg);border-radius:var(--radius-sm);"></div>
      <div class="field" style="margin-bottom:16px;"><div class="field-label">Client destinataire</div>
        <select class="field-input" id="cdPortalClient"><option>Carrefour Supply Chain</option><option>Amazon FBA — Saint-Priest</option><option>Sanofi — Gerland</option><option>Rhenus Logistics</option><option>FM Logistic</option></select>
      </div>
      <div class="field" style="margin-bottom:16px;"><div class="field-label">Visibilité du profil</div>
        <div style="display:flex;gap:8px;">
          <div class="cd-vis-opt on" onclick="cdPickVis(this,'full')" data-v="full" style="flex:1;padding:14px;border:1.5px solid var(--green);background:var(--green-bg);border-radius:var(--radius-sm);cursor:pointer;text-align:center;"><div style="font-size:20px;margin-bottom:4px;">👁</div><div style="font-size:12px;font-weight:700;color:var(--green);">Profil complet</div><div style="font-size:10px;color:var(--text-tertiary);margin-top:2px;">Nom, tel, CV visible</div></div>
          <div class="cd-vis-opt" onclick="cdPickVis(this,'partial')" data-v="partial" style="flex:1;padding:14px;border:1.5px solid var(--border);background:var(--surface);border-radius:var(--radius-sm);cursor:pointer;text-align:center;"><div style="font-size:20px;margin-bottom:4px;">◐</div><div style="font-size:12px;font-weight:700;color:var(--orange);">Partiel</div><div style="font-size:10px;color:var(--text-tertiary);margin-top:2px;">Compétences + dispo</div></div>
          <div class="cd-vis-opt" onclick="cdPickVis(this,'anon')" data-v="anon" style="flex:1;padding:14px;border:1.5px solid var(--border);background:var(--surface);border-radius:var(--radius-sm);cursor:pointer;text-align:center;"><div style="font-size:20px;margin-bottom:4px;">🔒</div><div style="font-size:12px;font-weight:700;color:var(--text-tertiary);">Anonymisé</div><div style="font-size:10px;color:var(--text-tertiary);margin-top:2px;">Initiales uniquement</div></div>
        </div>
      </div>
      <div style="padding:10px 14px;background:var(--accent-bg);border-radius:8px;font-size:11.5px;color:var(--accent);display:flex;align-items:center;gap:6px;">💡 Le client verra ce profil dans son portail dès validation</div>
    </div>
    <div class="modal-footer"><button class="btn-secondary" onclick="cdClosePortal()">Annuler</button><button class="btn-primary" onclick="cdConfirmPortalPush()">👁 Envoyer au portail</button></div>
  </div>
</div>

<!-- CANDIDATS DRAWER -->
<div class="cd-dov" id="cdDOverlay" onclick="cdCloseDrawer()"></div>
<div class="cd-dw" id="cdDrawer">
  <div class="cd-dw-head"><span style="font-size:15px;font-weight:800;">📄 Fiche candidat</span><button class="cd-dw-x" onclick="cdCloseDrawer()">✕</button></div>
  <div id="cdDrawerContent"></div>
</div>
</div>
<div class="page-section" id="page-missions">
<div class="main">
  <header class="header">
    <div class="header-left">
      <div class="header-title"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><rect x="2" y="7" width="20" height="14" rx="2"/><path d="M16 7V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v2"/></svg>Missions</div>
      <div class="header-subtitle">12 missions actives — 5 à pourvoir en urgence</div>
    </div>
    <div class="header-right">
      <button class="ms-h-btn" onclick="showToast('Export missions')">📊 Exporter</button>
      <button class="ms-h-btn ms-h-btn-primary" onclick="msOpenModal()">+ Nouvelle mission</button>
      <div class="header-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/></svg><div class="notif-dot"></div></div>
    </div>
  </header>
  <div class="content">
    <div class="kpis" style="grid-template-columns:repeat(5,1fr);">
      <div class="kpi" style="animation-delay:0s;cursor:pointer" onclick="msFilterByKpi('all')"><div class="kpi-top"><div class="kpi-icon" style="background:var(--accent-bg)">📋</div></div><div class="kpi-val" id="kpi-ms-active" style="color:var(--accent)">12</div><div class="kpi-label">Missions actives</div></div>
      <div class="kpi" style="animation-delay:0.05s;cursor:pointer" onclick="msFilterByKpi('urgent')"><div class="kpi-top"><div class="kpi-icon" style="background:var(--red-bg)">🔥</div></div><div class="kpi-val" id="kpi-ms-urgent" style="color:var(--red)">5</div><div class="kpi-label">Urgentes</div></div>
      <div class="kpi" style="animation-delay:0.1s;cursor:pointer" onclick="msFilterByKpi('filled')"><div class="kpi-top"><div class="kpi-icon" style="background:var(--green-bg)">✅</div></div><div class="kpi-val" id="kpi-ms-filled" style="color:var(--green)">34</div><div class="kpi-label">Postes pourvus ce mois</div></div>
      <div class="kpi" style="animation-delay:0.15s;cursor:pointer" onclick="msFilterByKpi('progress')"><div class="kpi-top"><div class="kpi-icon" style="background:var(--blue-bg)">👥</div></div><div class="kpi-val" id="kpi-ms-on-site" style="color:var(--blue)">67</div><div class="kpi-label">Intérimaires en poste</div></div>
      <div class="kpi" style="animation-delay:0.2s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--orange-bg)">⏱</div><div class="kpi-trend" style="background:var(--green-bg);color:var(--green)">-18%</div></div><div class="kpi-val" id="kpi-ms-avg-days" style="color:var(--orange)">2.1j</div><div class="kpi-label">Temps moyen placement</div></div>
    </div>

    <div class="ms-toolbar">
      <div class="ms-search"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="var(--text-tertiary)" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input placeholder="Rechercher une mission, client..." id="msSearchInput" oninput="msDoFilter()"/></div>
      <div class="ms-pill on" data-msf="all" onclick="msSetFilter(this)">Toutes</div>
      <div class="ms-pill" data-msf="open" onclick="msSetFilter(this)">🟢 Ouvertes</div>
      <div class="ms-pill" data-msf="urgent" onclick="msSetFilter(this)">🔥 Urgentes</div>
      <div class="ms-pill" data-msf="progress" onclick="msSetFilter(this)">🔵 En cours</div>
      <div class="ms-pill" data-msf="filled" onclick="msSetFilter(this)">✅ Pourvues</div>
      <div class="ms-toolbar-right">
        <div class="ms-view-toggle">
          <div class="ms-view-btn on" id="msVTable" onclick="msSetView('table')">☰ Table</div>
          <div class="ms-view-btn" id="msVKanban" onclick="msSetView('kanban')">⊞ Kanban</div>
        </div>
      </div>
    </div>

    <div class="ms-table-card" id="msTableView"><div style="overflow-x:auto"><table><thead><tr><th>Mission</th><th>Statut</th><th>Postes</th><th>Candidats affectés</th><th>Matchings IA</th><th>Dates</th><th>Lieu</th><th>Actions</th></tr></thead><tbody id="msTableBody"></tbody></table></div></div>
    <div class="ms-kanban" id="msKanbanView"></div>

    <div class="powered">Propulsé par <span>IZYSS</span> — Intelligence Artificielle au service de l'intérim</div>
  </div>
</div>

<!-- MISSIONS DRAWER -->
<div class="ms-dov" id="msDOverlay" onclick="msCloseDrawer()"></div>
<div class="ms-dw" id="msDrawer">
  <div class="ms-dw-head"><span style="font-size:15px;font-weight:800;">📋 Détails mission</span><button class="ms-dw-x" onclick="msCloseDrawer()">✕</button></div>
  <div id="msDrawerContent"></div>
</div>

<!-- MISSIONS NEW MODAL -->
<div class="modal-ov" id="msNewModal">
  <div class="modal" style="width:560px;">
    <div class="modal-h"><div class="modal-t">📋 Nouvelle mission</div><button class="modal-x" onclick="msCloseModal()">✕</button></div>
    <div class="modal-body">
      <div class="field"><div class="field-label">Intitulé du poste</div><input class="field-input" id="msMTitle" placeholder="Ex: Cariste CACES 3"/></div>
      <div class="field-row">
        <div class="field"><div class="field-label">Client</div><select class="field-input" id="msMClient"><option>Carrefour Supply Chain</option><option>Amazon FBA</option><option>Sanofi</option><option>Rhenus Logistics</option><option>FM Logistic</option></select></div>
        <div class="field"><div class="field-label">Localisation</div><input class="field-input" id="msMLoc" placeholder="Ex: Lyon 7e"/></div>
      </div>
      <div class="field-row">
        <div class="field"><div class="field-label">Date début</div><input class="field-input" type="date" id="msMStart"/></div>
        <div class="field"><div class="field-label">Date fin</div><input class="field-input" type="date" id="msMEnd"/></div>
      </div>
      <div class="field-row">
        <div class="field"><div class="field-label">Nb postes à pourvoir</div><input class="field-input" type="number" id="msMNb" value="1" min="1"/></div>
        <div class="field"><div class="field-label">Horaires</div><select class="field-input"><option>Journée</option><option>Matin (6h-14h)</option><option>Après-midi (14h-22h)</option><option>Nuit (22h-6h)</option><option>2x8</option><option>3x8</option></select></div>
      </div>
      <div class="field">
        <div class="field-label">Urgence</div>
        <div class="ms-urg-pills">
          <div class="ms-urg-pill on high" onclick="msPickUrg(this,'high')">🔴 Critique</div>
          <div class="ms-urg-pill" onclick="msPickUrg(this,'med')">🟠 Moyen</div>
          <div class="ms-urg-pill" onclick="msPickUrg(this,'low')">🟢 Normal</div>
        </div>
      </div>
      <div class="field"><div class="field-label">Compétences requises</div><textarea class="field-input" placeholder="CACES 3, expérience entrepôt, visite médicale à jour..."></textarea></div>
      <div style="padding:12px 16px;background:var(--accent-bg);border-radius:10px;font-size:12px;color:var(--accent);display:flex;align-items:center;gap:8px;">🤖 <b>L'IA lancera automatiquement le matching</b> dès la création de la mission</div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="msCloseModal()">Annuler</button>
      <button class="ms-h-btn ms-h-btn-primary" onclick="msCreateMission()">🚀 Créer et lancer le matching</button>
    </div>
  </div>
</div>
</div>
<div class="page-section" id="page-contrats">
<div class="main">
  <header class="header">
    <div class="header-left">
      <div class="header-title"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>Contrats</div>
      <div class="header-subtitle">Gérez vos contrats et avenants en quelques clics</div>
    </div>
    <div class="header-right">
      <button class="ct-h-btn" onclick="showToast('Export Excel en cours...')">📊 Exporter</button>
      <button class="ct-h-btn ct-h-btn-primary" onclick="ctOpenNewContrat()">+ Nouveau contrat</button>
    </div>
  </header>
  <div class="content">
    <div class="kpis" style="grid-template-columns:repeat(5,1fr);">
      <div class="kpi" style="animation-delay:0s;cursor:pointer" onclick="ctFilterByKpi('active')"><div class="kpi-top"><div class="kpi-icon" style="background:var(--green-bg)">📝</div><div class="kpi-trend" style="background:var(--green-bg);color:var(--green)">+8 ce mois</div></div><div class="kpi-val" id="kpi-ct-active" style="color:var(--green)">34</div><div class="kpi-label">Contrats actifs</div></div>
      <div class="kpi" style="animation-delay:0.05s;cursor:pointer" onclick="ctFilterByKpi('sign')"><div class="kpi-top"><div class="kpi-icon" style="background:var(--blue-bg)">✍️</div></div><div class="kpi-val" id="kpi-ct-sign" style="color:var(--blue)">6</div><div class="kpi-label">En attente signature</div></div>
      <div class="kpi" style="animation-delay:0.1s;cursor:pointer" onclick="ctFilterByKpi('all')"><div class="kpi-top"><div class="kpi-icon" style="background:#FDE8F3">📎</div></div><div class="kpi-val" id="kpi-ct-amendments" style="color:#E84393">12</div><div class="kpi-label">Avenants ce mois</div></div>
      <div class="kpi" style="animation-delay:0.15s;cursor:pointer" onclick="ctFilterByKpi('expiring')"><div class="kpi-top"><div class="kpi-icon" style="background:var(--orange-bg)">⏰</div></div><div class="kpi-val" id="kpi-ct-expiring" style="color:var(--orange)">5</div><div class="kpi-label">Expirent sous 7j</div></div>
      <div class="kpi" style="animation-delay:0.2s;cursor:pointer" onclick="ctFilterByKpi('ended')"><div class="kpi-top"><div class="kpi-icon" style="background:var(--accent-bg)">📄</div></div><div class="kpi-val" id="kpi-ct-yearly" style="color:var(--accent)">187</div><div class="kpi-label">Total annuel</div></div>
    </div>
    <div class="ct-toolbar">
      <div class="ct-search"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="var(--text-tertiary)" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input placeholder="Rechercher un contrat, candidat, client..." id="ctSearchInput" oninput="ctDoFilter()"/></div>
      <div class="ct-pill on" data-ctf="all" onclick="ctSf(this)">Tous</div>
      <div class="ct-pill" data-ctf="active" onclick="ctSf(this)">✅ Actifs</div>
      <div class="ct-pill" data-ctf="sign" onclick="ctSf(this)">✍️ À signer</div>
      <div class="ct-pill" data-ctf="expiring" onclick="ctSf(this)">⏰ Expirent bientôt</div>
      <div class="ct-pill" data-ctf="ended" onclick="ctSf(this)">🏁 Terminés</div>
    </div>
    <div class="ct-tcard">
      <div class="table-wrap"><table><thead><tr><th>Candidat</th><th>Client / Mission</th><th>Période</th><th>Avancement</th><th>Statut</th><th>Avenants</th><th>Actions</th></tr></thead><tbody id="ctTableBody"></tbody></table></div>
      <div class="ct-pagination"><div class="pag-info" id="ctPagInfo"></div></div>
    </div>
    <div class="powered">Propulsé par <span>IZYSS</span> — Intelligence Artificielle au service de l'intérim</div>
  </div>
</div>

<!-- CONTRATS DRAWER -->
<div class="ct-dov" id="ctDOverlay" onclick="ctCd()"></div>
<div class="ct-dw" id="ctDrawer">
  <div class="ct-dw-head"><span style="font-size:15px;font-weight:800;">📄 Détail contrat</span><button class="ct-dw-x" onclick="ctCd()">✕</button></div>
  <div id="ctDC"></div>
</div>

<!-- CONTRATS AVENANT MODAL -->
<div class="modal-ov" id="ctAvenantModal">
  <div class="modal">
    <div class="modal-h"><div class="modal-t" id="ctAvenModalTitle">📎 Nouvel avenant</div><button class="modal-x" onclick="ctCloseAven()">✕</button></div>
    <div class="modal-body" id="ctAvenModalBody"></div>
    <div class="modal-footer"><button class="btn-secondary" onclick="ctCloseAven()">Annuler</button><button class="ct-btn-p" onclick="ctConfirmAven()">📎 Générer l'avenant</button></div>
  </div>
</div>

<!-- CONTRATS NEW CONTRACT MODAL -->
<div class="modal-ov" id="ctNewContratModal">
  <div class="modal" style="width:540px;">
    <div class="modal-h"><div class="modal-t">📝 Nouveau contrat</div><button class="modal-x" onclick="ctCloseNewContrat()">✕</button></div>
    <div class="modal-body">
      <div class="field"><div class="field-label">Candidat</div><select class="field-input"><option>Marc Lefèvre — Cariste CACES 3</option><option>Thomas Roche — Cariste CACES 1,3,5</option><option>Sarah Dubois — Préparatrice commandes</option><option>Omar Sayed — Cariste CACES 5</option></select></div>
      <div class="field"><div class="field-label">Client</div><select class="field-input"><option>Carrefour Supply Chain</option><option>Amazon — Saint-Priest</option><option>Sanofi — Gerland</option><option>FM Logistic</option></select></div>
      <div class="field"><div class="field-label">Poste / Qualification</div><input class="field-input" placeholder="Ex: Cariste CACES 3" value="Cariste CACES 3"/></div>
      <div class="field-row"><div class="field"><div class="field-label">Date début</div><input class="field-input" type="date" value="2026-02-17"/></div><div class="field"><div class="field-label">Date fin</div><input class="field-input" type="date" value="2026-03-14"/></div></div>
      <div class="field-row"><div class="field"><div class="field-label">Horaires</div><input class="field-input" placeholder="Ex: 6h-14h" value="6h — 14h"/></div><div class="field"><div class="field-label">Taux horaire</div><input class="field-input" placeholder="Ex: 12.50€" value="12.50 €"/></div></div>
      <div class="field"><div class="field-label">Lieu de mission</div><input class="field-input" placeholder="Adresse" value="Entrepôt Carrefour — Vénissieux"/></div>
      <div style="padding:10px 14px;background:var(--accent-bg);border-radius:8px;font-size:11.5px;color:var(--accent);display:flex;align-items:center;gap:6px;">🤖 Le contrat sera pré-rempli par l'IA avec les infos du candidat et du client</div>
    </div>
    <div class="modal-footer"><button class="btn-secondary" onclick="ctCloseNewContrat()">Annuler</button><button class="ct-btn-ac" onclick="ctCreateContrat()">📝 Générer le contrat</button></div>
  </div>
</div>
</div>
<div class="page-section" id="page-scoring">
<div class="main">
  <header class="header">
    <div class="header-left">
      <div class="header-title">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2" stroke-linecap="round"><path d="M12 20V10"/><path d="M18 20V4"/><path d="M6 20v-4"/></svg>
        Scoring CV
      </div>
      <div class="header-subtitle">Configurez vos critères d'évaluation et consultez les scores en temps réel</div>
    </div>
    <div class="header-right">
      <div style="display:flex;align-items:center;gap:8px;padding:7px 14px;background:var(--green-bg);border-radius:20px;font-size:12px;font-weight:600;color:var(--green);">
        <span class="live-dot"></span>
        Scoring actif
      </div>
      <div class="header-btn">
        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg>
        <div class="notif-dot"></div>
      </div>
    </div>
  </header>

  <div class="content">
    <div class="scoring-layout">

      <!-- LEFT: CONFIG PANEL -->
      <div class="card" id="configCard">
        <div class="card-header">
          <div>
            <div class="card-title">⚙️ Configuration des critères</div>
            <div class="card-subtitle">Attribuez des points à chaque critère</div>
          </div>
        </div>

        <div class="total-bar">
          <div>
            <div class="total-label">Total des points</div>
            <div style="display:flex;align-items:baseline;gap:2px;margin-top:4px;">
              <div class="total-value valid" id="totalValue">100</div>
              <div class="total-target">/ 100 pts</div>
            </div>
          </div>
          <div style="font-size:12px;color:var(--text-tertiary);">
            <span id="activeCount">6</span> critères actifs
          </div>
        </div>
        <div style="padding: 0 24px;">
          <div class="total-progress">
            <div class="total-progress-fill" id="totalProgressFill" style="width:100%; background: var(--green);"></div>
          </div>
        </div>

        <div class="criteria-section">
          <div class="criteria-section-title">Critères prédéfinis</div>
        </div>
        <div id="predefinedCriteria"></div>

        <div class="criteria-section">
          <div class="criteria-section-title">Vos critères personnalisés</div>
        </div>
        <div id="customCriteria"></div>

        <div class="add-criterion-area">
          <button class="add-criterion-btn" id="addBtn" onclick="showAddForm()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
            Ajouter un critère personnalisé
          </button>
          <div class="add-form" id="addForm">
            <input type="text" id="newCriterionName" placeholder="Nom du critère (ex: Permis B)" />
            <input type="text" id="newCriterionDesc" placeholder="Description courte (optionnel)" />
            <div class="add-form-actions">
              <button class="btn-primary" onclick="addCustomCriterion()">Ajouter</button>
              <button class="btn-secondary" onclick="hideAddForm()">Annuler</button>
            </div>
          </div>
        </div>

        <div class="save-bar">
          <div class="save-info">
            <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="12" r="10"/><line x1="12" y1="16" x2="12" y2="12"/><line x1="12" y1="8" x2="12.01" y2="8"/></svg>
            Les scores sont recalculés automatiquement
          </div>
          <button class="save-btn" onclick="saveConfig()">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z"/><polyline points="17 21 17 13 7 13 7 21"/><polyline points="7 3 7 8 15 8"/></svg>
            Sauvegarder
          </button>
        </div>
      </div>

      <!-- RIGHT: CV RESULTS -->
      <div class="card">
        <div class="results-header">
          <div class="card-title">
            📊 Candidats scorés
            <span style="font-size:12px;font-weight:500;color:var(--text-tertiary);margin-left:4px;">— temps réel</span>
            <span class="live-dot" style="margin-left:4px;"></span>
          </div>
          <div class="results-filters">
            <div class="filter-chip active" onclick="filterCandidates('all', this)">Tous</div>
            <div class="filter-chip" onclick="filterCandidates('high', this)">Score élevé</div>
            <div class="filter-chip" onclick="filterCandidates('available', this)">Disponibles</div>
          </div>
        </div>

        <table class="cv-table">
          <thead>
            <tr>
              <th>Candidat</th>
              <th>Score global</th>
              <th>Détail scoring</th>
              <th>Statut</th>
              <th></th>
            </tr>
          </thead>
          <tbody id="cvTableBody"></tbody>
        </table>

        <div class="powered-by">
          Propulsé par <span>IZYSS</span> — Intelligence Artificielle au service de l'intérim
        </div>
      </div>
    </div>
  </div>
</div>
</div>
<div class="page-section" id="page-relances">
<div class="main">
  <header class="header">
    <div class="header-left">
      <div class="header-title"><svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="var(--accent)" stroke-width="2"><path d="M22 16.92v3a2 2 0 0 1-2.18 2 19.79 19.79 0 0 1-8.63-3.07 19.5 19.5 0 0 1-6-6 19.79 19.79 0 0 1-3.07-8.67A2 2 0 0 1 4.11 2h3a2 2 0 0 1 2 1.72c.127.96.362 1.903.7 2.81a2 2 0 0 1-.45 2.11L8.09 9.91a16 16 0 0 0 6 6l1.27-1.27a2 2 0 0 1 2.11-.45c.907.338 1.85.573 2.81.7A2 2 0 0 1 22 16.92z"/></svg>Relances & Suivi</div>
      <div class="header-subtitle">Automatisez vos relances, pointages et suivis candidats</div>
    </div>
    <div class="header-right">
      <div style="display:flex;align-items:center;gap:8px;padding:7px 14px;background:var(--green-bg);border-radius:20px;font-size:12px;font-weight:600;color:var(--green);"><span class="live-dot"></span> 3 campagnes actives</div>
      <div class="header-btn"><svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg><div class="notif-dot"></div></div>
    </div>
  </header>

  <div class="content">
    <div class="kpis">
      <div class="kpi" style="animation-delay:0s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--accent-bg)">📤</div><div class="kpi-trend" style="background:var(--green-bg);color:var(--green)">+12 auj.</div></div><div class="kpi-val" style="color:var(--accent)">156</div><div class="kpi-label">Relances envoyées</div></div>
      <div class="kpi" style="animation-delay:0.05s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--green-bg)">✅</div><div class="kpi-trend" style="background:var(--green-bg);color:var(--green)">78%</div></div><div class="kpi-val" style="color:var(--green)">122</div><div class="kpi-label">Réponses reçues</div></div>
      <div class="kpi" style="animation-delay:0.1s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--blue-bg)">📍</div></div><div class="kpi-val" style="color:var(--blue)">18</div><div class="kpi-label">Présences confirmées</div></div>
      <div class="kpi" style="animation-delay:0.15s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--orange-bg)">⏳</div></div><div class="kpi-val" style="color:var(--orange)">34</div><div class="kpi-label">En attente de réponse</div></div>
      <div class="kpi" style="animation-delay:0.2s"><div class="kpi-top"><div class="kpi-icon" style="background:var(--red-bg)">🚨</div></div><div class="kpi-val" style="color:var(--red)">3</div><div class="kpi-label">Alertes (pas de réponse)</div></div>
    </div>

    <div class="layout">
      <div>
        <div class="card" style="margin-bottom:24px;">
          <div class="card-h">
            <div class="card-t">🚀 Campagnes actives</div>
            <div class="card-a" onclick="openRelanceModal()">+ Nouvelle campagne</div>
          </div>
          <div class="campaigns" id="campList"></div>
        </div>
        <div class="card presence">
          <div class="card-h">
            <div class="card-t">📍 Pointage du jour <span style="font-size:12px;color:var(--text-tertiary);font-weight:500;margin-left:4px;">— Lundi 10 fév.</span></div>
            <div class="card-a" onclick="relanceToast('Relance envoyée aux non-confirmés')">Relancer tous</div>
          </div>
          <div class="presence-grid" id="presenceGrid"></div>
        </div>
      </div>
      <div class="card">
        <div class="card-h">
          <div class="card-t"><span class="live-dot" style="margin-right:4px;"></span> Activité en direct</div>
        </div>
        <div class="feed" id="feed"></div>
      </div>
    </div>
    <div class="powered">Propulsé par <span>IZYSS</span> — Intelligence Artificielle au service de l'intérim</div>
  </div>
</div>

<!-- RELANCE CAMPAIGN MODAL -->
<div class="modal-ov" id="relanceModal">
  <div class="modal">
    <div class="modal-h">
      <div class="modal-t">🚀 Nouvelle campagne de relance</div>
      <button class="modal-x" onclick="closeRelanceModal()">✕</button>
    </div>
    <div class="modal-body">
      <div class="field">
        <div class="field-label">Type de relance</div>
        <div class="type-grid">
          <div class="type-card on" onclick="pickType(this)"><div class="type-card-icon">📋</div><div class="type-card-name">Disponibilité</div><div class="type-card-desc">Dispo cette semaine ?</div></div>
          <div class="type-card" onclick="pickType(this)"><div class="type-card-icon">✅</div><div class="type-card-name">Confirmation</div><div class="type-card-desc">Confirmer une mission</div></div>
          <div class="type-card" onclick="pickType(this)"><div class="type-card-icon">💤</div><div class="type-card-name">Réactivation</div><div class="type-card-desc">Candidats dormants</div></div>
          <div class="type-card" onclick="pickType(this)"><div class="type-card-icon">⭐</div><div class="type-card-name">Satisfaction</div><div class="type-card-desc">Retour fin de mission</div></div>
          <div class="type-card" onclick="pickType(this)"><div class="type-card-icon">📄</div><div class="type-card-name">Documents</div><div class="type-card-desc">Visite méd., CACES...</div></div>
          <div class="type-card" onclick="pickType(this)"><div class="type-card-icon">✍️</div><div class="type-card-name">Personnalisé</div><div class="type-card-desc">Message libre</div></div>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Canal d'envoi</div>
        <div class="ch-pills">
          <div class="ch-pill on" onclick="pickCh(this)">📱 SMS</div>
          <div class="ch-pill" onclick="pickCh(this)">💬 WhatsApp</div>
          <div class="ch-pill" onclick="pickCh(this)">📧 Email</div>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Nom de la campagne</div>
        <input class="field-input" id="campName" placeholder="Ex: Dispo semaine 7" />
      </div>
      <div class="field-row">
        <div class="field">
          <div class="field-label">Candidats ciblés</div>
          <select class="field-input">
            <option>Tous les candidats actifs (847)</option>
            <option>Caristes CACES (234)</option>
            <option>Prépa. commandes (189)</option>
            <option>Sans mission depuis 30j (156)</option>
            <option>Sans mission depuis 90j (89)</option>
            <option>Mission cette semaine (34)</option>
          </select>
        </div>
        <div class="field">
          <div class="field-label">Programmation</div>
          <select class="field-input">
            <option>Envoyer maintenant</option>
            <option>Demain 8h</option>
            <option>Lundi prochain 8h</option>
            <option>Chaque lundi 8h (récurrent)</option>
            <option>Chaque vendredi 17h (récurrent)</option>
            <option>Personnalisé...</option>
          </select>
        </div>
      </div>
      <div class="field">
        <div class="field-label">Message (personnalisable)</div>
        <textarea class="field-input" id="campMsg">Bonjour {prénom}, êtes-vous disponible cette semaine pour une mission en intérim ? Répondez OUI ou NON. Merci !</textarea>
      </div>
      <div style="padding:12px 16px;background:var(--accent-bg);border-radius:10px;font-size:12px;color:var(--accent);display:flex;align-items:center;gap:8px;">
        💡 <b>L'IA comprend les réponses libres</b> — "oui dispo lundi", "non pas cette semaine", "à partir de mercredi" → mise à jour automatique de la fiche candidat
      </div>
    </div>
    <div class="modal-footer">
      <button class="btn-secondary" onclick="closeRelanceModal()">Annuler</button>
      <button class="btn-primary" onclick="createCampaign()">🚀 Lancer la campagne</button>
    </div>
  </div>
</div>
</div>
<div class="page-section" id="page-portail">
<div class="main">
  <nav class="pc-topbar">
    <div class="pc-tbl">
      <div class="pc-logo">TS</div>
      <div class="pc-brand"><div class="pc-nm">TalentStaff</div><div class="pc-pw">powered by <b>IZYSS</b></div></div>
      <div class="pc-sep"></div>
      <div class="pc-cl">🏢 Carrefour Supply Chain</div>
    </div>
    <div class="pc-tbr">
      <div class="pc-btn"><svg width="17" height="17" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M18 8A6 6 0 0 0 6 8c0 7-3 9-3 9h18s-3-2-3-9"/><path d="M13.73 21a2 2 0 0 1-3.46 0"/></svg><div class="pc-dot"></div></div>
      <div class="pc-usr"><div class="pc-av">PD</div><div class="pc-un">Philippe D.</div></div>
    </div>
  </nav>

  <div class="pc-page">
    <div class="pc-hero">
      <div class="pc-hero-top">
        <div><h1>Bonjour Philippe 👋</h1><p>Vos talents sélectionnés par intelligence artificielle</p></div>
        <div class="pc-hero-badge">✨ 3 nouveaux profils</div>
      </div>
      <div class="pc-hero-stats">
        <div class="pc-hs"><div class="pc-hs-v">12</div><div class="pc-hs-l">Profils</div></div>
        <div class="pc-hs"><div class="pc-hs-v">8</div><div class="pc-hs-l">Disponibles</div></div>
        <div class="pc-hs"><div class="pc-hs-v">3</div><div class="pc-hs-l">Missions</div></div>
        <div class="pc-hs"><div class="pc-hs-v">95%</div><div class="pc-hs-l">Match moyen</div></div>
      </div>
    </div>

    <div class="pc-pills">
      <div class="pc-pill on" data-pf="all" onclick="pcSf(this)">Tous</div>
      <div class="pc-pill" data-pf="dispo" onclick="pcSf(this)">✅ Disponibles</div>
      <div class="pc-pill" data-pf="new" onclick="pcSf(this)">✨ Nouveaux</div>
      <div class="pc-pill" data-pf="req" onclick="pcSf(this)">👋 Demandés</div>
      <div class="pc-pill-sep"></div>
      <div class="pc-pill" data-pm="cariste" onclick="pcSmf(this)">🏗️ Caristes</div>
      <div class="pc-pill" data-pm="prepa" onclick="pcSmf(this)">📦 Prépa.</div>
      <div class="pc-pill-s"><svg width="15" height="15" viewBox="0 0 24 24" fill="none" stroke="var(--text-tertiary)" stroke-width="2"><circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/></svg><input placeholder="Rechercher..." oninput="pcSq=this.value.toLowerCase();pcR()"/></div>
    </div>

    <div class="pc-grid" id="pcGrid"></div>
    <div class="powered">Propulsé par <b>IZYSS</b> — IA au service de l'intérim</div>
  </div>
</div>

<div class="pc-dov" id="pcDO" onclick="pcCd()"></div>
<div class="pc-dw" id="pcDW">
  <div class="pc-dw-head"><span style="font-size:15px;font-weight:800;">📄 Profil candidat</span><button class="pc-dw-x" onclick="pcCd()">✕</button></div>
  <div id="pcDC"></div>
</div>
</div>

<!-- TOAST (global) -->
<div class="toast" id="toast"></div>

<script>
// ===== SOURCE DE VÉRITÉ — DONNÉES MÉTIER =====
// Source: IZYSS-Details-Application.csv — mise à jour manuelle requise
const IZYSS_DATA = {
  candidates: [
    {id:1,  name:'Marc Lefèvre',     initials:'ML', role:'Cariste CACES 3',          aiScore:92, status:'dispo',    location:'Lyon 7e',         skills:['CACES 3','Entrepôt','Picking']},
    {id:2,  name:'Thomas Roche',     initials:'TR', role:'Cariste CACES 1,3,5',      aiScore:89, status:'dispo',    location:'Villeurbanne',    skills:['CACES 1,3,5','Gerbage']},
    {id:3,  name:'Sarah Dubois',     initials:'SD', role:'Préparatrice commandes',   aiScore:87, status:'dispo',    location:'Saint-Priest',    skills:['Prépa','Scan RF','PDA']},
    {id:4,  name:'Fatima El Amrani', initials:'FA', role:'Cariste CACES 3,5',        aiScore:85, status:'mission',  location:'Vénissieux',      skills:['CACES 3,5','Chargement']},
    {id:5,  name:'Antoine Girard',   initials:'AG', role:'Manutentionnaire',         aiScore:78, status:'dispo',    location:'Décines',         skills:['Manutention','Port charges']},
    {id:6,  name:'Julie Martin',     initials:'JM', role:'Agent de production',      aiScore:81, status:'mission',  location:'Oullins',         skills:['Production','BPF']},
    {id:7,  name:'Sophie Morel',     initials:'SM', role:'Cariste junior',           aiScore:72, status:'dispo',    location:'Bron',            skills:['CACES 3','Formation récente']},
    {id:8,  name:'Nadia Khelif',     initials:'NK', role:'Agent logistique',         aiScore:76, status:'mission',  location:'Saint-Priest',    skills:['Logistique','Scan RF']},
    {id:9,  name:'Karim Benali',     initials:'KB', role:'Manutentionnaire',         aiScore:74, status:'indispo',  location:'Vaulx-en-Velin',  skills:['Manutention','Port charges']},
    {id:10, name:'Pierre Blanc',     initials:'PB', role:'Cariste confirmé',         aiScore:88, status:'dispo',    location:'Gerland',         skills:['CACES 1,3,5','8 ans exp.']},
    {id:11, name:'Lucas Ferreira',   initials:'LF', role:'Préparateur commandes',    aiScore:69, status:'dormant',  location:'Meyzieu',         skills:['Prépa','Commande vocale']},
    {id:12, name:'Amina Diallo',     initials:'AD', role:'Agent de production',      aiScore:82, status:'dispo',    location:'Gerland',         skills:['Production','Qualité']},
    {id:13, name:'Hugo Mercier',     initials:'HM', role:'Manutentionnaire',         aiScore:65, status:'dormant',  location:'Corbas',          skills:['Manutention basique']},
    {id:14, name:'Emma Laurent',     initials:'EL', role:'Prépa. commandes frais',   aiScore:79, status:'dispo',    location:'Décines',         skills:['Froid','Prépa','CACES 1']},
    {id:15, name:'Omar Sayed',       initials:'OS', role:'Cariste CACES 5',          aiScore:58, status:'indispo',  location:'Corbas',          skills:['CACES 5','Grande hauteur']}
  ],
  missions: [
    {id:1, title:'Caristes CACES 3',                    client:'Carrefour Supply Chain', location:'Saint-Priest', urgency:'high',   status:'open',     totalPositions:4, filledPositions:2, matchings:12},
    {id:2, title:'Prépa. commandes',                    client:'Amazon FBA',             location:'Saint-Priest', urgency:'high',   status:'open',     totalPositions:6, filledPositions:3, matchings:18},
    {id:3, title:'Agents de production',                client:'Sanofi',                 location:'Gerland',      urgency:'medium', status:'progress', totalPositions:3, filledPositions:2, matchings:8},
    {id:4, title:'Cariste CACES 5 — Grande hauteur',   client:'FM Logistic',            location:'Vénissieux',   urgency:'high',   status:'urgent',   totalPositions:2, filledPositions:0, matchings:5},
    {id:5, title:'Manutentionnaires',                   client:'Rhenus Logistics',       location:'Corbas',       urgency:'medium', status:'open',     totalPositions:5, filledPositions:3, matchings:14},
    {id:6, title:'Préparateur commandes frais',         client:'Carrefour Supply Chain', location:'Décines',      urgency:'low',    status:'progress', totalPositions:2, filledPositions:2, matchings:6},
    {id:7, title:'Cariste CACES 1',                     client:'Amazon FBA',             location:'Saint-Priest', urgency:'low',    status:'filled',   totalPositions:3, filledPositions:3, matchings:9},
    {id:8, title:'Agents logistiques polyvalents',      client:'Rhenus Logistics',       location:'Corbas',       urgency:'medium', status:'open',     totalPositions:4, filledPositions:1, matchings:11}
  ],
  contracts: [
    {id:1,  candidateName:'Marc Lefèvre',     role:'Cariste CACES 3',       client:'Carrefour Supply Chain', startDate:'2026-01-13', endDate:'2026-03-14', hourlyRate:12.50, status:'active',   amendmentCount:2, contractNumber:'CTT-2026-0087'},
    {id:2,  candidateName:'Thomas Roche',     role:'Cariste CACES 1,3,5',   client:'Carrefour Supply Chain', startDate:'2026-02-03', endDate:'2026-02-28', hourlyRate:13.20, status:'active',   amendmentCount:0, contractNumber:'CTT-2026-0091'},
    {id:3,  candidateName:'Julie Martin',     role:'Préparatrice commandes', client:'Amazon — Saint-Priest',  startDate:'2026-02-03', endDate:'2026-02-21', hourlyRate:11.80, status:'active',   amendmentCount:1, contractNumber:'CTT-2026-0093'},
    {id:4,  candidateName:'Nadia Khelif',     role:'Agent logistique',       client:'Amazon — Saint-Priest',  startDate:'2026-02-03', endDate:'2026-02-14', hourlyRate:11.52, status:'expiring', amendmentCount:0, contractNumber:'CTT-2026-0094'},
    {id:5,  candidateName:'Karim Benali',     role:'Cariste',                client:'Carrefour Supply Chain', startDate:'2026-02-10', endDate:'2026-03-07', hourlyRate:12.00, status:'active',   amendmentCount:0, contractNumber:'CTT-2026-0096'},
    {id:6,  candidateName:'Pierre Blanc',     role:'Cariste confirmé',       client:'Sanofi — Gerland',       startDate:'2026-02-10', endDate:'2026-05-09', hourlyRate:13.80, status:'sign',     amendmentCount:0, contractNumber:'CTT-2026-0097'},
    {id:7,  candidateName:'Omar Sayed',       role:'Cariste CACES 5',        client:'FM Logistic',            startDate:'2026-02-17', endDate:'2026-03-14', hourlyRate:13.00, status:'sign',     amendmentCount:0, contractNumber:'CTT-2026-0098'},
    {id:8,  candidateName:'Sarah Dubois',     role:'Préparatrice commandes', client:'Amazon — Saint-Priest',  startDate:'2025-12-01', endDate:'2026-01-31', hourlyRate:11.52, status:'ended',    amendmentCount:1, contractNumber:'CTT-2025-0412'},
    {id:9,  candidateName:'Fatima El Amrani', role:'Cariste',                client:'Sanofi — Gerland',       startDate:'2025-11-04', endDate:'2026-01-17', hourlyRate:12.00, status:'ended',    amendmentCount:2, contractNumber:'CTT-2025-0378'},
    {id:10, candidateName:'Sophie Morel',     role:'Cariste junior',         client:'Carrefour Supply Chain', startDate:'2026-02-12', endDate:'2026-02-14', hourlyRate:11.88, status:'expiring', amendmentCount:0, contractNumber:'CTT-2026-0099'}
  ],
  clients: [
    {name:'Carrefour Supply Chain', emoji:'🏪', sector:'Grande distribution / Logistique', location:'Vénissieux, Décines'},
    {name:'Amazon — Saint-Priest',  emoji:'📦', sector:'E-commerce / Logistique',          location:'Saint-Priest (Centre STR1)'},
    {name:'Sanofi — Gerland',       emoji:'💊', sector:'Pharmaceutique',                    location:'Gerland, Saint-Fons'},
    {name:'FM Logistic',            emoji:'🏭', sector:'Logistique',                        location:'Vénissieux, Corbas'},
    {name:'Rhenus Logistics',       emoji:'🚛', sector:'Transport / Logistique',            location:'Corbas'}
  ]
};

// ===== MOTEUR KPI — CALCUL DYNAMIQUE =====
const KPIEngine = {
  dashboard() {
    // activeMissions : calculé dynamiquement depuis IZYSS_DATA.missions
    const activeMissions = IZYSS_DATA.missions.filter(m => ['open','progress','urgent'].includes(m.status)).length;
    return {
      totalCandidates: 847,    // Volume agence (PRD)
      activeMissions,           // Calculé depuis statuts IZYSS_DATA
      contractsThisMonth: 34,   // Volume mensuel agence (PRD)
      placementRate: 78         // Taux placement agence (PRD)
    };
  },
  candidates() {
    return {
      total: 847,      // Volume agence (PRD)
      available: 234,  // Disponibles cette semaine agence (PRD)
      onMission: 67,   // En mission agence (PRD)
      inactive: 156    // Inactifs +90j agence (PRD)
    };
  },
  missions() {
    const data = IZYSS_DATA.missions;
    // active et urgent : calculés depuis IZYSS_DATA
    const active = data.filter(m => ['open','progress','urgent'].includes(m.status)).length;
    const urgent = data.filter(m => m.urgency === 'high').length;
    return {
      active,                  // Calculé depuis statuts (open/progress/urgent)
      urgent,                  // Calculé depuis urgency=high
      filledThisMonth: 34,     // Postes pourvus agence (PRD)
      onSite: 67,              // Intérimaires en poste agence (PRD)
      avgPlacementDays: 2.1    // Délai moyen placement agence (PRD)
    };
  },
  contracts() {
    const data = IZYSS_DATA.contracts;
    // active, toSign, expiringSoon : calculés depuis IZYSS_DATA
    const active = data.filter(c => c.status === 'active').length;
    const toSign = data.filter(c => c.status === 'sign').length;
    const expiringSoon = data.filter(c => c.status === 'expiring').length;
    return {
      active,                  // Calculé depuis status=active
      toSign,                  // Calculé depuis status=sign
      amendmentsThisMonth: 12, // Avenants ce mois agence (PRD)
      expiringSoon,            // Calculé depuis status=expiring
      yearlyTotal: 187         // Total annuel agence (PRD)
    };
  }
};

// ===== INJECTION DES KPIs DANS LE DOM =====
function initKPIs() {
  // Dashboard KPIs
  const db = KPIEngine.dashboard();
  document.getElementById('kpi-db-total-candidates').textContent  = db.totalCandidates;
  document.getElementById('kpi-db-active-missions').textContent   = db.activeMissions;
  document.getElementById('kpi-db-contracts-month').textContent   = db.contractsThisMonth;
  document.getElementById('kpi-db-placement-rate').textContent    = db.placementRate + '%';

  // Candidats KPIs
  const cd = KPIEngine.candidates();
  document.getElementById('kpi-cd-total').textContent    = cd.total;
  document.getElementById('kpi-cd-available').textContent = cd.available;
  document.getElementById('kpi-cd-on-mission').textContent = cd.onMission;
  document.getElementById('kpi-cd-inactive').textContent  = cd.inactive;

  // Missions KPIs
  const ms = KPIEngine.missions();
  document.getElementById('kpi-ms-active').textContent       = ms.active;
  document.getElementById('kpi-ms-urgent').textContent       = ms.urgent;
  document.getElementById('kpi-ms-filled').textContent       = ms.filledThisMonth;
  document.getElementById('kpi-ms-on-site').textContent      = ms.onSite;
  document.getElementById('kpi-ms-avg-days').textContent     = ms.avgPlacementDays + 'j';

  // Contrats KPIs
  const ct = KPIEngine.contracts();
  document.getElementById('kpi-ct-active').textContent      = ct.active;
  document.getElementById('kpi-ct-sign').textContent        = ct.toSign;
  document.getElementById('kpi-ct-amendments').textContent  = ct.amendmentsThisMonth;
  document.getElementById('kpi-ct-expiring').textContent    = ct.expiringSoon;
  document.getElementById('kpi-ct-yearly').textContent      = ct.yearlyTotal;
}

document.addEventListener('DOMContentLoaded', function() {
  initKPIs();
});

// ===== NAVIGATION =====
let currentPage = 'matching';

function navigateTo(pageId) {
  if (currentPage === pageId) return;
  document.querySelectorAll('.page-section').forEach(s => s.classList.remove('active'));
  const target = document.getElementById('page-' + pageId);
  if (target) target.classList.add('active');
  document.querySelectorAll('.sidebar .nav-item').forEach(item => {
    item.classList.toggle('active', item.dataset.page === pageId);
  });
  currentPage = pageId;
  window.scrollTo(0, 0);
}

// ===== MATCHING PAGE JS (verbatim from original) =====
// ===== MISSIONS DATA =====
const missions = [
  {
    title: 'Cariste CACES 3', client: 'Carrefour Supply Chain', lieu: 'Lyon 7e',
    date: '2026-02-14', duree: '2 semaines', nb: 5, horaires: 'Journée (8h-16h)',
    tags: ['CACES 3', 'Expérience entrepôt', 'Visite médicale à jour'],
    candidates: [
      { name: 'Marc Lefèvre', initials: 'ML', sub: 'Cariste · Lyon 7e · 4 ans exp.', gradient: 'linear-gradient(135deg,#6C5CE7,#A29BFE)', pct: 95, status: 'Disponible', statusClass: 'available', crits: [{t:'CACES 3',s:'ok'},{t:'Expérience',s:'ok'},{t:'Proximité',s:'ok'},{t:'Visite méd.',s:'ok'}] },
      { name: 'Thomas Roche', initials: 'TR', sub: 'Cariste CACES 1,3,5 · Vénissieux · 6 ans', gradient: 'linear-gradient(135deg,#00B894,#55E6A5)', pct: 91, status: 'Disponible', statusClass: 'available', crits: [{t:'CACES 3',s:'ok'},{t:'Expérience',s:'ok'},{t:'Proximité',s:'partial'},{t:'Visite méd.',s:'ok'}] },
      { name: 'Fatima El Amrani', initials: 'FA', sub: 'Cariste · Gerland · 3 ans exp.', gradient: 'linear-gradient(135deg,#F39C12,#FDCB6E)', pct: 87, status: 'Disponible', statusClass: 'available', crits: [{t:'CACES 3',s:'ok'},{t:'Expérience',s:'ok'},{t:'Proximité',s:'ok'},{t:'Visite méd.',s:'partial'}] },
      { name: 'Karim Benali', initials: 'KB', sub: 'Cariste · Saint-Priest · 2 ans', gradient: 'linear-gradient(135deg,#E74C3C,#FF7675)', pct: 82, status: 'En attente', statusClass: 'pending', crits: [{t:'CACES 3',s:'ok'},{t:'Expérience',s:'partial'},{t:'Proximité',s:'partial'},{t:'Visite méd.',s:'ok'}] },
      { name: 'Antoine Girard', initials: 'AG', sub: 'Cariste · Décines · 5 ans exp.', gradient: 'linear-gradient(135deg,#4A90D9,#74B9FF)', pct: 79, status: 'Disponible', statusClass: 'available', crits: [{t:'CACES 3',s:'ok'},{t:'Expérience',s:'ok'},{t:'Proximité',s:'partial'},{t:'Visite méd.',s:'no'}] },
      { name: 'Sophie Morel', initials: 'SM', sub: 'Cariste · Bron · 1 an exp.', gradient: 'linear-gradient(135deg,#A29BFE,#DDA0DD)', pct: 74, status: 'Disponible', statusClass: 'available', crits: [{t:'CACES 3',s:'ok'},{t:'Expérience',s:'partial'},{t:'Proximité',s:'ok'},{t:'Visite méd.',s:'ok'}] },
      { name: 'Youssef Amara', initials: 'YA', sub: 'Magasinier · Oullins · 3 ans', gradient: 'linear-gradient(135deg,#00CEC9,#81ECEC)', pct: 68, status: 'Disponible', statusClass: 'available', crits: [{t:'CACES 3',s:'partial'},{t:'Expérience',s:'partial'},{t:'Proximité',s:'ok'},{t:'Visite méd.',s:'ok'}] },
      { name: 'Claire Dupont', initials: 'CD', sub: 'Cariste · Villeurbanne · 2 ans', gradient: 'linear-gradient(135deg,#FD79A8,#FDCB6E)', pct: 63, status: 'En attente', statusClass: 'pending', crits: [{t:'CACES 3',s:'ok'},{t:'Expérience',s:'partial'},{t:'Proximité',s:'partial'},{t:'Visite méd.',s:'no'}] },
    ]
  },
  {
    title: 'Préparateur commandes', client: 'Amazon FBA', lieu: 'Saint-Priest',
    date: '2026-02-12', duree: '1 mois', nb: 3, horaires: '2x8',
    tags: ['Préparation commandes', 'Scan RF', 'Port de charges'],
    candidates: [
      { name: 'Sarah Dubois', initials: 'SD', sub: 'Prépa. commandes · Villeurbanne · 3 ans', gradient: 'linear-gradient(135deg,#4A90D9,#74B9FF)', pct: 93, status: 'Disponible', statusClass: 'available', crits: [{t:'Prépa. cmd',s:'ok'},{t:'Scan RF',s:'ok'},{t:'Proximité',s:'ok'}] },
      { name: 'Julie Martin', initials: 'JM', sub: 'Opératrice · Décines · 2 ans', gradient: 'linear-gradient(135deg,#A29BFE,#DDA0DD)', pct: 85, status: 'Disponible', statusClass: 'available', crits: [{t:'Prépa. cmd',s:'ok'},{t:'Scan RF',s:'partial'},{t:'Proximité',s:'ok'}] },
      { name: 'Nadia Khelif', initials: 'NK', sub: 'Manutentionnaire · Vénissieux · 1 an', gradient: 'linear-gradient(135deg,#00B894,#55E6A5)', pct: 76, status: 'Disponible', statusClass: 'available', crits: [{t:'Prépa. cmd',s:'partial'},{t:'Scan RF',s:'ok'},{t:'Proximité',s:'ok'}] },
      { name: 'Lucas Ferreira', initials: 'LF', sub: 'Logistique · Lyon 8e · 4 ans', gradient: 'linear-gradient(135deg,#F39C12,#FDCB6E)', pct: 71, status: 'En attente', statusClass: 'pending', crits: [{t:'Prépa. cmd',s:'ok'},{t:'Scan RF',s:'partial'},{t:'Proximité',s:'partial'}] },
      { name: 'Emma Laurent', initials: 'EL', sub: 'Prépa. commandes · Meyzieu · 2 ans', gradient: 'linear-gradient(135deg,#E74C3C,#FF7675)', pct: 67, status: 'Disponible', statusClass: 'available', crits: [{t:'Prépa. cmd',s:'ok'},{t:'Scan RF',s:'no'},{t:'Proximité',s:'partial'}] },
    ]
  },
  {
    title: 'Agent de production', client: 'Sanofi', lieu: 'Gerland',
    date: '2026-02-17', duree: '3 mois', nb: 2, horaires: '3x8',
    tags: ['Production pharma', 'Salle blanche', 'BPF'],
    candidates: [
      { name: 'Pierre Blanc', initials: 'PB', sub: 'Agent prod. pharma · Lyon 7e · 5 ans', gradient: 'linear-gradient(135deg,#6C5CE7,#A29BFE)', pct: 90, status: 'Disponible', statusClass: 'available', crits: [{t:'Prod. pharma',s:'ok'},{t:'Salle blanche',s:'ok'},{t:'BPF',s:'ok'}] },
      { name: 'Amina Diallo', initials: 'AD', sub: 'Opératrice · Gerland · 3 ans', gradient: 'linear-gradient(135deg,#00CEC9,#81ECEC)', pct: 84, status: 'Disponible', statusClass: 'available', crits: [{t:'Prod. pharma',s:'ok'},{t:'Salle blanche',s:'ok'},{t:'BPF',s:'partial'}] },
      { name: 'Romain Faure', initials: 'RF', sub: 'Agent conditionnement · Bron · 2 ans', gradient: 'linear-gradient(135deg,#F39C12,#FDCB6E)', pct: 72, status: 'En attente', statusClass: 'pending', crits: [{t:'Prod. pharma',s:'partial'},{t:'Salle blanche',s:'ok'},{t:'BPF',s:'no'}] },
    ]
  }
];

let currentMission = 0;

// ===== RENDER MATCHES =====
function renderMatches(missionIdx) {
  const m = missions[missionIdx];
  const list = document.getElementById('matchList');
  const count = document.getElementById('resultsCount');
  count.textContent = m.candidates.length;

  list.innerHTML = m.candidates.map((c, i) => {
    const circ = 2 * Math.PI * 22;
    const offset = circ - (c.pct / 100) * circ;
    const col = c.pct >= 85 ? 'var(--green)' : c.pct >= 70 ? 'var(--orange)' : 'var(--red)';

    return `
      <div class="match-card" style="animation:fadeUp 0.4s ease backwards; animation-delay:${i * 0.05}s;">
        <div class="match-rank ${i < 3 ? 'top' : ''}">#${i + 1}</div>
        <div class="match-avatar" style="background:${c.gradient};">${c.initials}</div>
        <div class="match-info">
          <div class="match-name">${c.name}</div>
          <div class="match-sub">${c.sub}</div>
          <div class="match-criteria">
            ${c.crits.map(cr => `<div class="match-crit ${cr.s}">${cr.s === 'ok' ? '✓' : cr.s === 'partial' ? '~' : '✗'} ${cr.t}</div>`).join('')}
          </div>
        </div>
        <div class="match-pct-wrap">
          <div class="match-ring">
            <svg viewBox="0 0 48 48">
              <circle class="match-ring-bg" cx="24" cy="24" r="22"/>
              <circle class="match-ring-fill" cx="24" cy="24" r="22" stroke="${col}" stroke-dasharray="${circ}" stroke-dashoffset="${offset}"/>
            </svg>
            <div class="match-ring-text" style="color:${col};">${c.pct}%</div>
          </div>
          <div class="match-pct-label">compatibilité</div>
        </div>
        <div class="match-card-actions">
          <div class="match-action-btn" title="Voir CV">📄</div>
          <div class="match-action-btn" title="Contacter">📱</div>
          <div class="match-action-btn" title="Générer contrat">📝</div>
        </div>
      </div>
    `;
  }).join('');
}

function updateFiche(missionIdx) {
  const m = missions[missionIdx];
  document.getElementById('fichePoste').value = m.title;
  document.getElementById('ficheClient').value = m.client;
  document.getElementById('ficheLieu').value = m.lieu;
  document.getElementById('ficheDate').value = m.date;
  document.getElementById('ficheNb').value = m.nb;

  const tagsEl = document.getElementById('ficheTags');
  tagsEl.innerHTML = m.tags.map(t => `<div class="fiche-tag">${t} <span class="fiche-tag-remove" onclick="removeTag(this)">×</span></div>`).join('');
}

function selectMission(idx, el) {
  currentMission = idx;
  document.querySelectorAll('.mission-tab').forEach(t => t.classList.remove('active'));
  if (el) el.classList.add('active');
  updateFiche(idx);
  renderMatches(idx);
}

// ===== TAGS =====
function removeTag(el) { el.parentElement.remove(); }
function addTag() {
  const input = document.getElementById('newTagInput');
  const val = input.value.trim();
  if (!val) return;
  const tag = document.createElement('div');
  tag.className = 'fiche-tag';
  tag.innerHTML = val + ' <span class="fiche-tag-remove" onclick="removeTag(this)">×</span>';
  document.getElementById('ficheTags').appendChild(tag);
  input.value = '';
}

// ===== MATCHING =====
function runMatching() {
  const list = document.getElementById('matchList');
  const overlay = document.getElementById('scanOverlay');
  const fill = document.getElementById('scanFill');
  const sub = document.getElementById('scanSub');

  list.style.display = 'none';
  overlay.classList.add('show');

  let progress = 0;
  const total = 847;
  const interval = setInterval(() => {
    progress += Math.floor(Math.random() * 120) + 40;
    if (progress > total) progress = total;
    fill.style.width = (progress / total * 100) + '%';
    sub.textContent = progress + ' / ' + total + ' profils analysés';
    if (progress >= total) {
      clearInterval(interval);
      setTimeout(() => {
        overlay.classList.remove('show');
        list.style.display = 'block';
        renderMatches(currentMission);
        showToast('✅ Matching terminé — ' + missions[currentMission].candidates.length + ' candidats compatibles trouvés');
      }, 400);
    }
  }, 200);
}

// ===== NEW FICHE MODAL =====
function openNewFiche() {
  document.getElementById('newFicheModal').classList.add('show');
}
function closeModal() {
  document.getElementById('newFicheModal').classList.remove('show');
}
function createFiche() {
  const poste = document.getElementById('modalPoste').value.trim();
  const client = document.getElementById('modalClient').value.trim();
  const lieu = document.getElementById('modalLieu').value.trim();
  if (!poste) { showToast('⚠️ Veuillez renseigner un intitulé de poste'); return; }

  // Add tab
  const tabs = document.getElementById('missionTabs');
  const newTab = document.createElement('div');
  newTab.className = 'mission-tab';
  newTab.innerHTML = `
    <div class="mission-tab-urgency medium"></div>
    <div class="mission-tab-info">
      <div class="mission-tab-title">${poste}</div>
      <div class="mission-tab-meta">📍 ${client || 'Client'} — ${lieu || 'Localisation'}</div>
    </div>
    <div class="mission-tab-match">0</div>
  `;
  tabs.insertBefore(newTab, tabs.lastElementChild);

  // Add to missions data
  const comps = document.getElementById('modalComp').value.split(',').map(s => s.trim()).filter(Boolean);
  missions.push({
    title: poste, client: client || 'Nouveau client', lieu: lieu || '',
    date: document.getElementById('modalDate').value || '2026-03-01',
    duree: '1 mois', nb: parseInt(document.getElementById('modalNb').value) || 1,
    horaires: 'Journée (8h-16h)', tags: comps.length ? comps : [poste],
    candidates: []
  });

  const newIdx = missions.length - 1;
  newTab.onclick = () => selectMission(newIdx, newTab);

  closeModal();
  selectMission(newIdx, newTab);
  showToast('✅ Fiche de poste "' + poste + '" créée — Lancez le matching !');
}

// ===== TOAST =====
function showToast(msg) {
  const t = document.getElementById('toast');
  t.textContent = msg;
  t.classList.add('show');
  setTimeout(() => t.classList.remove('show'), 3000);
}

// ===== INIT =====
renderMatches(0);

// ===== SCORING PAGE JS =====
const predefined = [
  { id: 'exp', name: 'Expérience métier', desc: 'Années dans le secteur', icon: '💼', color: '#6C5CE7', bg: '#F0EEFF', points: 25, active: true },
  { id: 'cert', name: 'Certifications / CACES', desc: 'Habilitations et permis', icon: '🎓', color: '#4A90D9', bg: '#EBF3FC', points: 20, active: true },
  { id: 'dispo', name: 'Disponibilité', desc: 'Rapidité de démarrage', icon: '⚡', color: '#2ECC71', bg: '#E8F8F0', points: 20, active: true },
  { id: 'geo', name: 'Proximité géographique', desc: 'Distance au lieu de mission', icon: '📍', color: '#F39C12', bg: '#FEF5E7', points: 15, active: true },
  { id: 'eval', name: 'Évaluations précédentes', desc: 'Notes des missions passées', icon: '⭐', color: '#E74C3C', bg: '#FDECEB', points: 10, active: true },
  { id: 'lang', name: 'Compétences linguistiques', desc: 'Langues parlées', icon: '🌍', color: '#00B894', bg: '#E8F8F5', points: 10, active: true },
];

let customCriteria = [];
let customIdCounter = 0;

const scoringCandidates = [
  {
    name: 'Marc Lefèvre', initials: 'ML', sub: 'Cariste CACES 3 · Lyon 7e',
    gradient: 'linear-gradient(135deg, #6C5CE7, #A29BFE)',
    status: 'available', statusText: 'Disponible',
    scores: { exp: 23, cert: 20, dispo: 18, geo: 14, eval: 9, lang: 8 }
  },
  {
    name: 'Sarah Dubois', initials: 'SD', sub: 'Préparatrice commandes · Villeurbanne',
    gradient: 'linear-gradient(135deg, #4A90D9, #74B9FF)',
    status: 'available', statusText: 'Disponible',
    scores: { exp: 20, cert: 18, dispo: 20, geo: 12, eval: 10, lang: 7 }
  },
  {
    name: 'Thomas Roche', initials: 'TR', sub: 'Cariste CACES 1,3,5 · Vénissieux',
    gradient: 'linear-gradient(135deg, #00B894, #55E6A5)',
    status: 'available', statusText: 'Disponible',
    scores: { exp: 25, cert: 20, dispo: 15, geo: 10, eval: 8, lang: 6 }
  },
  {
    name: 'Fatima El Amrani', initials: 'FA', sub: 'Agent de production · Gerland',
    gradient: 'linear-gradient(135deg, #F39C12, #FDCB6E)',
    status: 'pending', statusText: 'En attente',
    scores: { exp: 18, cert: 14, dispo: 16, geo: 15, eval: 7, lang: 10 }
  },
  {
    name: 'Karim Benali', initials: 'KB', sub: 'Manutentionnaire · Saint-Priest',
    gradient: 'linear-gradient(135deg, #E74C3C, #FF7675)',
    status: 'placed', statusText: 'Placé',
    scores: { exp: 15, cert: 12, dispo: 10, geo: 13, eval: 6, lang: 5 }
  },
  {
    name: 'Julie Martin', initials: 'JM', sub: 'Opératrice conditionnement · Décines',
    gradient: 'linear-gradient(135deg, #A29BFE, #DDA0DD)',
    status: 'available', statusText: 'Disponible',
    scores: { exp: 21, cert: 16, dispo: 19, geo: 11, eval: 9, lang: 8 }
  },
];

function renderCriteria() {
  const predContainer = document.getElementById('predefinedCriteria');
  const custContainer = document.getElementById('customCriteria');

  predContainer.innerHTML = predefined.map((c, i) => criterionHTML(c, 'pred', i)).join('');
  custContainer.innerHTML = customCriteria.map((c, i) => criterionHTML(c, 'cust', i)).join('');

  updateTotal();
  renderScoringCandidates();
}

function criterionHTML(c, type, index) {
  return `
    <div class="criterion">
      <label class="criterion-toggle">
        <input type="checkbox" ${c.active ? 'checked' : ''} onchange="toggleCriterion('${type}', ${index})" />
        <span class="toggle-slider"></span>
      </label>
      <div class="criterion-icon" style="background:${c.bg};">${c.icon}</div>
      <div class="criterion-info">
        <div class="criterion-name">${c.name}</div>
        <div class="criterion-desc">${c.desc || ''}</div>
      </div>
      <div class="criterion-points">
        <div class="points-btn" onclick="changePoints('${type}', ${index}, -5)">−</div>
        <div class="points-value ${c.active ? '' : 'disabled'}">${c.points}</div>
        <div class="points-btn" onclick="changePoints('${type}', ${index}, 5)">+</div>
      </div>
    </div>
  `;
}

function toggleCriterion(type, index) {
  const list = type === 'pred' ? predefined : customCriteria;
  list[index].active = !list[index].active;
  renderCriteria();
}

function changePoints(type, index, delta) {
  const list = type === 'pred' ? predefined : customCriteria;
  list[index].points = Math.max(0, Math.min(100, list[index].points + delta));
  renderCriteria();
}

function updateTotal() {
  const allCriteria = [...predefined, ...customCriteria];
  const active = allCriteria.filter(c => c.active);
  const total = active.reduce((sum, c) => sum + c.points, 0);

  const el = document.getElementById('totalValue');
  const fill = document.getElementById('totalProgressFill');
  const countEl = document.getElementById('activeCount');

  el.textContent = total;
  countEl.textContent = active.length;

  const pct = Math.min(total / 100 * 100, 150);
  fill.style.width = Math.min(pct, 100) + '%';

  if (total === 100) {
    el.className = 'total-value valid';
    fill.style.background = 'var(--green)';
  } else if (total > 100) {
    el.className = 'total-value over';
    fill.style.background = 'var(--red)';
  } else {
    el.className = 'total-value warning';
    fill.style.background = 'var(--orange)';
  }
}

function showAddForm() {
  document.getElementById('addBtn').style.display = 'none';
  document.getElementById('addForm').classList.add('show');
  document.getElementById('newCriterionName').focus();
}

function hideAddForm() {
  document.getElementById('addBtn').style.display = 'flex';
  document.getElementById('addForm').classList.remove('show');
  document.getElementById('newCriterionName').value = '';
  document.getElementById('newCriterionDesc').value = '';
}

function addCustomCriterion() {
  const name = document.getElementById('newCriterionName').value.trim();
  const desc = document.getElementById('newCriterionDesc').value.trim();
  if (!name) return;

  const icons = ['🔧', '🏗️', '📋', '🔬', '🛡️', '💡', '🚗', '📐'];
  const colors = ['#6C5CE7', '#4A90D9', '#2ECC71', '#F39C12', '#E74C3C', '#00B894'];
  const bgs = ['#F0EEFF', '#EBF3FC', '#E8F8F0', '#FEF5E7', '#FDECEB', '#E8F8F5'];
  const idx = customIdCounter % icons.length;

  customCriteria.push({
    id: 'custom_' + customIdCounter++,
    name, desc,
    icon: icons[idx],
    color: colors[idx],
    bg: bgs[idx],
    points: 10,
    active: true
  });

  hideAddForm();
  renderCriteria();
  showToast('✅ Critère "' + name + '" ajouté');
}

function renderScoringCandidates(filter) {
  const tbody = document.getElementById('cvTableBody');
  const activeCriteria = [...predefined, ...customCriteria].filter(c => c.active);
  const maxTotal = activeCriteria.reduce((s, c) => s + c.points, 0) || 1;

  let filtered = scoringCandidates;
  if (filter === 'high') filtered = scoringCandidates.filter(c => calcTotal(c, activeCriteria) / maxTotal >= 0.8);
  if (filter === 'available') filtered = scoringCandidates.filter(c => c.status === 'available');

  filtered.sort((a, b) => calcTotal(b, activeCriteria) - calcTotal(a, activeCriteria));

  tbody.innerHTML = filtered.map((c, i) => {
    const total = calcTotal(c, activeCriteria);
    const pct = Math.round((total / maxTotal) * 100);
    const circumference = 2 * Math.PI * 20;
    const offset = circumference - (pct / 100) * circumference;
    const scoreColor = pct >= 80 ? 'var(--green)' : pct >= 60 ? 'var(--orange)' : 'var(--red)';

    const breakdown = activeCriteria.slice(0, 4).map(cr => {
      const pts = c.scores[cr.id] || Math.round(Math.random() * cr.points * 0.8);
      const bPct = (pts / cr.points) * 100;
      return `
        <div class="breakdown-row">
          <div class="breakdown-label">${cr.name.substring(0, 12)}</div>
          <div class="breakdown-track"><div class="breakdown-fill" style="width:${bPct}%; background:${cr.color};"></div></div>
          <div class="breakdown-pts" style="color:${cr.color};">${pts}</div>
        </div>
      `;
    }).join('');

    return `
      <tr style="animation: fadeUp 0.4s ease backwards; animation-delay: ${i * 0.06}s;">
        <td>
          <div class="candidate-cell">
            <div class="candidate-avatar" style="background:${c.gradient};">${c.initials}</div>
            <div>
              <div class="candidate-name">${c.name}</div>
              <div class="candidate-sub">${c.sub}</div>
            </div>
          </div>
        </td>
        <td>
          <div class="score-ring">
            <svg viewBox="0 0 44 44">
              <circle class="score-ring-bg" cx="22" cy="22" r="20"/>
              <circle class="score-ring-fill" cx="22" cy="22" r="20"
                stroke="${scoreColor}"
                stroke-dasharray="${circumference}"
                stroke-dashoffset="${offset}"/>
            </svg>
            <div class="score-ring-text" style="color:${scoreColor};">${pct}</div>
          </div>
        </td>
        <td>
          <div class="score-breakdown">${breakdown}</div>
        </td>
        <td>
          <span class="status-badge ${c.status}"><span class="status-dot"></span>${c.statusText}</span>
        </td>
        <td>
          <div class="row-actions">
            <div class="row-action-btn" title="Voir le CV">📄</div>
            <div class="row-action-btn" title="Contacter">📱</div>
          </div>
        </td>
      </tr>
    `;
  }).join('');
}

function calcTotal(candidate, activeCriteria) {
  return activeCriteria.reduce((sum, cr) => {
    return sum + (candidate.scores[cr.id] || Math.round(Math.random() * cr.points * 0.7));
  }, 0);
}

function filterCandidates(filter, el) {
  document.querySelectorAll('.filter-chip').forEach(c => c.classList.remove('active'));
  if (el) el.classList.add('active');
  renderScoringCandidates(filter);
}

function saveConfig() {
  const allActive = [...predefined, ...customCriteria].filter(c => c.active);
  const total = allActive.reduce((s, c) => s + c.points, 0);

  if (total !== 100) {
    showToast('⚠️ Le total doit être de 100 points (actuellement ' + total + ')');
    return;
  }

  showToast('✅ Configuration sauvegardée — Scores recalculés en temps réel');
  renderScoringCandidates();
}

renderCriteria();

// ===== RELANCES PAGE JS =====
const relanceCampaigns = [
  {id:1,name:'Dispo semaine 7',type:'📋',desc:'Disponibilité — 234 caristes ciblés',status:'running',sent:234,replied:187,rate:80,channel:'SMS',color:'var(--green)'},
  {id:2,name:'Confirmation lundi — Carrefour',type:'✅',desc:'Confirmation mission — 18 candidats placés',status:'running',sent:18,replied:15,rate:83,channel:'SMS',color:'var(--green)'},
  {id:3,name:'Réactivation dormants +90j',type:'💤',desc:'Candidats inactifs depuis 3 mois — 89 ciblés',status:'running',sent:89,replied:34,rate:38,channel:'WhatsApp',color:'var(--orange)'},
  {id:4,name:'Satisfaction mission Sanofi',type:'⭐',desc:'Retour fin de mission — 8 candidats',status:'done',sent:8,replied:7,rate:88,channel:'SMS',color:'var(--accent)'},
  {id:5,name:'Docs CACES expirés',type:'📄',desc:'Renouvellement CACES — 12 candidats',status:'scheduled',sent:0,replied:0,rate:0,channel:'Email',color:'var(--blue)'},
  {id:6,name:'Dispo semaine 8',type:'📋',desc:'Disponibilité — Tous les actifs',status:'scheduled',sent:0,replied:0,rate:0,channel:'SMS',color:'var(--blue)'},
];

function renderCampaigns(){
  const el=document.getElementById('campList');
  if(!el) return;
  el.innerHTML=relanceCampaigns.map((c,i)=>{
    const barW=c.sent?Math.round(c.replied/c.sent*100):0;
    const barCol=barW>=70?'linear-gradient(90deg,var(--green),#55E6A5)':barW>=40?'linear-gradient(90deg,var(--orange),#FDCB6E)':'linear-gradient(90deg,var(--red),#FF7675)';
    return`<div class="camp ${c.status}" style="animation:fadeUp 0.4s ease backwards;animation-delay:${i*0.05}s;">
      <div class="camp-top">
        <div class="camp-icon" style="background:${c.status==='running'?'var(--green-bg)':c.status==='scheduled'?'var(--blue-bg)':c.status==='done'?'var(--accent-bg)':'var(--orange-bg)'}">${c.type}</div>
        <div class="camp-info"><div class="camp-name">${c.name}</div><div class="camp-desc">${c.desc}</div></div>
        <div class="camp-status ${c.status}">${c.status==='running'?'● En cours':c.status==='scheduled'?'⏰ Programmé':c.status==='done'?'✓ Terminé':'⏸ Pause'}</div>
      </div>
      ${c.sent?`<div class="camp-stats">
        <div class="camp-stat"><div class="camp-stat-val">${c.sent}</div><div class="camp-stat-label">envoyés</div></div>
        <div class="camp-stat"><div class="camp-stat-val">${c.replied}</div><div class="camp-stat-label">réponses</div></div>
        <div class="camp-stat"><div class="camp-stat-val" style="color:${c.color}">${c.rate}%</div><div class="camp-stat-label">taux</div></div>
        <div class="camp-stat"><div class="camp-stat-val">📱</div><div class="camp-stat-label">${c.channel}</div></div>
      </div>
      <div class="camp-bar"><div class="camp-bar-fill" style="width:${barW}%;background:${barCol}"></div></div>`:''}
      <div class="camp-actions">
        ${c.status==='running'?`<div class="camp-btn pause" onclick="event.stopPropagation();pauseCamp(${c.id})">⏸ Pause</div><div class="camp-btn" onclick="event.stopPropagation();showToast('Détails campagne')">📊 Détails</div>`:''}
        ${c.status==='scheduled'?`<div class="camp-btn" onclick="event.stopPropagation();launchCamp(${c.id})">▶ Lancer maintenant</div><div class="camp-btn stop" onclick="event.stopPropagation();cancelCamp(${c.id})">✕ Annuler</div>`:''}
        ${c.status==='done'?`<div class="camp-btn" onclick="event.stopPropagation();showToast('Rapport campagne')">📊 Voir rapport</div><div class="camp-btn" onclick="event.stopPropagation();showToast('Campagne dupliquée')">🔄 Relancer</div>`:''}
        ${c.status==='paused'?`<div class="camp-btn" onclick="event.stopPropagation();resumeCamp(${c.id})">▶ Reprendre</div>`:''}
      </div>
    </div>`;
  }).join('');
}

const presence=[
  {nm:'Marc L.',i:'ML',gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)',mission:'Carrefour — Cariste',st:'confirmed',time:'Confirmé à 7h42'},
  {nm:'Thomas R.',i:'TR',gr:'linear-gradient(135deg,#00C48C,#55E6A5)',mission:'Carrefour — Cariste',st:'confirmed',time:'Confirmé à 7h38'},
  {nm:'Fatima E.',i:'FA',gr:'linear-gradient(135deg,#FF9F43,#FDCB6E)',mission:'Carrefour — Cariste',st:'confirmed',time:'Confirmé à 7h55'},
  {nm:'Karim B.',i:'KB',gr:'linear-gradient(135deg,#FF6B6B,#FF8E53)',mission:'Carrefour — Cariste',st:'waiting',time:'SMS envoyé à 7h30'},
  {nm:'Sophie M.',i:'SM',gr:'linear-gradient(135deg,#FD79A8,#FDCB6E)',mission:'Carrefour — Cariste',st:'waiting',time:'SMS envoyé à 7h30'},
  {nm:'Julie M.',i:'JM',gr:'linear-gradient(135deg,#A29BFE,#DDA0DD)',mission:'Amazon — Prépa.',st:'confirmed',time:'Confirmé à 7h35'},
  {nm:'Nadia K.',i:'NK',gr:'linear-gradient(135deg,#00C48C,#81ECEC)',mission:'Amazon — Prépa.',st:'confirmed',time:'Confirmé à 7h50'},
  {nm:'Claire D.',i:'CD',gr:'linear-gradient(135deg,#4A90D9,#74B9FF)',mission:'Amazon — Prépa.',st:'absent',time:'⚠ Aucune réponse depuis 8h15'},
];

function renderPresence(){
  const el=document.getElementById('presenceGrid');
  if(!el) return;
  el.innerHTML=presence.map(p=>`
    <div class="pres-card ${p.st}">
      <div class="pres-av" style="background:${p.gr}">${p.i}</div>
      <div class="pres-info"><div class="pres-nm">${p.nm}</div><div class="pres-mission">${p.mission}</div><div class="pres-time">${p.time}</div></div>
      <div class="pres-status ${p.st}">${p.st==='confirmed'?'✓ Présent':p.st==='waiting'?'⏳ Attente':'🚨 Absent'}</div>
    </div>
  `).join('');
}

const feedItems=[
  {icon:'✅',bg:'var(--green-bg)',msg:'<b>Marc L.</b> a confirmé sa présence — Carrefour',time:'Il y a 2 min',tag:'Présence',tagBg:'var(--green-bg)',tagC:'var(--green)'},
  {icon:'📱',bg:'var(--accent-bg)',msg:'<b>Thomas R.</b> a répondu "oui dispo toute la semaine"',time:'Il y a 5 min',tag:'Dispo',tagBg:'var(--accent-bg)',tagC:'var(--accent)'},
  {icon:'❌',bg:'var(--red-bg)',msg:'<b>Sophie M.</b> a répondu "pas dispo avant le 24"',time:'Il y a 8 min',tag:'Indispo',tagBg:'var(--red-bg)',tagC:'var(--red)'},
  {icon:'🔄',bg:'var(--blue-bg)',msg:'<b>Campagne Dispo S7</b> : 187/234 réponses (80%)',time:'Il y a 12 min',tag:'Campagne',tagBg:'var(--blue-bg)',tagC:'var(--blue)'},
  {icon:'⭐',bg:'var(--orange-bg)',msg:'<b>Pierre B.</b> a noté sa mission Sanofi : 5/5',time:'Il y a 18 min',tag:'Satisfaction',tagBg:'var(--orange-bg)',tagC:'var(--orange)'},
  {icon:'💤',bg:'#E3F6FC',msg:'<b>Lucas F.</b> réactivé après 3 mois — "je recherche"',time:'Il y a 25 min',tag:'Réactivé',tagBg:'#E3F6FC',tagC:'#00B4D8'},
  {icon:'📄',bg:'#FDE8F3',msg:'<b>Amina D.</b> a envoyé son nouveau CACES',time:'Il y a 32 min',tag:'Document',tagBg:'#FDE8F3',tagC:'#E84393'},
  {icon:'✅',bg:'var(--green-bg)',msg:'<b>Nadia K.</b> a confirmé sa présence — Amazon',time:'Il y a 40 min',tag:'Présence',tagBg:'var(--green-bg)',tagC:'var(--green)'},
  {icon:'🚨',bg:'var(--red-bg)',msg:'<b>Claire D.</b> — aucune réponse depuis 45 min ⚠',time:'Il y a 45 min',tag:'Alerte',tagBg:'var(--red-bg)',tagC:'var(--red)'},
  {icon:'📱',bg:'var(--accent-bg)',msg:'<b>Karim B.</b> a répondu "oui je serai là lundi"',time:'Il y a 1h',tag:'Confirmation',tagBg:'var(--accent-bg)',tagC:'var(--accent)'},
  {icon:'💬',bg:'var(--green-bg)',msg:'<b>Youssef A.</b> a répondu "dispo le matin uniquement"',time:'Il y a 1h15',tag:'Dispo partiel',tagBg:'var(--orange-bg)',tagC:'var(--orange)'},
  {icon:'🔄',bg:'var(--blue-bg)',msg:'<b>Campagne Réactivation</b> : 34/89 réponses (38%)',time:'Il y a 2h',tag:'Campagne',tagBg:'var(--blue-bg)',tagC:'var(--blue)'},
];

function renderFeed(){
  const el=document.getElementById('feed');
  if(!el) return;
  el.innerHTML=feedItems.map((f,i)=>`
    <div class="feed-item" style="animation-delay:${i*0.04}s">
      <div class="feed-icon" style="background:${f.bg}">${f.icon}</div>
      <div class="feed-content">
        <div class="feed-msg">${f.msg} <span class="feed-tag" style="background:${f.tagBg};color:${f.tagC}">${f.tag}</span></div>
        <div class="feed-time">${f.time}</div>
      </div>
    </div>
  `).join('');
}

function pauseCamp(id){const c=relanceCampaigns.find(x=>x.id===id);c.status='paused';renderCampaigns();showToast('⏸ Campagne "'+c.name+'" en pause');}
function resumeCamp(id){const c=relanceCampaigns.find(x=>x.id===id);c.status='running';renderCampaigns();showToast('▶ Campagne "'+c.name+'" reprise');}
function launchCamp(id){const c=relanceCampaigns.find(x=>x.id===id);c.status='running';renderCampaigns();showToast('🚀 Campagne "'+c.name+'" lancée !');}
function cancelCamp(id){const i=relanceCampaigns.findIndex(x=>x.id===id);relanceCampaigns.splice(i,1);renderCampaigns();showToast('Campagne annulée');}

function openRelanceModal(){document.getElementById('relanceModal').classList.add('show');}
function closeRelanceModal(){document.getElementById('relanceModal').classList.remove('show');}
function pickType(el){document.querySelectorAll('.type-card').forEach(c=>c.classList.remove('on'));el.classList.add('on');}
function pickCh(el){document.querySelectorAll('.ch-pill').forEach(c=>c.classList.remove('on'));el.classList.add('on');}

function createCampaign(){
  const name=document.getElementById('campName').value.trim()||'Nouvelle campagne';
  relanceCampaigns.unshift({id:Date.now(),name,type:'📋',desc:'Campagne personnalisée',status:'running',sent:0,replied:0,rate:0,channel:'SMS',color:'var(--blue)'});
  renderCampaigns();
  closeRelanceModal();
  showToast('🚀 Campagne "'+name+'" lancée !');
  setTimeout(()=>{
    const c=relanceCampaigns[0];
    c.sent=42;c.replied=0;
    renderCampaigns();
    let rep=0;
    const iv=setInterval(()=>{
      rep+=Math.floor(Math.random()*5)+1;
      if(rep>c.sent)rep=c.sent;
      c.replied=rep;c.rate=Math.round(rep/c.sent*100);
      c.color=c.rate>=70?'var(--green)':c.rate>=40?'var(--orange)':'var(--red)';
      renderCampaigns();
      if(rep>=c.sent)clearInterval(iv);
    },800);
  },1500);
}

renderCampaigns();
renderPresence();
renderFeed();

setInterval(()=>{
  const names=['Emma L.','Paul V.','Léa B.','Omar S.','Inès M.','Hugo R.'];
  const nm=names[Math.floor(Math.random()*names.length)];
  const actions=[
    {icon:'✅',bg:'var(--green-bg)',msg:`<b>${nm}</b> a répondu "oui disponible"`,tag:'Dispo',tagBg:'var(--green-bg)',tagC:'var(--green)'},
    {icon:'❌',bg:'var(--red-bg)',msg:`<b>${nm}</b> a répondu "pas cette semaine"`,tag:'Indispo',tagBg:'var(--red-bg)',tagC:'var(--red)'},
    {icon:'✅',bg:'var(--green-bg)',msg:`<b>${nm}</b> a confirmé sa présence`,tag:'Présence',tagBg:'var(--green-bg)',tagC:'var(--green)'},
  ];
  const a=actions[Math.floor(Math.random()*actions.length)];
  a.time='À l\'instant';
  feedItems.unshift(a);
  if(feedItems.length>20)feedItems.pop();
  renderFeed();
},8000);

// ===== PORTAIL CLIENT PAGE JS =====
const pcCandidates=[
  {id:1,nm:'Marc Lefèvre',an:'Marc L.',i:'ML',rl:'Cariste CACES 3',gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)',p:95,ms:'cariste',lk:0,av:'g',at:'Dispo immédiatement',aw:'Dès le 14 fév.',st:'new',lc:'Lyon 7e',xp:'4 ans',sk:[{t:'CACES 3',s:'g'},{t:'Entrepôt',s:'g'},{t:'Manutention',s:'g'},{t:'Visite méd. ✓',s:'b'}],dt:{age:'32 ans',pe:'B + CACES 1,3',mo:'15 km',ho:'Journée / 2x8',ex:[{t:'Cariste CACES 3',c:'XPO Logistics',p:'2022 — Présent · 4 ans'},{t:'Magasinier-Cariste',c:'Kuehne+Nagel',p:'2020 — 2022 · 2 ans'}]}},
  {id:2,nm:'Thomas Roche',an:'Thomas R.',i:'TR',rl:'Cariste CACES 1,3,5',gr:'linear-gradient(135deg,#00C48C,#55E6A5)',p:91,ms:'cariste',lk:0,av:'g',at:'Dispo immédiatement',aw:'Dès le 12 fév.',st:'new',lc:'Vénissieux',xp:'6 ans',sk:[{t:'CACES 1,3,5',s:'g'},{t:"Chef d'équipe",s:'g'},{t:'Gerbage 9m',s:'b'}],dt:{age:'35 ans',pe:'B + CACES 1,3,5',mo:'20 km',ho:'Tous horaires',ex:[{t:'Cariste polyvalent',c:'FM Logistic',p:'2020 — Présent · 6 ans'}]}},
  {id:3,nm:'Sarah Dubois',an:'Sarah D.',i:'SD',rl:'Préparatrice commandes',gr:'linear-gradient(135deg,#4A90D9,#74B9FF)',p:93,ms:'prepa',lk:1,av:'g',at:'Dispo immédiatement',aw:'Dès le 12 fév.',st:'new',lc:'Villeurbanne',xp:'3 ans',sk:[{t:'Prépa. commandes',s:'g'},{t:'Scan RF',s:'g'},{t:'CACES 1',s:'g'},{t:'Pick & Pack',s:'b'}],dt:{age:'28 ans',pe:'B + CACES 1',mo:'25 km',ho:'2x8',ex:[{t:'Préparatrice commandes',c:'Confidentiel',p:'2023 — 2025 · 2 ans'},{t:'Agent logistique',c:'Confidentiel',p:'2022 — 2023 · 1 an'}]}},
  {id:4,nm:'Fatima El Amrani',an:'Fatima E.',i:'FA',rl:'Cariste',gr:'linear-gradient(135deg,#FF9F43,#FDCB6E)',p:87,ms:'cariste',lk:1,av:'g',at:'Disponible',aw:'Dès le 17 fév.',st:'dispo',lc:'Gerland',xp:'3 ans',sk:[{t:'CACES 3',s:'g'},{t:'Entrepôt',s:'g'},{t:'Visite méd. ⚠',s:'o'}],dt:{age:'30 ans',pe:'B + CACES 3',mo:'10 km',ho:'Journée',ex:[{t:'Cariste',c:'Confidentiel',p:'2023 — 2025 · 3 ans'}]}},
  {id:5,nm:'Antoine Girard',an:'Antoine G.',i:'AG',rl:'Cariste expérimenté',gr:'linear-gradient(135deg,#4A90D9,#74B9FF)',p:79,ms:'cariste',lk:1,av:'g',at:'Disponible',aw:'Sous 1 semaine',st:'dispo',lc:'Décines',xp:'5 ans',sk:[{t:'CACES 3',s:'g'},{t:'5 ans exp.',s:'g'},{t:'Visite méd. ✗',s:'o'}],dt:{age:'38 ans',pe:'B + CACES 3,5',mo:'15 km',ho:'Journée / Matin',ex:[{t:'Cariste',c:'Confidentiel',p:'2021 — 2025 · 5 ans'}]}},
  {id:6,nm:'Julie Martin',an:'Julie M.',i:'JM',rl:'Préparatrice commandes',gr:'linear-gradient(135deg,#A29BFE,#DDA0DD)',p:85,ms:'prepa',lk:0,av:'g',at:'Disponible',aw:'Dès le 14 fév.',st:'dispo',lc:'Décines',xp:'2 ans',sk:[{t:'Prépa. commandes',s:'g'},{t:'Conditionnement',s:'g'},{t:'Scan RF',s:'o'}],dt:{age:'26 ans',pe:'B',mo:'20 km',ho:'2x8 / 3x8',ex:[{t:'Opératrice',c:"L'Oréal",p:'2024 — 2025 · 2 ans'}]}},
  {id:7,nm:'Sophie Morel',an:'Sophie M.',i:'SM',rl:'Cariste junior',gr:'linear-gradient(135deg,#FD79A8,#FDCB6E)',p:74,ms:'cariste',lk:1,av:'o',at:'Sous conditions',aw:'À partir du 24 fév.',st:'dispo',lc:'Bron',xp:'1 an',sk:[{t:'CACES 3',s:'g'},{t:'1 an exp.',s:'o'}],dt:{age:'24 ans',pe:'B + CACES 3',mo:'15 km',ho:'Journée',ex:[{t:'Cariste',c:'Confidentiel',p:'2025 · 1 an'}]}},
  {id:8,nm:'Nadia Khelif',an:'Nadia K.',i:'NK',rl:'Agent logistique',gr:'linear-gradient(135deg,#00C48C,#81ECEC)',p:76,ms:'prepa',lk:0,av:'g',at:'Disponible',aw:'Dès le 12 fév.',st:'dispo',lc:'Vénissieux',xp:'1 an',sk:[{t:'Manutention',s:'g'},{t:'Scan RF',s:'g'},{t:'Prépa.',s:'o'}],dt:{age:'29 ans',pe:'B',mo:'10 km',ho:'Matin / Après-midi',ex:[{t:'Manutentionnaire',c:'DHL Supply Chain',p:'2024 — 2025 · 1 an'}]}},
  {id:9,nm:'Karim Benali',an:'Karim B.',i:'KB',rl:'Cariste',gr:'linear-gradient(135deg,#FF6B6B,#FF8E53)',p:82,ms:'cariste',lk:0,av:'b',at:'Demandé',aw:'Confirmation en cours',st:'req',lc:'Saint-Priest',xp:'2 ans',sk:[{t:'CACES 3',s:'g'},{t:'Entrepôt',s:'g'}],dt:{age:'27 ans',pe:'B + CACES 3',mo:'20 km',ho:'Tous horaires',ex:[{t:'Cariste',c:'Geodis',p:'2024 — 2025 · 2 ans'}]}},
  {id:10,nm:'Pierre Blanc',an:'Pierre B.',i:'PB',rl:'Cariste confirmé',gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)',p:90,ms:'cariste',lk:0,av:'b',at:'En validation',aw:'Contrat en préparation',st:'req',lc:'Lyon 7e',xp:'5 ans',sk:[{t:'CACES 3,5',s:'g'},{t:"Chef d'équipe",s:'g'},{t:'5 ans exp.',s:'b'}],dt:{age:'34 ans',pe:'B + CACES 1,3,5',mo:'15 km',ho:'Tous horaires',ex:[{t:"Cariste chef d'équipe",c:'Kuehne+Nagel',p:'2021 — 2025 · 5 ans'}]}},
  {id:11,nm:'Lucas Ferreira',an:'Lucas F.',i:'LF',rl:'Agent logistique',gr:'linear-gradient(135deg,#FF9F43,#FDCB6E)',p:71,ms:'prepa',lk:1,av:'o',at:'En attente',aw:'Relancé le 8 fév.',st:'dispo',lc:'Lyon 8e',xp:'4 ans',sk:[{t:'Prépa. commandes',s:'g'},{t:'Scan RF',s:'o'},{t:'CACES 1',s:'g'}],dt:{age:'33 ans',pe:'B + CACES 1',mo:'20 km',ho:'2x8',ex:[{t:'Préparateur commandes',c:'Confidentiel',p:'2022 — 2025 · 4 ans'}]}},
  {id:12,nm:'Amina Diallo',an:'Amina D.',i:'AD',rl:'Agent de production',gr:'linear-gradient(135deg,#00B4D8,#81ECEC)',p:84,ms:'cariste',lk:0,av:'g',at:'Disponible',aw:'Dès le 15 fév.',st:'dispo',lc:'Gerland',xp:'3 ans',sk:[{t:'Production',s:'g'},{t:'CACES 1',s:'g'},{t:'BPF',s:'o'}],dt:{age:'31 ans',pe:'B + CACES 1',mo:'10 km',ho:'3x8',ex:[{t:'Agent de production',c:'Sanofi',p:'2022 — 2025 · 3 ans'}]}},
];

let pcFf='all',pcMf='all',pcSq='';

function pcR(){
  const g=document.getElementById('pcGrid');
  if(!g) return;
  let l=[...pcCandidates];
  if(pcFf==='new')l=l.filter(c=>c.st==='new');
  else if(pcFf==='dispo')l=l.filter(c=>c.av==='g');
  else if(pcFf==='req')l=l.filter(c=>c.st==='req');
  if(pcMf!=='all')l=l.filter(c=>c.ms===pcMf);
  if(pcSq)l=l.filter(c=>(c.lk?c.an:c.nm).toLowerCase().includes(pcSq)||c.rl.toLowerCase().includes(pcSq));
  l.sort((a,b)=>b.p-a.p);
  if(!l.length){g.innerHTML='<div class="pc-empty"><div style="font-size:52px">🔍</div><div style="font-size:16px;font-weight:700">Aucun profil</div><div style="font-size:13px;color:var(--text-tertiary)">Essayez d\'autres filtres</div></div>';return;}
  g.innerHTML=l.map((c,i)=>{
    const ci=2*Math.PI*23,of=ci-(c.p/100)*ci;
    const co=c.p>=85?'var(--green)':c.p>=70?'var(--orange)':'var(--red)';
    const bg=c.p>=85?'linear-gradient(90deg,#00C48C,#55E6A5)':c.p>=70?'linear-gradient(90deg,#FF9F43,#FDCB6E)':'linear-gradient(90deg,#FF6B6B,#FF8E53)';
    const dn=c.lk?c.an:c.nm;
    const nw=c.st==='new',rq=c.st==='req';
    const dc=c.av==='g'?'green':c.av==='o'?'orange':'blue';
    let bt='';
    if(rq)bt=`<button class="pc-btn-a done">✓ Demandé</button><button class="pc-btn-a see" onclick="pcE(event);pcOd(${c.id})">Voir profil</button>`;
    else bt=`<button class="pc-btn-a yes" onclick="pcE(event);pcRqC(${c.id})">👋 Intéressé</button><button class="pc-btn-a no" onclick="pcE(event);pcDlC(${c.id})">✕</button><button class="pc-btn-a see" onclick="pcE(event);pcOd(${c.id})">📄</button>`;
    return`<div class="pc-card${nw?' nw':''}" style="animation-delay:${i*0.04}s" onclick="pcOd(${c.id})">
      <div class="pc-bar"><i style="width:${c.p}%;background:${bg}"></i></div>
      <div class="pc-body">
        <div class="pc-avatar" style="background:${c.gr}">${c.i}${c.lk?'<div class="pc-lk">🔒</div>':''}</div>
        <div class="pc-info">
          <div class="pc-cname">${dn}</div>
          <div class="pc-role">${c.rl} · ${c.lc}</div>
          <div class="pc-chips">${c.sk.slice(0,3).map(s=>`<div class="pc-chip ${s.s}">${s.s==='g'?'✓':s.s==='o'?'⚠':'ℹ'} ${s.t}</div>`).join('')}</div>
        </div>
        <div class="pc-pct">
          <div class="pc-ring"><svg viewBox="0 0 50 50"><circle class="pc-ring-bg" cx="25" cy="25" r="23"/><circle class="pc-ring-fg" cx="25" cy="25" r="23" stroke="${co}" stroke-dasharray="${ci}" stroke-dashoffset="${of}"/></svg><div class="pc-ring-t" style="color:${co}">${c.p}%</div></div>
          <div class="pc-ring-l">match</div>
        </div>
      </div>
      <div class="pc-avail"><div class="pc-dot-av ${c.av}"></div><div class="pc-at" style="color:var(--${dc})">${c.at}</div><div class="pc-aw">${c.aw}</div></div>
      <div class="pc-act" onclick="pcE(event)">${bt}</div>
    </div>`;
  }).join('');
}

function pcE(e){e.stopPropagation();}
function pcSf(el){pcFf=el.dataset.pf;document.querySelectorAll('.pc-pill[data-pf]').forEach(p=>p.classList.remove('on'));el.classList.add('on');pcR();}
function pcSmf(el){const m=el.dataset.pm;if(pcMf===m){pcMf='all';el.classList.remove('on');}else{document.querySelectorAll('.pc-pill[data-pm]').forEach(p=>p.classList.remove('on'));pcMf=m;el.classList.add('on');}pcR();}

function pcRqC(id){const c=pcCandidates.find(x=>x.id===id);c.st='req';c.av='b';c.at='Demandé';c.aw='Confirmation en cours';pcR();showToast('✅ Demande envoyée pour '+(c.lk?c.an:c.nm));}
function pcDlC(id){const i=pcCandidates.findIndex(x=>x.id===id);pcCandidates.splice(i,1);pcR();showToast('Profil retiré');}

function pcOd(id){
  const c=pcCandidates.find(x=>x.id===id);if(!c)return;
  const d=c.dt,dn=c.lk?c.an:c.nm,rq=c.st==='req';
  document.getElementById('pcDC').innerHTML=`
    <div class="pc-dw-body">
      <div class="pc-dw-av" style="background:${c.gr}">${c.i}</div>
      <div class="pc-dw-nm">${dn}</div>
      <div class="pc-dw-rl">${c.rl} · ${c.lc} · ${c.xp} d'expérience</div>
      ${c.lk?'<div class="pc-dw-anon">🔒 Profil anonymisé par l\'agence. Faites une demande pour accéder au profil complet.</div>':''}
      <div class="pc-dw-sec"><div class="pc-dw-sec-t">Informations</div>
        <div class="pc-dw-grid">
          ${!c.lk?`<div class="pc-dw-it"><div class="pc-dw-it-l">Âge</div><div class="pc-dw-it-v">${d.age}</div></div>`:''}
          <div class="pc-dw-it"><div class="pc-dw-it-l">Expérience</div><div class="pc-dw-it-v">${c.xp}</div></div>
          <div class="pc-dw-it"><div class="pc-dw-it-l">Permis</div><div class="pc-dw-it-v">${d.pe}</div></div>
          <div class="pc-dw-it"><div class="pc-dw-it-l">Mobilité</div><div class="pc-dw-it-v">${d.mo}</div></div>
          <div class="pc-dw-it"><div class="pc-dw-it-l">Horaires</div><div class="pc-dw-it-v">${d.ho}</div></div>
          <div class="pc-dw-it"><div class="pc-dw-it-l">Disponibilité</div><div class="pc-dw-it-v" style="color:var(--green);font-weight:800">${c.aw}</div></div>
        </div>
      </div>
      <div class="pc-dw-sec"><div class="pc-dw-sec-t">Compétences</div>
        <div class="pc-dw-chips">${c.sk.map(s=>`<div class="pc-chip ${s.s}" style="font-size:12px;padding:6px 14px">${s.s==='g'?'✓':s.s==='o'?'⚠':'ℹ'} ${s.t}</div>`).join('')}</div>
      </div>
      <div class="pc-dw-sec"><div class="pc-dw-sec-t">Expériences</div>
        ${d.ex.map(e=>`<div class="pc-dw-exp-i"><div class="pc-dw-exp-t">${e.t}</div><div class="pc-dw-exp-c">${c.lk?'Entreprise confidentielle':e.c}</div><div class="pc-dw-exp-p">${e.p}</div></div>`).join('')}
      </div>
    </div>
    <div class="pc-dw-foot">
      ${rq?`<button class="pc-dw-btn" style="background:var(--green-bg);color:var(--green);pointer-events:none">✓ Déjà demandé</button>`
      :`<button class="pc-dw-btn no" onclick="pcDlC(${c.id});pcCd()">✕ Pas intéressé</button><button class="pc-dw-btn yes" onclick="pcRqC(${c.id});pcCd()">👋 Je suis intéressé</button>`}
    </div>`;
  document.getElementById('pcDO').classList.add('on');
  document.getElementById('pcDW').classList.add('on');
}
function pcCd(){document.getElementById('pcDO').classList.remove('on');document.getElementById('pcDW').classList.remove('on');}

pcR();

// ===== CANDIDATS PAGE JS =====

const cdCands=[
  {id:1,nm:'Marc Lefèvre',i:'ML',rl:'Cariste CACES 3',gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)',sc:92,st:'dispo',lc:'Lyon 7e',date:'Aujourd\'hui',sk:[{t:'CACES 1,3',s:'g'},{t:'Entrepôt',s:'g'},{t:'Manutention',s:'g'}],xp:'4 ans',tel:'06 12 34 56 78',email:'marc.l@email.com',pe:'B + CACES 1,3',mo:'15 km',ho:'Journée / 2x8',age:'32 ans',exps:[{t:'Cariste CACES 3',c:'XPO Logistics',p:'2022 — Présent'},{t:'Magasinier',c:'Kuehne+Nagel',p:'2020 — 2022'}],tl:[{d:'gn',m:'Confirmé présent — Carrefour',t:'Aujourd\'hui 7h42'},{d:'bl',m:'Mission proposée — Carrefour Supply',t:'Hier 14h30'},{d:'gn',m:'A répondu "dispo cette semaine"',t:'Lundi 8h15'}]},
  {id:2,nm:'Thomas Roche',i:'TR',rl:'Cariste CACES 1,3,5',gr:'linear-gradient(135deg,#00B894,#55E6A5)',sc:89,st:'mission',lc:'Vénissieux',date:'Aujourd\'hui',sk:[{t:'CACES 1,3,5',s:'g'},{t:'Chef d\'équipe',s:'g'},{t:'Gerbage 9m',s:'b'}],xp:'6 ans',tel:'06 23 45 67 89',email:'thomas.r@email.com',pe:'B + CACES 1,3,5',mo:'20 km',ho:'Tous horaires',age:'35 ans',exps:[{t:'Cariste polyvalent',c:'FM Logistic',p:'2020 — Présent'}],tl:[{d:'bl',m:'En mission chez Carrefour — Sem. 7',t:'Depuis lundi'},{d:'gn',m:'Score IA : 89/100',t:'Il y a 3j'}]},
  {id:3,nm:'Sarah Dubois',i:'SD',rl:'Préparatrice commandes',gr:'linear-gradient(135deg,#4A90D9,#74B9FF)',sc:87,st:'dispo',lc:'Villeurbanne',date:'Hier',sk:[{t:'Prépa. cmd',s:'g'},{t:'Scan RF',s:'g'},{t:'CACES 1',s:'g'},{t:'Pick & Pack',s:'b'}],xp:'3 ans',tel:'06 34 56 78 90',email:'sarah.d@email.com',pe:'B + CACES 1',mo:'25 km',ho:'2x8',age:'28 ans',exps:[{t:'Préparatrice',c:'Amazon',p:'2023 — 2025'},{t:'Agent logistique',c:'Easydis',p:'2022 — 2023'}],tl:[{d:'gn',m:'A répondu "disponible immédiatement"',t:'Hier 10h20'},{d:'or',m:'Visite médicale à renouveler',t:'Il y a 5j'}]},
  {id:4,nm:'Fatima El Amrani',i:'FA',rl:'Cariste',gr:'linear-gradient(135deg,#F39C12,#FDCB6E)',sc:78,st:'dispo',lc:'Gerland',date:'Hier',sk:[{t:'CACES 3',s:'g'},{t:'Entrepôt',s:'g'},{t:'Visite méd. ⚠',s:'o'}],xp:'3 ans',tel:'06 45 67 89 01',email:'fatima.e@email.com',pe:'B + CACES 3',mo:'10 km',ho:'Journée',age:'30 ans',exps:[{t:'Cariste',c:'Stef Logistique',p:'2023 — 2025'}],tl:[{d:'or',m:'Visite médicale expirée depuis 15j',t:'Il y a 2j'}]},
  {id:5,nm:'Antoine Girard',i:'AG',rl:'Cariste expérimenté',gr:'linear-gradient(135deg,#4A90D9,#74B9FF)',sc:82,st:'dispo',lc:'Décines',date:'Il y a 3j',sk:[{t:'CACES 3,5',s:'g'},{t:'5 ans exp.',s:'g'},{t:'Visite méd. ✗',s:'o'}],xp:'5 ans',tel:'06 56 78 90 12',email:'antoine.g@email.com',pe:'B + CACES 3,5',mo:'15 km',ho:'Journée',age:'38 ans',exps:[{t:'Cariste',c:'Rhenus Logistics',p:'2021 — 2025'}],tl:[{d:'gn',m:'Dispo confirmé',t:'Il y a 3j'}]},
  {id:6,nm:'Julie Martin',i:'JM',rl:'Préparatrice commandes',gr:'linear-gradient(135deg,#A29BFE,#DDA0DD)',sc:75,st:'mission',lc:'Décines',date:'Aujourd\'hui',sk:[{t:'Prépa. cmd',s:'g'},{t:'Conditionnement',s:'g'},{t:'Scan RF',s:'o'}],xp:'2 ans',tel:'06 67 89 01 23',email:'julie.m@email.com',pe:'B',mo:'20 km',ho:'2x8 / 3x8',age:'26 ans',exps:[{t:'Opératrice',c:'L\'Oréal',p:'2024 — 2025'}],tl:[{d:'bl',m:'En mission chez Amazon — Sem. 7',t:'Depuis lundi'}]},
  {id:7,nm:'Sophie Morel',i:'SM',rl:'Cariste junior',gr:'linear-gradient(135deg,#FD79A8,#FDCB6E)',sc:65,st:'indispo',lc:'Bron',date:'Il y a 5j',sk:[{t:'CACES 3',s:'g'},{t:'1 an exp.',s:'o'}],xp:'1 an',tel:'06 78 90 12 34',email:'sophie.m@email.com',pe:'B + CACES 3',mo:'15 km',ho:'Journée',age:'24 ans',exps:[{t:'Cariste',c:'Bolloré',p:'2025'}],tl:[{d:'or',m:'Indisponible jusqu\'au 24 fév.',t:'Il y a 5j'}]},
  {id:8,nm:'Nadia Khelif',i:'NK',rl:'Agent logistique',gr:'linear-gradient(135deg,#00B894,#81ECEC)',sc:73,st:'dispo',lc:'Vénissieux',date:'Hier',sk:[{t:'Manutention',s:'g'},{t:'Scan RF',s:'g'},{t:'Prépa.',s:'o'}],xp:'1 an',tel:'06 89 01 23 45',email:'nadia.k@email.com',pe:'B',mo:'10 km',ho:'Matin / AM',age:'29 ans',exps:[{t:'Manutentionnaire',c:'DHL',p:'2024 — 2025'}],tl:[{d:'gn',m:'Disponible confirmé',t:'Hier 9h'}]},
  {id:9,nm:'Karim Benali',i:'KB',rl:'Cariste',gr:'linear-gradient(135deg,#E74C3C,#FF7675)',sc:77,st:'mission',lc:'Saint-Priest',date:'Aujourd\'hui',sk:[{t:'CACES 3',s:'g'},{t:'Entrepôt',s:'g'}],xp:'2 ans',tel:'06 90 12 34 56',email:'karim.b@email.com',pe:'B + CACES 3',mo:'20 km',ho:'Tous horaires',age:'27 ans',exps:[{t:'Cariste',c:'Geodis',p:'2024 — 2025'}],tl:[{d:'bl',m:'En mission chez Carrefour',t:'Depuis lundi'}]},
  {id:10,nm:'Pierre Blanc',i:'PB',rl:'Cariste confirmé',gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)',sc:90,st:'mission',lc:'Lyon 7e',date:'Aujourd\'hui',sk:[{t:'CACES 3,5',s:'g'},{t:'Chef d\'équipe',s:'g'},{t:'5 ans exp.',s:'b'}],xp:'5 ans',tel:'06 01 23 45 67',email:'pierre.b@email.com',pe:'B + CACES 1,3,5',mo:'15 km',ho:'Tous horaires',age:'34 ans',exps:[{t:'Cariste chef d\'équipe',c:'Kuehne+Nagel',p:'2021 — 2025'}],tl:[{d:'bl',m:'Contrat signé — Sanofi 3 mois',t:'Hier'}]},
  {id:11,nm:'Lucas Ferreira',i:'LF',rl:'Agent logistique',gr:'linear-gradient(135deg,#F39C12,#FDCB6E)',sc:62,st:'dormant',lc:'Lyon 8e',date:'Il y a 92j',sk:[{t:'Prépa. cmd',s:'g'},{t:'Scan RF',s:'o'},{t:'CACES 1',s:'g'}],xp:'4 ans',tel:'06 12 34 56 00',email:'lucas.f@email.com',pe:'B + CACES 1',mo:'20 km',ho:'2x8',age:'33 ans',exps:[{t:'Préparateur',c:'Casino Logistique',p:'2022 — 2025'}],tl:[{d:'or',m:'Aucune activité depuis 92 jours',t:'Il y a 92j'}]},
  {id:12,nm:'Amina Diallo',i:'AD',rl:'Agent de production',gr:'linear-gradient(135deg,#00B4D8,#81ECEC)',sc:80,st:'dispo',lc:'Gerland',date:'Il y a 2j',sk:[{t:'Production',s:'g'},{t:'CACES 1',s:'g'},{t:'BPF',s:'o'}],xp:'3 ans',tel:'06 23 45 67 00',email:'amina.d@email.com',pe:'B + CACES 1',mo:'10 km',ho:'3x8',age:'31 ans',exps:[{t:'Agent production',c:'Sanofi',p:'2022 — 2025'}],tl:[{d:'gn',m:'Nouveau CACES envoyé',t:'Il y a 2j'}]},
  {id:13,nm:'Hugo Mercier',i:'HM',rl:'Manutentionnaire',gr:'linear-gradient(135deg,#636e72,#b2bec3)',sc:58,st:'dormant',lc:'Caluire',date:'Il y a 120j',sk:[{t:'Manutention',s:'g'},{t:'Port de charges',s:'g'}],xp:'6 mois',tel:'06 34 56 78 00',email:'hugo.m@email.com',pe:'B',mo:'10 km',ho:'Journée',age:'22 ans',exps:[{t:'Manutentionnaire',c:'DPD',p:'2025'}],tl:[{d:'or',m:'Aucune activité depuis 120 jours',t:'Il y a 120j'}]},
  {id:14,nm:'Emma Laurent',i:'EL',rl:'Préparatrice commandes',gr:'linear-gradient(135deg,#fd79a8,#e17055)',sc:71,st:'indispo',lc:'Meyzieu',date:'Il y a 7j',sk:[{t:'Prépa. cmd',s:'g'},{t:'Scan RF',s:'o'}],xp:'2 ans',tel:'06 45 67 89 00',email:'emma.l@email.com',pe:'B',mo:'15 km',ho:'Matin',age:'25 ans',exps:[{t:'Préparatrice',c:'Chronopost',p:'2024 — 2025'}],tl:[{d:'or',m:'En arrêt maladie jusqu\'au 20 fév.',t:'Il y a 7j'}]},
  {id:15,nm:'Omar Sayed',i:'OS',rl:'Cariste CACES 5',gr:'linear-gradient(135deg,#00cec9,#55efc4)',sc:85,st:'dispo',lc:'Vaulx-en-Velin',date:'Aujourd\'hui',sk:[{t:'CACES 5',s:'g'},{t:'Grande hauteur',s:'g'},{t:'3 ans exp.',s:'b'}],xp:'3 ans',tel:'06 56 78 90 00',email:'omar.s@email.com',pe:'B + CACES 1,3,5',mo:'25 km',ho:'Tous horaires',age:'30 ans',exps:[{t:'Cariste CACES 5',c:'FM Logistic',p:'2023 — 2025'}],tl:[{d:'gn',m:'Disponible immédiatement',t:'Aujourd\'hui 8h'}]},
];

let cdFilter='all',cdView='table',cdSearchQ='';
const cdStMap={dispo:{l:'Disponible',c:'st-dispo',e:'●'},mission:{l:'En mission',c:'st-mission',e:'🏗️'},indispo:{l:'Indisponible',c:'st-indispo',e:'✗'},dormant:{l:'Dormant',c:'st-attente',e:'💤'}};

function cdFiltered(){
  let l=[...cdCands];
  if(cdFilter!=='all')l=l.filter(c=>c.st===filter);
  if(cdSearchQ)l=l.filter(c=>c.nm.toLowerCase().includes(cdSearchQ)||c.rl.toLowerCase().includes(cdSearchQ)||c.lc.toLowerCase().includes(cdSearchQ)||c.sk.some(s=>s.t.toLowerCase().includes(cdSearchQ)));
  return l;
}

function cdRenderTable(){
  const l=cdFiltered();
  document.getElementById('cdTotalCount').textContent=l.length;
  document.getElementById('cdTableBody').innerHTML=l.map((c,i)=>{
    const s=cdStMap[c.st];
    const scCol=c.sc>=80?'var(--gn)':c.sc>=65?'var(--or)':'var(--rd)';
    const scBg=c.sc>=80?'linear-gradient(90deg,#2ECC71,#55E6A5)':c.sc>=65?'linear-gradient(90deg,#F39C12,#FDCB6E)':'linear-gradient(90deg,#E74C3C,#FF7675)';
    return`<tr onclick="cdOpenDrawer(${c.id})" style="animation:up 0.3s ease backwards;animation-delay:${i*0.02}s">
      <td><div class="td-candidate"><div class="td-av" style="background:${c.gr}">${c.i}</div><div class="td-info"><div class="td-nm">${c.nm}</div><div class="td-role">${c.rl}</div></div></div></td>
      <td><div class="td-tags">${c.sk.slice(0,3).map(s=>`<div class="cd-tag ${s.s}">${s.t}</div>`).join('')}</div></td>
      <td><div class="td-score"><div class="score-bar"><div class="score-fill" style="width:${c.sc}%;background:${scBg}"></div></div><div class="score-val" style="color:${scCol}">${c.sc}</div></div></td>
      <td><div class="td-status ${s.c}">${s.e} ${s.l}</div></td>
      <td><div class="td-loc">📍 ${c.lc}</div></td>
      <td><div class="td-date">${c.date}</div></td>
      <td><div class="td-actions" onclick="event.stopPropagation()">
        <div class="act-btn" title="Voir profil" onclick="cdOpenDrawer(${c.id})">📄</div>
        <div class="act-btn" title="Appeler" onclick="showToast('Appel ${c.nm}...')">📱</div>
        <div class="act-btn" title="Proposer mission" onclick="showToast('${c.nm} ajouté au matching')">🎯</div>
        <div class="act-btn" title="Envoyer au portail client" onclick="cdOpenPortalPush(${c.id})" style="color:var(--ac)">👁</div>
      </div></td>
    </tr>`;
  }).join('');
}

function cdRenderGrid(){
  const l=cdFiltered();
  document.getElementById('cdGridView').innerHTML=l.map((c,i)=>{
    const ci=2*Math.PI*18,of=ci-(c.sc/100)*ci;
    const co=c.sc>=80?'var(--gn)':c.sc>=65?'var(--or)':'var(--rd)';
    const s=cdStMap[c.st];
    return`<div class="g-card" style="animation-delay:${i*0.03}s" onclick="cdOpenDrawer(${c.id})">
      <div class="g-card-top">
        <div class="g-av" style="background:${c.gr}">${c.i}</div>
        <div class="g-info">
          <div class="g-nm">${c.nm}</div>
          <div class="g-rl">${c.rl}</div>
          <div class="g-meta"><div class="g-meta-i">📍 ${c.lc}</div><div class="g-meta-i">💼 ${c.xp}</div></div>
        </div>
        <div class="g-score">
          <div class="g-ring"><svg viewBox="0 0 40 40"><circle class="g-ring-bg" cx="20" cy="20" r="18"/><circle class="g-ring-fg" cx="20" cy="20" r="18" stroke="${co}" stroke-dasharray="${ci}" stroke-dashoffset="${of}"/></svg><div class="g-ring-t" style="color:${co}">${c.sc}</div></div>
          <div class="g-ring-l">score</div>
        </div>
      </div>
      <div class="g-tags">${c.sk.map(s=>`<div class="cd-tag ${s.s}">${s.t}</div>`).join('')}</div>
      <div class="g-bottom">
        <div class="g-status ${s.c}">${s.e} ${s.l}</div>
        <div class="g-actions" onclick="event.stopPropagation()">
          <div class="act-btn" onclick="cdOpenDrawer(${c.id})">📄</div>
          <div class="act-btn" onclick="showToast('Appel ${c.nm}')">📱</div>
          <div class="act-btn" onclick="showToast('${c.nm} → matching')">🎯</div>
          <div class="act-btn" onclick="cdOpenPortalPush(${c.id})" style="color:var(--ac)" title="Portail client">👁</div>
        </div>
      </div>
    </div>`;
  }).join('');
}

function cdRender(){cdRenderTable();cdRenderGrid();}

function cdSetFilter(el){
  cdFilter=el.dataset.cf;
  document.querySelectorAll('.cd-pill[data-cf]').forEach(p=>p.classList.remove('on'));
  el.classList.add('on');cdRender();
}
function cdDoFilter(){cdSearchQ=document.getElementById('cdSearchInput').value.toLowerCase().trim();cdRender();}
function cdSetView(v){
  cdView=v;
  document.getElementById('cdViewTable').classList.toggle('on',v==='table');
  document.getElementById('cdViewGrid').classList.toggle('on',v==='grid');
  document.getElementById('cdTableView').classList.toggle('off',v==='grid');
  document.getElementById('cdGridView').classList.toggle('on',v==='grid');
}

// DRAWER
function cdOpenDrawer(id){
  const c=cdCands.find(x=>x.id===id);if(!c)return;
  const s=cdStMap[c.st];
  document.getElementById('cdDrawerContent').innerHTML=`
    <div class="cd-dw-profile">
      <div class="cd-dw-hero">
        <div class="cd-dw-av" style="background:${c.gr}">${c.i}</div>
        <div><div class="cd-dw-nm">${c.nm}</div><div class="cd-dw-rl">${c.rl} · ${c.lc}</div><div class="cd-dw-st" style="margin-top:8px"><span class="td-status ${s.c}">${s.e} ${s.l}</span></div></div>
      </div>
      <div class="cd-dw-quick">
        <button class="cd-dw-qbtn" onclick="showToast('Appel ${c.nm}...')">📱 Appeler</button>
        <button class="cd-dw-qbtn" onclick="showToast('SMS envoyé')">💬 SMS</button>
        <button class="cd-dw-qbtn" onclick="showToast('${c.nm} → matching')">🎯 Matcher</button>
        <button class="cd-dw-qbtn primary" onclick="showToast('${c.nm} → portail client')">👁 Proposer</button>
      </div>
      <div class="cd-dw-sec"><div class="cd-dw-sec-t">Informations</div>
        <div class="cd-dw-grid">
          <div class="cd-dw-it"><div class="cd-dw-it-l">Âge</div><div class="cd-dw-it-v">${c.age}</div></div>
          <div class="cd-dw-it"><div class="cd-dw-it-l">Expérience</div><div class="cd-dw-it-v">${c.xp}</div></div>
          <div class="cd-dw-it"><div class="cd-dw-it-l">Téléphone</div><div class="cd-dw-it-v">${c.tel}</div></div>
          <div class="cd-dw-it"><div class="cd-dw-it-l">Email</div><div class="cd-dw-it-v" style="font-size:12px">${c.email}</div></div>
          <div class="cd-dw-it"><div class="cd-dw-it-l">Permis</div><div class="cd-dw-it-v">${c.pe}</div></div>
          <div class="cd-dw-it"><div class="cd-dw-it-l">Mobilité</div><div class="cd-dw-it-v">${c.mo}</div></div>
          <div class="cd-dw-it"><div class="cd-dw-it-l">Horaires</div><div class="cd-dw-it-v">${c.ho}</div></div>
          <div class="cd-dw-it"><div class="cd-dw-it-l">Score IA</div><div class="cd-dw-it-v" style="color:${c.sc>=80?'var(--gn)':c.sc>=65?'var(--or)':'var(--rd)'};font-size:18px">${c.sc}/100</div></div>
        </div>
      </div>
      <div class="cd-dw-sec"><div class="cd-dw-sec-t">Compétences</div>
        <div class="cd-dw-chips">${c.sk.map(s=>`<div class="cd-tag ${s.s}" style="font-size:12px;padding:5px 14px">${s.t}</div>`).join('')}</div>
      </div>
      <div class="cd-dw-sec"><div class="cd-dw-sec-t">Expériences</div>
        ${c.exps.map(e=>`<div class="cd-dw-exp-i"><div class="cd-dw-exp-t">${e.t}</div><div class="cd-dw-exp-c">${e.c}</div><div class="cd-dw-exp-p">${e.p}</div></div>`).join('')}
      </div>
      <div class="cd-dw-sec"><div class="cd-dw-sec-t">Historique d'activité</div>
        <div class="cd-dw-timeline">${c.tl.map(t=>`<div class="cd-dw-tl-item"><div class="cd-dw-tl-dot ${t.d}"></div><div><div class="cd-dw-tl-msg">${t.m}</div><div class="cd-dw-tl-time">${t.t}</div></div></div>`).join('')}</div>
      </div>
    </div>`;
  document.getElementById('cdDOverlay').classList.add('on');
  document.getElementById('cdDrawer').classList.add('on');
}
function cdCloseDrawer(){document.getElementById('cdDOverlay').classList.remove('on');document.getElementById('cdDrawer').classList.remove('on');}

// IMPORT
function cdOpenImport(){document.getElementById('cdImportModal').classList.add('show');}
function cdCloseImport(){document.getElementById('cdImportModal').classList.remove('show');}
function cdHandleDrop(e){showToast('📄 '+e.dataTransfer.files.length+' fichiers reçus');}
function cdHandleFiles(f){showToast('📄 '+f.length+' fichiers sélectionnés');}
function cdSimulateImport(){closeImport();showToast('🤖 Extraction IA en cours... 12 CVs détectés');}

function cdToastIgnored(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3000);}

// PORTAL PUSH
let cdPortalCandId=null;
function cdOpenPortalPush(id){
  const c=cdCands.find(x=>x.id===id);if(!c)return;
  cdPortalCandId=id;
  document.getElementById('cdPortalCandInfo').innerHTML=`<div class="td-av" style="background:${c.gr};width:42px;height:42px;border-radius:12px;display:flex;align-items:center;justify-content:center;font-weight:700;font-size:14px;color:#fff;flex-shrink:0">${c.i}</div><div><div style="font-weight:700;font-size:14px">${c.nm}</div><div style="font-size:12px;color:var(--tx2)">${c.rl} · ${c.lc}</div></div>`;
  document.querySelectorAll('.cd-vis-opt').forEach((el,i)=>{
    if(i===0){el.style.borderColor='var(--gn)';el.style.background='var(--gnbg)';el.classList.add('on');}
    else{el.style.borderColor='var(--bd)';el.style.background='var(--sf)';el.classList.remove('on');}
  });
  document.getElementById('cdPortalModal').classList.add('show');
}
function cdClosePortal(){document.getElementById('cdPortalModal').classList.remove('show');}
function cdPickVis(el,v){
  document.querySelectorAll('.cd-vis-opt').forEach(e=>{e.style.borderColor='var(--bd)';e.style.background='var(--sf)';e.classList.remove('on');});
  const cols={full:['var(--gn)','var(--gnbg)'],partial:['var(--or)','var(--orbg)'],anon:['var(--tx3)','var(--sf2)']};
  el.style.borderColor=cols[v][0];el.style.background=cols[v][1];el.classList.add('on');
}
function cdConfirmPortalPush(){
  const c=cdCands.find(x=>x.id===cdPortalCandId);
  const client=document.getElementById('cdPortalClient').value;
  const vis=document.querySelector('.cd-vis-opt.on')?.dataset.v||'full';
  const visLabel={full:'complet',partial:'partiel',anon:'anonymisé'}[vis];
  closePortal();
  showToast(`✅ ${c.nm} envoyé au portail ${client} (profil ${visLabel})`);
}

cdRender();


// ===== DASHBOARD PAGE JS =====
function dbToggleChat(){
  const panel=document.getElementById('dbChatPanel');
  panel.classList.toggle('open');
}

// Show/hide chat widget based on active page
const dbObserver=new MutationObserver(()=>{
  const dbPage=document.getElementById('page-dashboard');
  const chatW=document.getElementById('dbChatWidget');
  if(dbPage && chatW){
    chatW.style.display=dbPage.style.display==='none'?'none':'block';
  }
});
document.querySelectorAll('.page-section').forEach(el=>{
  dbObserver.observe(el,{attributes:true,attributeFilter:['style']});
});
// Initial state
setTimeout(()=>{
  const dbPage=document.getElementById('page-dashboard');
  const chatW=document.getElementById('dbChatWidget');
  if(dbPage && chatW){
    chatW.style.display=dbPage.style.display==='none'?'none':'block';
  }
},100);


// ===== CONTRATS PAGE JS =====
function ctFilterByKpi(status){
  ctFf=status;
  document.querySelectorAll('.ct-pill[data-ctf]').forEach(p=>{
    p.classList.toggle('on',p.dataset.ctf===status);
  });
  ctRender();
  // Scroll vers la table
  document.querySelector('.ct-tcard')?.scrollIntoView({behavior:'smooth',block:'nearest'});
}

const ctContrats=[
  {id:1,nm:'Marc Lefèvre',i:'ML',gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)',rl:'Cariste CACES 3',cl:'Carrefour Supply Chain',cli:'🏪',lieu:'Entrepôt Vénissieux',d1:'2026-01-13',d2:'2026-03-14',h:'6h — 14h',tx:'12.50 €',st:'active',aven:[{num:1,type:'Prolongation',detail:'Fin repoussée du 28/02 au 14/03',date:'2026-02-03',st:'signed'},{num:2,type:'Horaires',detail:'Passage en 2x8 : 6h-14h / 14h-22h',date:'2026-02-10',st:'signed'}],num:'CTT-2026-0087'},
  {id:2,nm:'Thomas Roche',i:'TR',gr:'linear-gradient(135deg,#00B894,#55E6A5)',rl:'Cariste CACES 1,3,5',cl:'Carrefour Supply Chain',cli:'🏪',lieu:'Entrepôt Vénissieux',d1:'2026-02-03',d2:'2026-02-28',h:'14h — 22h',tx:'13.20 €',st:'active',aven:[],num:'CTT-2026-0091'},
  {id:3,nm:'Julie Martin',i:'JM',gr:'linear-gradient(135deg,#A29BFE,#DDA0DD)',rl:'Préparatrice commandes',cl:'Amazon — Saint-Priest',cli:'📦',lieu:'Centre Amazon STR1',d1:'2026-02-03',d2:'2026-02-21',h:'5h — 13h',tx:'11.80 €',st:'active',aven:[{num:1,type:'Taux horaire',detail:'Passage de 11.52€ à 11.80€ / heure',date:'2026-02-07',st:'signed'}],num:'CTT-2026-0093'},
  {id:4,nm:'Nadia Khelif',i:'NK',gr:'linear-gradient(135deg,#00B894,#81ECEC)',rl:'Agent logistique',cl:'Amazon — Saint-Priest',cli:'📦',lieu:'Centre Amazon STR1',d1:'2026-02-03',d2:'2026-02-14',h:'5h — 13h',tx:'11.52 €',st:'expiring',aven:[],num:'CTT-2026-0094'},
  {id:5,nm:'Karim Benali',i:'KB',gr:'linear-gradient(135deg,#E74C3C,#FF7675)',rl:'Cariste',cl:'Carrefour Supply Chain',cli:'🏪',lieu:'Entrepôt Vénissieux',d1:'2026-02-10',d2:'2026-03-07',h:'6h — 14h',tx:'12.00 €',st:'active',aven:[],num:'CTT-2026-0096'},
  {id:6,nm:'Pierre Blanc',i:'PB',gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)',rl:'Cariste confirmé',cl:'Sanofi — Gerland',cli:'💊',lieu:'Site Sanofi Gerland',d1:'2026-02-10',d2:'2026-05-09',h:'7h — 15h',tx:'13.80 €',st:'sign',aven:[],num:'CTT-2026-0097'},
  {id:7,nm:'Omar Sayed',i:'OS',gr:'linear-gradient(135deg,#00cec9,#55efc4)',rl:'Cariste CACES 5',cl:'FM Logistic',cli:'🏭',lieu:'Plateforme Corbas',d1:'2026-02-17',d2:'2026-03-14',h:'6h — 14h',tx:'13.00 €',st:'sign',aven:[],num:'CTT-2026-0098'},
  {id:8,nm:'Sarah Dubois',i:'SD',gr:'linear-gradient(135deg,#4A90D9,#74B9FF)',rl:'Préparatrice commandes',cl:'Amazon — Saint-Priest',cli:'📦',lieu:'Centre Amazon STR1',d1:'2025-12-01',d2:'2026-01-31',h:'5h — 13h',tx:'11.52 €',st:'ended',aven:[{num:1,type:'Prolongation',detail:'Fin repoussée du 31/12 au 31/01',date:'2025-12-20',st:'signed'}],num:'CTT-2025-0412'},
  {id:9,nm:'Fatima El Amrani',i:'FA',gr:'linear-gradient(135deg,#F39C12,#FDCB6E)',rl:'Cariste',cl:'Sanofi — Gerland',cli:'💊',lieu:'Site Sanofi Gerland',d1:'2025-11-04',d2:'2026-01-17',h:'7h — 15h',tx:'12.00 €',st:'ended',aven:[{num:1,type:'Lieu de mission',detail:'Transfert de Gerland vers Saint-Fons',date:'2025-12-02',st:'signed'},{num:2,type:'Prolongation',detail:'Fin repoussée du 20/12 au 17/01',date:'2025-12-15',st:'signed'}],num:'CTT-2025-0378'},
  {id:10,nm:'Sophie Morel',i:'SM',gr:'linear-gradient(135deg,#FD79A8,#FDCB6E)',rl:'Cariste junior',cl:'Carrefour Supply Chain',cli:'🏪',lieu:'Entrepôt Vénissieux',d1:'2026-02-12',d2:'2026-02-14',h:'6h — 14h',tx:'11.88 €',st:'expiring',aven:[],num:'CTT-2026-0099'},
];

const ctStMap={active:{l:'Actif',c:'st-active',e:'●'},sign:{l:'À signer',c:'st-sign',e:'✍️'},expiring:{l:'Expire bientôt',c:'st-pending',e:'⏰'},ended:{l:'Terminé',c:'st-ended',e:'🏁'}};

let ctFf='all',ctSq='';

function ctDaysBetween(a,b){return Math.round((new Date(b)-new Date(a))/(1000*60*60*24));}
function ctFmtDate(d){const p=d.split('-');return p[2]+'/'+p[1]+'/'+p[0].slice(2);}
function ctProgress(c){
  const total=ctDaysBetween(c.d1,c.d2);
  const now=ctDaysBetween(c.d1,'2026-02-11');
  return Math.min(100,Math.max(0,Math.round(now/total*100)));
}

function ctFiltered(){
  let l=[...ctContrats];
  if(ctFf==='active')l=l.filter(c=>c.st==='active');
  else if(ctFf==='sign')l=l.filter(c=>c.st==='sign');
  else if(ctFf==='expiring')l=l.filter(c=>c.st==='expiring');
  else if(ctFf==='ended')l=l.filter(c=>c.st==='ended');
  if(ctSq)l=l.filter(c=>c.nm.toLowerCase().includes(ctSq)||c.cl.toLowerCase().includes(ctSq)||c.rl.toLowerCase().includes(ctSq)||c.num.toLowerCase().includes(ctSq));
  return l;
}

function ctRender(){
  const l=ctFiltered();
  document.getElementById('ctPagInfo').textContent=l.length+' contrat'+(l.length>1?'s':'');
  document.getElementById('ctTableBody').innerHTML=l.map((c,i)=>{
    const s=ctStMap[c.st];
    const pct=ctProgress(c);
    const pCol=c.st==='ended'?'var(--tx3)':pct>=80?'var(--or)':'var(--gn)';
    const pBg=c.st==='ended'?'var(--bd)':pct>=80?'linear-gradient(90deg,var(--or),#FDCB6E)':'linear-gradient(90deg,var(--gn),#55E6A5)';
    const daysLeft=ctDaysBetween('2026-02-11',c.d2);
    return`<tr onclick="ctOd(${c.id})" style="animation:up 0.3s ease backwards;animation-delay:${i*0.02}s">
      <td><div class="ct-td-c"><div class="ct-td-av" style="background:${c.gr}">${c.i}</div><div><div class="ct-td-nm">${c.nm}</div><div class="ct-td-sub">${c.rl}</div></div></div></td>
      <td><div class="ct-td-client"><div class="ct-td-cl-logo">${c.cli}</div><div><div class="ct-td-cl-nm">${c.cl}</div></div></div></td>
      <td><div class="ct-td-dates"><b>${ctFmtDate(c.d1)}</b> → <b>${ctFmtDate(c.d2)}</b><div style="font-size:10px;color:${daysLeft<=7&&c.st!=='ended'?'var(--or)':'var(--tx3)'};">${c.st==='ended'?'Terminé':daysLeft+'j restants'}</div></div></td>
      <td><div class="ct-td-bar"><div class="ct-progress-bar"><div class="ct-progress-fill" style="width:${pct}%;background:${pBg}"></div></div><div class="ct-progress-pct" style="color:${pCol}">${pct}%</div></div></td>
      <td><div class="ct-st-badge ${s.c}">${s.e} ${s.l}</div></td>
      <td><div class="ct-td-avenant">${c.aven.length?'<span style="color:var(--pk)">📎 '+c.aven.length+'</span>':'<span style="color:var(--tx3)">—</span>'}</div></td>
      <td><div class="td-actions" onclick="event.stopPropagation()">
        <div class="ct-act-btn" title="Voir détail" onclick="ctOd(${c.id})">📄</div>
        <div class="ct-act-btn aven" title="Faire un avenant" onclick="ctOpenQuickAven(${c.id})">📎</div>
        ${c.st==='active'||c.st==='expiring'?'<div class="ct-act-btn warn" title="Prolonger" onclick="ctOpenAvenType('+c.id+',\'prolong\')">🔄</div>':''}
        ${c.st==='sign'?'<div class="ct-act-btn" title="Envoyer signature" onclick="toast(\'Lien de signature envoyé par SMS\')" style="color:var(--bl)">✍️</div>':''}
      </div></td>
    </tr>`;
  }).join('');
}

function ctSf(el){ctFf=el.dataset.ctf;document.querySelectorAll('.ct-pill[data-ctf]').forEach(p=>p.classList.remove('on'));el.classList.add('on');ctRender();}
function ctDoFilter(){ctSq=document.getElementById('ctSearchInput').value.toLowerCase().trim();ctRender();}

// DRAWER
function ctOd(id){
  const c=ctContrats.find(x=>x.id===id);if(!c)return;
  const s=ctStMap[c.st];
  const pct=ctProgress(c);
  const totalDays=ctDaysBetween(c.d1,c.d2);
  const daysLeft=ctDaysBetween('2026-02-11',c.d2);
  const pCol=pct>=80?'var(--or)':'var(--gn)';
  const pBg=c.st==='ended'?'var(--tx3)':pct>=80?'linear-gradient(90deg,var(--or),#FDCB6E)':'linear-gradient(90deg,var(--gn),#55E6A5)';

  document.getElementById('ctDC').innerHTML=`
    <div class="ct-dw-body">
      <div class="ct-dw-hero">
        <div class="ct-dw-av">${c.i}</div>
        <div style="flex:1"><div class="ct-dw-nm">${c.nm}</div><div class="ct-dw-rl">${c.rl} — ${c.cl}</div><div class="ct-dw-num">${c.num}</div></div>
        <div class="ct-st-badge ${s.c}" style="align-self:flex-start;">${s.e} ${s.l}</div>
      </div>

      <div class="ct-tl-bar">
        <div class="ct-tl-bar-label"><span>${ctFmtDate(c.d1)}</span><span style="font-weight:700;color:${c.st==='ended'?'var(--tx3)':daysLeft<=7?'var(--or)':'var(--tx)'}">${c.st==='ended'?'Terminé':daysLeft+'j restants'}</span><span>${ctFmtDate(c.d2)}</span></div>
        <div class="ct-tl-bar-track"><div class="ct-tl-bar-fill" style="width:${pct}%;background:${pBg}"></div></div>
      </div>

      ${c.st!=='ended'?`<div class="ct-dw-sec"><div class="ct-dw-sec-t">⚡ Avenant rapide</div>
        <div class="ct-quick-aven">
          <div class="ct-qa-btn" onclick="ctOpenAvenType(${c.id},'prolong')"><div class="ct-qa-ico">🔄</div><div class="ct-qa-t">Prolonger</div><div class="ct-qa-d">Modifier la date de fin</div></div>
          <div class="ct-qa-btn" onclick="ctOpenAvenType(${c.id},'horaires')"><div class="ct-qa-ico">🕐</div><div class="ct-qa-t">Modifier horaires</div><div class="ct-qa-d">Changer les heures</div></div>
          <div class="ct-qa-btn" onclick="ctOpenAvenType(${c.id},'lieu')"><div class="ct-qa-ico">📍</div><div class="ct-qa-t">Changer le lieu</div><div class="ct-qa-d">Nouveau site de mission</div></div>
          <div class="ct-qa-btn" onclick="ctOpenAvenType(${c.id},'taux')"><div class="ct-qa-ico">💰</div><div class="ct-qa-t">Modifier le taux</div><div class="ct-qa-d">Ajuster la rémunération</div></div>
        </div>
      </div>`:''}

      <div class="ct-dw-sec"><div class="ct-dw-sec-t">Informations du contrat</div>
        <div class="ct-dw-grid">
          <div class="ct-dw-it"><div class="ct-dw-it-l">Client</div><div class="ct-dw-it-v">${c.cli} ${c.cl}</div></div>
          <div class="ct-dw-it"><div class="ct-dw-it-l">Lieu</div><div class="ct-dw-it-v">${c.lieu}</div></div>
          <div class="ct-dw-it"><div class="ct-dw-it-l">Horaires</div><div class="ct-dw-it-v">${c.h}</div></div>
          <div class="ct-dw-it"><div class="ct-dw-it-l">Taux horaire</div><div class="ct-dw-it-v" style="color:var(--ac);font-size:16px">${c.tx}</div></div>
          <div class="ct-dw-it"><div class="ct-dw-it-l">Début</div><div class="ct-dw-it-v">${ctFmtDate(c.d1)}</div></div>
          <div class="ct-dw-it"><div class="ct-dw-it-l">Fin</div><div class="ct-dw-it-v">${ctFmtDate(c.d2)}</div></div>
          <div class="ct-dw-it"><div class="ct-dw-it-l">Durée totale</div><div class="ct-dw-it-v">${totalDays} jours</div></div>
          <div class="ct-dw-it"><div class="ct-dw-it-l">N° contrat</div><div class="ct-dw-it-v" style="font-family:'Space Mono',monospace;font-size:12px">${c.num}</div></div>
        </div>
      </div>

      <div class="ct-dw-sec">
        <div class="ct-dw-sec-t">📎 Avenants (${c.aven.length}) ${c.st!=='ended'?'<span style="color:var(--pk);cursor:pointer" onclick="ctOpenQuickAven('+c.id+')">+ Ajouter</span>':''}</div>
        <div class="ct-aven-list">
          ${c.aven.length?c.aven.map(a=>`
            <div class="ct-aven-card">
              <div class="ct-aven-card-top"><div class="ct-aven-num">Avenant n°${a.num}</div><div class="ct-aven-date">${a.date.split('-').reverse().join('/')}</div></div>
              <div class="ct-aven-type">${a.type==='Prolongation'?'🔄':a.type==='Horaires'?'🕐':a.type==='Lieu de mission'?'📍':'💰'} ${a.type}</div>
              <div class="ct-aven-detail">${a.detail}</div>
              <div class="ct-aven-badge" style="background:var(--gnbg);color:var(--gn);">✓ Signé</div>
            </div>
          `).join(''):`<div style="padding:24px;text-align:center;color:var(--tx3);font-size:13px;">Aucun avenant pour ce contrat</div>`}
        </div>
      </div>
    </div>
  `;
  document.getElementById('ctDOverlay').classList.add('on');
  document.getElementById('ctDrawer').classList.add('on');
}
function ctCd(){document.getElementById('ctDOverlay').classList.remove('on');document.getElementById('ctDrawer').classList.remove('on');}

// AVENANT
let ctAvenContratId=null,ctAvenType='';
function ctOpenQuickAven(id){ctAvenContratId=id;openAvenType(id,'prolong');}

function ctOpenAvenType(id,type){
  ctAvenContratId=id;ctAvenType=type;
  const c=ctContrats.find(x=>x.id===id);
  const titles={prolong:'🔄 Prolonger le contrat',horaires:'🕐 Modifier les horaires',lieu:'📍 Changer le lieu',taux:'💰 Modifier le taux horaire'};
  document.getElementById('ctAvenModalTitle').textContent=titles[type]||'📎 Nouvel avenant';

  let html=`<div style="display:flex;align-items:center;gap:12px;padding:14px 16px;background:var(--bg);border-radius:var(--rs);margin-bottom:20px;">
    <div style="width:38px;height:38px;border-radius:10px;background:${c.gr};display:flex;align-items:center;justify-content:center;color:#fff;font-weight:700;font-size:13px">${c.i}</div>
    <div><div style="font-weight:700">${c.nm}</div><div style="font-size:12px;color:var(--tx2)">${c.num} — ${c.cl}</div></div>
  </div>`;

  if(type==='prolong'){
    html+=`
      <div class="field"><div class="field-label">Date de fin actuelle</div><input class="field-input" value="${ctFmtDate(c.d2)}" disabled style="opacity:0.6"/></div>
      <div class="field"><div class="field-label">Nouvelle date de fin</div><input class="field-input" type="date" id="ctAvenVal" value="${c.d2.replace(/(\d{4})-(\d{2})-(\d{2})/,(m,y,mo,d)=>{const nd=new Date(y,mo-1,parseInt(d)+14);return nd.toISOString().split('T')[0];})}"/></div>
      <div class="field-hint">💡 L'avenant sera généré automatiquement avec la nouvelle date</div>`;
  } else if(type==='horaires'){
    html+=`
      <div class="field"><div class="field-label">Horaires actuels</div><input class="field-input" value="${c.h}" disabled style="opacity:0.6"/></div>
      <div class="field"><div class="field-label">Nouveaux horaires</div><input class="field-input" id="ctAvenVal" placeholder="Ex: 14h — 22h" value="14h — 22h"/></div>`;
  } else if(type==='lieu'){
    html+=`
      <div class="field"><div class="field-label">Lieu actuel</div><input class="field-input" value="${c.lieu}" disabled style="opacity:0.6"/></div>
      <div class="field"><div class="field-label">Nouveau lieu</div><input class="field-input" id="ctAvenVal" placeholder="Nouvelle adresse"/></div>`;
  } else if(type==='taux'){
    html+=`
      <div class="field"><div class="field-label">Taux horaire actuel</div><input class="field-input" value="${c.tx}" disabled style="opacity:0.6"/></div>
      <div class="field"><div class="field-label">Nouveau taux horaire</div><input class="field-input" id="ctAvenVal" placeholder="Ex: 13.50 €"/></div>`;
  }
  html+=`<div style="margin-top:16px;padding:10px 14px;background:var(--pkbg);border-radius:8px;font-size:11.5px;color:var(--pk);display:flex;align-items:center;gap:6px;">📎 L'avenant sera envoyé pour signature électronique au candidat</div>`;

  document.getElementById('ctAvenModalBody').innerHTML=html;
  document.getElementById('ctAvenantModal').classList.add('show');
}

function ctCloseAven(){document.getElementById('ctAvenantModal').classList.remove('show');}

function ctConfirmAven(){
  const c=ctContrats.find(x=>x.id===ctAvenContratId);
  const val=document.getElementById('ctAvenVal')?.value||'';
  const typeLabels={prolong:'Prolongation',horaires:'Horaires',lieu:'Lieu de mission',taux:'Taux horaire'};
  const details={
    prolong:'Fin repoussée au '+val,
    horaires:'Passage en '+val,
    lieu:'Transfert vers '+val,
    taux:'Nouveau taux : '+val
  };
  c.aven.push({num:c.aven.length+1,type:typeLabels[ctAvenType],detail:details[ctAvenType],date:'2026-02-11',st:'pending'});
  
  if(ctAvenType==='prolong'&&val){c.d2=val;}
  if(ctAvenType==='horaires'&&val){c.h=val;}
  if(ctAvenType==='lieu'&&val){c.lieu=val;}
  if(ctAvenType==='taux'&&val){c.tx=val;}

  closeAven();ctCd();render();
  showToast('📎 Avenant n°'+c.aven.length+' généré — '+typeLabels[ctAvenType]+' — envoyé pour signature');
}

// NEW CONTRACT
function ctOpenNewContrat(){document.getElementById('ctNewContratModal').classList.add('show');}
function ctCloseNewContrat(){document.getElementById('ctNewContratModal').classList.remove('show');}
function ctCreateContrat(){closeNewContrat();showToast('📝 Contrat généré et envoyé pour signature !');}

function ctToastIgnored(m){const t=document.getElementById('toast');t.textContent=m;t.classList.add('show');setTimeout(()=>t.classList.remove('show'),3500);}

ctRender();


// ===== MISSIONS PAGE JS =====
const msMissions=[
  {id:1,title:'Caristes CACES 3',client:'Carrefour Supply Chain',loc:'Saint-Priest',urg:'high',st:'open',postes:4,filled:2,matchs:12,dates:'10 fév. → 28 mars',ho:'2x8',sk:['CACES 3','Entrepôt','Visite méd.'],
    cands:[{nm:'Marc L.',i:'ML',gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)',st:'Confirmé',stc:'green-bg',stcc:'green'},{nm:'Thomas R.',i:'TR',gr:'linear-gradient(135deg,#00B894,#55E6A5)',st:'Confirmé',stc:'green-bg',stcc:'green'},{nm:'Karim B.',i:'KB',gr:'linear-gradient(135deg,#E74C3C,#FF7675)',st:'En attente',stc:'orange-bg',stcc:'orange'}]},
  {id:2,title:'Prépa. commandes',client:'Amazon FBA',loc:'Saint-Priest',urg:'high',st:'open',postes:6,filled:3,matchs:18,dates:'12 fév. → 15 avril',ho:'3x8',sk:['Prépa. commandes','Scan RF','Port de charges'],
    cands:[{nm:'Sarah D.',i:'SD',gr:'linear-gradient(135deg,#4A90D9,#74B9FF)',st:'Confirmé',stc:'green-bg',stcc:'green'},{nm:'Julie M.',i:'JM',gr:'linear-gradient(135deg,#A29BFE,#DDA0DD)',st:'Confirmé',stc:'green-bg',stcc:'green'},{nm:'Nadia K.',i:'NK',gr:'linear-gradient(135deg,#00B894,#81ECEC)',st:'Confirmé',stc:'green-bg',stcc:'green'}]},
  {id:3,title:'Agents de production',client:'Sanofi',loc:'Gerland',urg:'medium',st:'progress',postes:3,filled:2,matchs:8,dates:'17 fév. → 30 juin',ho:'3x8',sk:['Production','BPF','CACES 1'],
    cands:[{nm:'Amina D.',i:'AD',gr:'linear-gradient(135deg,#00B4D8,#81ECEC)',st:'Confirmé',stc:'green-bg',stcc:'green'},{nm:'Pierre B.',i:'PB',gr:'linear-gradient(135deg,#6C5CE7,#A29BFE)',st:'Contrat signé',stc:'accent-bg',stcc:'accent'}]},
  {id:4,title:'Cariste CACES 5 — Grande hauteur',client:'FM Logistic',loc:'Vénissieux',urg:'high',st:'urgent',postes:2,filled:0,matchs:5,dates:'14 fév. → 28 fév.',ho:'Journée',sk:['CACES 5','Grande hauteur','3 ans exp.'],cands:[]},
  {id:5,title:'Manutentionnaires',client:'Rhenus Logistics',loc:'Corbas',urg:'medium',st:'open',postes:5,filled:3,matchs:14,dates:'10 fév. → 31 mars',ho:'2x8',sk:['Manutention','Port charges','Visite méd.'],
    cands:[{nm:'Hugo M.',i:'HM',gr:'linear-gradient(135deg,#636e72,#b2bec3)',st:'En attente',stc:'orange-bg',stcc:'orange'}]},
  {id:6,title:'Préparateur commandes frais',client:'Carrefour Supply Chain',loc:'Décines',urg:'low',st:'progress',postes:2,filled:2,matchs:6,dates:'3 fév. → 28 fév.',ho:'Matin',sk:['Prépa. commandes','Froid','CACES 1'],
    cands:[{nm:'Emma L.',i:'EL',gr:'linear-gradient(135deg,#fd79a8,#e17055)',st:'Confirmé',stc:'green-bg',stcc:'green'},{nm:'Lucas F.',i:'LF',gr:'linear-gradient(135deg,#F39C12,#FDCB6E)',st:'Confirmé',stc:'green-bg',stcc:'green'}]},
  {id:7,title:'Cariste CACES 1',client:'Amazon FBA',loc:'Saint-Priest',urg:'low',st:'filled',postes:3,filled:3,matchs:9,dates:'3 fév. → 15 mars',ho:'3x8',sk:['CACES 1','Entrepôt'],
    cands:[{nm:'Omar S.',i:'OS',gr:'linear-gradient(135deg,#00cec9,#55efc4)',st:'En poste',stc:'green-bg',stcc:'green'},{nm:'Fatima E.',i:'FA',gr:'linear-gradient(135deg,#F39C12,#FDCB6E)',st:'En poste',stc:'green-bg',stcc:'green'},{nm:'Antoine G.',i:'AG',gr:'linear-gradient(135deg,#4A90D9,#74B9FF)',st:'En poste',stc:'green-bg',stcc:'green'}]},
  {id:8,title:'Agents logistiques polyvalents',client:'Rhenus Logistics',loc:'Corbas',urg:'medium',st:'open',postes:4,filled:1,matchs:11,dates:'17 fév. → 30 avril',ho:'2x8',sk:['Logistique','Polyvalent','Scan RF'],
    cands:[{nm:'Sophie M.',i:'SM',gr:'linear-gradient(135deg,#FD79A8,#FDCB6E)',st:'Proposé',stc:'blue-bg',stcc:'blue'}]},
];

const msStMap={open:{l:'Ouverte',c:'ms-st-open',e:'🟢'},progress:{l:'En cours',c:'ms-st-progress',e:'🔵'},urgent:{l:'Urgente',c:'ms-st-urgent',e:'🔥'},filled:{l:'Pourvue',c:'ms-st-filled',e:'✅'},done:{l:'Terminée',c:'ms-st-done',e:'—'}};
const msUrgMap={high:'ms-td-urgency high',medium:'ms-td-urgency medium',low:'ms-td-urgency low'};

let msFilter='all',msViewMode='table',msSearchQ='';

function msFiltered(){
  let l=[...msMissions];
  if(msFilter==='open')l=l.filter(m=>m.st==='open');
  else if(msFilter==='urgent')l=l.filter(m=>m.urg==='high'||m.st==='urgent');
  else if(msFilter==='progress')l=l.filter(m=>m.st==='progress');
  else if(msFilter==='filled')l=l.filter(m=>m.st==='filled');
  if(msSearchQ)l=l.filter(m=>m.title.toLowerCase().includes(msSearchQ)||m.client.toLowerCase().includes(msSearchQ)||m.loc.toLowerCase().includes(msSearchQ));
  return l;
}

function msRenderTable(){
  const l=msFiltered();
  document.getElementById('msTableBody').innerHTML=l.map((m,i)=>{
    const s=msStMap[m.st]||msStMap.open;
    const fillPct=m.postes?Math.round(m.filled/m.postes*100):0;
    const fillCol=fillPct>=100?'var(--green)':fillPct>=50?'var(--orange)':'var(--red)';
    return`<tr onclick="msOpenDrawer(${m.id})" style="animation:fadeUp 0.3s ease backwards;animation-delay:${i*0.03}s">
      <td><div class="ms-td-mission"><div class="${msUrgMap[m.urg]}"></div><div class="ms-td-m-info"><div class="ms-td-m-title">${m.title}</div><div class="ms-td-m-client">${m.client}</div></div></div></td>
      <td><div class="ms-td-status ${s.c}">${s.e} ${s.l}</div></td>
      <td><span style="font-family:'Space Mono',monospace;font-weight:700;color:${fillCol}">${m.filled}/${m.postes}</span></td>
      <td><div class="ms-td-avatars">${m.cands.slice(0,3).map(c=>`<div style="background:${c.gr}">${c.i}</div>`).join('')}${m.cands.length>3?`<div class="ms-td-plus">+${m.cands.length-3}</div>`:m.cands.length===0?'<span style="font-size:12px;color:var(--text-tertiary)">—</span>':''}</div></td>
      <td><div class="ms-td-match"><div class="ms-match-num" style="color:var(--accent)">${m.matchs}</div><div class="ms-match-bar"><div class="ms-match-fill" style="width:${Math.min(m.matchs*5,100)}%;background:linear-gradient(90deg,var(--accent),var(--accent-light))"></div></div></div></td>
      <td><div class="ms-td-dates">📅 ${m.dates}</div></td>
      <td><div class="ms-td-loc">📍 ${m.loc}</div></td>
      <td><div class="td-actions" onclick="event.stopPropagation()">
        <div class="ms-act-btn" title="Voir détails" onclick="msOpenDrawer(${m.id})">📋</div>
        <div class="ms-act-btn" title="Lancer matching" onclick="showToast('🎯 Matching IA lancé pour ${m.title}')">🎯</div>
        <div class="ms-act-btn" title="Relancer candidats" onclick="showToast('📱 Relance envoyée')">📱</div>
      </div></td>
    </tr>`;
  }).join('');
}

function msRenderKanban(){
  const cols=[
    {key:'urgent',title:'🔥 Urgentes',filter:m=>m.st==='urgent'||m.urg==='high'},
    {key:'open',title:'🟢 Ouvertes',filter:m=>m.st==='open'&&m.urg!=='high'},
    {key:'progress',title:'🔵 En cours',filter:m=>m.st==='progress'},
    {key:'filled',title:'✅ Pourvues',filter:m=>m.st==='filled'},
  ];
  const all=msFiltered();
  document.getElementById('msKanbanView').innerHTML=cols.map(col=>{
    const items=all.filter(col.filter);
    return`<div class="ms-kb-col">
      <div class="ms-kb-col-h"><div class="ms-kb-col-title">${col.title}</div><div class="ms-kb-col-count">${items.length}</div></div>
      <div class="ms-kb-col-body">${items.map((m,i)=>{
        return`<div class="ms-kb-card" style="animation-delay:${i*0.04}s" onclick="msOpenDrawer(${m.id})">
          <div class="ms-kb-top"><div class="ms-kb-urg" style="background:${m.urg==='high'?'var(--red)':m.urg==='medium'?'var(--orange)':'var(--green)'}"></div><div class="ms-kb-title">${m.title}</div></div>
          <div class="ms-kb-client">🏢 ${m.client}</div>
          <div class="ms-kb-meta">
            <div class="ms-kb-meta-i">📍 ${m.loc}</div>
            <div class="ms-kb-meta-i">👥 ${m.filled}/${m.postes} pourvus</div>
            <div class="ms-kb-meta-i">📅 ${m.dates.split(' → ')[0]}</div>
          </div>
          <div class="ms-kb-footer">
            <div class="ms-kb-avatars">${m.cands.slice(0,4).map(c=>`<div style="background:${c.gr}">${c.i}</div>`).join('')}${m.cands.length===0?'<span style="font-size:11px;color:var(--text-tertiary)">Aucun candidat</span>':''}</div>
            <div class="ms-kb-match">🎯 ${m.matchs} matchs</div>
          </div>
        </div>`;
      }).join('')}</div>
    </div>`;
  }).join('');
}

function msRender(){msRenderTable();msRenderKanban();}

function msSetFilter(el){msFilter=el.dataset.msf;document.querySelectorAll('.ms-pill[data-msf]').forEach(p=>p.classList.remove('on'));el.classList.add('on');msRender();}
function msDoFilter(){msSearchQ=document.getElementById('msSearchInput').value.toLowerCase().trim();msRender();}
function msFilterByKpi(status){
  msFilter=status;
  document.querySelectorAll('.ms-pill[data-msf]').forEach(p=>p.classList.toggle('on',p.dataset.msf===status));
  msRender();
  document.querySelector('.ms-table-card')?.scrollIntoView({behavior:'smooth',block:'nearest'});
}
function msSetView(v){
  msViewMode=v;
  document.getElementById('msVTable').classList.toggle('on',v==='table');
  document.getElementById('msVKanban').classList.toggle('on',v==='kanban');
  document.getElementById('msTableView').classList.toggle('off',v==='kanban');
  document.getElementById('msKanbanView').classList.toggle('on',v==='kanban');
}

function msOpenDrawer(id){
  const m=msMissions.find(x=>x.id===id);if(!m)return;
  const s=msStMap[m.st]||msStMap.open;
  const fillPct=m.postes?Math.round(m.filled/m.postes*100):0;
  document.getElementById('msDrawerContent').innerHTML=`
    <div class="ms-dw-body">
      <div class="ms-dw-m-header">
        <div class="ms-dw-m-title"><div class="${msUrgMap[m.urg]}" style="width:12px;height:12px"></div>${m.title}</div>
        <div class="ms-dw-m-client">🏢 ${m.client} · 📍 ${m.loc}</div>
        <div class="ms-dw-m-status"><span class="ms-td-status ${s.c}" style="font-size:12px">${s.e} ${s.l}</span></div>
      </div>
      <div class="ms-dw-quick">
        <button class="ms-dw-qbtn primary" onclick="showToast('🎯 Matching IA lancé')">🎯 Matching IA</button>
        <button class="ms-dw-qbtn" onclick="showToast('📱 Relance envoyée')">📱 Relancer</button>
        <button class="ms-dw-qbtn" onclick="showToast('👁 Envoyé au portail')">👁 Portail</button>
      </div>
      <div class="ms-dw-sec"><div class="ms-dw-sec-t">Détails de la mission</div>
        <div class="ms-dw-grid">
          <div class="ms-dw-it"><div class="ms-dw-it-l">Postes</div><div class="ms-dw-it-v" style="color:${fillPct>=100?'var(--green)':'var(--orange)'}">${m.filled} / ${m.postes} pourvus</div></div>
          <div class="ms-dw-it"><div class="ms-dw-it-l">Matchings IA</div><div class="ms-dw-it-v" style="color:var(--accent)">${m.matchs} candidats</div></div>
          <div class="ms-dw-it"><div class="ms-dw-it-l">Dates</div><div class="ms-dw-it-v">${m.dates}</div></div>
          <div class="ms-dw-it"><div class="ms-dw-it-l">Horaires</div><div class="ms-dw-it-v">${m.ho}</div></div>
          <div class="ms-dw-it"><div class="ms-dw-it-l">Localisation</div><div class="ms-dw-it-v">${m.loc}</div></div>
          <div class="ms-dw-it"><div class="ms-dw-it-l">Urgence</div><div class="ms-dw-it-v" style="color:${m.urg==='high'?'var(--red)':m.urg==='medium'?'var(--orange)':'var(--green)'}">${m.urg==='high'?'🔴 Critique':m.urg==='medium'?'🟠 Moyen':'🟢 Normal'}</div></div>
        </div>
      </div>
      <div class="ms-dw-sec"><div class="ms-dw-sec-t">Compétences requises</div>
        <div class="ms-dw-chips">${m.sk.map(s=>`<div class="ms-tag">${s}</div>`).join('')}</div>
      </div>
      <div class="ms-dw-sec"><div class="ms-dw-sec-t">Candidats affectés (${m.cands.length})</div>
        ${m.cands.length?m.cands.map(c=>`<div class="ms-dw-cand">
          <div class="ms-dw-cand-av" style="background:${c.gr}">${c.i}</div>
          <div class="ms-dw-cand-info"><div class="ms-dw-cand-nm">${c.nm}</div><div class="ms-dw-cand-rl">${c.st}</div></div>
          <div class="ms-dw-cand-status" style="background:var(--${c.stc});color:var(--${c.stcc})">${c.st}</div>
        </div>`).join(''):'<div style="padding:20px;text-align:center;color:var(--text-tertiary);font-size:13px;">Aucun candidat affecté — <span style="color:var(--accent);cursor:pointer;font-weight:600" onclick="showToast(\'🎯 Matching IA lancé\')">Lancer le matching IA</span></div>'}
      </div>
    </div>`;
  document.getElementById('msDOverlay').classList.add('on');
  document.getElementById('msDrawer').classList.add('on');
}
function msCloseDrawer(){document.getElementById('msDOverlay').classList.remove('on');document.getElementById('msDrawer').classList.remove('on');}

function msOpenModal(){document.getElementById('msNewModal').classList.add('show');}
function msCloseModal(){document.getElementById('msNewModal').classList.remove('show');}
function msPickUrg(el,v){
  document.querySelectorAll('.ms-urg-pill').forEach(p=>{p.classList.remove('on','high','med','low');});
  el.classList.add('on',v);
}
function msCreateMission(){
  const title=document.getElementById('msMTitle').value.trim()||'Nouvelle mission';
  msCloseModal();
  showToast('🚀 Mission "'+title+'" créée — Matching IA en cours...');
}

msRender();

</script>

</body>
</html>
